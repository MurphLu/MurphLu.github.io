<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <title>
        
        TCP连接三次握手四次挥手
        
    </title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.css"/>
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/swift.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/ruby.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/bash.min.js"></script>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <link rel="stylesheet" href="/css/index.css">
    <script src="/js/md5.js"></script>

    <link href="//at.alicdn.com/t/font_751236_90n6bpjkuko.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
        $(document).ready(function() {
            $('pre code').each(function(i, block) {
                hljs.highlightBlock(block);
            });
        });
    </script>
</head>
<body>
    <div class="container">
        <div class="container">
            <div class="navbar navbar-expand-sm navbar-light">
    <a class="navbar-brand" href="#">
        <img src="/img/ava.jpg" width="30" height="30" alt="">
    </a>
    <button class="navbar-toggler btn-sm border-0" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a href="/" class=" nav-link ">
                    Home
                </a>
            </li>
            <li class="nav-item">
                <a href="/archives" class=" nav-link ">
                    Archives
                </a>
            </li>
            <li class="nav-item">
                <a href="/about/" class=" nav-link ">
                    about
                </a>
            </li>
        </ul>
    </div>
</div>
        </div>
        <hr />
        <div class="container">
            <div class="container">
    <div>
        <h5>
            TCP连接三次握手四次挥手
        </h5>
    </div>
    <div class="postHeaderFontTime">
        <span>2016-10-20 23:27:00</span>
        <span>&nbsp&nbsp&nbsp</span>
        
        <span><span class="iconfont icon-tags"></span>
            
            <a class="text-secondary" href="/tags/Network/" title="Network">Network</a>
            
            <a class="text-secondary" href="/tags/TCP/" title="TCP">TCP</a>
            
            
        </span>

        <span>&nbsp&nbsp&nbsp</span>
        <span class="iconfont icon-read"></span> <span class="text-secondary" id="busuanzi_value_page_pv"></span>
    </div>
    <hr />
    <div class="post-content ">
        <div class="markdown-body">
            <h3 id="建立连接协议（三次握手）"><a href="#建立连接协议（三次握手）" class="headerlink" title="建立连接协议（三次握手）"></a>建立连接协议（三次握手）</h3><blockquote>
<p>（1）客户端发送一个带SYN标志的TCP报文到服务器。这是三次握手过程中的报文1。<br>（2） 服务器端回应客户端的，这是三次握手中的第2个报文，这个报文同时带ACK标志和SYN标志。因此它表示对刚才客户端SYN报文的回应；同时又标志SYN给客户端，询问客户端是否准备好进行数据通讯。<br>（3） 客户必须再次回应服务段一个ACK报文，这是报文段3。  </p>
</blockquote>
<p>　</p>
<h3 id="连接终止协议（四次挥手）"><a href="#连接终止协议（四次挥手）" class="headerlink" title="连接终止协议（四次挥手）"></a>连接终止协议（四次挥手）</h3><p>　　由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。    </p>
<blockquote>
<p>（1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送（报文段4)<br>（2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1（报文段5）。和SYN一样，一个FIN将占用一个序号<br>（3） 服务器关闭客户端的连接，发送一个FIN给客户端（报文段6）<br>（4） 客户段发回ACK报文确认，并将确认序号设置为收到序号加1（报文段7）  
　　</p>
</blockquote>
<h3 id="连接状态"><a href="#连接状态" class="headerlink" title="连接状态"></a>连接状态</h3><p><code>CLOSED</code>:这个没什么好说的了，表示初始状态。　　</p>
<p><code>LISTEN</code>:这个也是非常容易理解的一个状态，表示服务器端的某个SOCKET处于监听状态，可以接受连接了。　　 </p>
<p><code>SYN_RCVD</code>:这个状态表示接受到了SYN报文，在正常情况下，这个状态是服务器端的SOCKET在建立TCP连接时的三次握手会话过程中的一个中间状态，很短暂，基本上用netstat你是很难看到这种状态的，除非你特意写了一个客户端测试程序，故意将三次TCP握手过程中最后一个ACK报文不予发送。因此这种状态时，当收到客户端的ACK报文后，它会进入到ESTABLISHED状态。　　</p>
<p><code>SYN_SENT</code>:这个状态与SYN_RCVD遥想呼应，当客户端SOCKET执行CONNECT连接时，它首先发送SYN报文，因此也随即它会进入到了SYN_SENT状态，并等待服务端的发送三次握手中的第2个报文。SYN_SENT状态表示客户端已发送SYN报文。　　</p>
<p><code>ESTABLISHED</code>：这个容易理解了，表示连接已经建立了.<br><code>FIN_WAIT_1</code>:这个状态要好好解释一下，其实FIN_WAIT_1和FIN_WAIT_2状态的真正含义都是表示等待对方的FIN报文。而这两种状态的区别是：FIN_WAIT_1状态实际上是当SOCKET在ESTABLISHED状态时，它想主动关闭连接，向对方发送了FIN报文，此时该SOCKET即进入到FIN_WAIT_1状态。而当对方回应ACK报文后，则进入到FIN_WAIT_2状态，当然在实际的正常情况下，无论对方何种情况下，都应该马上回应ACK报文，所以FIN_WAIT_1状态一般是比较难见到的，而FIN_WAIT_2状态还有时常常可以用netstat看到。 </p>
<p><code>FIN_WAIT_2</code>：<br>上面已经详细解释了这种状态，实际上FIN_WAIT_2状态下的SOCKET，表示半连接，也即有一方要求close连接，但另外还告诉对方，我暂时还有点数据需要传送给你，稍后再关闭连接。　　</p>
<p><code>TIME_WAIT</code>:表示收到了对方的FIN报文，并发送出了ACK报文，就等2MSL后即可回到CLOSED可用状态了。如果FIN_WAIT_1状态下，收到了对方同时带FIN标志和ACK标志的报文时，可以直接进入到TIME_WAIT状态，而无须经过FIN_WAIT_2状态。　　  </p>
<p><code>CLOSING</code>:这种状态比较特殊，实际情况中应该是很少见，属于一种比较罕见的例外状态。正常情况下，当你发送FIN报文后，按理来说是应该先收到（或同时收到）对方的ACK报文，再收到对方的FIN报文。但是CLOSING状态表示你发送FIN报文后，并没有收到对方的ACK报文，反而却也收到了对方的FIN报文。什么情况下会出现此种情况呢？其实细想一下，也不难得出结论：那就是如果双方几乎在同时close一个SOCKET的话，那么就出现了双方同时发送FIN报文的情况，也即会出现CLOSING状态，表示双方都正在关闭SOCKET连接。<br>　　<br><code>CLOSE_WAIT</code>:<br>这种状态的含义其实是表示在等待关闭。怎么理解呢？当对方close一个SOCKET后发送FIN报文给自己，你系统毫无疑问地会回应一个ACK报文给对方，此时则进入到CLOSE_WAIT状态。接下来呢，实际上你真正需要考虑的事情是察看你是否还有数据发送给对方，如果没有的话，那么你也就可以close这个SOCKET，发送FIN报文给对方，也即关闭连接。所以你在CLOSE_WAIT状态下，需要完成的事情是等待你去关闭连接。　　  </p>
<p><code>LAST_ACK</code>:这个状态还是比较容易好理解的，它是被动关闭一方在发送FIN报文后，最后等待对方的ACK报文</p>

        </div>
        <hr />
        <div class="col-12">
            <div style="text-align: center">
            <div class="btn-group" role="group" aria-label="Basic example">
                
                <a class="btn btn-outline-info" href="/2016/10/21/关于NSTimer与ScrollView冲突问题的解决/">上一篇</a>
                
                
                <a class="btn btn-outline-info" href="/2016/08/05/Mac-OS-X-11中修改-usr-bin文件-“Operation-not-permitted”问题/">下一篇</a>
                
            </div>
            </div>

        </div>
        <div id="comment-container">
        </div>
    </div>
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            id: md5(TCP连接三次握手四次挥手), // 可选。默认为 location.href
            owner: 'MurphLu',
            repo: 'murphlu.github.io',
            oauth: {
                client_id: '01c3bc760286123e1272',
                client_secret: '5c33b24d431b6a6193d31eff81f2d0ed3c15bdcb',
            },
        })
        gitment.render('comment-container')
    </script>
</div>
        </div>
        <div class="container">
            <div class="container">
    <hr />
    <p class="text-center">
        
        <a class="text-dark" target="_blank" href="https://github.com/MurphLu">
            <i class="iconfont icon-github"></i>
        </a>
        
        
        <a class="text-dark" target="_blank" href="https://www.zhihu.com/people/jy-lu-59">
            <i class="iconfont icon-zhihu"></i>
        </a>
        
        
        <a class="text-dark" target="_blank" href="https://weibo.com/HiGodl">
            <i class="iconfont icon-sina"></i>
        </a>
        

        
        <a class="text-dark" target="_blank" href="https://www.facebook.com/lijiyang.jyLu">
            <i class="iconfont icon-facebook"></i>
        </a>
        

        
        <a class="text-dark" target="_blank" href="https://mobile.twitter.com/jy_LuS">
            <i class="iconfont icon-twitter"></i>
        </a>
        

        
        <a class="text-dark" target="_blank" href="https://www.instagram.com/jiy_lulu">
            <i class="iconfont icon-instagram"></i>
        </a>
        

        
        <a class="text-dark" target="_blank" href="https://www.linkedin.com/in/继扬-陆-869a17124">
            <i class="iconfont icon-linkedin"></i>
        </a>
        

        <!---->

        

        

    </p>
    <p class="text-center text-muted footerFont">

        © 2018 - 2019 Murph Lu | Powered by <a class="text-info" href="https://hexo.io">Hexo</a> |
        <span id="busuanzi_container_site_uv">
            visitor <span id="busuanzi_value_site_uv"></span>
        </span>
    </p>
</div>
        </div>
    </div>
</body>

</html>
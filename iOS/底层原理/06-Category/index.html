
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://murphlu.github.io/iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/06-Category/">
      
      
        <link rel="prev" href="../05-KVC/">
      
      
        <link rel="next" href="../07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>06 Category - Murph's NoteBook</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../javascripts/highlight.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#category" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Murph&#39;s NoteBook" class="md-header__button md-logo" aria-label="Murph's NoteBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Murph's NoteBook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              06 Category
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/MurphLu/MurphLu.github.io.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Murph's NoteBook
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Welcome to MkDocs

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Java/Java%E5%9F%BA%E7%A1%80/init/" class="md-tabs__link">
          
  
  Java

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/" class="md-tabs__link">
          
  
  Web

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../daily/2023-11-16/" class="md-tabs__link">
          
  
  Daily

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/" class="md-tabs__link">
          
  
  iOS

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../macOS%20Related/setup_new_device/" class="md-tabs__link">
          
  
  macOS Related

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/" class="md-tabs__link">
          
  
  杂

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Murph&#39;s NoteBook" class="md-nav__button md-logo" aria-label="Murph's NoteBook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Murph's NoteBook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/MurphLu/MurphLu.github.io.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Murph's NoteBook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to MkDocs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java基础
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Java基础
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Java/Java%E5%9F%BA%E7%A1%80/init/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Init
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spring
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Spring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Java/Spring/init/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Init
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vue
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Vue
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1_1" id="__nav_3_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vue Up And Run
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            Vue Up And Run
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 1. Vue 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 2. Vue.js 组件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 3. 使用 Vue 添加样式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 4. render 函数和 JSX
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 5. 使用 Vue-router 实现客户端路由
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 6 使用 vuex实现状态管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 7. Vuex 进阶
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Daily
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Daily
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../daily/2023-11-16/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 11 16
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    iOS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            iOS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    底层原理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            底层原理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 OC 对象的本质
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 类对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-isa%E3%80%81class%E3%80%81superClass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 isa、class、superClass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-KVO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    04 KVO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-KVC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 KVC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    06 Category
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    06 Category
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#category" class="md-nav__link">
    <span class="md-ellipsis">
      Category
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Category">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    <span class="md-ellipsis">
      类和分类中的 load 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize" class="md-nav__link">
    <span class="md-ellipsis">
      类和分类中的 +initialize 方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    07 关联对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-block/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    08 block
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    09 runtime
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-runloop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 runloop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 多线程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 内存管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 优化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../14-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 应用程序加载
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../InterviewQuestions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InterviewQuestions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../WWDC2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WWDC2020
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    macOS Related
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            macOS Related
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../macOS%20Related/setup_new_device/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup new device
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    杂
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            杂
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ffmpeg删除视频中的音频流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    postgreSQL配置远程访问
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%9D%82/shell%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%96%87%E4%BB%B6%E5%B9%B6%E9%87%8D%E5%91%BD%E5%90%8D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shell遍历文件夹中文件并重命名
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%9D%82/%E4%BD%BF%E7%94%A8%20rmagick%20%E4%BB%8E%20pdf%20%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用 rmagick 从 pdf 导出图片模糊的问题
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#category" class="md-nav__link">
    <span class="md-ellipsis">
      Category
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Category">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#load" class="md-nav__link">
    <span class="md-ellipsis">
      类和分类中的 load 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize" class="md-nav__link">
    <span class="md-ellipsis">
      类和分类中的 +initialize 方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>06 Category</h1>

<h2 id="category">Category</h2>
<p>通过 runtime 动态将 Category 方法合并到类对象/元类对象中</p>
<p>分类的底层结构</p>
<pre><code class="language-C++">struct _category_t {
    const char *name; // 类名
    struct _class_t *cls; // 类
    const struct _method_list_t *instance_methods; // 实例方法
    const struct _method_list_t *class_methods; // 类方法
    const struct _protocol_list_t *protocols; // 协议
    const struct _prop_list_t *properties; // 属性
};
</code></pre>
<p>编译完之后，分类的信息全部存放在 <code>_category_t</code> 结构中，而不是合并到对应的类中</p>
<p>比如下面的分类：</p>
<pre><code class="language-Objective-C">#import &quot;Person.h&quot;

NS_ASSUME_NONNULL_BEGIN
@protocol P
-(void)smile;
@end

@interface Person (Action) &lt;P&gt;
@property (nonatomic, assign) int a;

-(void) run;
@end

NS_ASSUME_NONNULL_END

#import &quot;Person+Action.h&quot;
@implementation Person (Action)
@dynamic a;

-(void) run {
    NSLog(@&quot;running.....&quot;);
}
-(void) eat {
    NSLog(@&quot;eating.....&quot;);
}
+(void)sleep {
    NSLog(@&quot;sleepping.....&quot;);
}

- (void)smile {
    NSLog(@&quot;ha&quot;);
}

@end
</code></pre>
<p>编译成 C++ 代码之后为</p>
<pre><code class="language-C++">static struct _category_t _OBJC_$_CATEGORY_Person_$_Action __attribute__ ((used, section (&quot;__DATA,__objc_const&quot;))) = 
{
    &quot;Person&quot;,
    0, // &amp;OBJC_CLASS_$_Person,
    (const struct _method_list_t *)&amp;_OBJC_$_CATEGORY_INSTANCE_METHODS_Person_$_Action,
    (const struct _method_list_t *)&amp;_OBJC_$_CATEGORY_CLASS_METHODS_Person_$_Action,
    (const struct _protocol_list_t *)&amp;_OBJC_CATEGORY_PROTOCOLS_$_Person_$_Action,
    (const struct _prop_list_t *)&amp;_OBJC_$_PROP_LIST_Person_$_Action,
};
</code></pre>
<p>分类在 runtime 中的加载</p>
<ul>
<li>objc-os.mm</li>
</ul>
<pre><code class="language-C++">/***********************************************************************
* _objc_init
* Bootstrap initialization. Registers our image notifier with dyld.
* Called by libSystem BEFORE library initialization time
**********************************************************************/
void _objc_init(void)
{
    ...
    // 省略其他内容，来看我们需要的一个方法，该方法调用了 dyld 库中的方法来注册回调
    _dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);
    ...
}
</code></pre>
<p>dyld 库中的实现</p>
<pre><code class="language-C++">// dyld/dyld_priv.h
//
// Note: only for use by objc runtime
// Register handlers to be called when objc images are mapped, unmapped, and initialized.
// Dyld will call back the &quot;mapped&quot; function with an array of images that contain an objc-image-info section.
// Those images that are dylibs will have the ref-counts automatically bumped, so objc will no longer need to
// call dlopen() on them to keep them from being unloaded.  During the call to _dyld_objc_notify_register(),
// dyld will call the &quot;mapped&quot; function with already loaded objc images.  During any later dlopen() call,
// dyld will also call the &quot;mapped&quot; function.  Dyld will call the &quot;init&quot; function when dyld would be called
// initializers in that image.  This is when objc calls any +load methods in that image.
//
void _dyld_objc_notify_register(_dyld_objc_notify_mapped    mapped,
                                _dyld_objc_notify_init      init,
                                _dyld_objc_notify_unmapped  unmapped);

// dyld/APIs.cpp
void _dyld_objc_notify_register(_dyld_objc_notify_mapped    mapped,
                                _dyld_objc_notify_init      init,
                                _dyld_objc_notify_unmapped  unmapped)
{
    log_apis(&quot;_dyld_objc_notify_register(%p, %p, %p)\n&quot;, mapped, init, unmapped);

    gAllImages.setObjCNotifiers(mapped, init, unmapped);
}
</code></pre>
<p>During the call to _dyld_objc_notify_register(), dyld will call the "mapped" function with already loaded objc images.  During any later dlopen() call, dyld will also call the "mapped" function.  Dyld will call the "init" function when dyld would be called initializers in that image.  This is when objc calls any +load methods in that image.</p>
<p>大概意思就是当调用 _dyld_objc_notify_register() 方法时，会调用 <code>mapped</code> 方法，并将已经加载的 objc 镜像传入，然后之后再次调用 dlopen 方法时 dyld 会再次调用 mapped 方法并将新加载的镜像传入</p>
<p>我们看一下  <code>gAllImages.setObjCNotifiers</code> 的实现</p>
<pre><code class="language-C++">void AllImages::setObjCNotifiers(_dyld_objc_notify_mapped map, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmap)
{
    // 先将三个回调赋值给 AllImages 的成员，供后续调用
    _objcNotifyMapped   = map;
    _objcNotifyInit     = init;
    _objcNotifyUnmapped = unmap;

    ...
    // 省略调中间部分，我们只看 map 调用的部分
    // callback about already loaded images
    uint32_t maxCount = count();
    STACK_ALLOC_ARRAY(const mach_header*, mhs,   maxCount);
    STACK_ALLOC_ARRAY(const char*,        paths, maxCount);
    // don't need _mutex here because this is called when process is still single threaded
    // 遍历已经加载的镜像，并查看是否有 objc 镜像，如果有，就添加到数组中
    for (const LoadedImage&amp; li : _loadedImages) {
        if ( li.image()-&gt;hasObjC() ) {
            paths.push_back(imagePath(li.image()));
            mhs.push_back(li.loadedAddress());
        }
    }
    // 如果有加载好的 objc 镜像，那么就调用 map
    if ( !mhs.empty() ) {
        (*map)((uint32_t)mhs.count(), &amp;paths[0], &amp;mhs[0]);
        if ( log_notifications(&quot;dyld: objc-mapped-notifier called with %ld images:\n&quot;, mhs.count()) ) {
            for (uintptr_t i=0; i &lt; mhs.count(); ++i) {
                log_notifications(&quot;dyld:  objc-mapped: %p %s\n&quot;,  mhs[i], paths[i]);
            }
        }
    }
}
</code></pre>
<p>然后再看下 dlopen()</p>
<pre><code class="language-C++">const MachOLoaded* AllImages::dlopen(Diagnostics&amp; diag, const char* path, bool rtldNoLoad, bool rtldLocal,
                                     bool rtldNoDelete, bool rtldNow, bool fromOFI, const void* callerAddress,
                                     bool canUsePrebuiltSharedCacheClosure)
{

    ...
    // 前边代码忽略，我们直接看最后返回了 loadImage
    return loadImage(diag, path, topImageNum, newClosure, rtldLocal, rtldNoDelete, rtldNow, fromOFI, callerAddress);
}

// dlopen method
__attribute__((noinline))
const MachOLoaded* AllImages::loadImage(Diagnostics&amp; diag, const char* path,
                                        closure::ImageNum topImageNum, const closure::DlopenClosure* newClosure,
                                        bool rtldLocal, bool rtldNoDelete, bool rtldNow, bool fromOFI,
                                        const void* callerAddress) {
    ...

    // tell gAllImages about new images
    addImages(newImages);

    // Run notifiers before applyInterposingToDyldCache() as then we have an
    // accurate image list before any calls to findImage().
    // TODO: Can we move this even earlier, eg, after map images but before fixups?
    runImageNotifiers(newImages);

    // if closure adds images that override dyld cache, patch cache
    if ( newClosure != nullptr )
        applyInterposingToDyldCache(newClosure, mach_task_self());

    // 该方法会调用 镜像加载的回调，我们继续看
    runImageCallbacks(newImages);

    // run initializers
    runInitialzersBottomUp(topImage);

    return topLoadAddress;
}

void AllImages::runImageCallbacks(const Array&lt;LoadedImage&gt;&amp; newImages)
{
    // 去掉无用的代码，我们看到这里的实现同 setObjCNotifiers 中最后对 map 调用的过程基本相同
    // call objc about images that use objc
    if ( _objcNotifyMapped != nullptr ) {
        const char*         pathsBuffer[count];
        const mach_header*  mhBuffer[count];
        uint32_t            imagesWithObjC = 0;
        for (const LoadedImage&amp; li : newImages) {
            const closure::Image* image = li.image();
            if ( image-&gt;hasObjC() ) {
                pathsBuffer[imagesWithObjC] = imagePath(image);
                mhBuffer[imagesWithObjC]    = li.loadedAddress();
               ++imagesWithObjC;
            }
        }
        if ( imagesWithObjC != 0 ) {
            dyld3::ScopedTimer timer(DBG_DYLD_TIMING_OBJC_MAP, 0, 0, 0);
            (*_objcNotifyMapped)(imagesWithObjC, pathsBuffer, mhBuffer);
            if ( log_notifications(&quot;dyld: objc-mapped-notifier called with %d images:\n&quot;, imagesWithObjC) ) {
                for (uint32_t i=0; i &lt; imagesWithObjC; ++i) {
                    log_notifications(&quot;dyld:  objc-mapped: %p %s\n&quot;,  mhBuffer[i], pathsBuffer[i]);
                }
            }
        }
    }
}

</code></pre>
<p>好了，看完了 dyld 中的调用过程，我们继续回到 objc 代码中查看 mapImages 的实现</p>
<p>Code in objc</p>
<pre><code class="language-C++">// objc-runtime-new.mm
void
map_images(unsigned count, const char * const paths[],
           const struct mach_header * const mhdrs[])
{
    mutex_locker_t lock(runtimeLock);
    return map_images_nolock(count, paths, mhdrs);
}

// objc-os.mm
void 
map_images_nolock(unsigned mhCount, const char * const mhPaths[],
                  const struct mach_header * const mhdrs[])
{
    static bool firstTime = YES;
    header_info *hList[mhCount];
    uint32_t hCount;
    size_t selrefCount = 0;

    // 略过前面的代码，我们直接看 这里调用了 _read_images
    if (hCount &gt; 0) {
        _read_images(hList, hCount, totalClasses, unoptimizedTotalClasses);
    }

    firstTime = NO;

    // Call image load funcs after everything is set up.
    for (auto func : loadImageFuncs) {
        for (uint32_t i = 0; i &lt; mhCount; i++) {
            func(mhdrs[i]);
        }
    }
}

// objc-runtime-new.mm
// 通过方法中剩下的注释我么可以看到 _read_images 中所作的事情，我们只保留 Discover categories 这部分代码，然后继续往下看
void _read_images(header_info **hList, uint32_t hCount, int totalClasses, int unoptimizedTotalClasses)
{
    header_info *hi;
    uint32_t hIndex;
    size_t count;
    size_t i;
    Class *resolvedFutureClasses = nil;
    size_t resolvedFutureClassCount = 0;
    static bool doneOnce;
    bool launchTime = NO;
    TimeLogger ts(PrintImageTimes);

    runtimeLock.assertLocked();

#define EACH_HEADER \
    hIndex = 0;         \
    hIndex &lt; hCount &amp;&amp; (hi = hList[hIndex]); \
    hIndex++

    if (!doneOnce) {
        doneOnce = YES;
        launchTime = YES;

        ts.log(&quot;IMAGE TIMES: first time tasks&quot;);
    }

    // Fix up @selector references

    ts.log(&quot;IMAGE TIMES: fix up selector references&quot;);

    // Discover classes. Fix up unresolved future classes. Mark bundle classes.
    ts.log(&quot;IMAGE TIMES: discover classes&quot;);

    // Fix up remapped classes
    // Class list and nonlazy class list remain unremapped.
    // Class refs and super refs are remapped for message dispatching.

    ts.log(&quot;IMAGE TIMES: remap classes&quot;);

#if SUPPORT_FIXUP
    // Fix up old objc_msgSend_fixup call sites
    ts.log(&quot;IMAGE TIMES: fix up objc_msgSend_fixup&quot;);
#endif


    // Discover protocols. Fix up protocol refs.
    ts.log(&quot;IMAGE TIMES: discover protocols&quot;);

    // Fix up @protocol references
    // Preoptimized images may have the right 
    // answer already but we don't know for sure.
    ts.log(&quot;IMAGE TIMES: fix up @protocol references&quot;);

    // Discover categories. Only do this after the initial category
    // attachment has been done. For categories present at startup,
    // discovery is deferred until the first load_images call after
    // the call to _dyld_objc_notify_register completes. rdar://problem/53119145
    if (didInitialAttachCategories) {
        for (EACH_HEADER) {
            load_categories_nolock(hi);
        }
    }
    ts.log(&quot;IMAGE TIMES: discover categories&quot;);

    // Category discovery MUST BE Late to avoid potential races
    // when other threads call the new category code before
    // this thread finishes its fixups.

    // +load handled by prepare_load_methods()

    // Realize non-lazy classes (for +load methods and static instances)

    ts.log(&quot;IMAGE TIMES: realize non-lazy classes&quot;);

    // Realize newly-resolved future classes, in case CF manipulates them

    ts.log(&quot;IMAGE TIMES: realize future classes&quot;);


    // Print preoptimization statistics
#undef EACH_HEADER
}

// objc-runtime-new.mm
static void load_categories_nolock(header_info *hi) {
    bool hasClassProperties = hi-&gt;info()-&gt;hasCategoryClassProperties();

    size_t count;
    // 定义方法，接收 Category 列表，在 load_categories_nolock 最后调用了该方法并传入 header_info 中包含的 Category
    auto processCatlist = [&amp;](category_t * const *catlist) {
        for (unsigned i = 0; i &lt; count; i++) {
            category_t *cat = catlist[i];
            Class cls = remapClass(cat-&gt;cls);
            locstamped_category_t lc{cat, hi};

            if (!cls) {
                // Category's target class is missing (probably weak-linked).
                // Ignore the category.
                if (PrintConnecting) {
                    _objc_inform(&quot;CLASS: IGNORING category \?\?\?(%s) %p with &quot;
                                 &quot;missing weak-linked target class&quot;,
                                 cat-&gt;name, cat);
                }
                continue;
            }

            // Process this category.
            if (cls-&gt;isStubClass()) {
                // Stub classes are never realized. Stub classes
                // don't know their metaclass until they're
                // initialized, so we have to add categories with
                // class methods or properties to the stub itself.
                // methodizeClass() will find them and add them to
                // the metaclass as appropriate.
                if (cat-&gt;instanceMethods ||
                    cat-&gt;protocols ||
                    cat-&gt;instanceProperties ||
                    cat-&gt;classMethods ||
                    cat-&gt;protocols ||
                    (hasClassProperties &amp;&amp; cat-&gt;_classProperties))
                {
                    objc::unattachedCategories.addForClass(lc, cls);
                }
            } else {
                // First, register the category with its target class.
                // Then, rebuild the class's method lists (etc) if
                // the class is realized.
                // 现将 Category 注册到其目标类中，当类对象初始化后，将类方法列表重建

                // 如果是类对象
                if (cat-&gt;instanceMethods ||  cat-&gt;protocols
                    ||  cat-&gt;instanceProperties)
                {
                    if (cls-&gt;isRealized()) {
                        // 我们继续往下看 attachCategories 该方法的实现
                        attachCategories(cls, &amp;lc, 1, ATTACH_EXISTING);
                    } else {
                        objc::unattachedCategories.addForClass(lc, cls);
                    }
                }

                // 如果为元类对象
                if (cat-&gt;classMethods  ||  cat-&gt;protocols
                    ||  (hasClassProperties &amp;&amp; cat-&gt;_classProperties))
                {
                    if (cls-&gt;ISA()-&gt;isRealized()) {
                        attachCategories(cls-&gt;ISA(), &amp;lc, 1, ATTACH_EXISTING | ATTACH_METACLASS);
                    } else {
                        objc::unattachedCategories.addForClass(lc, cls-&gt;ISA());
                    }
                }
            }
        }
    };

    processCatlist(hi-&gt;catlist(&amp;count));
    processCatlist(hi-&gt;catlist2(&amp;count));
}

// Attach method lists and properties and protocols from categories to a class.
// Assumes the categories in cats are all loaded and sorted by load order, 
// oldest categories first.
static void
attachCategories(Class cls, const locstamped_category_t *cats_list, uint32_t cats_count,
                 int flags)
{
    /*
     * Only a few classes have more than 64 categories during launch.
     * This uses a little stack, and avoids malloc.
     *
     * Categories must be added in the proper order, which is back
     * to front. To do that with the chunking, we iterate cats_list
     * from front to back, build up the local buffers backwards,
     * and call attachLists on the chunks. attachLists prepends the
     * lists, so the final result is in the expected order.
     */
    constexpr uint32_t ATTACH_BUFSIZ = 64;
    method_list_t   *mlists[ATTACH_BUFSIZ];
    property_list_t *proplists[ATTACH_BUFSIZ];
    protocol_list_t *protolists[ATTACH_BUFSIZ];

    uint32_t mcount = 0;
    uint32_t propcount = 0;
    uint32_t protocount = 0;
    bool fromBundle = NO;

    // 先检查是否为元类
    bool isMeta = (flags &amp; ATTACH_METACLASS);
    // 如果没有 class_rw_ext_t 实例则初始化 class_rw_ext_t，用到才会初始化，来优化内存占用
    auto rwe = cls-&gt;data()-&gt;extAllocIfNeeded();

    // 遍历分类
    for (uint32_t i = 0; i &lt; cats_count; i++) {
        auto&amp; entry = cats_list[i];
        // 获取当前分类的方法列表
        method_list_t *mlist = entry.cat-&gt;methodsForMeta(isMeta);
        // 如果不为空，那么就将分类方法列表添加到 class_rw_ext_t 的方法列表中
        if (mlist) {
            // 只有当 mlists 放满之后，才会向 class_rw_ext_t 方法列表中追加
            if (mcount == ATTACH_BUFSIZ) {
                prepareMethodLists(cls, mlists, mcount, NO, fromBundle, __func__);
                // 向 class_rw_ext_t 方法列表中添加分类中的方法列表
                rwe-&gt;methods.attachLists(mlists, mcount);
                mcount = 0;
            }
            // 如果未满，那么就先将方法列表存到 mlist 中，到最后再判断 mcount 是否为0，如果不为0，则把最后的 mlists 添加到 class_rw_ext_t 方法列表中
            // 可以看到添加的顺序为从后向前添加，那么最先编译的分类会放到数组最后，编译过程中越靠后的分类优先级越高
            mlists[ATTACH_BUFSIZ - ++mcount] = mlist;
            fromBundle |= entry.hi-&gt;isBundle();
        }

        //  对于分类中的属性和协议，同方法列表处理方式基本相同，
        //最后也会用 class_rw_ext_t 对应的成员变量(properties, protocols) 调用 attachLists
        // 将分类中的属性和协议添加到类中

        // 获取当前分类的属性列表
        property_list_t *proplist =
            entry.cat-&gt;propertiesForMeta(isMeta, entry.hi);
        if (proplist) {
            if (propcount == ATTACH_BUFSIZ) {
                rwe-&gt;properties.attachLists(proplists, propcount);
                propcount = 0;
            }
            proplists[ATTACH_BUFSIZ - ++propcount] = proplist;
        }

        // 获取当前分类的协议列表
        protocol_list_t *protolist = entry.cat-&gt;protocolsForMeta(isMeta);
        if (protolist) {
            if (protocount == ATTACH_BUFSIZ) {
                rwe-&gt;protocols.attachLists(protolists, protocount);
                protocount = 0;
            }
            protolists[ATTACH_BUFSIZ - ++protocount] = protolist;
        }
    }

    if (mcount &gt; 0) {
        prepareMethodLists(cls, mlists + ATTACH_BUFSIZ - mcount, mcount,
                           NO, fromBundle, __func__);
        rwe-&gt;methods.attachLists(mlists + ATTACH_BUFSIZ - mcount, mcount);
        if (flags &amp; ATTACH_EXISTING) {
            flushCaches(cls, __func__, [](Class c){
                // constant caches have been dealt with in prepareMethodLists
                // if the class still is constant here, it's fine to keep
                return !c-&gt;cache.isConstantOptimizedCache();
            });
        }
    }

    rwe-&gt;properties.attachLists(proplists + ATTACH_BUFSIZ - propcount, propcount);

    rwe-&gt;protocols.attachLists(protolists + ATTACH_BUFSIZ - protocount, protocount);
}

void attachLists(List* const * addedLists, uint32_t addedCount) {
        if (addedCount == 0) return;

        if (hasArray()) {
            // many lists -&gt; many lists
            uint32_t oldCount = array()-&gt;count;
            uint32_t newCount = oldCount + addedCount;
            // 创建新的列表，大小为当前类中列表大小 + 分类中的列表大小
            array_t *newArray = (array_t *)malloc(array_t::byteSize(newCount));
            newArray-&gt;count = newCount;
            array()-&gt;count = newCount;
            // 将类中原有的列表放到新列表后面
            for (int i = oldCount - 1; i &gt;= 0; i--)
                newArray-&gt;lists[i + addedCount] = array()-&gt;lists[i];
            // 在新列表最前面添加分类中的列表
            for (unsigned i = 0; i &lt; addedCount; i++)
                newArray-&gt;lists[i] = addedLists[i];
            // 释放原来列表
            free(array());
            // 将新列表赋给类对象
            setArray(newArray);
            validate();
        }
        else if (!list  &amp;&amp;  addedCount == 1) {
            // 0 lists -&gt; 1 list
            list = addedLists[0];
            validate();
        } 
        else {
            // 1 list -&gt; many lists
            Ptr&lt;List&gt; oldList = list;
            uint32_t oldCount = oldList ? 1 : 0;
            uint32_t newCount = oldCount + addedCount;
            setArray((array_t *)malloc(array_t::byteSize(newCount)));
            array()-&gt;count = newCount;
            if (oldList) array()-&gt;lists[addedCount] = oldList;
            for (unsigned i = 0; i &lt; addedCount; i++)
                array()-&gt;lists[i] = addedLists[i];
            validate();
        }
    }

</code></pre>
<p>至此，分类加载完毕，方法，属性，协议已经全部添加到类对象中。
从 <code>attachLists</code> 方法中我们可以看到，分类方法会添加到类方法列表最前面，所以，当分类中定义了与类中相同的方法时，会优先调用分类中的方法</p>
<p>类扩展在编译的时候就已经合并到类中了</p>
<pre><code class="language-Objective-C">@interface Person()
@property(nonatimic, assign) height;
@end
</code></pre>
<h3 id="load">类和分类中的 load 方法</h3>
<pre><code class="language-C++">_dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);

</code></pre>
<p>我们继续来看 <code>_dyld_objc_notify_register</code> 传入的 <code>load_images</code>，
<code>load_images</code> 最后调用了 <code>call_load_methods</code></p>
<pre><code class="language-C++">// objc-runtime-new.mm
void
load_images(const char *path __unused, const struct mach_header *mh)
{
    if (!didInitialAttachCategories &amp;&amp; didCallDyldNotifyRegister) {
        didInitialAttachCategories = true;
        loadAllCategories();
    }

    // Return without taking locks if there are no +load methods here.
    if (!hasLoadMethods((const headerType *)mh)) return;

    recursive_mutex_locker_t lock(loadMethodLock);

    // Discover load methods
    {
        mutex_locker_t lock2(runtimeLock);
        prepare_load_methods((const headerType *)mh);
    }

    // Call +load methods (without runtimeLock - re-entrant)
    call_load_methods();
} 

// objc-loadmethod.mm
void call_load_methods(void)
{
    static bool loading = NO;
    bool more_categories;

    loadMethodLock.assertLocked();

    // Re-entrant calls do nothing; the outermost call will finish the job.
    if (loading) return;
    loading = YES;

    void *pool = objc_autoreleasePoolPush();

    do {
        // 1. Repeatedly call class +loads until there aren't any more
        // 先调用所有 class 的 load 方法
        while (loadable_classes_used &gt; 0) {
            call_class_loads();
        }

        // 2. Call category +loads ONCE
        // 然后调用 Category 的 load 方法
        more_categories = call_category_loads();

        // 3. Run more +loads if there are classes OR more untried categories
    } while (loadable_classes_used &gt; 0  ||  more_categories);

    objc_autoreleasePoolPop(pool);

    loading = NO;
}

static void call_class_loads(void)
{
    int i;

    // Detach current loadable list.
    struct loadable_class *classes = loadable_classes;
    int used = loadable_classes_used;
    loadable_classes = nil;
    loadable_classes_allocated = 0;
    loadable_classes_used = 0;

    // Call all +loads for the detached list.
    for (i = 0; i &lt; used; i++) {
        // 直接拿到类对象，然后直接获取到类对象中方法列表的地址进行调用，这样做可以保证直接调用到类对象中的 +(void)load 方法
        Class cls = classes[i].cls;
        load_method_t load_method = (load_method_t)classes[i].method;
        if (!cls) continue; 

        if (PrintLoading) {
            _objc_inform(&quot;LOAD: +[%s load]\n&quot;, cls-&gt;nameForLogging());
        }
        (*load_method)(cls, @selector(load));
    }

    // Destroy the detached list.
    if (classes) free(classes);
}

static bool call_category_loads(void)
{
    int i, shift;
    bool new_categories_added = NO;

    // Detach current loadable list.
    struct loadable_category *cats = loadable_categories;
    int used = loadable_categories_used;
    int allocated = loadable_categories_allocated;
    loadable_categories = nil;
    loadable_categories_allocated = 0;
    loadable_categories_used = 0;

    // Call all +loads for the detached list.
    for (i = 0; i &lt; used; i++) {
        // 直接拿到分类对象，然后直接获取到分类对象中方法列表的地址进行调用，这样做可以保证直接调用到分类对象中的 +(void)load 方法
        Category cat = cats[i].cat;
        load_method_t load_method = (load_method_t)cats[i].method;
        Class cls;
        if (!cat) continue;

        cls = _category_getClass(cat);
        if (cls  &amp;&amp;  cls-&gt;isLoadable()) {
            if (PrintLoading) {
                _objc_inform(&quot;LOAD: +[%s(%s) load]\n&quot;, 
                             cls-&gt;nameForLogging(), 
                             _category_getName(cat));
            }
            (*load_method)(cls, @selector(load));
            cats[i].cat = nil;
        }
    }
    ...

    return new_categories_added;
}
</code></pre>
<p>通过上面代码我们可以看到，runtime 通过 load_images -&gt; call_load_methods 来调用 <code>load</code> 方法
其调用顺序为，通过指针先调用所有类的 load 方法，然后再调用所有分类的 load 方法，类和分类的load 方法调用顺序为编译顺序
因为在加载完之后分类方法已经都合并到类中，包括 load 方法，所以在调用的时候需要直接拿到 类或分类对象本身，然后直接拿到方法列表指针，然后再进行调用，这样能保证我们看到的调用顺序</p>
<p>+load 方法会在 runtime 加载类、分类是调用
每个类、分类的 +load，在程序运行过程中只调用一次</p>
<ul>
<li>调用顺序</li>
<li>
<ul>
<li>先调用类的 +load （按照编译先后顺序调用，先编译先调用，调用子类的 load 之前会先调用父类的 load）</li>
</ul>
</li>
<li>
<ul>
<li>在调用分类的 load（同样按照编译先后顺序调用）</li>
</ul>
</li>
</ul>
<p>为保证父类的 load 优先调用，通过 prepare_load_methods-&gt;schedule_class_load 将编译后的类进行重排，来保证父类在最前</p>
<pre><code class="language-C++">void prepare_load_methods(const headerType *mhdr)
{
    size_t count, i;

    runtimeLock.assertLocked();

    classref_t const *classlist = 
        _getObjc2NonlazyClassList(mhdr, &amp;count);
    for (i = 0; i &lt; count; i++) {
        schedule_class_load(remapClass(classlist[i]));
    }

    category_t * const *categorylist = _getObjc2NonlazyCategoryList(mhdr, &amp;count);
    for (i = 0; i &lt; count; i++) {
        category_t *cat = categorylist[i];
        Class cls = remapClass(cat-&gt;cls);
        if (!cls) continue;  // category for ignored weak-linked class
        if (cls-&gt;isSwiftStable()) {
            _objc_fatal(&quot;Swift class extensions and categories on Swift &quot;
                        &quot;classes are not allowed to have +load methods&quot;);
        }
        realizeClassWithoutSwift(cls, nil);
        ASSERT(cls-&gt;ISA()-&gt;isRealized());
        add_category_to_loadable_list(cat);
    }
}
static void schedule_class_load(Class cls)
{
    if (!cls) return;
    ASSERT(cls-&gt;isRealized());  // _read_images should realize

    if (cls-&gt;data()-&gt;flags &amp; RW_LOADED) return;

    // Ensure superclass-first ordering
    schedule_class_load(cls-&gt;getSuperclass());

    add_class_to_loadable_list(cls);
    cls-&gt;setInfo(RW_LOADED); 
}
</code></pre>
<h3 id="initialize">类和分类中的 +initialize 方法</h3>
<p><code>+initialize</code> 方法是在类第一次接受消息的时候调用的
每个类只调用一次，<code>initialize</code> 是通过消息转发（objc_msgSend）调用的，so 同一个类只会调用一次，并且类中的 <code>initialize</code> 会被分类中的 <code>initialize</code> 覆盖掉</p>
<p>调用顺序
先调用父类的 +initialize 方法，然后再调用自己的 +initialize 方法</p>
<p>Source Code</p>
<pre><code class="language-C++">Method class_getClassMethod(Class cls, SEL sel)
{
    if (!cls  ||  !sel) return nil;

    return class_getInstanceMethod(cls-&gt;getMeta(), sel);
}

Method class_getInstanceMethod(Class cls, SEL sel)
{
    if (!cls  ||  !sel) return nil;

    // This deliberately avoids +initialize because it historically did so.

    // This implementation is a bit weird because it's the only place that 
    // wants a Method instead of an IMP.

#warning fixme build and search caches

    // Search method lists, try method resolver, etc.
    lookUpImpOrForward(nil, sel, cls, LOOKUP_RESOLVER);

#warning fixme build and search caches

    return _class_getMethod(cls, sel);
}

IMP lookUpImpOrForward(id inst, SEL sel, Class cls, int behavior)
{
    const IMP forward_imp = (IMP)_objc_msgForward_impcache;
    IMP imp = nil;
    Class curClass;

    ...
    // 这里调用了 realizeAndInitializeIfNeeded_locked， 我们继续往下看
    cls = realizeAndInitializeIfNeeded_locked(inst, cls, behavior &amp; LOOKUP_INITIALIZE);
    // runtimeLock may have been dropped but is now locked again
    runtimeLock.assertLocked();
    curClass = cls;
    ...
    runtimeLock.unlock();
    if (slowpath((behavior &amp; LOOKUP_NIL) &amp;&amp; imp == forward_imp)) {
        return nil;
    }
    return imp;
}

static Class
realizeAndInitializeIfNeeded_locked(id inst, Class cls, bool initialize)
{
    if (slowpath(initialize &amp;&amp; !cls-&gt;isInitialized())) {
        // 找一下 initializeAndLeaveLocked 的实现
        cls = initializeAndLeaveLocked(cls, inst, runtimeLock);
        // runtimeLock may have been dropped but is now locked again

        // If sel == initialize, class_initialize will send +initialize and
        // then the messenger will send +initialize again after this
        // procedure finishes. Of course, if this is not being called
        // from the messenger then it won't happen. 2778172
    }
    return cls;
}

static Class initializeAndLeaveLocked(Class cls, id obj, mutex_t&amp; lock)
{
    return initializeAndMaybeRelock(cls, obj, lock, true);
}

/***********************************************************************
* class_initialize.  Send the '+initialize' message on demand to any
* uninitialized class. Force initialization of superclasses first.
* inst is an instance of cls, or nil. Non-nil is better for performance.
* Returns the class pointer. If the class was unrealized then 
* it may be reallocated.
* Locking: 
*   runtimeLock must be held by the caller
*   This function may drop the lock.
*   On exit the lock is re-acquired or dropped as requested by leaveLocked.
**********************************************************************/
static Class initializeAndMaybeRelock(Class cls, id inst,
                                      mutex_t&amp; lock, bool leaveLocked)
{
    ...
    initializeNonMetaClass(nonmeta);
    ...
}

void initializeNonMetaClass(Class cls)
{
    ASSERT(!cls-&gt;isMetaClass());

    Class supercls;
    bool reallyInitialize = NO;

    // Make sure super is done initializing BEFORE beginning to initialize cls.
    // See note about deadlock above.
    supercls = cls-&gt;getSuperclass();
    ...
    // 如果有父类，并且父类没有调用 Initialize，那么先去通过递归调用父类的 Initialize
    if (supercls  &amp;&amp;  !supercls-&gt;isInitialized()) {
        initializeNonMetaClass(supercls);
    }
    ...
    // 最后调用自己的 initialize 方法
            callInitialize(cls);
    ...

}

void callInitialize(Class cls)
{
    ((void(*)(Class, SEL))objc_msgSend)(cls, @selector(initialize));
    asm(&quot;&quot;);
}
</code></pre>
<ul>
<li><code>+initialize</code> 和 <code>+load</code> 最大的区别是，+initialize 是通过 objc_msgSend 进行调用的，所以会有以下特点</li>
<li>
<ul>
<li>如果子类没有实现 <code>+initialize</code>，会调用父类的 <code>+initialize</code>，（所以父类的 +initialize 可能会被调用多次，但是父类自己只调用一次）</li>
</ul>
</li>
<li>
<ul>
<li>如果分类实现了 <code>+initialize</code>，就会覆盖类本身的 <code>+initialize</code> 调用</li>
</ul>
</li>
<li><code>+initialize</code> 方法是在类第一次接受消息的时候调用的</li>
<li><code>+load</code> 是在类和分类加载的时候调用的</li>
<li>先调用父类的 <code>+initialize</code> 方法，然后再调用自己的 <code>+initialize</code> 方法</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../../javascripts/highlight.min.js"></script>
      
        <script src="../../../javascripts/highlightjs-line-numbers.min.js"></script>
      
        <script src="../../../javascripts/highlight.js"></script>
      
    
  </body>
</html>
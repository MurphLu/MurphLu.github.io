{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/","title":"Chapter 1. Vue \u57fa\u7840","text":""},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_1","title":"\u5b89\u88c5\u8bbe\u7f6e\uff1a","text":"<p>\u7b80\u5355\u5f15\u7528</p> <pre><code>&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;hello&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;!-- vue app \u6839\u8282\u70b9 vue app \u4e0d\u80fd\u5728body\u4e0a\u8fdb\u884c\u521d\u59cb\u5316--&gt;\n        &lt;div id=\"app\"&gt;&lt;/div&gt;\n        &lt;!-- vue cdn \u5f15\u7528 --&gt;\n        &lt;script src=\"https://unpkg.com/vue\"&gt;&lt;/script&gt;\n        &lt;script&gt;\n            new Vue({\n                el: \"#app\",\n                created(){}\n            });\n        &lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>\u4e0a\u8ff0\u65b9\u6cd5\u53ea\u5bf9\u7b80\u5355\u9875\u9762\u6bd4\u8f83\u53cb\u597d\uff0c\u6d89\u53ca\u5230\u66f4\u52a0\u590d\u6742\u7684\u573a\u666f\u9700\u8981\u5f15\u5165webpack\u6253\u5305\u5de5\u5177\u4ee5\u53ca\u4f7f\u7528\u4e00\u7cfb\u5217\u5176\u4ed6\u7279\u6027\u65f6\u8fd9\u79cd\u65b9\u5f0f\u5c31\u4e0d\u9002\u7528\u4e86</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#vue-loader-webpack","title":"vue-loader \u548c webpack","text":"<p>vue-loader \u662fwebpack\u7684\u4e00\u4e2a\u52a0\u8f7d\u5668\uff0c\u7528\u6765\u5728webpack\u6253\u5305\u8fc7\u7a0b\u4e2d\u52a0\u8f7d Vue \u6587\u4ef6\uff08\u5176\u4e2d\u5305\u542b\u4e86HTML\uff0cJavaScript\uff0cCSS\uff09\uff0c\u6216\u8005\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u811a\u624b\u67b6vue-cli\u6765\u5b8c\u6210vue\u5f00\u53d1\u7684\u57fa\u7840\u914d\u7f6e</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_2","title":"\u6a21\u677f\u8bed\u6cd5","text":"<p>Vue.js \u4f7f\u7528\u4e86\u57fa\u4e8e HTML \u7684\u6a21\u677f\u8bed\u6cd5\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u58f0\u660e\u5f0f\u5730\u5c06 DOM \u7ed1\u5b9a\u81f3\u5e95\u5c42 Vue \u5b9e\u4f8b\u7684\u6570\u636e\u3002\u6240\u6709 Vue.js \u7684\u6a21\u677f\u90fd\u662f\u5408\u6cd5\u7684 HTML\uff0c\u6240\u4ee5\u80fd\u88ab\u9075\u5faa\u89c4\u8303\u7684\u6d4f\u89c8\u5668\u548c HTML \u89e3\u6790\u5668\u89e3\u6790\u3002</p> <p>{{ msg }} \uff0c \u6570\u636e\u7ed1\u5b9a\u6700\u5e38\u89c1\u7684\u5f62\u5f0f\u5c31\u662f\u4f7f\u7528\u201cMustache\u201d\u8bed\u6cd5 (\u53cc\u5927\u62ec\u53f7) \u7684\u6587\u672c\u63d2\u503c</p> <p>Mustache \u6807\u7b7e\u5c06\u4f1a\u88ab\u66ff\u4ee3\u4e3a\u5bf9\u5e94\u6570\u636e\u5bf9\u8c61\u4e0a <code>msg</code> property \u7684\u503c\u3002\u65e0\u8bba\u4f55\u65f6\uff0c\u7ed1\u5b9a\u7684\u6570\u636e\u5bf9\u8c61\u4e0a <code>msg</code> property \u53d1\u751f\u4e86\u6539\u53d8\uff0c\u63d2\u503c\u5904\u7684\u5185\u5bb9\u90fd\u4f1a\u66f4\u65b0\u3002</p> <p>\u6307\u4ee4 (Directives) \u662f\u5e26\u6709 <code>v-</code> \u524d\u7f00\u7684\u7279\u6b8a attribute\u3002\u6307\u4ee4 attribute \u7684\u503c\u9884\u671f\u662f\u5355\u4e2a JavaScript \u8868\u8fbe\u5f0f (<code>v-for</code> \u662f\u4f8b\u5916\u60c5\u51b5\uff0c\u7a0d\u540e\u6211\u4eec\u518d\u8ba8\u8bba)\u3002\u6307\u4ee4\u7684\u804c\u8d23\u662f\uff0c\u5f53\u8868\u8fbe\u5f0f\u7684\u503c\u6539\u53d8\u65f6\uff0c\u5c06\u5176\u4ea7\u751f\u7684\u8fde\u5e26\u5f71\u54cd\uff0c\u54cd\u5e94\u5f0f\u5730\u4f5c\u7528\u4e8e DOM\u3002</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#v-if-vs-v-show","title":"v-if VS v-show","text":"<p>v-if\u6307\u4ee4\u7684\u503c\u4e3a false\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5143\u7d20\u4e0d\u4f1a\u88ab\u63d2\u5165 DOM</p> <p>v-show\u6307\u4ee4\u5219\u901a\u8fc7\u4f7f\u7528CSS \u6837\u5f0f\u6765\u63a7\u5236\u5143\u7d20\u7684\u663e\u793a/\u9690\u85cf</p> <p>\u56e0\u4e3a\u4f7f\u7528v-if\u9690\u85cf\u7684\u5185\u90e8\u5143\u7d20\u4e0d\u4f1a\u88ab\u663e\u793a\uff0cVue\u4e0d\u4f1a\u5c1d\u8bd5\u751f\u6210\u5bf9\u5e94\u7684HTML\u4ee3\u7801\uff1b\u800c\u5bf9\u4e8ev-show\u6307\u4ee4\uff0c\u4e8b\u5b9e\u5e76\u975e\u5982\u6b64\u3002\u8fd9\u610f\u5473\u7740\u9690\u85cf\u5c1a\u672a\u52a0\u8f7d\u7684\u5185\u5bb9\u65f6\uff0cv-if\u6307\u4ee4\u66f4\u597d\u4e00\u4e9b</p> <p>\u6b64\u5916\uff0c\u540c v-if \u4e00\u540c\u4f7f\u7528\u7684\u8fd8\u6709 v-else-if \u548c v-else</p> <p>\u4f7f\u7528 v-if  \u4f1a\u6709\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500\uff0c\u56e0\u4e3a\u5728\u6bcf\u6b21\u6761\u4ef6\u53d8\u5316\u5bf9\u5e94\u63d2\u5165\u6216\u79fb\u9664\u5143\u7d20\u65f6\uff0c\u90fd\u9700\u8981\u751f\u6210\u5143\u7d20\u5185\u90e8\u7684 DOM \u6811\u3002v-show \u9664\u4e86\u5728\u521d\u6b21\u521b\u5efa\u65f6\u7684\u5f00\u9500\uff0c\u6ca1\u6709\u5176\u4ed6\u989d\u5916\u5f00\u9500\uff0c\u5982\u679c\u9700\u8981\u9891\u7e41\u5207\u6362\u5185\u5bb9\u65f6\uff0c\u9009\u62e9 v-show \u662f\u6bd4\u8f83\u597d\u7684</p> <p>\u5982\u679c\u5143\u7d20\u4e4b\u4e2d\u5305\u542b\u56fe\u7247\uff0c\u4f7f\u7528v-show \u4f1a\u66f4\u597d\uff0c\u56e0\u4e3a\u5982\u679c\u5143\u7d20\u7684 v-show \u4e3afalse \u7684\u8bdd\uff0c\u53ef\u4ee5\u5728\u56fe\u7247\u663e\u793a\u4e4b\u524d\u5c31\u53bb\u52a0\u8f7d\u5b83\uff0c\u800c\u4e0d\u662f\u50cf v-if \u90a3\u6837\uff0c\u5f53\u5143\u7d20\u663e\u793a\u51fa\u6765\u65f6\u624d\u5f00\u59cb\u6784\u5efa\u5143\u7d20 DOM \u6811\uff0c\u5e76\u52a0\u8f7d\u5176\u4e2d\u7684\u5185\u5bb9</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_3","title":"\u6a21\u677f\u4e2d\u7684\u5faa\u73af","text":"<p>v-for \u6307\u4ee4\u7528\u6765\u904d\u5386\u4e00\u4e2a\u6570\u7ec4\u6216\u5bf9\u8c61\uff0c\u5c06\u6307\u4ee4\u6240\u5728\u7684\u5143\u7d20\u5faa\u73af\u8f93\u51fa\u5230\u9875\u9762\u4e0a</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_4","title":"\u5c5e\u6027\u7ed1\u5b9a","text":"<p>v-bind \u53ef\u4ee5\u63a5\u6536\u53c2\u6570\uff0c\u5e76\u5c06\u53c2\u6570\u503c\u7ed1\u5b9a\u5230\u4e00\u4e2a HTML \u5c5e\u6027\u4e0a</p> <p><code>&lt;button v-bind:type=\"buttonType\"&gt;&lt;/button&gt;</code></p> <p>\u6216\u8005\u7b80\u5199\u4e3a\uff1a</p> <p><code>&lt;button :type=\"buttonType\"&gt;&lt;/button&gt;</code></p> <p>::Tips\uff1a\u65e0\u8bba\u9009\u62e9\u4f7f\u7528v-bind\u8fd8\u662f\u7b80\u5199\u8bed\u6cd5\uff0c\u5c3d\u91cf\u4fdd\u6301\u4e00\u81f4\u3002\u5728\u67d0\u4e9b\u5730\u65b9\u4f7f\u7528v-bind\uff0c\u800c\u5728\u53e6\u5916\u7684\u5730\u65b9\u53c8\u4f7f\u7528\u7b80\u5199\u8bed\u6cd5\uff0c\u8fd9\u6837\u4f1a\u8ba9\u4ee3\u7801\u53d8\u5f97\u6709\u4e9b\u51cc\u4e71\u3002::</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_5","title":"\u54cd\u5e94\u5f0f","text":"<p>Vue \u9664\u4e86\u5728\u4e00\u5f00\u59cb\u521b\u5efa HTML\uff0cVue \u540c\u65f6\u8fd8\u76d1\u63a7 data \u5bf9\u8c61\u7684\u53d8\u5316\uff0c\u5e76\u5728\u6570\u636e\u53d8\u5316\u65f6\u66f4\u65b0 DOM\u3002</p> <p>\u54cd\u5e94\u5f0f\u7684\u5b9e\u73b0</p> <p>Vue \u4fee\u6539\u4e86\u6bcf\u4e2a\u6dfb\u52a0\u5230 data \u4e0a\u7684\u5bf9\u8c61\uff0c\u5f53\u5bf9\u8c61\u53d1\u751f\u53d8\u5316\u65f6 Vue \u4f1a\u6536\u5230\u901a\u77e5\uff0c\u4ece\u800c\u5b9e\u73b0\u54cd\u5e94\u5f0f\u3002\u5bf9\u8c61\u7684\u6bcf\u4e2a\u5c5e\u6027\u90fd\u4f1a\u5457\u66ff\u6362\u4e3a getter \u548c setter \u65b9\u6cd5\uff0c\u56e0\u6b64\u53ef\u4ee5\u50cf\u4f7f\u7528\u6b63\u5e38\u5bf9\u8c61\u4e00\u6837\u4f7f\u7528\u5b83\uff0c\u4f46\u5f53\u4f60\u4fee\u6539\u8fd9\u4e2a\u5c5e\u6027\u65f6\uff0cVue\u4f1a\u77e5\u9053\u5b83\u53d1\u751f\u4e86\u53d8\u5316\u3002</p> <p>\u4f8b\u5982\uff1a <code>const data = { userId: 10};</code></p> <p>\u4f7f\u7528 Object.defineProperty() \u8986\u5199\u8fd9\u4e2a\u5c5e\u6027\uff1a</p> <pre><code>const storedData = {};\nstoredData.userId = data.userId;\nObject.defineProperty(data, 'userId', {\n    get(){\n        return storedData.userId;\n    },\n    set(value) {\n        console.log('User id changed');\n        sotredData.userId = value;\n    },\n    configurable: true,\n    enumerable: true\n});\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u5c31\u5c55\u73b0\u4e86 vue \u7684\u5b9e\u73b0\u601d\u8def</p> <p>\u540c\u65f6 Vue \u8fd8\u4f7f\u7528\u4ee3\u7406\u65b9\u6cd5\u5c01\u88c5\u4e86\u88ab\u89c2\u5bdf\u7684\u6570\u7ec4\u5bf9\u8c61\u4e0a\u7684\u4e00\u4e9b\u6570\u7ec4\u65b9\u6cd5\uff0c\u6765\u89c2\u5bdf\u6570\u7ec4\u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5f53\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u7684\u65f6\u5019 vue \u4f1a\u53ca\u65f6\u77e5\u9053\u6570\u7ec4\u7684\u53d8\u5316\u5e76\u89e6\u53d1\u5fc5\u8981\u7684\u89c6\u56fe\u66f4\u65b0</p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ol> <li>\u5c5e\u6027\u7684 getter/setter \u662f\u5728 Vue \u5b9e\u4f8b\u521d\u59cb\u5316\u7684\u65f6\u5019\u6dfb\u52a0\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u5c5e\u6027\u5e76\u4e0d\u80fd\u4f7f\u5c5e\u6027\u6210\u4e3a\u54cd\u5e94\u5f0f\u7684</li> </ol> <p>\u6700\u7b80\u5355\u7684\u529e\u6cd5\u662f\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u5728\u5bf9\u8c61\u4e0a\u5b9a\u4e49\u597d\u8fd9\u4e2a\u5c5e\u6027\uff0c\u5e76\u5c06\u503c\u8bbe\u4e3a undefined</p> <p>\u6216\u8005\uff0c\u4f7f\u7528 <code>Object.assign()</code> \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u6765\u8986\u76d6\u539f\u6709\u5bf9\u8c61</p> <p>\u518d\u6216\u8005\uff0cVue \u63d0\u4f9b\u4e86 <code>Vue.set()</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u65b9\u6cd5\u5c06\u5c5e\u6027\u8bbe\u7f6e\u4e3a\u54cd\u5e94\u5f0f\u7684</p> <ol> <li>\u4e0d\u80fd\u76f4\u63a5\u4f7f\u7528\u7d22\u5f15\u6765\u8bbe\u7f6e\u6570\u7ec4\u5143\u7d20</li> </ol> <p>\u53ef\u4ee5\u4f7f\u7528 <code>.splice()</code> \u65b9\u6cd5\u79fb\u9664\u65e7\u5143\u7d20\u5e76\u6dfb\u52a0\u65b0\u5143\u7d20</p> <p>\u6216\u8005\uff0c\u4f7f\u7528 <code>Vue.set()</code></p> <ol> <li>\u8bbe\u7f6e\u6570\u7ec4\u957f\u5ea6</li> </ol> <p>\u4e0d\u53ef\u4f7f\u7528JavaScript\u65b9\u6cd5\u76f4\u63a5\u8bbe\u7f6e\u6570\u7ec4\u957f\u5ea6\uff0cvue \u65e0\u6cd5\u68c0\u6d4b\u5230\u5bf9\u6570\u7ec4\u5bf9\u8c61\u7684\u66f4\u6539\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>.splice()</code> \u6765\u64cd\u4f5c\uff0c\u4f46\u662f\u8be5\u65b9\u6cd5\u53ea\u80fd\u7528\u6765\u7f29\u77ed\u6570\u7ec4</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_6","title":"\u53cc\u5411\u6570\u636e\u7ed1\u5b9a","text":"<p>v-bind \u53ea\u80fd\u901a\u8fc7\u663e\u793a\u51fa\u6765\u7684\u503c\u6765\u53cd\u5e94 data \u4e2d\u6240\u5b58\u50a8\u7684\u503c\uff0c\u4f46\u662f\u4e0d\u80fd\u901a\u8fc7UI\u4e0a\u5bf9\u503c\u7684\u4fee\u6539\u6765\u53cd\u5411\u6539\u53d8 data \u4e2d\u7684\u503c\uff0c\u8981\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\u5c31\u9700\u8981\u901a\u8fc7 v-model \u6765\u5b9e\u73b0\u53cc\u5411\u6570\u636e\u7ed1\u5b9a</p> <pre><code>&lt;div id=\"app\"&gt;\n    &lt;input type=\"text\" v-model=\"inputText\"&gt;\n    &lt;p&gt; inputText: {{ inputText }} &lt;/p&gt;\n&lt;/div&gt;\n</code></pre> <p>data \u4e2d\u7684\u503c\u4f1a\u53cd\u5e94\u5728 input \u7684 value \u4e0a\uff0c\u540c\u65f6\u5bf9\u4e8e input \u4e2d\u7684\u8f93\u5165\u4e5f\u4f1a\u53cd\u5411\u6539\u53d8 data  \u4e2d\u5bf9\u5e94\u5c5e\u6027\u7684\u503c</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#html","title":"\u52a8\u6001\u8bbe\u7f6e HTML","text":"<p>\u4f7f\u7528 {{ }} \u63d2\u5165\u5bf9\u5e94\u7684\u503c\u65f6\uff0c\u5176\u4e2d\u7684 HTML \u5b57\u7b26\u4f1a\u88ab\u81ea\u52a8\u8f6c\u4e49\uff0c\u5165\u8fc7\u60f3\u76f4\u63a5\u63d2\u5165\u4e00\u6bb5 HTML \u4ee3\u7801\u7684\u8bdd\u9700\u8981\u4f7f\u7528  <code>&lt;div v-html=\"myHtml\"&gt;&lt;/div&gt; \u8fd9\u79cd\u5f62\u5f0f</code>\uff0c\u65e0\u8bba \u201cmyHtml\u201d\u4e2d\u5305\u542b\u4ec0\u4e48\u5185\u5bb9\uff0c\u90fd\u4e0d\u4f1a\u88ab\u8f6c\u4e49\uff0c\u800c\u662f\u76f4\u63a5\u8f93\u51fa\u5230\u9875\u9762</p> <p>\u4f46\u662f\u8fd9\u4e00\u529f\u80fd\u9700\u8981\u614e\u7528\uff0c\u6709\u53ef\u80fd\u4f1a\u66b4\u9732\u5728 XSS \u98ce\u9669\u4e2d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_7","title":"\u65b9\u6cd5","text":"<p>\u5728 Vue \u6a21\u677f\u91cc\uff0c\u51fd\u6570\u88ab\u5b9a\u4e49\u4e3a\u65b9\u6cd5\u6765\u4f7f\u7528\uff0c\u53ea\u8981\u5c06\u4e00\u4e2a\u51fd\u6570\u5b58\u50a8\u4e3a methods \u5bf9\u8c61\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u5c31\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u4f7f\u7528\u5b83</p> <pre><code>&lt;script&gt;\nexport default {\n  data() {\n    return {\n      hours: new Date().getHours(),\n      greetee: \"good\"\n    };\n  },\n  methods: {\n    generatorHelloMessage() {\n      if(this.hours &lt; 12) { \n        return \"Morning\";\n      } else if (this.hours &gt;= 12 &amp;&amp; this.hours &lt; 18) {\n        return \"Afternoon\";\n      } else {\n        return \"evening\";\n      }\n    }\n  }\n};\n&lt;/script&gt;\n</code></pre> <p>\u9664\u4e86\u5728\u63d2\u503c\u4e2d\u4f7f\u7528\u65b9\u6cd5\uff0c\u8fd8\u53ef\u4ee5\u5c06\u5176\u7528\u5728\u5c5e\u6027\u7ed1\u5b9a\u4e2d\uff0c\u751a\u81f3\u4efb\u4f55\u53ef\u4ee5\u4f7f\u7528 JavaScript \u8868\u8fbe\u5f0f\u7684\u5730\u65b9\u90fd\u53ef\u4ee5\u4f7f\u7528\u65b9\u6cd5</p> <p>\u5728\u65b9\u6cd5\u4e2d this \u6307\u5411\u8be5\u65b9\u6cd5\u6240\u5c5e\u7684\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u4f7f\u7528 this \u8bbf\u95ee\u5bf9\u8c61\u7684 data \u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u5176\u4ed6\u65b9\u6cd5</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_8","title":"\u8ba1\u7b97\u5c5e\u6027","text":"<p>\u8ba1\u7b97\u5c5e\u6027\u4ecb\u4e8e data \u5bf9\u8c61\u5c5e\u6027 \u548c \u65b9\u6cd5 \u4e4b\u95f4\uff0c\u53ef\u4ee5\u50cf\u8bbf\u95ee data \u5bf9\u8c61\u5c5e\u6027\u4e00\u6837\u53bb\u8bbf\u95ee\u8ba1\u7b97\u5c5e\u6027\uff0c\u4f46\u662f\u9700\u8981\u4ee5\u51fd\u6570\u7684\u65b9\u5f0f\u5b9a\u4e49\u5b83</p> <p>\u4e0d\u8bba\u5728\u65b9\u6cd5\u6216\u8005\u5176\u4ed6\u8ba1\u7b97\u5c5e\u6027\uff0c\u6291\u6216\u662f\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 this \u6765\u8bbf\u95ee\u8fd9\u4e2a\u8ba1\u7b97\u5c5e\u6027</p> <p>\u5f53\u8ba1\u7b97\u5c5e\u6027\u6240\u4f7f\u7528\u7684 data \u5c5e\u6027\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u8ba1\u7b97\u5c5e\u6027\u7684\u503c\u4e5f\u4f1a\u540c\u4e8b\u53d1\u751f\u53d8\u5316</p> <p>\u9664\u4e86\u660e\u663e\u7684\u8bed\u6cd5\u533a\u522b\u4e4b\u5916\uff0c\u8ba1\u7b97\u5c5e\u6027\u548c\u65b9\u6cd5\u7684\u533a\u522b\u4f53\u73b0\u5728\uff1a</p> <ol> <li>\u8ba1\u7b97\u5c5e\u6027\u4f1a\u88ab\u7f13\u5b58\uff0c\u53ea\u6709\u8ba1\u7b97\u5c5e\u6027\u7684\u4f9d\u8d56\u53d1\u751f\u53d8\u5316\u65f6\u8ba1\u7b97\u5c5e\u6027\u7684\u4ee3\u7801\u624d\u4f1a\u88ab\u6267\u884c\u83b7\u53d6\u65b0\u503c\uff0c\u5426\u5219\u4f1a\u4e00\u76f4\u4f7f\u7528\u88ab\u7f13\u5b58\u7684\u503c\uff0c\u4f46\u662f\u65b9\u6cd5\u5219\u662f\u6bcf\u6b21\u8c03\u7528\u90fd\u4f1a\u6267\u884c\u4e00\u6b21</li> <li>\u8ba1\u7b97\u5c5e\u6027\u53ef\u4ee5\u901a\u8fc7\u5c06\u51fd\u6570\u6539\u4e3a\u5e26\u6709get set \u5c5e\u6027\u7684\u5bf9\u8c61\uff0c\u6765\u5bf9\u8ba1\u7b97\u5c5e\u6027\u8fdb\u884c\u8d4b\u503c</li> </ol> <p>data VS \u8ba1\u7b97\u5c5e\u6027 VS \u65b9\u6cd5</p> \u53ef\u8bfb \u53ef\u5199 \u53ef\u63a5\u6536\u53c2\u6570 \u9700\u8981\u8fd0\u7b97 \u6709\u7f13\u5b58 data true true false false \u4e0d\u9700\u8981\u8fd0\u7b97\uff0c\u4e5f\u8c08\u4e0d\u4e0a\u7f13\u5b58 \u65b9\u6cd5 true false true true false \u8ba1\u7b97\u5c5e\u6027 true true false true true"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_9","title":"\u4fa6\u542c\u5668","text":"<p>\u4fa6\u542c\u5668\u53ef\u4ee5\u7528\u6765\u76d1\u542c data \u5bf9\u8c61\u5c5e\u6027\u6216\u8005\u8ba1\u7b97\u5c5e\u6027\u7684\u53d8\u5316</p> <p>\u5728 Vue \u4e2d\uff0c\u8ba1\u7b97\u5c5e\u6027\u4f1a\u6bd4\u4fa6\u542c\u5668\u66f4\u597d\u4e00\u4e9b\uff0c\u540c\u8bbe\u7f6e\u6570\u636e\u7136\u540e\u76d1\u542c\u5b83\u7684\u53d8\u5316\u76f8\u6bd4\uff0c\u4f7f\u7528\u4e00\u4e2a\u5e26\u6709 setter \u7684\u8ba1\u7b97\u5c5e\u6027\u4f1a\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p> <p>\u867d\u7136\u5927\u90e8\u5206\u7b80\u5355\u4f8b\u5b50\u7528\u4e0d\u5230\u4fa6\u542c\u5668\uff0c\u4f46\u5176\u5f88\u9002\u5408\u7528\u6765\u5904\u7406\u5f02\u6b65\u64cd\u4f5c</p> <p>\u53ef\u4ee5\u4f7f\u7528  <code>.</code> \u64cd\u4f5c\u7b26\u6765\u76d1\u542c\u5bf9\u8c61\u67d0\u4e2a\u5c5e\u6027\u7684\u53d8\u5316</p> <p>\u5f53\u76d1\u542c\u7684\u5c5e\u6027\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4fa6\u542c\u5668\u4f1a\u88ab\u4f20\u5165\u4e24\u4e2a\u53c2\u6570 <code>\uff08val, oldVal\uff09</code> \u7528\u6765\u4e86\u89e3\u8be5\u5c5e\u6027\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\u53d8\u5316</p> <p>\u5f53\u76d1\u542c\u4e00\u4e2a\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76d1\u542c\u6574\u4e2a\u5bf9\u8c61\u7684\u53d8\u5316\uff0c\u8fd9\u79cd\u64cd\u4f5c\u53eb\u505a\u6df1\u5ea6\u76d1\u542c</p> <pre><code>watch:{\n    formData:{\n        handler(){\n            console.log();\n        },\n        deep: true\n    }\n}\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_10","title":"\u8fc7\u6ee4\u5668","text":"<p>\u8fc7\u6ee4\u5668\u7528\u6765\u5728\u6a21\u677f\u4e2d\u5904\u7406\u6570\u636e\uff0c\u53ef\u4ee5\u7528\u94fe\u5f0f\u8c03\u7528\u5728\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u8fc7\u4e2a\u8fc7\u6ee4\u5668</p> <p>\u8fc7\u6ee4\u5668\u9664\u4e86\u5728\u63d2\u503c\u4e2d\u4f7f\u7528\uff0c\u8fd8\u53ef\u4ee5\u5728 v-bind \u4e2d\u4f7f\u7528</p> <p>\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u7684 filters \u5bf9\u8c61\u4e2d\u5b9a\u4e49\u8fc7\u6ee4\u5668\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>Vue.filter()</code> \u6765\u6ce8\u518c\u5168\u5c40\u8fc7\u6ee4\u5668</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#refs-dom","title":"\u4f7f\u7528 refs \u83b7\u53d6 DOM","text":"<p>\u901a\u8fc7\u8bbe\u7f6e\u5143\u7d20\u7684 ref \u5c5e\u6027\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 <code>this.$refs.&lt;\u5c5e\u6027\u503c&gt;</code>  \u6765\u83b7\u53d6\u5bf9\u5e94\u7684 DOM \u5143\u7d20</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_11","title":"\u8f93\u5165\u548c\u4e8b\u4ef6","text":"<p>\u53ef\u4ee5\u4f7f\u7528 v-on \u6307\u4ee4\u5c06\u4e8b\u4ef6\u4fa6\u542c\u5668\u7ed1\u5b9a\u5230\u5143\u7d20\u4e0a\uff0c<code>v-on:click=\u201ctestFunc\u201d</code>   \u539f\u751f DOM \u4e8b\u4ef6\u5bf9\u8c61\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\u7ed1\u5b9a\u7684\u65b9\u6cd5\u4e2d\u3002\u5982\u679c\u4f7f\u7528\u5185\u8054\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7$event \u6765\u8bbf\u95ee\u4e8b\u4ef6\u5bf9\u8c61\u3002</p> <p><code>v-on:click</code> \u4e5f\u53ef\u4ee5\u4f7f\u7528\u7b80\u5199\u5f62\u5f0f <code>@click</code></p> <p>\u4e8b\u4ef6\u4fee\u9970\u7b26</p> <p>\u53ef\u4ee5\u4f7f\u7528\u5f88\u591a\u4fee\u9970\u7b26\u6765\u4fee\u6539\u4e8b\u4ef6\u4fa6\u542c\u5668\u6216\u8005\u4e8b\u4ef6\u672c\u8eab\uff0c\u6bd4\u5982 <code>v-on:click.once</code></p> <ul> <li><code>.stop</code> - \u8c03\u7528 <code>event.stopPropagation()</code>\u3002\u963b\u6b62\u4e8b\u4ef6\u7ee7\u7eed\u4f20\u64ad\uff0c\u907f\u514d\u5728\u7236\u7ea7\u5143\u7d20\u4e0a\u89e6\u53d1\u4e8b\u4ef6</li> <li><code>.prevent</code> - \u8c03\u7528 <code>event.preventDefault()</code>\u3002\u963b\u6b62\u4e8b\u4ef6\u9ed8\u8ba4\u884c\u4e3a</li> <li><code>.capture</code> - \u6dfb\u52a0\u4e8b\u4ef6\u4fa6\u542c\u5668\u65f6\u4f7f\u7528 capture \u6a21\u5f0f\u3002</li> <li><code>.self</code> - \u53ea\u5f53\u4e8b\u4ef6\u662f\u4ece\u4fa6\u542c\u5668\u7ed1\u5b9a\u7684\u5143\u7d20\u672c\u8eab\u89e6\u53d1\u65f6\u624d\u89e6\u53d1\u56de\u8c03\u3002</li> <li><code>.{keyCode | keyAlias}</code> - \u53ea\u5f53\u4e8b\u4ef6\u662f\u4ece\u7279\u5b9a\u952e\u89e6\u53d1\u65f6\u624d\u89e6\u53d1\u56de\u8c03\u3002</li> <li><code>.native</code> - \u76d1\u542c\u7ec4\u4ef6\u6839\u5143\u7d20\u7684\u539f\u751f\u4e8b\u4ef6\u3002</li> <li><code>.once</code> - \u53ea\u89e6\u53d1\u4e00\u6b21\u56de\u8c03\u3002</li> <li><code>.left</code> - (2.2.0) \u53ea\u5f53\u70b9\u51fb\u9f20\u6807\u5de6\u952e\u65f6\u89e6\u53d1\u3002</li> <li><code>.right</code> - (2.2.0) \u53ea\u5f53\u70b9\u51fb\u9f20\u6807\u53f3\u952e\u65f6\u89e6\u53d1\u3002</li> <li><code>.middle</code> - (2.2.0) \u53ea\u5f53\u70b9\u51fb\u9f20\u6807\u4e2d\u952e\u65f6\u89e6\u53d1\u3002</li> <li><code>.passive</code> - (2.3.0) \u4ee5 <code>{ passive: true }</code> \u6a21\u5f0f\u6dfb\u52a0\u4fa6\u542c\u5668</li> </ul>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_12","title":"\u751f\u547d\u5468\u671f\u94a9\u5b50","text":"<ul> <li><code>beforeCreated</code> - <code>function</code>, \u5728\u5b9e\u4f8b\u521d\u59cb\u5316\u4e4b\u540e,\u8fdb\u884c\u6570\u636e\u4fa6\u542c\u548c\u4e8b\u4ef6/\u4fa6\u542c\u5668\u7684\u914d\u7f6e\u4e4b\u524d\u540c\u6b65\u8c03\u7528\u3002</li> <li><code>created</code> - <code>function</code>, \u5728\u5b9e\u4f8b\u521b\u5efa\u5b8c\u4e4b\u540e\u7acb\u5373\u540c\u6b65\u8c03\u7528\uff0c\u6b64\u65f6 \u6570\u636e\u4fa6\u542c\u3001\u8ba1\u7b97\u5c5e\u6027\u3001\u65b9\u6cd5\u3001\u4e8b\u4ef6/\u4fa6\u542c\u5668\u7684\u56de\u8c03\u51fd\u6570 \u90fd\u4ee5\u914d\u7f6e\u5b8c\u6bd5\uff0c\u4f46\u662f\u6302\u8f7d\u9636\u6bb5\u8fd8\u672a\u5f00\u59cb\uff0c\u5e76\u4e14 <code>$el</code> property \u76ee\u524d\u5c1a\u4e0d\u53ef\u7528</li> <li><code>beforeMount</code> - <code>function</code>, \u6302\u8f7d\u5f00\u59cb\u4e4b\u524d\u88ab\u8c03\u7528\uff0c\u76f8\u5173\u7684 <code>render</code> \u51fd\u6570\u9996\u6b21\u88ab\u8c03\u7528</li> <li><code>mounted</code> - function, \u5b9e\u4f8b\u88ab\u6302\u8f7d\u4e4b\u540e\u8c03\u7528\uff0c\u4f46\u662f <code>mounted</code> \u5e76\u4e0d\u80fd\u4fdd\u8bc1\u6240\u6709\u7684\u5b50\u7ec4\u4ef6\u6302\u8f7d\u5b8c\u6210\uff0c\u5982\u679c\u60f3\u8981\u7b49\u5230\u6574\u4e2a\u89c6\u56fe\u6e32\u67d3\u5b8c\u6210\u518d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728 <code>mounted</code> \u4e2d\u4f7f\u7528 <code>this.$nextTick(function(){})</code> \u6765\u6267\u884c\u5bf9\u5e94\u64cd\u4f5c</li> <li><code>beforeUpdate</code> - <code>function</code>, \u5728\u6570\u636e\u53d1\u751f\u6539\u53d8\u4e4b\u540e\uff0cDOM \u88ab\u66f4\u65b0\u4e4b\u524d\u8c03\u7528\u3002</li> <li><code>updated</code> - <code>function</code>, \u5728\u6570\u636e\u66f4\u6539\u5bfc\u81f4\u865a\u62df DOM \u91cd\u65b0\u6e32\u67d3\u548c\u8ddf\u65b0\u5b8c\u6bd5\u4e4b\u540e\u88ab\u8c03\u7528\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5e76\u4e0d\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u94a9\u5b50\uff0c\u5982\u679c\u9700\u8981\u6839\u7edd\u6570\u636e\u505a\u5bf9\u5e94\u7684\u72b6\u6001\u6539\u53d8\uff0c\u6700\u597d\u662f\u901a\u8fc7 \u8ba1\u7b97\u5c5e\u6027 \u6216\u8005 watcher \u6765\u5b9e\u73b0\uff0c<code>updated</code> \u540c <code>mounted</code> \u4e00\u6837\uff0c\u4e5f\u4e0d\u80fd\u4fdd\u8bc1\u6240\u6709\u5b50\u7ec4\u4ef6\u4e5f\u90fd\u88ab\u91cd\u65b0\u6e32\u67d3\u5b8c\u6bd5\uff0c\u5982\u679c\u9700\u8981\u5728\u6240\u6709\u5b50\u7ec4\u4ef6\u6e32\u67d3\u5b8c\u6bd5\u6267\u884c\u4e00\u4e9b\u7279\u5b9a\u64cd\u4f5c\uff0c\u90a3\u4e48\u9700\u8981\u5728 <code>updated</code> \u65b9\u6cd5\u4e2d\u4f7f\u7528<code>this.$nextTick(function(){})</code> \u6765\u6267\u884c\u5bf9\u5e94\u64cd\u4f5c</li> <li><code>activated</code> - <code>function</code>\uff0c \u88ab keep-alive \u7f13\u5b58\u7684\u7ec4\u4ef6\u5728\u6fc0\u6d3b\u65f6\u8c03\u7528</li> <li><code>deactivated</code> - <code>function</code>, \u88ab keep-alive \u7f13\u5b58\u7684\u7ec4\u4ef6\u5931\u6d3b\u65f6\u8c03\u7528</li> <li><code>beforeDestory</code> - <code>function</code>, \u5b9e\u4f8b\u9500\u6bc1\u4e4b\u524d\u8c03\u7528\u3002\u5728\u8fd9\u4e00\u6b65\uff0c\u5b9e\u4f8b\u4efb\u7136\u5b8c\u5168\u53ef\u7528</li> <li><code>destroyed</code> - <code>function</code>, \u5b9e\u4f8b\u9500\u6bc1\u540e\u8c03\u7528\u3002\u8be5\u94a9\u5b50\u88ab\u8c03\u7528\u540e\uff0c\u5bf9\u5e94 Vue \u5b9e\u4f8b\u7684\u6240\u6709\u6307\u4ee4\u90fd\u88ab\u89e3\u7ed1\uff0c\u6240\u6709\u4e8b\u4ef6\u76d1\u542c\u90fd\u88ab\u79fb\u9664\uff0c\u6240\u6709\u5b50\u5b9e\u4f8b\u4e5f\u90fd\u88ab\u9500\u6bc1</li> <li><code>errorCaptured</code> - <code>(err: Error, vm: Component, info: string) =&gt; ?boolean</code>\uff0cv2.5.0+\u65b0\u589e\uff0c\u5728\u6355\u83b7\u4e00\u4e2a\u6765\u81ea\u540e\u4ee3\u7ec4\u4ef6\u7684\u9519\u8bef\u65f6\u88ab\u8c03\u7528\u3002\u6b64\u94a9\u5b50\u4f1a\u6536\u5230\u4e09\u4e2a\u53c2\u6570\uff1a\u9519\u8bef\u5bf9\u8c61\u3001\u53d1\u751f\u9519\u8bef\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4ee5\u53ca\u4e00\u4e2a\u5305\u542b\u9519\u8bef\u6765\u6e90\u4fe1\u606f\u7684\u5b57\u7b26\u4e32\u3002\u6b64\u94a9\u5b50\u53ef\u4ee5\u8fd4\u56de <code>false</code> \u4ee5\u963b\u6b62\u8be5\u9519\u8bef\u7ee7\u7eed\u5411\u4e0a\u4f20\u64ad\u3002</li> </ul>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_13","title":"\u81ea\u5b9a\u4e49\u6307\u4ee4","text":"<p>\u9664\u4e86 Vue \u5185\u7f6e\u7684\u4e00\u4e9b\u6307\u4ee4 \u4f8b\u5982\uff1a v-if, v-model, v-html\uff0cVue \u4e5f\u652f\u6301\u521b\u5efa\u81ea\u5b9a\u4e49\u6307\u4ee4\uff0c\u5982\u679c\u60f3\u5bf9 DOM \u8fdb\u884c\u67d0\u4e9b\u64cd\u4f5c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u6307\u4ee4\u6765\u5b9e\u73b0\u3002</p> <p>\u6dfb\u52a0\u4e00\u4e2a\u6307\u4ee4\u7c7b\u4f3c\u4e8e\u6dfb\u52a0\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff1a \u53ef\u4ee5\u5c06\u5b83\u4f20\u5165 Vue \u5b9e\u4f8b\u6216\u8005\u7ec4\u4ef6\u7684 <code>directives</code> \u5c5e\u6027\uff0c\u6216\u8005\u4f7f\u7528 <code>Vue.directive()</code> \u6ce8\u518c\u4e00\u4e2a\u5168\u5c40\u6307\u4ee4\u3002\u9700\u8981\u4f20\u5165\u6307\u4ee4\u7684\u540d\u5b57\uff0c\u4ee5\u53ca\u4e00\u4e2a\u5305\u542b\u94a9\u5b50\u51fd\u6570\u7684\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u94a9\u5b50\u51fd\u6570\u4f1a\u5728\u8bbe\u7f6e\u4e86\u8be5\u6307\u4ee4\u7684\u5143\u7d20\u7684\u751f\u547d\u5468\u671f\u7684\u5404\u4e2a\u9636\u6bb5\u88ab\u89e6\u53d1</p> <pre><code>Vue.directive('my-directive', {\n    bind(el){\n\n    },\n    update(){\n    }\n})\n</code></pre> <p>\u6307\u4ee4\u94a9\u5b50\u51fd\u6570</p> <ul> <li>bind,  \u5728\u6307\u4ee4\u7ed1\u5b9a\u5230\u5143\u7d20\u65f6\u88ab\u8c03\u7528</li> <li>inserted,  \u5728\u7ed1\u5b9a\u7684\u5143\u7d20\u88ab\u6dfb\u52a0\u5230\u7236\u8282\u70b9\u65f6\u88ab\u8c03\u7528\u2014\u2014\u4f46\u548cmounted\u4e00\u6837\uff0c\u6b64\u65f6\u8fd8\u4e0d\u80fd\u4fdd\u8bc1\u5143\u7d20\u5df2\u7ecf\u88ab\u6dfb\u52a0\u5230DOM\u4e0a\u3002\u53ef\u4ee5\u4f7f\u7528<code>this.$nextTick</code>\u6765\u4fdd\u8bc1\u8fd9\u4e00\u70b9</li> <li>update,  \u5728\u7ed1\u5b9a\u8be5\u6307\u4ee4\u7684\u7ec4\u4ef6\u8282\u70b9\u88ab\u66f4\u65b0\u65f6\u8c03\u7528\uff0c\u4f46\u662f\u8be5\u7ec4\u4ef6\u7684\u5b50\u7ec4\u4ef6\u53ef\u80fd\u6b64\u65f6\u8fd8\u672a\u66f4\u65b0\u3002</li> <li>componentUpdated,  \u548cupdated\u94a9\u5b50\u7c7b\u4f3c\uff0c\u4f46\u5b83\u4f1a\u5728\u7ec4\u4ef6\u7684\u5b50\u7ec4\u4ef6\u90fd\u66f4\u65b0\u5b8c\u6210\u540e\u8c03\u7528</li> <li>unbind,  \u7528\u4e8e\u6307\u4ee4\u7684\u62c6\u9664\uff0c\u5f53\u6307\u4ee4\u4ece\u5143\u7d20\u4e0a\u89e3\u7ed1\u65f6\u4f1a\u88ab\u8c03\u7528</li> </ul> <p>\u6307\u4ee4\u4e2d\u6700\u5e38\u7528\u7684\u4e3a bind \u548c update\u3002\u540c\u65f6 Vue \u4e5f\u63d0\u4f9b\u4e86\u53ea\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u94a9\u5b50\u7684\u7b80\u4fbf\u5199\u6cd5</p> <pre><code>Vue.directive('my-directive', (el)=&gt;{\n    // bind \u548c update \u90fd\u4f1a\u89e6\u53d1\u8be5\u5b9e\u73b0\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_14","title":"\u94a9\u5b50\u51fd\u6570\u7684\u53c2\u6570","text":"<p>\u6307\u4ee4\u94a9\u5b50\u51fd\u6570\u4f1a\u88ab\u4f20\u5165\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li><code>el</code>\uff1a\u6307\u4ee4\u6240\u7ed1\u5b9a\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u7528\u6765\u76f4\u63a5\u64cd\u4f5c DOM\u3002</li> <li><code>binding</code>\uff1a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5305\u542b\u4ee5\u4e0b property\uff1a</li> <li><code>name</code>\uff1a\u6307\u4ee4\u540d\uff0c\u4e0d\u5305\u62ec <code>v-</code> \u524d\u7f00\u3002</li> <li><code>value</code>\uff1a\u6307\u4ee4\u7684\u7ed1\u5b9a\u503c\uff0c\u4f8b\u5982\uff1a<code>v-my-directive=\"1 + 1\"</code> \u4e2d\uff0c\u7ed1\u5b9a\u503c\u4e3a <code>2</code>\u3002</li> <li><code>oldValue</code>\uff1a\u6307\u4ee4\u7ed1\u5b9a\u7684\u524d\u4e00\u4e2a\u503c\uff0c\u4ec5\u5728 <code>update</code> \u548c <code>componentUpdated</code> \u94a9\u5b50\u4e2d\u53ef\u7528\u3002\u65e0\u8bba\u503c\u662f\u5426\u6539\u53d8\u90fd\u53ef\u7528\u3002</li> <li><code>expression</code>\uff1a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u6307\u4ee4\u8868\u8fbe\u5f0f\u3002\u4f8b\u5982 <code>v-my-directive=\"1 + 1\"</code> \u4e2d\uff0c\u8868\u8fbe\u5f0f\u4e3a <code>\"1 + 1\"</code>\u3002</li> <li><code>arg</code>\uff1a\u4f20\u7ed9\u6307\u4ee4\u7684\u53c2\u6570\uff0c\u53ef\u9009\u3002\u4f8b\u5982 <code>v-my-directive:foo</code> \u4e2d\uff0c\u53c2\u6570\u4e3a <code>\"foo\"</code>\u3002</li> <li><code>modifiers</code>\uff1a\u4e00\u4e2a\u5305\u542b\u4fee\u9970\u7b26\u7684\u5bf9\u8c61\u3002\u4f8b\u5982\uff1a<code>v-my-directive.foo.bar</code> \u4e2d\uff0c\u4fee\u9970\u7b26\u5bf9\u8c61\u4e3a <code>{ foo: true, bar: true }</code>\u3002</li> <li><code>vnode</code>\uff1aVue \u7f16\u8bd1\u751f\u6210\u7684\u865a\u62df\u8282\u70b9\u3002\u79fb\u6b65 VNode API \u6765\u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002</li> <li><code>oldVnode</code>\uff1a\u4e0a\u4e00\u4e2a\u865a\u62df\u8282\u70b9\uff0c\u4ec5\u5728 <code>update</code> \u548c <code>componentUpdated</code> \u94a9\u5b50\u4e2d\u53ef\u7528\u3002</li> </ul> <p>\u52a8\u6001\u6307\u4ee4\u53c2\u6570</p> <p>\u6307\u4ee4\u7684\u53c2\u6570\u53ef\u4ee5\u662f\u52a8\u6001\u7684\u3002\u4f8b\u5982\uff0c\u5728 <code>v-mydirective:[argument]=\"value\"</code> \u4e2d\uff0c<code>argument</code> \u53c2\u6570\u53ef\u4ee5\u6839\u636e\u7ec4\u4ef6\u5b9e\u4f8b\u6570\u636e\u8fdb\u884c\u66f4\u65b0\uff01\u8fd9\u4f7f\u5f97\u81ea\u5b9a\u4e49\u6307\u4ee4\u53ef\u4ee5\u5728\u5e94\u7528\u4e2d\u88ab\u7075\u6d3b\u4f7f\u7528\u3002</p> <p>\u5bf9\u8c61\u5b57\u9762\u91cf</p> <p>\u5982\u679c\u6307\u4ee4\u9700\u8981\u591a\u4e2a\u503c\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a JavaScript \u5bf9\u8c61\u5b57\u9762\u91cf\u3002\u8bb0\u4f4f\uff0c\u6307\u4ee4\u51fd\u6570\u80fd\u591f\u63a5\u53d7\u6240\u6709\u5408\u6cd5\u7684 JavaScript \u8868\u8fbe\u5f0f\u3002</p> <p>\u6307\u4ee4\u8be6\u7ec6\u53c2\u89c1\uff1a Vue \u81ea\u5b9a\u4e49\u6307\u4ee4</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%201.%20Vue%20%E5%9F%BA%E7%A1%80/#_15","title":"\u8fc7\u6e21\u548c\u52a8\u753b","text":"<p>Vue \u63d0\u4f9b\u4e86 <code>transition</code> \u7684\u5c01\u88c5\u7ec4\u4ef6\uff0c\u5728\u4e0b\u5217\u60c5\u5f62\u4e2d\uff0c\u53ef\u4ee5\u7ed9\u4efb\u4f55\u5143\u7d20\u548c\u7ec4\u4ef6\u6dfb\u52a0\u8fdb\u5165/\u79bb\u5f00\u8fc7\u6e21</p> <ul> <li>\u6761\u4ef6\u6e32\u67d3 (\u4f7f\u7528 <code>v-if</code>)</li> <li>\u6761\u4ef6\u5c55\u793a (\u4f7f\u7528 <code>v-show</code>)</li> <li>\u52a8\u6001\u7ec4\u4ef6</li> <li>\u7ec4\u4ef6\u6839\u8282\u70b9</li> </ul> <pre><code>&lt;template&gt;\n  &lt;div&gt;\n    &lt;button v-on:click=\"show = !show\"&gt;\u6de6&lt;/button&gt;\n    &lt;transition name=\"fade\"&gt;\n      &lt;p v-if=\"show\"&gt;hello&lt;/p&gt;\n    &lt;/transition&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\nexport default {\n  data() {\n    return {\n      show: true,\n    };\n  },\n};\n&lt;/script&gt;\n\n&lt;style&gt;\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.5s;\n}\n.fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */ {\n  opacity: 0;\n}\n&lt;/style&gt;\n</code></pre> <p>\u8fc7\u6e21\u7c7b\u540d</p> <p>\u5728\u8fdb\u5165/\u79bb\u5f00\u7684\u8fc7\u6e21\u4e2d\uff0c\u4f1a\u6709 6 \u4e2a class \u5207\u6362\u3002</p> <ol> <li><code>v-enter</code>\uff1a\u5b9a\u4e49\u8fdb\u5165\u8fc7\u6e21\u7684\u5f00\u59cb\u72b6\u6001\u3002\u5728\u5143\u7d20\u88ab\u63d2\u5165\u4e4b\u524d\u751f\u6548\uff0c\u5728\u5143\u7d20\u88ab\u63d2\u5165\u4e4b\u540e\u7684\u4e0b\u4e00\u5e27\u79fb\u9664\u3002</li> <li><code>v-enter-active</code>\uff1a\u5b9a\u4e49\u8fdb\u5165\u8fc7\u6e21\u751f\u6548\u65f6\u7684\u72b6\u6001\u3002\u5728\u6574\u4e2a\u8fdb\u5165\u8fc7\u6e21\u7684\u9636\u6bb5\u4e2d\u5e94\u7528\uff0c\u5728\u5143\u7d20\u88ab\u63d2\u5165\u4e4b\u524d\u751f\u6548\uff0c\u5728\u8fc7\u6e21/\u52a8\u753b\u5b8c\u6210\u4e4b\u540e\u79fb\u9664\u3002\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u88ab\u7528\u6765\u5b9a\u4e49\u8fdb\u5165\u8fc7\u6e21\u7684\u8fc7\u7a0b\u65f6\u95f4\uff0c\u5ef6\u8fdf\u548c\u66f2\u7ebf\u51fd\u6570\u3002</li> <li><code>v-enter-to</code>\uff1a2.1.8 \u7248\u53ca\u4ee5\u4e0a\u5b9a\u4e49\u8fdb\u5165\u8fc7\u6e21\u7684\u7ed3\u675f\u72b6\u6001\u3002\u5728\u5143\u7d20\u88ab\u63d2\u5165\u4e4b\u540e\u4e0b\u4e00\u5e27\u751f\u6548 (\u4e0e\u6b64\u540c\u65f6 <code>v-enter</code> \u88ab\u79fb\u9664)\uff0c\u5728\u8fc7\u6e21/\u52a8\u753b\u5b8c\u6210\u4e4b\u540e\u79fb\u9664\u3002</li> <li><code>v-leave</code>\uff1a\u5b9a\u4e49\u79bb\u5f00\u8fc7\u6e21\u7684\u5f00\u59cb\u72b6\u6001\u3002\u5728\u79bb\u5f00\u8fc7\u6e21\u88ab\u89e6\u53d1\u65f6\u7acb\u523b\u751f\u6548\uff0c\u4e0b\u4e00\u5e27\u88ab\u79fb\u9664\u3002</li> <li><code>v-leave-active</code>\uff1a\u5b9a\u4e49\u79bb\u5f00\u8fc7\u6e21\u751f\u6548\u65f6\u7684\u72b6\u6001\u3002\u5728\u6574\u4e2a\u79bb\u5f00\u8fc7\u6e21\u7684\u9636\u6bb5\u4e2d\u5e94\u7528\uff0c\u5728\u79bb\u5f00\u8fc7\u6e21\u88ab\u89e6\u53d1\u65f6\u7acb\u523b\u751f\u6548\uff0c\u5728\u8fc7\u6e21/\u52a8\u753b\u5b8c\u6210\u4e4b\u540e\u79fb\u9664\u3002\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u88ab\u7528\u6765\u5b9a\u4e49\u79bb\u5f00\u8fc7\u6e21\u7684\u8fc7\u7a0b\u65f6\u95f4\uff0c\u5ef6\u8fdf\u548c\u66f2\u7ebf\u51fd\u6570\u3002</li> <li><code>v-leave-to</code>\uff1a2.1.8 \u7248\u53ca\u4ee5\u4e0a\u5b9a\u4e49\u79bb\u5f00\u8fc7\u6e21\u7684\u7ed3\u675f\u72b6\u6001\u3002\u5728\u79bb\u5f00\u8fc7\u6e21\u88ab\u89e6\u53d1\u4e4b\u540e\u4e0b\u4e00\u5e27\u751f\u6548 (\u4e0e\u6b64\u540c\u65f6 <code>v-leave</code> \u88ab\u5220\u9664)\uff0c\u5728\u8fc7\u6e21/\u52a8\u753b\u5b8c\u6210\u4e4b\u540e\u79fb\u9664\u3002</li> </ol> <p>\u5bf9\u4e8e\u8fd9\u4e9b\u5728\u8fc7\u6e21\u4e2d\u5207\u6362\u7684\u7c7b\u540d\u6765\u8bf4\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u4e00\u4e2a\u6ca1\u6709\u540d\u5b57\u7684 <code>&lt;transition&gt;</code>\uff0c\u5219 <code>v-</code> \u662f\u8fd9\u4e9b\u7c7b\u540d\u7684\u9ed8\u8ba4\u524d\u7f00\u3002\u5982\u679c\u4f60\u4f7f\u7528\u4e86 <code>&lt;transition name=\"my-transition\"&gt;</code>\uff0c\u90a3\u4e48 <code>v-enter</code> \u4f1a\u66ff\u6362\u4e3a <code>my-transition-enter</code>\u3002</p> <p><code>v-enter-active</code> \u548c <code>v-leave-active</code> \u53ef\u4ee5\u63a7\u5236\u8fdb\u5165/\u79bb\u5f00\u8fc7\u6e21\u7684\u4e0d\u540c\u7684\u7f13\u548c\u66f2\u7ebf\uff0c\u5728\u4e0b\u9762\u7ae0\u8282\u4f1a\u6709\u4e2a\u793a\u4f8b\u8bf4\u660e\u3002</p> <p>\u81ea\u5b9a\u4e49\u8fc7\u6e21\u7c7b\u540d</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b attribute \u6765\u81ea\u5b9a\u4e49\u8fc7\u6e21\u7c7b\u540d\uff1a</p> <ul> <li><code>enter-class</code></li> <li><code>enter-active-class</code></li> <li><code>enter-to-class</code> (2.1.8+)</li> <li><code>leave-class</code></li> <li><code>leave-active-class</code></li> <li><code>leave-to-class</code> (2.1.8+)</li> </ul> <p>\u4ed6\u4eec\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u666e\u901a\u7684\u7c7b\u540d\uff0c\u8fd9\u5bf9\u4e8e Vue \u7684\u8fc7\u6e21\u7cfb\u7edf\u548c\u5176\u4ed6\u7b2c\u4e09\u65b9 CSS \u52a8\u753b\u5e93\uff0c\u5982 Animate.css\u7ed3\u5408\u4f7f\u7528\u5341\u5206\u6709\u7528\u3002</p> <p>javascript \u94a9\u5b50</p> <p>\u53ef\u4ee5\u5728 attribute \u4e2d\u58f0\u660e JavaScript \u94a9\u5b50</p> <pre><code>&lt;transition\n  v-on:before-enter=\"beforeEnter\"\n  v-on:enter=\"enter\"\n  v-on:after-enter=\"afterEnter\"\n  v-on:enter-cancelled=\"enterCancelled\"\n\n  v-on:before-leave=\"beforeLeave\"\n  v-on:leave=\"leave\"\n  v-on:after-leave=\"afterLeave\"\n  v-on:leave-cancelled=\"leaveCancelled\"\n&gt;\n  &lt;!-- ... --&gt;\n&lt;/transition&gt;\n</code></pre> <p>\u8be6\u7ec6\u53c2\u89c1\uff1a\u8fc7\u6e21&amp;\u52a8\u753b</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/","title":"Chapter 2. Vue.js \u7ec4\u4ef6","text":"<p>\u7ec4\u4ef6\u662f\u4e00\u6bb5\u72ec\u7acb\u7684\u3001\u4ee3\u8868\u4e86\u9875\u9762\u7684\u4e00\u4e2a\u90e8\u5206\u7684\u4ee3\u7801\u7247\u6bb5\u3002\u5b83\u62e5\u6709\u81ea\u5df1\u7684\u6570\u636e\u3001JavaScript\u811a\u672c\uff0c\u4ee5\u53ca\u6837\u5f0f\u6807\u7b7e\u3002\u7ec4\u4ef6\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u7684\u7ec4\u4ef6\uff0c\u5e76\u4e14\u5b83\u4eec\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u3002\u7ec4\u4ef6\u53ef\u4ee5\u662f\u6309\u94ae\u6216\u8005\u56fe\u6807\u8fd9\u6837\u5f88\u5c0f\u7684\u5143\u7d20\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u66f4\u5927\u7684\u5143\u7d20\uff0c\u6bd4\u5982\u5728\u6574\u4e2a\u7f51\u7ad9\u6216\u8005\u6574\u4e2a\u9875\u9762\u4e0a\u91cd\u590d\u4f7f\u7528\u7684\u8868\u5355</p> <p>\u7ec4\u4ef6\u662f\u72ec\u7acb\u7684\uff0c\u53ef\u4ee5\u786e\u4fdd\u7ec4\u4ef6\u4e2d\u7684\u4ee3\u7801\u4e0d\u4f1a\u5f71\u54cd\u4efb\u4f55\u5176\u4ed6\u7ec4\u4ef6\u6216\u4ea7\u751f\u4efb\u4f55\u526f\u4f5c\u7528</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u7ec4\u4ef6\uff0c\u5e76\u901a\u8fc7 components \u914d\u7f6e\u5bf9\u8c61\u5c06\u5176\u4f20\u5165 app</p> <pre><code>&lt;div id='app'&gt;\n    &lt;custom-button&gt;&lt;/custom-button&gt;\n&lt;/div&gt;\n&lt;script&gt;\n    const CustomButton = {\n        template: '&lt;button&gt;\u81ea\u5b9a\u4e49\u6309\u94ae&lt;/button&gt;'\n    };\n    new Vue({\n        el: '#app',\n        components: {\n            CustomButton\n        }\n    })\n&lt;/script&gt;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>Vue.component()</code> \u6765\u6ce8\u518c\u4e00\u4e2a\u5168\u5c40\u7ec4\u4ef6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u76f4\u63a5\u5728\u4efb\u610f\u6a21\u677f\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u7ec4\u4ef6\u4e86\uff0c\u5e76\u4e0d\u9700\u8981\u5728 components \u914d\u7f6e\u5bf9\u8c61\u4e2d\u6dfb\u52a0\u8be5\u7ec4\u4ef6</p> <pre><code>Vue.component('custom-button', {\n    template: '&lt;button&gt;\u81ea\u5b9a\u4e49\u6309\u94ae&lt;/button&gt;'\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#_1","title":"\u6570\u636e\u3001\u65b9\u6cd5\u548c\u8ba1\u7b97\u5c5e\u6027","text":"<p>\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u62e5\u6709\u81ea\u5df1\u7684\u6570\u636e\u3001\u65b9\u6cd5\u548c\u8ba1\u7b97\u5c5e\u6027\uff0c\u4ee5\u53ca\u524d\u9762\u7ae0\u8282\u4e2d\u51fa\u73b0\u8fc7\u7684\u5c5e\u6027</p> <p>\u7ec4\u4ef6\u4e0e Vue \u5b9e\u4f8b\u4e4b\u95f4\u7684\u4e00\u4e2a\u5dee\u522b\uff1aVue \u5b9e\u4f8b\u4e2d data \u5c5e\u6027\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u4f46\u662f\u7ec4\u4ef6\u4e2d\u7684 data \u5c5e\u6027\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u56e0\u4e3a\u7ec4\u4ef6\u53ef\u4ee5\u5728\u4e00\u4e2a\u9875\u9762\u4e0a\u88ab\u591a\u6b21\u5f15\u7528\uff0c\u5982\u679c\u5171\u4eab\u4e00\u4e2a data \u5bf9\u8c61\u7684\u8bdd\u90a3\u5c06\u4f1a\u662f\u707e\u96be\uff08\u56e0\u4e3a\u540c\u4e00\u4e2a\u7ec4\u4ef6\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u7684data\u5c5e\u6027\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u5f53\u8be5\u7ec4\u4ef6\u7684\u67d0\u4e2a\u5b9e\u4f8b\u4fee\u6539\u4e86\u81ea\u8eab\u7684data\u5c5e\u6027\uff0c\u76f8\u5f53\u4e8e\u6240\u6709\u5b9e\u4f8b\u7684data\u5c5e\u6027\u90fd\u88ab\u4fee\u6539\u4e86\uff09\uff0c\u6240\u4ee5\u7ec4\u4ef6\u7684data\u5c5e\u6027\u5e94\u8be5\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5728\u7ec4\u4ef6\u521d\u59cb\u5316\u65f6Vue\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u751f\u6210data\u5bf9\u8c61</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#_2","title":"\u4f20\u9012\u6570\u636e","text":"<p>\u53ef\u4ee5\u4f7f\u7528 props \u5c5e\u6027\u6765\u4f20\u9012\u6570\u636e</p> <p>Props\u662f\u901a\u8fc7HTML\u5c5e\u6027\u4f20\u5165\u7ec4\u4ef6\u7684\uff08\u6bd4\u5982\u793a\u4f8b\u4e2d\u7684color=\"red\"\uff09\uff1b\u4e4b\u540e\u5728\u7ec4\u4ef6\u5185\u90e8\uff0cprops\u5c5e\u6027\u7684\u503c\u8868\u793a\u53ef\u4ee5\u4f20\u5165\u7ec4\u4ef6\u7684\u5c5e\u6027\u7684\u540d\u79f0</p> <p>prop \u9a8c\u8bc1</p> <p>\u9664\u4e86\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u7684\u7b80\u5355\u6570\u7ec4\uff0c\u6765\u8868\u660e\u7ec4\u4ef6\u53ef\u4ee5\u63a5\u6536\u7684\u5c5e\u6027\u7684\u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u4f20\u9012\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6765\u63cf\u8ff0\u5c5e\u6027\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u5b83\u7684\u7c7b\u578b\u3001\u662f\u5426\u5fc5\u987b\u3001\u9ed8\u8ba4\u503c\u4ee5\u53ca\u7528\u4e8e\u9ad8\u7ea7\u9a8c\u8bc1\u7684\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u51fd\u6570</p> <p>props \u7684\u5927\u5c0f\u5199</p> <p>\u5728HTML\u4e2d\u901a\u8fc7kebab\uff08my-prop=\u2018\u2019\uff09\u5f62\u5f0f\u6307\u5b9a\u7684\u5c5e\u6027\uff0c\u4f1a\u5728\u7ec4\u4ef6\u5185\u90e8\u81ea\u52a8\u8f6c\u6362\u4e3acamel\uff08myProp\uff09\u5f62\u5f0f</p> <p>\u54cd\u5e94\u5f0f</p> <p>\u5bf9\u4e8edata\u5bf9\u8c61\u3001\u65b9\u6cd5\u8fd8\u6709\u8ba1\u7b97\u5c5e\u6027\uff0c\u5f53\u5b83\u4eec\u7684\u503c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6a21\u677f\u4e5f\u4f1a\u66f4\u65b0\uff1b\u540c\u6837\uff0cprops\u4e5f\u662f\u8fd9\u6837\u7684\u3002\u5728\u7236\u7ea7\u5b9e\u4f8b\u4e2d\u8bbe\u5b9aprop\u7684\u503c\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528v-bind\u6307\u4ee4\u5c06\u8be5prop\u4e0e\u67d0\u4e2a\u503c\u7ed1\u5b9a\u3002\u90a3\u4e48\u65e0\u8bba\u4f55\u65f6\u53ea\u8981\u8fd9\u4e2a\u503c\u53d1\u751f\u53d8\u5316\uff0c\u5728\u7ec4\u4ef6\u5185\u4efb\u4f55\u4f7f\u7528\u8be5prop\u7684\u5730\u65b9\u90fd\u4f1a\u66f4\u65b0</p> <p>\u5982\u679c prop \u7684\u503c\u7c7b\u578b\u4e0d\u662f\u5b57\u7b26\u4e32\u7684\u8bdd\uff0c\u90a3\u4e48\u5fc5\u987b\u4f7f\u7528 v-bind \u6307\u4ee4\uff0c\u5426\u5219\u4f1a\u629b\u51fa\u8b66\u544a</p> <p>\u8fd9\u662f\u56e0\u4e3a\u4f20\u9012\u7ed9attr\u7684\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f\u6570\u5b57\u3002\u5982\u679c\u8981\u4f20\u5165\u4e00\u4e2a\u6570\u5b57\uff0c\u5c31\u8981\u4f7f\u7528v-bind\u6307\u4ee4\uff0c\u5b83\u4f1a\u628a\u4f20\u5165\u7684\u503c\u5f53\u4f5c\u8868\u8fbe\u5f0f\u6c42\u503c\uff0c\u7136\u540e\u518d\u4f20\u9012\u7ed9prop</p> <pre><code>&lt;template&gt;\n  &lt;div&gt;propsTest: {{ numberProp }}&lt;/div&gt;\n&lt;/template&gt;\n\n&lt;script&gt;\nexport default {\n  props: {\n    numberProp: {\n      type: Number,\n      required: true,\n    },\n    stringProp: {\n      type: String,\n      required: true\n    }\n  },\n};\n&lt;/script&gt;\n</code></pre> <pre><code>&lt;PropTest v-bind:number-prop='10' stringProp='10a'/&gt;\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#sync","title":"\u6570\u636e\u6d41\u548c.sync\u4fee\u9970\u7b26","text":"<p>\u6570\u636e\u901a\u8fc7prop\u4ece\u7236\u7ea7\u7ec4\u4ef6\u4f20\u9012\u5230\u5b50\u7ec4\u4ef6\u4e2d\uff0c\u5f53\u7236\u7ea7\u7ec4\u4ef6\u4e2d\u7684\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u4f20\u9012\u7ed9\u5b50\u7ec4\u4ef6\u7684prop\u4e5f\u4f1a\u66f4\u65b0\u3002\u4f46\u662f\u4f60\u4e0d\u53ef\u4ee5\u5728\u5b50\u7ec4\u4ef6\u4e2d\u4fee\u6539prop</p> <p>\u5982\u679c\u60f3\u8981\u4f7f\u7528\u53cc\u5411\u7ed1\u5b9a\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4fee\u9970\u7b26\u6765\u5b9e\u73b0\uff1a.sync\u4fee\u9970\u7b26\u3002\u5b83\u53ea\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6</p> <pre><code>&lt;PropTest :number-prop.sync='numberToDisplay' stringProp='10a'/&gt;\n</code></pre> <pre><code>&lt;PropTest \n    :number-prop='numberToDisplay'\n    @update:number-prop='numberToDisplay'\n    stringProp='10a'/&gt;\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u66f4\u6539\u7236\u7ea7\u7ec4\u4ef6\u7684\u503c\uff0c\u5219\u9700\u8981\u89e6\u53d1 update:number-prop \u4e8b\u4ef6</p> <pre><code>&lt;template&gt;\n  &lt;div&gt;\n    &lt;p&gt;propsTest: {{ numberProp }}&lt;/p&gt;\n    &lt;button @click=\"updateNumber\"&gt;{{ numberSync }}&lt;/button&gt;\n  &lt;/div&gt;\n\n&lt;/template&gt;\n\n&lt;script&gt;\nexport default {\n  props: {\n    numberProp: {\n      type: Number,\n      required: true,\n    },\n    stringProp: {\n      type: String,\n      required: true\n    },\n    numberSync: {\n      type: Number,\n      required: true,\n    }\n  },\n  methods: {\n    // \u89e6\u53d1\u7236\u7ea7\u7ec4\u4ef6 update:number-sync \u7684\u6267\u884c\n    updateNumber(){\n      this.$emit('update:number-sync', 4)\n    }\n  }\n};\n&lt;/script&gt;\n</code></pre> <pre><code>&lt;PropTest v-bind:number-prop='10' stringProp='10a' :number-sync.sync=\"number1\"/&gt;\n</code></pre> <p>::Warning\uff1a\u5982\u679c\u7236\u7ea7\u7ec4\u4ef6\u4e0e\u5b50\u7ec4\u4ef6\u90fd\u5bf9\u540c\u4e00\u4e2a\u503c\u7684\u66f4\u65b0\u505a\u51fa\u53cd\u5e94\uff0c\u5e76\u4e14\u5728\u5904\u7406\u66f4\u65b0\u7684\u8fc7\u7a0b\u4e2d\u518d\u6b21\u6539\u53d8\u8fd9\u4e2a\u503c\uff0c\u8fd9\u4f1a\u8ba9\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u95ee\u9898\u3002::</p> <p>\u5982\u679c\u4ec5\u4ec5\u60f3\u8981\u66f4\u65b0\u4eceprop\u4f20\u5165\u7684\u503c\uff0c\u800c\u4e0d\u5173\u5fc3\u7236\u7ea7\u7ec4\u4ef6\u7684\u503c\u7684\u66f4\u65b0\uff0c\u4f60\u53ef\u4ee5\u5728\u4e00\u5f00\u59cb\u7684data\u51fd\u6570\u4e2d\u901a\u8fc7this\u6765\u5f15\u7528prop\u7684\u503c\uff0c\u5c06\u5b83\u590d\u5236\u5230data\u5bf9\u8c61\u4e2d\uff0c\u5e76\u4e3a prop \u6dfb\u52a0\u4e00\u4e2a\u4fa6\u542c\u5668\uff0c\u5f53prop\u53d8\u5316\u65f6\u5c06\u65b0\u503c\u62f7\u8d1d\u5230data \u5bf9\u8c61\u4e2d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#v-model","title":"\u81ea\u5b9a\u4e49\u8f93\u5165\u7ec4\u4ef6\u4e0e v-model","text":"<p>\u4e0e.sync\u4fee\u9970\u7b26\u76f8\u4f3c\uff0c\u53ef\u4ee5\u5728\u7ec4\u4ef6\u4e0a\u4f7f\u7528v-model\u6307\u4ee4\u6765\u521b\u5efa\u81ea\u5b9a\u4e49\u8f93\u5165\u7ec4\u4ef6</p> <pre><code>&lt;input-username\n    v-model=\"username\" /&gt;\n</code></pre> <p>\u7b49\u6548\u4e8e\uff1a</p> <pre><code>&lt;input-username\n    :value=\"username\"\n    @input=\"value=&gt;username=value\" /&gt;\n</code></pre> <p>\u6240\u4ee5\uff0c\u521b\u5efainputUsername \u7ec4\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u5b83\u505a\u4e24\u4ef6\u4e8b\uff1a\u9996\u5148\uff0c\u9700\u8981\u901a\u8fc7value \u5c5e\u6027\u83b7\u53d6\u521d\u59cb\u503c\uff0c\u7136\u540e\u65e0\u8bba\u4f55\u65f6\u53ea\u8981value\u503c\u53d1\u751f\u53d8\u5316\uff0c\u5b83\u5fc5\u987b\u89e6\u53d1\u4e00\u4e2ainput \u4e8b\u4ef6</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#slot","title":"\u4f7f\u7528\u63d2\u69fd\uff08slot\uff09\u5c06\u5185\u5bb9\u4f20\u9012\u7ed9\u7ec4\u4ef6","text":"<p>\u9664\u4e86\u5c06\u6570\u636e\u4f5c\u4e3aprop \u4f20\u5165\u5230\u7ec4\u4ef6\u4e2d\uff0cVue\u4e5f\u652f\u6301\u4f20\u5165HTML\u3002</p> <pre><code>&lt;template&gt;\n  &lt;div&gt;\n    &lt;!-- \u5982\u679c\u4e0d\u4f20\u503c\uff0c\u5219\u663e\u793a\u9ed8\u8ba4\u5185\u5bb9 --&gt;\n    &lt;slot&gt;\u8fd9\u662f\u9ed8\u8ba4\u5185\u5bb9&lt;/slot&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n</code></pre> <pre><code>&lt;!-- \u5982\u679c\u4f20\u503c\uff0c\u5219\u4f1a\u7528\u4f20\u5165\u503c\u66ff\u6362\u6389\u9ed8\u8ba4\u503c --&gt;\n&lt;slot-test&gt;\u6de6&lt;/slot-test&gt;\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#_3","title":"\u5177\u540d\u63d2\u69fd","text":"<p>\u5177\u540d\u63d2\u69fd\u5141\u8bb8\u4f60\u5728\u540c\u4e00\u7ec4\u4ef6\u4e2d\u62e5\u6709\u591a\u4e2a\u63d2\u69fd</p> <pre><code>&lt;template&gt;\n  &lt;div&gt;\n    &lt;header&gt;\n      &lt;slot name=\"header\"&gt;&lt;/slot&gt;\n    &lt;/header&gt;\n    &lt;main&gt;\n      &lt;slot&gt;&lt;/slot&gt;\n    &lt;/main&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n</code></pre> <p>\u4f7f\u7528\u65b9\u6cd5</p> <pre><code>&lt;slot-test&gt;\n    &lt;h2 slot=\"header\"&gt;\u8fd9\u662fheader&lt;/h2&gt;\n    &lt;p&gt;\u6de6&lt;/p&gt;\n&lt;/slot-test&gt;\n</code></pre> <p>\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684 h2\u5219\u4f1a\u5728 name=header\u7684slot \u7684\u4f4d\u7f6e\u8f93\u51fa\uff0c\u4e8c\u5176\u4ed6\u5185\u5bb9\u5219\u4f1a\u8f93\u51fa\u5728slot\u4f4d\u7f6e</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#_4","title":"\u4f5c\u7528\u57df\u63d2\u69fd","text":"<p>\u53ef\u4ee5\u5c06\u6570\u636e\u4f20\u56deslot\u7ec4\u4ef6\uff0c\u4f7f\u7236\u7ec4\u4ef6\u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u8bbf\u95ee\u5b50\u7ec4\u4ef6\u4e2d\u7684\u6570\u636e</p> <pre><code>&lt;template&gt;\n  &lt;div class=\"user\"&gt;\n    &lt;slot :user=\"user\"&gt;&lt;/slot&gt;\n  &lt;/div&gt;\n&lt;/template&gt;\n</code></pre> <pre><code>&lt;slot-test v-slot=\"user\"&gt;    \n  &lt;p&gt;\u6de6&lt;/p&gt;\n  &lt;p v-if=\"user\"&gt;\u7528\u6237\u540d\uff1a{{ user }}&lt;/p&gt;\n&lt;/slot-test&gt;\n</code></pre> <p>\u81ea\u5b9a\u4e49\u4e8b\u4ef6</p> <p>\u5728 component\u4e2d\u89e6\u53d1\u8c03\u7528 <code>this.$emit(\u2018event\u2019)</code></p> <p>\u4f7f\u7528\u8fd9\u4e2acomponent\u65f6 <code>&lt;my-component v-on:event=\u201c\u201d&gt;&lt;/my-component&gt;</code></p> <p>\u53c2\u89c1 \u81ea\u5b9a\u4e49\u4e8b\u4ef6</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#mixin","title":"Mixin","text":"<p>Mixin \u662f\u4e00\u79cd\u4ee3\u7801\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5728\u591a\u4e2a\u7ec4\u4ef6\u95f4\u6a2a\u5411\u590d\u7528\u4ee3\u7801\u3002\u5f53\u7ec4\u4ef6\u95f4\u5305\u542b\u6bd4\u8f83\u591a\u7684\u5171\u540c\u903b\u8f91\u4ee3\u7801\uff0c\u90a3\u4e48\u6709\u4e09\u79cd\u65b9\u5f0f\u6765\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\uff1a\u4e3a\u6240\u6709\u7ec4\u4ef6\u7f16\u5199\u91cd\u590d\u4ee3\u7801\uff1b\u5c06\u5171\u540c\u4ee3\u7801\u5206\u79bb\u5230\u591a\u4e2a\u51fd\u6570\u4e2d\uff0c\u5e76\u5b58\u50a8\u5230util \u6587\u4ef6\u91cc\uff1b\u4f7f\u7528 mixin\uff0c\u5f53\u7136\uff0cmixin \u66f4\u7b26\u5408Vue \u4e60\u60ef\u7684\u5904\u7406\u65b9\u5f0f</p> <p>\u53ea\u8981\u5c06 mixin \u5bf9\u8c61\u6dfb\u52a0\u5230\u7ec4\u4ef6\u4e2d\uff0c\u90a3\u4e48\u8be5\u7ec4\u4ef6\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u5b58\u50a8\u5728 mixin \u5bf9\u8c61\u4e2d\u7684\u4efb\u4f55\u4e1c\u897f</p> <p>mixin \u5bf9\u8c61\u548c \u7ec4\u4ef6\u7684\u5408\u5e76</p> <p>\u5bf9\u4e8e\u751f\u547d\u5468\u671f\u7684\u94a9\u5b50\uff0cVue \u4f1a\u5c06 mixin \u548c\u7ec4\u4ef6\u4e2d\u7684\u5b9e\u73b0\u6dfb\u52a0\u5230\u4e00\u4e2a\u6570\u7ec4\u4e2d\uff0c\u5e76\u5168\u90e8\u6267\u884c</p> <p>\u4f46\u662f\u5bf9\u4e8e\u91cd\u590d\u7684\u65b9\u6cd5\u3001\u8ba1\u7b97\u5c5e\u6027\u6216\u8005\u5176\u4ed6\u7ec4\u4ef6\u81ea\u6709\u7684\u975e\u751f\u547d\u5468\u671f\u94a9\u5b50\u7684\u5c5e\u6027\uff0c\u90a3\u4e48\u7ec4\u4ef6\u4e2d\u7684\u5c5e\u6027\u4f1a\u8986\u76d6\u6389 mixin \u5bf9\u8c61\u4e2d\u76f8\u540c\u7684\u5c5e\u6027</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#vue-loader-vue","title":"vue-loader \u548c .vue \u6587\u4ef6","text":"<p>vue-loader \u63d0\u4f9b\u4e86\u4e00\u79cd\u65b9\u6cd5\uff0c\u53ef\u4ee5\u518d\u5728 .vue \u6587\u4ef6\u4e2d\u7f16\u5199\u57fa\u4e8e\u5355\u4e2a\u6587\u4ef6\u7684\u7ec4\u4ef6</p> <pre><code>&lt;template&gt;\n&lt;/template&gt;\n&lt;script&gt;\nexport default{\n\n}\n&lt;/script&gt;\n&lt;style&gt;\n&lt;/style&gt;\n</code></pre> <p>\u7ecf\u8fc7webpack \u548c vue-loader \u5904\u7406\u4e4b\u540e\uff0c\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u7ec4\u4ef6\uff0c\u5728\u7236\u7ec4\u4ef6\u4e2d\u901a\u8fc7 import \u7684\u65b9\u5f0f\u5f15\u5165\u5b50\u7ec4\u4ef6</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#prop","title":"\u975e prop \u5c5e\u6027","text":"<p>\u5982\u679c\u67d0\u4e2a\u7ec4\u4ef6\u8bbe\u7f6e\u7684\u5c5e\u6027\u5e76\u4e0d\u662f\u7528\u4f5cprop\uff0c\u90a3\u4e48\u8be5\u5c5e\u6027\u4f1a\u88ab\u6dfb\u52a0\u5230 HTML \u8ddf\u5143\u7d20\u4e0a\uff0c\u6bd4\u5982\u4e00\u4e9b\u9ed8\u8ba4\u7684 HTML attribute  class\uff0cstyle \u7b49</p> <p>\u5982\u679c\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u7684\u6839\u5143\u7d20\u8bbe\u7f6e\u76f8\u540c\u7684\u5c5e\u6027\uff0c\u90a3\u4e48\u5982\u679c\u8be5\u5c5e\u6027\u4e3a class \u6216\u8005 style\uff0c\u90a3\u4e48\u8f93\u51fa\u7ed3\u679c\u4e2d\u5c06\u4f1a\u5408\u5e76\u7ec4\u4ef6\u548c\u7ec4\u4ef6\u8ddf\u5143\u7d20\u8bbe\u7f6e\u7684\u5c5e\u6027\u503c\uff0c\u5982\u679c\u662f\u5176\u4ed6\u5c5e\u6027\uff0c\u90a3\u4e48\u7ec4\u4ef6\u4e2d\u8bbe\u7f6e\u7684\u5c5e\u6027\u503c\u4f1a\u76f4\u63a5\u66ff\u6362\u6389\u7ec4\u4ef6\u6839\u5143\u7d20\u7684\u5c5e\u6027\u503c</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%202.%20Vue.js%20%E7%BB%84%E4%BB%B6/#v-for","title":"\u7ec4\u4ef6\u548c v-for \u6307\u4ee4","text":"<p>\u5f53\u4f7f\u7528v-for\u6307\u4ee4\u904d\u5386\u4e00\u4e2a\u6570\u7ec4\u6216\u662f\u5bf9\u8c61\uff0c\u5e76\u4e14\u7ed9\u5b9a\u7684\u6570\u7ec4\u6216\u5bf9\u8c61\u6539\u53d8\u65f6\uff0cVue\u4e0d\u4f1a\u518d\u91cd\u590d\u751f\u6210\u6240\u6709\u7684\u5143\u7d20\uff0c\u800c\u662f\u667a\u80fd\u5730\u627e\u5230\u9700\u8981\u66f4\u6539\u7684\u5143\u7d20\uff0c\u5e76\u4e14\u53ea\u66f4\u6539\u8fd9\u4e9b\u5143\u7d20\u3002</p> <p>\u53ef\u662f\uff0c\u5982\u679c\u4f60\u5728\u6570\u7ec4\u7684\u4e2d\u95f4\u5220\u9664\u6216\u662f\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\uff0cVue\u4e0d\u4f1a\u77e5\u9053\u8be5\u5143\u7d20\u5bf9\u5e94\u7684\u662f\u9875\u9762\u4e0a\u54ea\u4e00\u4e2a\u5143\u7d20\uff0c\u5b83\u4f1a\u66f4\u65b0\u4ece\u5220\u9664\u6216\u662f\u6dfb\u52a0\u5143\u7d20\u7684\u4f4d\u7f6e\u5230\u5217\u8868\u7ed3\u5c3e\u4e4b\u95f4\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u3002\u8fd9\u79cd\u64cd\u4f5c\u5bf9\u4e8e\u590d\u6742\u7ed3\u6784\u6765\u8bf4\uff0c\u663e\u7136\u662f\u4e0d\u5408\u9002\u7684</p> <p>\u4f7f\u7528v-for\u6307\u4ee4\u65f6\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2akey\u5c5e\u6027\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u544a\u8bc9Vue\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u5e94\u8be5\u4e0e\u9875\u9762\u4e0a\u54ea\u4e2a\u5143\u7d20\u76f8\u5173\u8054\uff0c\u4ece\u800c\u5220\u9664\u6b63\u786e\u7684\u5143\u7d20</p> <p>\u4f7f\u7528\u6570\u7ec4\u4e0b\u6807\u4f5c\u4e3akey \u503c\u4e5f\u662f\u4e0d\u660e\u667a\u7684\uff0c\u867d\u7136Vue\u4e0d\u4f1a\u518d\u53d1\u51fa\u8b66\u544a\uff0c\u4e00\u4e2a\u5e76\u975e\u4f60\u671f\u671b\u7684\u5143\u7d20\u5c06\u88ab\u5220\u9664</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/","title":"Chapter 3. \u4f7f\u7528 Vue \u6dfb\u52a0\u6837\u5f0f","text":"<p>Vue\u63d0\u4f9b\u4e86\u51e0\u79cd\u65b9\u5f0f\u6765\u4e3a\u7f51\u7ad9\u6216\u662f\u5e94\u7528\u6dfb\u52a0\u6837\u5f0f\u3002<code>v-bind:class</code> \u548c <code>v-bind:style</code> \u4e24\u8005\u90fd\u6709\u4e13\u95e8\u7684\u529f\u80fd\uff0c\u5e2e\u52a9\u4f60\u901a\u8fc7\u6570\u636e\u8bbe\u7f6eclass\u5c5e\u6027\u548c\u5185\u8054\u6837\u5f0f\u3002\u5f53\u7ed3\u5408vue-loader\u4f7f\u7528\u7ec4\u4ef6\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528scoped CSS\u6765\u6dfb\u52a0\u6837\u5f0f\uff0c\u5e76\u4e14\u53ea\u5728\u8be5CSS\u6240\u5728\u7684\u7ec4\u4ef6\u4e2d\u6709\u6548</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/#class","title":"class \u7ed1\u5b9a","text":"<p>\u901a\u5e38\u4f7f\u7528 v-bind \u6765\u7ed1\u5b9a class \u5c5e\u6027\uff0c\u4ece\u800c\u6839\u636e\u6570\u636e\u7684\u53d8\u5316\u6dfb\u52a0\u6216\u5220\u9664\u7c7b\u540d\u3002</p> <p>\u5982\u679c\u4f20\u9012\u4e00\u4e2a\u6570\u7ec4\u7ed9v-bind:class\uff0c\u6570\u7ec4\u4e2d\u7684\u7c7b\u540d\u5c06\u4f1a\u88ab\u62fc\u63a5\u5230\u4e00\u8d77</p> <p>\u4e5f\u53ef\u4ee5\u5728\u6570\u7ec4\u8bed\u6cd5\u4e2d\u4f7f\u7528\u5bf9\u8c61\u8bed\u6cd5</p> <p>\u5982\u4e0b\u4f8b\u4e2d\uff0c\u53ea\u6709\u5f53 hasError \u4e3a true \u65f6\u624d\u4f1a\u6dfb\u52a0error \u7c7b</p> <pre><code>&lt;class-and-style \n    v-bind:class=\"[actived, background, {error: hasError}]\"&gt;\n&lt;/class-and-style&gt;\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/#_1","title":"\u5185\u8054\u6837\u5f0f\u7ed1\u5b9a","text":"<p><code>v-bind:style</code> \u7684\u5bf9\u8c61\u8bed\u6cd5\u5341\u5206\u76f4\u89c2\u2014\u2014\u770b\u7740\u975e\u5e38\u50cf CSS\uff0c\u4f46\u5176\u5b9e\u662f\u4e00\u4e2a JavaScript \u5bf9\u8c61</p> <pre><code>&lt;div v-bind:style=\"{ color: activeColor, fontSize: fontSize + 'px' }\"&gt;&lt;/div&gt;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u7ed1\u5b9a\u4e00\u4e2a\u6837\u5f0f\u5bf9\u8c61\uff0c\u8fd9\u6837\u4f1a\u8ba9\u6a21\u677f\u66f4\u6e05\u6670\uff0c</p> <p>\u5728data \u4e2d\u5b9a\u4e49\u4e00\u4e2a\u6837\u5f0f\u5bf9\u8c61</p> <pre><code>data(){\n    return {\n        styleObject: {\n            color: 'red',   \n        }\n    }\n}\n</code></pre> <pre><code>&lt;div v-bind:style=\"styleObject\"&gt;&lt;/div&gt;\n</code></pre> <p><code>v-bind:style</code> \u7684\u6570\u7ec4\u8bed\u6cd5\u53ef\u4ee5\u5c06\u591a\u4e2a\u6837\u5f0f\u5bf9\u8c61\u5e94\u7528\u5230\u540c\u4e00\u4e2a\u5143\u7d20\u4e0a</p> <pre><code>&lt;div v-bind:style=\"[baseStyles, overridingStyles]\"&gt;&lt;/div&gt;\n</code></pre> <p>\u5f53 <code>v-bind:style</code> \u4f7f\u7528\u9700\u8981\u6dfb\u52a0\u6d4f\u89c8\u5668\u5f15\u64ce\u524d\u7f00\u7684 CSS property \u65f6\uff0c\u5982 <code>transform</code>\uff0cVue.js \u4f1a\u81ea\u52a8\u4fa6\u6d4b\u5e76\u6dfb\u52a0\u76f8\u5e94\u7684\u524d\u7f00\u3002</p> <p>\u591a\u91cd\u503c</p> <p>\u4ece 2.3.0 \u8d77\u4f60\u53ef\u4ee5\u4e3a <code>style</code> \u7ed1\u5b9a\u4e2d\u7684 property \u63d0\u4f9b\u4e00\u4e2a\u5305\u542b\u591a\u4e2a\u503c\u7684\u6570\u7ec4\uff0c\u5e38\u7528\u4e8e\u63d0\u4f9b\u591a\u4e2a\u5e26\u524d\u7f00\u7684\u503c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;div :style=\"{ display: ['-webkit-box', '-ms-flexbox', 'flex'] }\"&gt;&lt;/div&gt;\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/#vue-loader-scoped-css","title":"\u7528 vue-loader \u5b9e\u73b0 scoped CSS","text":"<p>\u4e0eJavaScript\u4e0d\u540c\uff0c\u7ec4\u4ef6\u4e2d\u7684CSS\u4e0d\u4ec5\u4f1a\u5f71\u54cd\u81ea\u8eab\uff0c\u8fd8\u4f1a\u5f71\u54cd\u5230\u9875\u9762\u4e0a\u6240\u6709\u7684HTML\u5143\u7d20</p> <p>Vue \u63d0\u4f9b\u4e86\u4e00\u79cd\u4e3a\u7ec4\u4ef6 css \u6dfb\u52a0\u4f5c\u7528\u57df\u7684\u65b9\u6cd5\uff0c\u5c06\u7ec4\u4ef6\u4e2d\u7684 <code>&lt;style&gt;&lt;/style&gt;</code> \u6dfb\u52a0 scoped \u5c5e\u6027 <code>&lt;style scoped&gt;&lt;/style&gt;</code> \u53ef\u4ee5\u5c06 \u7ec4\u4ef6\u4e2d\u7684 css \u9650\u5236\u4e3a\u53ea\u5728\u8be5\u7ec4\u4ef6\u4e2d\u6709\u6548</p> <p>\u6dfb\u52a0 scoped \u5c5e\u6027\u540e\uff0c\u8f93\u51fa\u7684 HTML \u4f1a\u4e3a\u7ec4\u4ef6\u4e2d\u6bcf\u4e2a HTML \u6807\u7b7e\u6dfb\u52a0\u4e00\u4e2a\u552f\u4e00\u7684 data-v-**** \u5c5e\u6027\uff0c\u540c\u65f6\u4e5f\u5c06\u5176\u6dfb\u52a0\u5230CSS\u9009\u62e9\u5668\u4e2d\u6765\u4fdd\u8bc1 CSS \u53ea\u5bf9\u7ec4\u4ef6\u4e2d\u7684 HTML \u6709\u6548\u3002</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/#vue-loader-css-modules","title":"\u7528 vue-loader \u5b9e\u73b0 CSS Modules","text":"<p>\u4f5c\u4e3ascoped CSS\u7684\u66ff\u4ee3\u65b9\u6848\uff0c\u53ef\u4ee5\u7528vue-loader\u5b9e\u73b0CSS Modules</p> <p>\u5c06\u7ec4\u4ef6\u4e2d\u7684 <code>&lt;style&gt;&lt;/style&gt;</code> \u6dfb\u52a0 module \u5c5e\u6027 <code>&lt;style module&gt;&lt;/style&gt;</code> \u5e76\u901a\u8fc7 $style.className \u6765\u5f15\u7528\u5b9a\u4e49\u597d\u7684\u7c7b</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%203.%20%E4%BD%BF%E7%94%A8%20Vue%20%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F/#_2","title":"\u9884\u5904\u7406\u5668","text":"<p>\u53ef\u4ee5\u8bbe\u7f6evue-loader\u6765\u8ba9\u9884\u5904\u7406\u5668\u5904\u7406CSS\u3001JavaScript\u548cHTML\u3002\u5047\u8bbe\u60f3\u8981\u4f7f\u7528SCSS\u800c\u4e0d\u662fCSS\uff0c\u4ee5\u5229\u7528\u8bf8\u5982\u5d4c\u5957\u548c\u53d8\u91cf\u8fd9\u6837\u7684\u7279\u6027\u3002\u53ef\u4ee5\u901a\u8fc7\u4e24\u4e2a\u6b65\u9aa4\u6765\u5b9e\u73b0\uff1a\u9996\u5148\u901a\u8fc7npm\u5b89\u88c5sass-loader\u548cnode-sass\uff0c\u7136\u540e\u5728style\u6807\u7b7e\u4e0a\u6dfb\u52a0lang=\"scss\"</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/","title":"Chapter 4. render \u51fd\u6570\u548c JSX","text":""},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/#_1","title":"\u57fa\u7840","text":"<p>Vue \u63a8\u8350\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4f7f\u7528\u6a21\u677f\u6765\u521b\u5efa HTML\uff0c\u4f46\u662f\u4e00\u4e9b\u590d\u6742\u7684\u573a\u666f\u4e2d\uff0c\u9700\u8981 JavaScript \u7684\u5b8c\u5168\u7f16\u7a0b\u80fd\u529b\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 \u6e32\u67d3\u51fd\u6570</p> <p>\u4f8b\u5982\u53ea\u80fd\u901a\u8fc7 level \u7684 prop \u52a8\u6001\u751f\u6210\u6807\u9898\uff08heading\uff09\u7ec4\u4ef6\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u5b9e\u73b0</p> <pre><code>Vue.component('anchored-heading', {\n    render: function(createElement){\n        return createElement(\n            'h' + this.level, // \u6807\u7b7e\u540d\u79f0\n            this.$slots.default // \u5b50\u8282\u70b9\u6570\u636e\n        )\n    },\n    props: {\n        level: {\n            type: Number,\n            required: true\n        }\n    }\n})\n</code></pre> <p>\u5411\u7ec4\u4ef6\u4e2d\u4f20\u9012\u4e0d\u5e26 <code>v-slot</code> \u6307\u4ee4\u7684\u5b50\u8282\u70b9\u65f6\uff0c\u6bd4\u5982 <code>anchored-heading</code> \u4e2d\u7684 <code>Hello world!</code>\uff0c\u8fd9\u4e9b\u5b50\u8282\u70b9\u88ab\u5b58\u50a8\u5728\u7ec4\u4ef6\u5b9e\u4f8b\u4e2d\u7684 <code>$slots.default</code> \u4e2d\uff0c\u8be6\u7ec6\u8bf7\u53c2\u89c1\uff1a \u5b9e\u4f8bProperty</p> <p>render\u51fd\u6570\u4f18\u4e8etemplate\u7684\u4e00\u4e2a\u5f88\u5927\u7684\u4f18\u52bf\uff0c\u5c31\u662f\u5728template\u4e2d\u52a8\u6001\u8bbe\u7f6e\u6807\u7b7e\u540d\u79f0\u5e76\u4e0d\u662f\u90a3\u4e48\u5bb9\u6613\u7684\uff0c\u5e76\u4e14\u4ee3\u7801\u53ef\u8bfb\u6027\u4e5f\u4e0d\u597d\u3002&lt;{{ tagName }}&gt;\u5199\u6cd5\u4e5f\u662f\u65e0\u6548\u7684</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/#dom","title":"\u865a\u62df DOM","text":"<p>Vue \u901a\u8fc7\u5efa\u7acb\u4e00\u4e2a\u865a\u62df DOM \u6765\u8ffd\u8e2a\u81ea\u5df1\u8981\u5982\u4f55\u6539\u53d8\u771f\u5b9e DOM</p> <p><code>createElement\u8fd4\u56de\u7684</code>\u5176\u5b9e\u4e0d\u662f\u4e00\u4e2a\u5b9e\u9645\u7684 DOM \u5143\u7d20\u3002\u5b83\u66f4\u51c6\u786e\u7684\u540d\u5b57\u53ef\u80fd\u662f <code>createNodeDescription</code>\uff0c\u56e0\u4e3a\u5b83\u6240\u5305\u542b\u7684\u4fe1\u606f\u4f1a\u544a\u8bc9 Vue \u9875\u9762\u4e0a\u9700\u8981\u6e32\u67d3\u4ec0\u4e48\u6837\u7684\u8282\u70b9\uff0c\u5305\u62ec\u53ca\u5176\u5b50\u8282\u70b9\u7684\u63cf\u8ff0\u4fe1\u606f\u3002\u6211\u4eec\u628a\u8fd9\u6837\u7684\u8282\u70b9\u63cf\u8ff0\u4e3a\u201c\u865a\u62df\u8282\u70b9 (virtual node)\u201d\uff0c\u4e5f\u5e38\u7b80\u5199\u5b83\u4e3a\u201cVNode\u201d\u3002\u201c\u865a\u62df DOM\u201d\u662f\u6211\u4eec\u5bf9\u7531 Vue \u7ec4\u4ef6\u6811\u5efa\u7acb\u8d77\u6765\u7684\u6574\u4e2a VNode \u6811\u7684\u79f0\u547c\u3002</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/#render-createelement","title":"render \u51fd\u6570\u4e2d createElement \u7684\u53c2\u6570","text":"<pre><code>// @returns {VNode}\ncreateElement(\n  // {String | Object | Function}\n  // \u4e00\u4e2a HTML \u6807\u7b7e\u540d\u3001\u7ec4\u4ef6\u9009\u9879\u5bf9\u8c61\uff0c\u6216\u8005\n  // resolve \u4e86\u4e0a\u8ff0\u4efb\u4f55\u4e00\u79cd\u7684\u4e00\u4e2a async \u51fd\u6570\u3002\u5fc5\u586b\u9879\u3002\n  'div',\n\n  // {Object}\n  // \u4e00\u4e2a\u4e0e\u6a21\u677f\u4e2d attribute \u5bf9\u5e94\u7684\u6570\u636e\u5bf9\u8c61\u3002\u53ef\u9009\u3002\n  {\n    // (\u8be6\u60c5\u89c1\u4e0b\u4e00\u8282)\n  },\n\n  // {String | Array}\n  // \u5b50\u7ea7\u865a\u62df\u8282\u70b9 (VNodes)\uff0c\u7531 `createElement()` \u6784\u5efa\u800c\u6210\uff0c\n  // \u4e5f\u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u6765\u751f\u6210\"\u6587\u672c\u865a\u62df\u8282\u70b9\"\u3002\u53ef\u9009\u3002\n  [\n    '\u5148\u5199\u4e00\u4e9b\u6587\u5b57',\n    createElement('h1', '\u4e00\u5219\u5934\u6761'),\n    createElement(MyComponent, {\n      props: {\n        someProp: 'foobar'\n      }\n    })\n  ]\n)\n</code></pre> <ul> <li>html \u6807\u7b7e\uff1a\u6807\u7b7e\u540d\u79f0\u662f\u6700\u7b80\u5355\u7684\uff0c\u4e5f\u662f\u552f\u4e00\u4e00\u4e2a\u5fc5\u9700\u7684\u53c2\u6570\u3002\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u6216\u662f\u4e00\u4e2a\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u51fd\u6570</li> <li>\u6570\u636e\u5bf9\u8c61\uff1a\u4e00\u4e2a\u4e0e\u6a21\u677f\u4e2d attribute \u5bf9\u5e94\u7684\u6570\u636e\u5bf9\u8c61\uff0c \u6b63\u5982 <code>v-bind:class</code> \u548c <code>v-bind:style</code> \u5728\u6a21\u677f\u8bed\u6cd5\u4e2d\u4f1a\u88ab\u7279\u522b\u5bf9\u5f85\u4e00\u6837\uff0c\u5b83\u4eec\u5728 VNode \u6570\u636e\u5bf9\u8c61\u4e2d\u4e5f\u6709\u5bf9\u5e94\u7684\u9876\u5c42\u5b57\u6bb5\u3002\u8be5\u5bf9\u8c61\u4e5f\u5141\u8bb8\u4f60\u7ed1\u5b9a\u666e\u901a\u7684 HTML attribute\uff0c\u4e5f\u5141\u8bb8\u7ed1\u5b9a\u5982 <code>innerHTML</code> \u8fd9\u6837\u7684 DOM property (\u8fd9\u4f1a\u8986\u76d6 <code>v-html</code> \u6307\u4ee4)</li> <li>\u5b50\u865a\u62df\u8282\u70b9\uff1aVNode \u5fc5\u987b\u552f\u4e00\uff0c\u7ec4\u4ef6\u6811\u4e2d\u6240\u6709\u7684 VNode \u5fc5\u987b\u662f\u552f\u4e00\u7684\uff0ccreateElement \u5b57\u8282\u70b9\u4e2d\u4f7f\u7528\u7684\u6240\u6709VNode\u5fc5\u987b\u662f\u552f\u4e00\u7684\uff0c\u4e0d\u80fd\u5b9e\u4f8b\u5316\u4e00\u4e2a\u800c\u5728\u5b50\u8282\u70b9\u4e2d\u91cd\u590d\u4f7f\u7528\u591a\u6b21</li> </ul> <p>\u6e32\u67d3\u51fd\u6570\u4e2d\u6ca1\u6709\u4e0e <code>v-model</code> \u7684\u76f4\u63a5\u5bf9\u5e94\u2014\u2014\u4f60\u5fc5\u987b\u81ea\u5df1\u5b9e\u73b0\u76f8\u5e94\u7684\u903b\u8f91</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/#jsx","title":"JSX","text":"<p>\u5982\u679c\u4f60\u5199\u4e86\u5f88\u591a <code>render</code> \u51fd\u6570\uff0c\u53ef\u80fd\u4f1a\u89c9\u5f97\u5b50\u865a\u62df\u8282\u70b9\u53c2\u6570\u7684\u7ed3\u6784\u5f88\u590d\u6742\u901a\u8fc7 createElement\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u865a\u62df\u8282\u70b9\u7684\u7ed3\u6784\u5f88\u9ebb\u70e6\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0Bable \u63d2\u4ef6 \u5728Vue\u4e2d\u4f7f\u7528 JSX \u8bed\u6cd5</p> <pre><code>render: function (h) {\n    return (\n      &lt;AnchoredHeading level={1}&gt;\n        &lt;span&gt;Hello&lt;/span&gt; world!\n      &lt;/AnchoredHeading&gt;\n    )\n  }\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%204.%20render%20%E5%87%BD%E6%95%B0%E5%92%8C%20JSX/#_2","title":"\u51fd\u6570\u5f0f\u7ec4\u4ef6","text":"<p>\u4e00\u4e9b\u7b80\u5355\u7684\u7ec4\u4ef6\uff0c\u6ca1\u6709\u4efb\u4f55\u72b6\u6001\u7ba1\u7406\uff0c\u4e0d\u9700\u8981\u76d1\u542c\u4efb\u4f55\u72b6\u6001\uff0c\u4e5f\u6ca1\u6709\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7684\u8bdd\uff0c\u53ef\u4ee5\u5c06\u7ec4\u4ef6\u6807\u8bb0\u4e3a functional\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u65e0\u72b6\u6001\uff08\u6ca1\u6709\u54cd\u5e94\u5f0f\u6570\u636e\uff09\uff0c\u4e5f\u6ca1\u6709\u5b9e\u4f8b\uff08\u6ca1\u6709 this \u4e0a\u4e0b\u6587\uff09</p> <pre><code>Vue.component('my-component', {\n  functional: true,\n  // Props \u662f\u53ef\u9009\u7684\n  props: {\n    // ...\n  },\n  // \u4e3a\u4e86\u5f25\u8865\u7f3a\u5c11\u7684\u5b9e\u4f8b\n  // \u63d0\u4f9b\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f5c\u4e3a\u4e0a\u4e0b\u6587\n  render: function (createElement, context) {\n    // ...\n  }\n})\n</code></pre> <p>\u7ec4\u4ef6\u9700\u8981\u7684\u4e00\u5207\u90fd\u662f\u901a\u8fc7 <code>context</code> \u53c2\u6570\u4f20\u9012\uff0c\u5b83\u662f\u4e00\u4e2a\u5305\u62ec\u5982\u4e0b\u5b57\u6bb5\u7684\u5bf9\u8c61\uff1a</p> <ul> <li><code>props</code>\uff1a\u63d0\u4f9b\u6240\u6709 prop \u7684\u5bf9\u8c61</li> <li><code>children</code>\uff1aVNode \u5b50\u8282\u70b9\u7684\u6570\u7ec4</li> <li><code>slots</code>\uff1a\u4e00\u4e2a\u51fd\u6570\uff0c\u8fd4\u56de\u4e86\u5305\u542b\u6240\u6709\u63d2\u69fd\u7684\u5bf9\u8c61</li> <li><code>scopedSlots</code>\uff1a(2.6.0+) \u4e00\u4e2a\u66b4\u9732\u4f20\u5165\u7684\u4f5c\u7528\u57df\u63d2\u69fd\u7684\u5bf9\u8c61\u3002\u4e5f\u4ee5\u51fd\u6570\u5f62\u5f0f\u66b4\u9732\u666e\u901a\u63d2\u69fd\u3002</li> <li><code>data</code>\uff1a\u4f20\u9012\u7ed9\u7ec4\u4ef6\u7684\u6574\u4e2a\u6570\u636e\u5bf9\u8c61\uff0c\u4f5c\u4e3a <code>createElement</code> \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u5165\u7ec4\u4ef6</li> <li><code>parent</code>\uff1a\u5bf9\u7236\u7ec4\u4ef6\u7684\u5f15\u7528</li> <li><code>listeners</code>\uff1a(2.3.0+) \u4e00\u4e2a\u5305\u542b\u4e86\u6240\u6709\u7236\u7ec4\u4ef6\u4e3a\u5f53\u524d\u7ec4\u4ef6\u6ce8\u518c\u7684\u4e8b\u4ef6\u76d1\u542c\u5668\u7684\u5bf9\u8c61\u3002\u8fd9\u662f <code>data.on</code> \u7684\u4e00\u4e2a\u522b\u540d\u3002</li> <li><code>injections</code>\uff1a(2.3.0+) \u5982\u679c\u4f7f\u7528\u4e86 <code>inject</code> \u9009\u9879\uff0c\u5219\u8be5\u5bf9\u8c61\u5305\u542b\u4e86\u5e94\u5f53\u88ab\u6ce8\u5165\u7684 property\u3002</li> </ul> <p>\u5728\u6dfb\u52a0 <code>functional: true</code> \u4e4b\u540e\uff0c\u9700\u8981\u66f4\u65b0\u6211\u4eec\u7684\u951a\u70b9\u6807\u9898\u7ec4\u4ef6\u7684\u6e32\u67d3\u51fd\u6570\uff0c\u4e3a\u5176\u589e\u52a0 <code>context</code>\u53c2\u6570\uff0c\u5e76\u5c06 <code>this.$slots.default</code> \u66f4\u65b0\u4e3a <code>context.children</code>\uff0c\u7136\u540e\u5c06 <code>this.level</code> \u66f4\u65b0\u4e3a <code>context.props.level</code>\u3002</p> <p>\u5b98\u65b9\u6587\u6863\uff1a\u6e32\u67d3\u51fd\u6570&amp;JSX</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/","title":"Chapter 5. \u4f7f\u7528 Vue-router \u5b9e\u73b0\u5ba2\u6237\u7aef\u8def\u7531","text":"<p>\u5bf9\u4e8e\u5927\u591a\u6570\u5355\u9875\u9762\u5e94\u7528\uff0c\u90fd\u63a8\u8350\u4f7f\u7528\u5b98\u65b9\u652f\u6301\u7684 vue-router \u5e93</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_1","title":"\u57fa\u672c\u7528\u6cd5","text":"<p>\u7b80\u5355\u5b9e\u4f8b</p> <p>HTML</p> <pre><code>&lt;script src=\"https://unpkg.com/vue/dist/vue.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://unpkg.com/vue-router/dist/vue-router.js\"&gt;&lt;/script&gt;\n\n&lt;div id=\"app\"&gt;\n  &lt;h1&gt;Hello App!&lt;/h1&gt;\n  &lt;p&gt;\n    &lt;!-- \u4f7f\u7528 router-link \u7ec4\u4ef6\u6765\u5bfc\u822a. --&gt;\n    &lt;!-- \u901a\u8fc7\u4f20\u5165 `to` \u5c5e\u6027\u6307\u5b9a\u94fe\u63a5. --&gt;\n    &lt;!-- &lt;router-link&gt; \u9ed8\u8ba4\u4f1a\u88ab\u6e32\u67d3\u6210\u4e00\u4e2a `&lt;a&gt;` \u6807\u7b7e --&gt;\n    &lt;router-link to=\"/foo\"&gt;Go to Foo&lt;/router-link&gt;\n    &lt;router-link to=\"/bar\"&gt;Go to Bar&lt;/router-link&gt;\n  &lt;/p&gt;\n  &lt;!-- \u8def\u7531\u51fa\u53e3 --&gt;\n  &lt;!-- \u8def\u7531\u5339\u914d\u5230\u7684\u7ec4\u4ef6\u5c06\u6e32\u67d3\u5728\u8fd9\u91cc --&gt;\n  &lt;router-view&gt;&lt;/router-view&gt;\n&lt;/div&gt;\n</code></pre> <p>JavaScript</p> <pre><code>// 0. \u5982\u679c\u4f7f\u7528\u6a21\u5757\u5316\u673a\u5236\u7f16\u7a0b\uff0c\u5bfc\u5165Vue\u548cVueRouter\uff0c\u8981\u8c03\u7528 Vue.use(VueRouter)\n\n// 1. \u5b9a\u4e49 (\u8def\u7531) \u7ec4\u4ef6\u3002\n// \u53ef\u4ee5\u4ece\u5176\u4ed6\u6587\u4ef6 import \u8fdb\u6765\nconst Foo = { template: '&lt;div&gt;foo&lt;/div&gt;' }\nconst Bar = { template: '&lt;div&gt;bar&lt;/div&gt;' }\n\n// 2. \u5b9a\u4e49\u8def\u7531\n// \u6bcf\u4e2a\u8def\u7531\u5e94\u8be5\u6620\u5c04\u4e00\u4e2a\u7ec4\u4ef6\u3002 \u5176\u4e2d\"component\" \u53ef\u4ee5\u662f\n// \u901a\u8fc7 Vue.extend() \u521b\u5efa\u7684\u7ec4\u4ef6\u6784\u9020\u5668\uff0c\n// \u6216\u8005\uff0c\u53ea\u662f\u4e00\u4e2a\u7ec4\u4ef6\u914d\u7f6e\u5bf9\u8c61\u3002\n// \u6211\u4eec\u665a\u70b9\u518d\u8ba8\u8bba\u5d4c\u5957\u8def\u7531\u3002\nconst routes = [\n  { path: '/foo', component: Foo },\n  { path: '/bar', component: Bar }\n]\n\n// 3. \u521b\u5efa router \u5b9e\u4f8b\uff0c\u7136\u540e\u4f20 `routes` \u914d\u7f6e\n// \u4f60\u8fd8\u53ef\u4ee5\u4f20\u522b\u7684\u914d\u7f6e\u53c2\u6570, \u4e0d\u8fc7\u5148\u8fd9\u4e48\u7b80\u5355\u7740\u5427\u3002\nconst router = new VueRouter({\n  routes // (\u7f29\u5199) \u76f8\u5f53\u4e8e routes: routes\n})\n\n// 4. \u521b\u5efa\u548c\u6302\u8f7d\u6839\u5b9e\u4f8b\u3002\n// \u8bb0\u5f97\u8981\u901a\u8fc7 router \u914d\u7f6e\u53c2\u6570\u6ce8\u5165\u8def\u7531\uff0c\n// \u4ece\u800c\u8ba9\u6574\u4e2a\u5e94\u7528\u90fd\u6709\u8def\u7531\u529f\u80fd\nconst app = new Vue({\n  router\n}).$mount('#app')\n</code></pre> <p>\u901a\u8fc7\u5bf9Vue \u5b9e\u4f8b\u6ce8\u5165\u8def\u7531\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4efb\u4f55\u7ec4\u4ef6\u5185\u901a\u8fc7 <code>this.$router</code> \u8bbf\u95ee\u8def\u7531\u5668\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>this.$route</code> \u8bbf\u95ee\u5f53\u524d\u8def\u7531</p> <p>\u5f53 <code>&lt;router-link&gt;</code> \u5bf9\u5e94\u7684\u8def\u7531\u5339\u914d\u6210\u529f\uff0c\u5c06\u81ea\u52a8\u8bbe\u7f6e class \u5c5e\u6027\u503c <code>.router-link-active</code></p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_2","title":"\u52a8\u6001\u8def\u7531\u5339\u914d","text":"<p>\u5f53\u6211\u4eec\u9700\u8981\u628a\u67d0\u79cd\u6a21\u5f0f\u5339\u914d\u5230\u7684\u6240\u6709\u8def\u7531\u5168\u90e8\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u7ec4\u4ef6\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 <code>vue-router</code> \u7684\u8def\u7531\u8def\u5f84\u4e2d\u4f7f\u7528\u201c\u52a8\u6001\u8def\u5f84\u53c2\u6570\u201d(dynamic segment) \u6765\u8fbe\u5230\u8fd9\u4e2a\u6548\u679c</p> <pre><code>const User = {\n  template: '&lt;div&gt;User&lt;/div&gt;'\n}\n\nconst router = new VueRouter({\n  routes: [\n    // \u52a8\u6001\u8def\u5f84\u53c2\u6570 \u4ee5\u5192\u53f7\u5f00\u5934\n    { path: '/user/:id', component: User }\n  ]\n})\n</code></pre> <p>\u6b64\u65f6 <code>/user/foo</code>\uff0c<code>user/bar</code> \u90fd\u4f1a\u6620\u5c04\u5230\u76f8\u540c\u7684\u8def\u7531\uff0c\u4e00\u4e2a\u201c\u8def\u5f84\u53c2\u6570\u201d\u4f7f\u7528\u5192\u53f7 <code>:</code> \u6807\u8bb0\u3002\u5f53\u5339\u914d\u5230\u4e00\u4e2a\u8def\u7531\u65f6\uff0c\u53c2\u6570\u503c\u4f1a\u88ab\u8bbe\u7f6e\u5230<code>this.$route.params</code>\uff0c\u53ef\u4ee5\u5728\u6bcf\u4e2a\u7ec4\u4ef6\u5185\u4f7f\u7528\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5728\u8def\u7531\u4e2d\u8bbe\u7f6e\u591a\u6bb5\u201c\u8def\u5f84\u53c2\u6570\u201d\uff0c\u5bf9\u5e94\u7684\u503c\u90fd\u4f1a\u8bbe\u7f6e\u5230 <code>$route.params</code> \u4e2d</p> \u6a21\u5f0f \u5339\u914d\u8def\u5f84 $route.params /user/:username /user/evan <code>{ username: 'evan' }</code> /user/:username/post/:post_id /user/evan/post/123 <code>{ username: 'evan', post_id: '123' }</code>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_3","title":"\u54cd\u5e94\u8def\u7531\u53c2\u6570\u7684\u53d8\u5316","text":"<p>\u5f53\u4f7f\u7528\u8def\u7531\u53c2\u6570\u65f6\uff0c\u539f\u6765\u7684\u7ec4\u4ef6\u4f1a\u88ab\u590d\u7528\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u751f\u547d\u5468\u671f\u7684\u94a9\u5b50\u4e0d\u4f1a\u518d\u6b21\u8c03\u7528</p> <p>\u5982\u679c\u9700\u8981\u5bf9\u8def\u7531\u53c2\u6570\u7684\u53d8\u5316\u4f5c\u51fa\u54cd\u5e94\uff0c\u53ef\u4ee5\u7b80\u5355\u7684watch <code>$route</code> \u5bf9\u8c61\uff0c\u6216\u8005\u4f7f\u75282.2\u4e4b\u540e\u5f15\u5165\u7684 <code>beforeRouteUpdate</code> \u5bfc\u822a\u5b88\u536b</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#404-not-fonud","title":"\u6355\u83b7\u6240\u6709\u8def\u7531\u6216404 Not fonud \u8def\u7531","text":"<p>\u5e38\u89c4\u53c2\u6570\u53ea\u4f1a\u5339\u914d <code>/</code> \u5206\u5272\u7684 URL \u7247\u6bb5\u4e2d\u7684\u5b57\u7b26\u3002\u5982\u679c\u60f3\u5339\u914d\u4efb\u610f\u8def\u5f84\uff0c\u53ef\u4ee5\u4f7f\u7528\u901a\u914d\u7b26 \uff08<code>*</code>\uff09</p> <p>\u5f53\u4f7f\u7528\u901a\u914d\u7b26\u8def\u7531\u65f6\uff0c\u5e94\u786e\u4fdd\u901a\u914d\u7b26\u8def\u7531\u653e\u5728\u6700\u540e\uff0c\u7531\u8def\u7531 <code>{path: \u2018*\u2019}</code> \u901a\u5e38\u7528\u4e8e\u5ba2\u6237\u7aef\u7684404\u9519\u8bef\u3002\u5982\u679c\u4f60\u4f7f\u7528\u4e86_History \u6a21\u5f0f_\uff0c\u8bf7\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u4f60\u7684\u670d\u52a1\u5668</p> <p>\u5f53\u4f7f\u7528\u901a\u914d\u7b26\u65f6 <code>$route.params</code> \u5185\u4f1a\u81ea\u52a8\u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a <code>pathMatch</code> \u7684\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u5305\u542b\u4e86\u901a\u914d\u7b26\u5339\u914d\u7684\u90e8\u5206</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_4","title":"\u9ad8\u7ea7\u5339\u914d\u6a21\u5f0f","text":"<p><code>vue-router</code> \u4f7f\u7528 path-to-regexp\u4f5c\u4e3a\u8def\u5f84\u5339\u914d\u5f15\u64ce\uff0c\u6240\u4ee5\u652f\u6301\u5f88\u591a\u9ad8\u7ea7\u7684\u5339\u914d\u6a21\u5f0f\u3002\u5982\uff1a\u52a8\u6001\u8def\u5f84\u53c2\u6570\u3001\u5339\u914d\u96f6\u4e2a\u6216\u591a\u4e2a\u3001\u4e00\u4e2a\u6216\u591a\u4e2a\uff0c\u751a\u81f3\u662f\u81ea\u5b9a\u4e49\u6b63\u5219\u5339\u914d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_5","title":"\u5339\u914d\u4f18\u5148\u7ea7","text":"<p>\u5f53\u540c\u4e00\u4e2a\u8def\u5f84\u53ef\u4ee5\u5339\u914d\u591a\u4e2a\u8def\u7531\u65f6\uff0c\u5339\u914d\u7684\u4f18\u5148\u7ea7\u6309\u7167\u8def\u7531\u5b9a\u4e49\u987a\u5e8f\u6765\u51b3\u5b9a</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_6","title":"\u5d4c\u5957\u8def\u7531","text":"<p>app \u6700\u9876\u5c42\u8bbe\u7f6e\u7684 <code>&lt;router-view&gt;</code> \u4f5c\u4e3a\u6700\u9876\u5c42\u51fa\u53e3\uff0c\u7528\u6765\u6e32\u67d3\u6700\u9ad8\u7ea7\u8def\u7531\u5339\u914d\u5230\u7684\u7ec4\u4ef6\u3002\u4e00\u4e2a\u88ab\u6e32\u67d3\u7684\u7ec4\u4ef6\u4e5f\u53ef\u4ee5\u5305\u542b\u81ea\u5df1\u7684 <code>&lt;router-view&gt;</code> \u3002</p> <p>\u8981\u5728\u5d4c\u5957\u7684\u51fa\u53e3\u4e2d\u6e32\u67d3\u7ec4\u4ef6\uff0c\u9700\u8981\u5728 <code>VueRouter</code> \u7684\u53c2\u6570\u4e2d\u4f7f\u7528 <code>children</code> \u914d\u7f6e\uff0c<code>children</code> \u7684\u914d\u7f6e\u540c <code>routes</code> \u914d\u7f6e\u65b9\u5f0f\u662f\u4e00\u6837\u7684\uff0c\u540c\u6837\u7684\u4f60\u53ef\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u5d4c\u5957\u591a\u5c42\u8def\u7531</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_7","title":"\u7f16\u7a0b\u5f0f\u5bfc\u822a","text":"<p>\u9664\u4e86\u4f7f\u7528 <code>&lt;router-link&gt;</code> \u521b\u5efa a \u6807\u7b7e\u6765\u5b9a\u4e49\u5bfc\u822a\u94fe\u63a5\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u501f\u52a9 router \u7684\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u901a\u8fc7\u7f16\u5199\u4ee3\u7801\u6765\u5b9e\u73b0</p> \u58f0\u660e\u5f0f \u7f16\u7a0b\u5f0f <code>&lt;router-link :to=\"...\"&gt;</code> <code>router.push(...)</code> <p>\u5728Vue\u5b9e\u4f8b\u5185\u90e8\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>$router</code> \u6765\u8bbf\u95ee\u8def\u7531\u5b9e\u4f8b</p> <ul> <li>router.push(location, onComplete?, onAbort?) \u5411 history \u4e2d\u6dfb\u52a0\u65b0\u8bb0\u5f55</li> <li>router.releace(location, onComplete?, onAbort?) \u66ff\u6362\u6389\u5f53\u524d\u7684 history \u8bb0\u5f55</li> <li>router.go(n) \u8fd9\u4e2a\u65b9\u6cd5\u7684\u53c2\u6570\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u610f\u601d\u662f\u5728 history \u8bb0\u5f55\u4e2d\u5411\u524d\u6216\u8005\u540e\u9000\u591a\u5c11\u6b65</li> </ul>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_8","title":"\u547d\u540d\u8def\u7531","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u8def\u7531 name \u5c5e\u6027\u6765\u7ed9\u8def\u7531\u6dfb\u52a0\u540d\u79f0\u6765\u6807\u8bc6\u4e00\u4e2a\u8def\u7531\uff0c\u5728\u8c03\u7528\u7684\u65f6\u5019\u901a\u8fc7\u4f20\u9012 name \u6765\u67e5\u627e\u8def\u7531</p> <pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/user/:userId',\n      name: 'user',\n      component: User\n    }\n  ]\n})\n\n&lt;router-link :to=\"{ name: 'user', params: { userId: 123 }}\"&gt;User&lt;/router-link&gt;\nrouter.push({ name: 'user', params: { userId: 123 } })\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_9","title":"\u547d\u540d\u89c6\u56fe","text":"<p>\u5982\u679c\u9700\u8981\u5728\u540c\u7ea7\u5c55\u793a\u591a\u4e2a\u89c6\u56fe\uff0c\u800c\u4e0d\u662f\u5d4c\u5957\u5c55\u793a\uff0c\u90a3\u4e48\u53ef\u4ee5\u901a\u8fc7\u547d\u540d\u89c6\u56fe\u6765\u5b9e\u73b0</p> <pre><code>&lt;router-view class=\"view one\"&gt;&lt;/router-view&gt;\n&lt;router-view class=\"view two\" name=\"a\"&gt;&lt;/router-view&gt;\n&lt;router-view class=\"view three\" name=\"b\"&gt;&lt;/router-view&gt;\n</code></pre> <pre><code>const router = new VueRouter({\n  routes: [\n    {\n      path: '/',\n      components: {\n        default: Foo,\n        a: Bar,\n        b: Baz\n      }\n    }\n  ]\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_10","title":"\u91cd\u5b9a\u5411\u548c\u522b\u540d","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u8def\u7531\u5c5e\u6027 redirect \u8bbe\u7f6e\u8def\u7531\u91cd\u5b9a\u5411\uff0c\u5c5e\u6027 alias \u53ef\u4ee5\u8bbe\u7f6e\u8def\u7531\u522b\u540d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_11","title":"\u8def\u7531\u7ec4\u4ef6\u4f20\u53c2","text":"<p>\u4f7f\u7528 <code>props</code> \u5c06\u7ec4\u4ef6\u548c\u8def\u7531\u89e3\u8026</p> <p>props \u8def\u7531\u5c5e\u6027\u53ef\u4ee5\u8bbe\u7f6e\u5c06\u8def\u7531\u53c2\u6570\u8bbe\u7f6e\u4e3a\u7ec4\u4ef6props\u503c\uff0c\u8fd9\u6837\u53ef\u4ee5\u65f6\u8def\u7531\u548c\u7ec4\u4ef6\u8fdb\u884c\u89e3\u8026\uff0c\u4ee5\u4fdd\u8bc1\u7ec4\u4ef6\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u53ef\u4f7f\u7528</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_12","title":"\u5bfc\u822a\u5b88\u536b","text":"<p><code>vue-router</code> \u63d0\u4f9b\u7684\u5bfc\u822a\u5b88\u536b\u4e3b\u8981\u7528\u6765\u901a\u8fc7\u8df3\u8f6c\u6216\u53d6\u6d88\u7684\u65b9\u5f0f\u5b88\u536b\u5bfc\u822a</p> <ol> <li>\u5bfc\u822a\u88ab\u89e6\u53d1\u3002</li> <li>\u5728\u5931\u6d3b\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528 <code>beforeRouteLeave</code> \u5b88\u536b\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>beforeEach</code> \u5b88\u536b\u3002</li> <li>\u5728\u91cd\u7528\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528 <code>beforeRouteUpdate</code> \u5b88\u536b (2.2+)\u3002</li> <li>\u5728\u8def\u7531\u914d\u7f6e\u91cc\u8c03\u7528 <code>beforeEnter</code>\u3002</li> <li>\u89e3\u6790\u5f02\u6b65\u8def\u7531\u7ec4\u4ef6\u3002</li> <li>\u5728\u88ab\u6fc0\u6d3b\u7684\u7ec4\u4ef6\u91cc\u8c03\u7528 <code>beforeRouteEnter</code>\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>beforeResolve</code> \u5b88\u536b (2.5+)\u3002</li> <li>\u5bfc\u822a\u88ab\u786e\u8ba4\u3002</li> <li>\u8c03\u7528\u5168\u5c40\u7684 <code>afterEach</code> \u94a9\u5b50\u3002</li> <li>\u89e6\u53d1 DOM \u66f4\u65b0\u3002</li> <li>\u8c03\u7528 <code>beforeRouteEnter</code> \u5b88\u536b\u4e2d\u4f20\u7ed9 <code>next</code> \u7684\u56de\u8c03\u51fd\u6570\uff0c\u521b\u5efa\u597d\u7684\u7ec4\u4ef6\u5b9e\u4f8b\u4f1a\u4f5c\u4e3a\u56de\u8c03\u51fd\u6570\u7684\u53c2\u6570\u4f20\u5165\u3002</li> </ol>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_13","title":"\u8def\u7531\u5143\u4fe1\u606f","text":"<p>\u5b9a\u4e49\u8def\u7531\u7684\u65f6\u5019\u53ef\u4ee5\u914d\u7f6e <code>meta</code> \u5b57\u6bb5</p> <p><code>routes</code> \u914d\u7f6e\u4e2d\u7684\u6bcf\u4e2a\u8def\u7531\u5bf9\u8c61\u4e3a \u8def\u7531\u8bb0\u5f55\u3002\u8def\u7531\u8bb0\u5f55\u53ef\u4ee5\u662f\u5d4c\u5957\u7684\uff0c\u56e0\u6b64\uff0c\u5f53\u4e00\u4e2a\u8def\u7531\u5339\u914d\u6210\u529f\u540e\uff0c\u4ed6\u53ef\u80fd\u5339\u914d\u591a\u4e2a\u8def\u7531\u8bb0\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u68c0\u67e5\u8def\u7531\u8bb0\u5f55\u4e2d\u7684 <code>meta</code> \u5b57\u6bb5\u6765\u505a\u4e00\u4e9b\u7279\u5b9a\u64cd\u4f5c</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%205.%20%E4%BD%BF%E7%94%A8%20Vue-router%20%E5%AE%9E%E7%8E%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%B7%AF%E7%94%B1/#_14","title":"\u8fc7\u6e21\u52a8\u6548","text":"<p><code>&lt;router-view&gt;</code> \u662f\u57fa\u672c\u7684\u52a8\u6001\u7ec4\u4ef6\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u7528 <code>&lt;transition&gt;</code> \u7ec4\u4ef6\u7ed9\u5b83\u6dfb\u52a0\u4e00\u4e9b\u8fc7\u6e21\u6548\u679c</p> <pre><code>&lt;transition&gt;\n  &lt;router-view&gt;&lt;/router-view&gt;\n&lt;/transition&gt;\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u57fa\u4e8e\u5f53\u524d\u8def\u7531\u4e0e\u76ee\u6807\u8def\u7531\u7684\u53d8\u5316\u5173\u7cfb\uff0c\u52a8\u6001\u8bbe\u7f6e\u8fc7\u6e21\u6548\u679c</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/","title":"Chapter 6 \u4f7f\u7528 vuex\u5b9e\u73b0\u72b6\u6001\u7ba1\u7406","text":""},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#vuex","title":"Vuex \u662f\u4ec0\u4e48","text":"<p>Vuex \u662f\u4e00\u4e2a\u4e13\u4e3a Vue.js \u5e94\u7528\u7a0b\u5e8f\u5f00\u53d1\u7684\u72b6\u6001\u7ba1\u7406\u6a21\u5f0f\u3002\u5b83\u91c7\u7528\u96c6\u4e2d\u5f0f\u5b58\u50a8\u7ba1\u7406\u5e94\u7528\u7684\u6240\u6709\u7ec4\u4ef6\u7684\u72b6\u6001\uff0c\u5e76\u4ee5\u76f8\u5e94\u7684\u89c4\u5219\u4fdd\u8bc1\u72b6\u6001\u4ee5\u4e00\u79cd\u53ef\u9884\u6d4b\u7684\u65b9\u5f0f\u53d1\u751f\u53d8\u5316</p> <p>\u5f53\u6211\u4eec\u9047\u5230\u591a\u4e2a\u7ec4\u4ef6\u5171\u4eab\u72b6\u6001\u65f6\uff0c\u5355\u9879\u6570\u636e\u6d41\u7684\u7b80\u6d01\u6027\u5f88\u5bb9\u6613\u88ab\u7834\u574f</p> <ul> <li>\u591a\u4e2a\u89c6\u56fe\u4f9d\u8d56\u540c\u4e00\u72b6\u6001</li> <li>\u6765\u81ea\u4e0d\u540c\u7684\u89c6\u56fe\u884c\u4e3a\u9700\u8981\u53d8\u66f4\u540c\u4e00\u72b6\u6001</li> </ul> <p>Vuex \u505a\u5230\u4e86\u5c06\u7ec4\u4ef6\u5171\u4eab\u7684\u72b6\u6001\u62bd\u53d6\u51fa\u6765\uff0c\u4ee5\u4e00\u4e2a\u5168\u5c40\u5355\u4f8b\u7684\u6a21\u5f0f\u6765\u7ba1\u7406\u8fd9\u4e9b\u72b6\u6001</p> <p></p> <p>\u5982\u679c\u5f00\u53d1\u4e00\u4e2a\u7b80\u5355\u7684\u5e94\u7528\uff0c\u90a3\u4e48 Vuex \u5e76\u4e0d\u662f\u5f88\u597d\u7684\u9009\u62e9\u3002\u4f46\u662f\uff0c\u5982\u679c\u60a8\u9700\u8981\u6784\u5efa\u4e00\u4e2a\u4e2d\u5927\u578b\u5355\u9875\u5e94\u7528\uff0c\u60a8\u5f88\u53ef\u80fd\u4f1a\u8003\u8651\u5982\u4f55\u66f4\u597d\u5730\u5728\u7ec4\u4ef6\u5916\u90e8\u7ba1\u7406\u72b6\u6001\uff0cVuex \u5c06\u4f1a\u6210\u4e3a\u81ea\u7136\u800c\u7136\u7684\u9009\u62e9</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_1","title":"\u5f00\u59cb","text":"<p>\u6bcf\u4e00\u4e2a Vuex \u5f15\u7528\u7684\u6838\u5fc3\u5c31\u662f store\uff08\u4ed3\u5e93\uff09\u3002store \u57fa\u672c\u4e0a\u5c31\u662f\u4e00\u4e2a\u5bb9\u5668\uff0c\u5b83\u5305\u542b\u7740\u5e94\u7528\u4e2d\u5927\u90e8\u5206\u7684\u72b6\u6001\u3002Vuex \u548c\u5355\u7eaf\u7684\u5168\u5c40\u5bf9\u8c61\u6709\u4ee5\u4e0b\u4e0d\u540c</p> <ol> <li>Vuex \u7684\u72b6\u6001\u5b58\u50a8\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u4e0e Vue \u7684\u54cd\u5e94\u5f0f\u7ed3\u5408</li> <li>\u4e0d\u80fd\u76f4\u63a5\u7684\u6539\u53d8 store \u4e2d\u7684\u72b6\u6001\uff0c\u6539\u53d8 store \u4e2d\u72b6\u6001\u7684\u552f\u4e00\u9014\u5f84\u5c31\u662f\u901a\u8fc7\u663e\u793a\u7684\u63d0\u4ea4 mutation \uff0c\u8fd9\u6837\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u5730\u8ddf\u8e2a\u6bcf\u4e00\u4e2a\u72b6\u6001\u7684\u53d8\u5316</li> </ol>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_2","title":"\u6838\u5fc3\u6982\u5ff5","text":""},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#state","title":"State","text":"<p>Vuex \u4f7f\u7528 \u5355\u4e00\u72b6\u6001\u6811\uff0c\u7528\u4e00\u4e2a\u5bf9\u8c61\u5305\u542b\u4e86\u5168\u90e8\u7684\u5e94\u7528\u5c42\u7ea7\u72b6\u6001\u3002\u4f5c\u4e3a\u4e00\u4e2a\u552f\u4e00\u6570\u636e\u6e90\u5b58\u5728</p> <p>\u5b58\u50a8\u5728 Vuex \u4e2d\u7684\u6570\u636e\u548c Vue\u5b9e\u4f8b\u4e2d\u7684 data \u9075\u5faa\u76f8\u540c\u7684\u89c4\u5219</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#vue-vuex","title":"\u5728 Vue \u7ec4\u4ef6\u4e2d\u83b7\u5f97 Vuex \u72b6\u6001","text":"<p>\u7531\u4e8e Vuex \u7684\u72b6\u6001\u5b58\u50a8\u662f\u54cd\u5e94\u5f0f\u7684\uff0c\u4ece store \u5b9e\u4f8b\u4e2d\u8bfb\u53d6\u72b6\u6001\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u5c31\u662f\u5728\u8ba1\u7b97\u5c5e\u6027\u4e2d\u8fd4\u56de\u67d0\u4e2a\u72b6\u6001</p> <p>Vuex \u901a\u8fc7 <code>store</code> \u9009\u9879\uff0c\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\u5c06\u72b6\u6001\u4ece\u6839\u7ec4\u4ef6\u201c\u6ce8\u5165\u201d\u5230\u6bcf\u4e00\u4e2a\u5b50\u7ec4\u4ef6\u4e2d\uff08\u9700\u8c03\u7528 <code>Vue.use(Vuex)</code>\uff09</p> <p>\u901a\u8fc7\u5728\u6839\u5b9e\u4f8b\u4e2d\u6ce8\u518c <code>store</code> \u9009\u9879\uff0c\u8be5 store \u5b9e\u4f8b\u4f1a\u6ce8\u5165\u5230\u6839\u7ec4\u4ef6\u4e0b\u7684\u6240\u6709\u5b50\u7ec4\u4ef6\u4e2d\uff0c\u4e14\u5b50\u7ec4\u4ef6\u80fd\u901a\u8fc7 <code>this.$store</code> \u8bbf\u95ee\u5230</p> <pre><code>const app = new Vue({\n  el: '#app',\n  // \u628a store \u5bf9\u8c61\u63d0\u4f9b\u7ed9 \"store\" \u9009\u9879\uff0c\u8fd9\u53ef\u4ee5\u628a store \u7684\u5b9e\u4f8b\u6ce8\u5165\u6240\u6709\u7684\u5b50\u7ec4\u4ef6\n  store,\n  components: { Counter },\n  template: `\n    &lt;div class=\"app\"&gt;\n      &lt;counter&gt;&lt;/counter&gt;\n    &lt;/div&gt;\n  `\n})\n</code></pre> <pre><code>const Counter = {\n  template: `&lt;div&gt;{{ count }}&lt;/div&gt;`,\n  computed: {\n    count () {\n      return this.$store.state.count\n    }\n  }\n}\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mapstate","title":"mapState \u8f85\u52a9\u51fd\u6570","text":"<p>\u5f53\u4e00\u4e2a\u7ec4\u4ef6\u9700\u8981\u83b7\u53d6\u591a\u4e2a\u72b6\u6001\u7684\u65f6\u5019\uff0c\u5c06\u8fd9\u4e9b\u72b6\u6001\u90fd\u58f0\u660e\u4e3a\u8ba1\u7b97\u5c5e\u6027\u4f1a\u6709\u4e9b\u91cd\u590d\u548c\u5197\u4f59\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>mapState</code> \u8f85\u52a9\u51fd\u6570\u5e2e\u52a9\u6211\u4eec\u751f\u6210\u8ba1\u7b97\u5c5e\u6027</p> <pre><code>// \u5728\u5355\u72ec\u6784\u5efa\u7684\u7248\u672c\u4e2d\u8f85\u52a9\u51fd\u6570\u4e3a Vuex.mapState\nimport { mapState } from 'vuex'\n\nexport default {\n  // ...\n  computed: mapState({\n    // \u7bad\u5934\u51fd\u6570\u53ef\u4f7f\u4ee3\u7801\u66f4\u7b80\u7ec3\n    count: state =&gt; state.count,\n\n    // \u4f20\u5b57\u7b26\u4e32\u53c2\u6570 'count' \u7b49\u540c\u4e8e `state =&gt; state.count`\n    countAlias: 'count',\n\n    // \u4e3a\u4e86\u80fd\u591f\u4f7f\u7528 `this` \u83b7\u53d6\u5c40\u90e8\u72b6\u6001\uff0c\u5fc5\u987b\u4f7f\u7528\u5e38\u89c4\u51fd\u6570\n    countPlusLocalState (state) {\n      return state.count + this.localCount\n    }\n  })\n}\n</code></pre> <p>\u5f53\u6620\u5c04\u7684\u8ba1\u7b97\u5c5e\u6027\u4e0e state \u5b50\u8282\u70b9\u540d\u79f0\u76f8\u540c\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ed9 mapState \u4f20\u4e00\u4e2a\u5b57\u7b26\u4e32</p> <pre><code>computed: mapState([\n  // \u6620\u5c04 this.count \u4e3a store.state.count\n  'count'\n])\n</code></pre> <p>\u5982\u679c\u9700\u8981\u540c\u5c40\u90e8\u8ba1\u7b97\u5c5e\u6027\u6df7\u5408\u4f7f\u7528\uff0c\u5219\u9700\u8981\u7528\u5230\u5bf9\u8c61\u5c55\u5f00\u8fd0\u7b97\u7b26\uff0c\u5c06 mapState \u8fd4\u56de\u7684\u5bf9\u8c61\u4e0e computed \u5bf9\u8c61\u7684\u5c40\u90e8\u8ba1\u7b97\u5c5e\u6027\u7ed3\u5408\u6210\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u4e5f\u5c31\u662f\u5c06 mapState \u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\u539f\u6837\u4f20\u9012\u7ed9 computed</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#getter","title":"Getter","text":"<p>\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a store \u7684\u8ba1\u7b97\u5c5e\u6027\uff0c\u5176\u7279\u70b9\u540c\u8ba1\u7b97\u5c5e\u6027\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u4f1a\u5c06getter\u7684\u503c\u7f13\u5b58\u8d77\u6765\uff0c\u5f53\u5176\u4f9d\u8d56\u7684\u503c\u53d1\u751f\u53d8\u5316\u65f6\u624d\u4f1a\u88ab\u91cd\u65b0\u8ba1\u7b97</p> <p>Getter \u63a5\u53d7 state \u4f5c\u4e3a\u5176\u7b2c\u4e00\u4e2a\u53c2\u6570</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#getter_1","title":"Getter\u7684\u8bbf\u95ee\u65b9\u5f0f","text":"<p>\u53ef\u4ee5\u901a\u8fc7\u5c5e\u6027\u8bbf\u95ee\uff0cgetter \u4f1a\u66b4\u9732\u4e3a store.getters \u5bf9\u8c61\uff0c\u53ef\u4ee5\u4ee5\u5c5e\u6027\u7684\u65b9\u5f0f\u8bbf\u95ee\u8fd9\u4e9b\u503c</p> <p>Getter \u4e5f\u53ef\u4ee5\u63a5\u53d7\u5176\u4ed6 getter \u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u53c2\u6570</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8ba9 getter \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c\u6765\u5b9e\u73b0\u7ed9 getter\u4f20\u53c2\u3002getter \u5728\u901a\u8fc7\u65b9\u6cd5\u8bbf\u95ee\u65f6\uff0c\u6bcf\u6b21\u90fd\u4f1a\u53bb\u8fdb\u884c\u8c03\u7528\uff0c\u800c\u4e0d\u4f1a\u7f13\u5b58\u7ed3\u679c</p> <p>Vuex \u4e5f\u63d0\u4f9b\u4e86 mapGetter \u6765\u8bb2 store \u4e2d\u7684 getter \u6620\u5c04\u5230\u5c40\u90e8\u8ba1\u7b97\u5c5e\u6027</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mutation","title":"Mutation","text":"<p>\u66f4\u6539 Vues \u7684 store \u4e2d\u72b6\u6001\u7684\u552f\u4e00\u65b9\u6cd5\u5c31\u662f\u63d0\u4ea4 mutation\u3002Vuex \u4e2d\u7684 mutation \u975e\u5e38\u7c7b\u4f3c\u4e8e\u4e8b\u4ef6\uff1a\u6bcf\u4e2a mutation \u90fd\u6709\u4e00\u4e2a\u5b57\u7b26\u4e32\u7684 \u4e8b\u4ef6\u7c7b\u578b (type) \u548c \u4e00\u4e2a \u56de\u8c03\u51fd\u6570 (handler)\u3002\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\u5c31\u662f\u6211\u4eec\u5b9e\u9645\u8fdb\u884c\u72b6\u6001\u66f4\u6539\u7684\u5730\u65b9\uff0c\u5e76\u4e14\u5b83\u4f1a\u63a5\u53d7 state \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570</p> <p>mutation handler \u4e0d\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\uff0c\u800c\u662f\u8981\u4ee5\u76f8\u5e94\u7684 type \u8c03\u7528 store.commit \u65b9\u6cd5</p> <pre><code>const store = new Vuex.Store({\n  state: {\n    count: 1\n  },\n  mutations: {\n    increment (state) {\n      // \u53d8\u66f4\u72b6\u6001\n      state.count++\n    }\n  }\n})\n\nstore.commit('increment')\n</code></pre> <p>\u53ef\u4ee5\u5411 store.commit \u4f20\u5165\u989d\u5916\u7684\u53c2\u6570\uff0c\u5373 mutation \u7684 \u8f7d\u8377\uff08payload\uff09\uff0c\u4f5c\u4e3a mutation \u56de\u8c03\u51fd\u6570\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f20\u5165</p> <pre><code>store.commit('increment', {\n  amount: 10\n})\n</code></pre> <p>\u63d0\u4ea4 mutation \u7684\u53e6\u4e00\u79cd\u65b9\u5f0f\u662f\u76f4\u63a5\u4f7f\u7528\u5305\u542b <code>type</code> \u5c5e\u6027\u7684\u5bf9\u8c61</p> <pre><code>store.commit({\n  type: 'increment',\n  amount: 10\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mutation-vue","title":"Mutation \u9700\u9075\u5b88 Vue \u7684\u54cd\u5e94\u89c4\u5219","text":"<p>Vuex \u4e2d\u7684 mutation \u4e5f\u9700\u8981\u4e0e\u4f7f\u7528 Vue \u4e00\u6837\u9075\u5b88\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879</p> <ul> <li>\u6700\u597d\u63d0\u524d\u5728 store \u4e2d\u521d\u59cb\u5316\u597d\u6240\u6709\u5c5e\u6027</li> <li>\u5982\u679c\u9700\u8981\u5728\u5bf9\u8c61\u4e0a\u6dfb\u52a0\u65b0\u5c5e\u6027\u65f6\uff0c\u5e94\u8be5</li> <li>\u4f7f\u7528 Vue.set()</li> <li>\u6216\u8005\u4ee5\u65b0\u5bf9\u8c61\u66ff\u6362\u8001\u5bf9\u8c61 <code>state.obj={\u2026state.obj, newProp:123}</code></li> </ul>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mutation_1","title":"\u4f7f\u7528\u5e38\u91cf\u66ff\u4ee3 Mutation \u4e8b\u4ef6\u7c7b\u578b","text":"<pre><code>// mutation-types.js\nexport const SOME_MUTATION = 'SOME_MUTATION'\n\n// store.js\nimport Vuex from 'vuex'\nimport { SOME_MUTATION } from './mutation-types'\n\nconst store = new Vuex.Store({\n  state: { ... },\n  mutations: {\n    // \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ES2015 \u98ce\u683c\u7684\u8ba1\u7b97\u5c5e\u6027\u547d\u540d\u529f\u80fd\u6765\u4f7f\u7528\u4e00\u4e2a\u5e38\u91cf\u4f5c\u4e3a\u51fd\u6570\u540d\n    [SOME_MUTATION] (state) {\n      // mutate state\n    }\n  }\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mutation_2","title":"Mutation \u5fc5\u987b\u662f\u540c\u6b65\u51fd\u6570","text":"<p>\u4e00\u6761\u91cd\u8981\u7684\u539f\u5219\u5c31\u662f\u8981\u8bb0\u4f4f mutation \u5fc5\u987b\u662f\u540c\u6b65\u51fd\u6570</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#mutation_3","title":"\u5728\u7ec4\u4ef6\u4e2d\u63d0\u4ea4 Mutation","text":"<p>\u5728\u7ec4\u4ef6\u4e2d\u53ef\u4ee5\u4f7f\u7528 <code>this.$store.commit(\u2018\u2019)</code> \u6765\u63d0\u4ea4 mutation\uff0c\u6216\u8005\u4f7f\u7528 <code>mapMutation</code> \u8f85\u52a9\u51fd\u6570\u5c06\u7ec4\u4ef6\u4e2d\u7684methods \u6620\u5c04\u4e3a store.commit\u8c03\u7528</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#action","title":"Action","text":"<p>action\u7c7b\u4f3c\u4e8e mutation\uff0c\u4e0d\u540c\u70b9\u5728\u4e8e\uff1a</p> <ul> <li>action \u63d0\u4ea4\u7684\u662fmutation\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u6539\u53d8\u72b6\u6001</li> <li>action\u53ef\u4ee5\u5305\u542b\u4efb\u610f\u5f02\u6b65\u64cd\u4f5c</li> </ul> <p>Action \u51fd\u6570\u63a5\u53d7\u4e00\u4e2a\u4e0e store \u5b9e\u4f8b\u5177\u6709\u76f8\u540c\u65b9\u6cd5\u548c\u5c5e\u6027\u7684 context \u5bf9\u8c61\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u8c03\u7528 <code>context.commit</code> \u63d0\u4ea4\u4e00\u4e2a mutation\uff0c\u6216\u8005\u901a\u8fc7 <code>context.state</code> \u548c <code>context.getters</code> \u6765\u83b7\u53d6 state \u548c getters\u3002</p> <p>\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u4f1a\u7ecf\u5e38\u7528\u5230 ES2015 \u7684 \u53c2\u6570\u89e3\u6784 (opens new window)\u6765\u7b80\u5316\u4ee3\u7801\uff08\u7279\u522b\u662f\u6211\u4eec\u9700\u8981\u8c03\u7528 <code>commit</code> \u5f88\u591a\u6b21\u7684\u65f6\u5019\uff09\uff1a</p> <pre><code>actions: {\n    increment (context) {\n        context.commit('increment')\n    }\n}\n\nactions: {\n  increment ({ commit }) {\n    commit('increment')\n  }\n}\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#action_1","title":"\u5206\u53d1 Action","text":"<p>Action \u901a\u8fc7 <code>store.dispatch</code> \u65b9\u6cd5\u89e6\u53d1</p> <p>Action \u5c31\u4e0d\u53d7\u7ea6\u675f\uff01\u6211\u4eec\u53ef\u4ee5\u5728 action \u5185\u90e8\u6267\u884c\u5f02\u6b65\u64cd\u4f5c</p> <p>Actions \u652f\u6301\u540c\u6837\u7684\u8f7d\u8377\u65b9\u5f0f\u548c\u5bf9\u8c61\u65b9\u5f0f\u8fdb\u884c\u5206\u53d1\uff0c\u4f20\u53c2\u65b9\u5f0f\u540cmutation\u76f8\u540c</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#action_2","title":"\u5728\u7ec4\u4ef6\u4e2d\u5206\u53d1Action","text":"<p>\u7ec4\u4ef6\u4e2d\u53ef\u4ee5\u4f7f\u7528 <code>this.$store.dispatch(\u2018\u2019)</code> \u6765\u5206\u53d1 action\uff0c\u6216\u8005\u4f7f\u7528 mapAction \u8f85\u52a9\u51fd\u6570\u5c06\u7ec4\u4ef6\u7684 methods \u6620\u5c04\u4e3a <code>store.dispatch</code> \u8c03\u7528</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#action_3","title":"\u7ec4\u5408Action","text":"<p>Action \u901a\u5e38\u662f\u5f02\u6b65\u7684\uff0c\u5982\u679c\u9700\u8981\u77e5\u9053action\u4f55\u65f6\u6267\u884c\u7ed3\u675f\uff0c<code>store.dispatch</code> \u53ef\u4ee5\u5904\u7406\u88ab\u89e6\u53d1\u7684 action \u7684\u5904\u7406\u51fd\u6570\u8fd4\u56de\u7684 Promise\uff0c\u5e76\u4e14 <code>store.dispatch</code> \u4ecd\u65e7\u8fd4\u56de Promise</p> <pre><code>actions: {\n  actionA ({ commit }) {\n    return new Promise((resolve, reject) =&gt; {\n      setTimeout(() =&gt; {\n        commit('someMutation')\n        resolve()\n      }, 1000)\n    })\n  }\n}\n\n\nstore.dispatch('actionA').then(() =&gt; {\n  // ...\n})\n</code></pre> <p>\u5982\u679c\u4f7f\u7528 async/await\uff0c\u90a3\u4e48\u53ef\u4ee5</p> <pre><code>// \u5047\u8bbe getData() \u548c getHTMLData() \u8fd4\u56de\u7684\u662f Promise\n\nactions: {\n  async actionA ({ commit }) {\n    commit('gotData', await getData())\n  },\n  async actionB ({ dispatch, commit }) {\n    await dispatch('actionA') // \u7b49\u5f85 actionA \u5b8c\u6210\n    commit('gotHTMLData', await getHTMLData())\n  }\n}\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#module","title":"Module","text":"<p>\u7531\u4e8e\u4f7f\u7528\u5355\u4e00\u72b6\u6001\u6811\uff0c\u5f53\u5e94\u7528\u53d8\u5f97\u975e\u5e38\u590d\u6742\u65f6\uff0cstore \u5bf9\u8c61\u5c31\u6709\u53ef\u80fd\u53d8\u5f97\u76f8\u5f53\u81c3\u80bf</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\uff0cVuex \u5141\u8bb8\u6211\u4eec\u5c06 store \u5206\u5272\u6210\u6a21\u5757\uff08module\uff09\u3002\u6bcf\u4e2a\u6a21\u5757\u90fd\u6709\u81ea\u5df1\u7684 state\uff0cmutation, action, getter\uff0c\u751a\u81f3\u662f\u5d4c\u5957\u5b50\u6a21\u5757</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_3","title":"\u6a21\u5757\u5c40\u90e8\u72b6\u6001","text":"<p>\u5bf9\u4e8e\u6a21\u5757\u5185\u90e8\u7684 mutation \u548c getter\uff0c\u63a5\u6536\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u6a21\u5757\u7684\u5c40\u90e8\u72b6\u6001\u5bf9\u8c61\u3002</p> <p>\u540c\u6837\uff0c\u5bf9\u4e8e\u6a21\u5757\u5185\u90e8\u7684 action\uff0c\u5c40\u90e8\u72b6\u6001\u901a\u8fc7 <code>context.state</code> \u66b4\u9732\u51fa\u6765\uff0c\u6839\u8282\u70b9\u72b6\u6001\u5219\u4e3a <code>context.rootState</code></p> <p>\u5bf9\u4e8e\u6a21\u5757\u5185\u90e8\u7684 getter\uff0c\u6839\u8282\u70b9\u72b6\u6001\u4f1a\u4f5c\u4e3a\u7b2c\u4e09\u4e2a\u53c2\u6570\u66b4\u9732\u51fa\u6765</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_4","title":"\u547d\u540d\u7a7a\u95f4","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6a21\u5757\u5185\u90e8\u7684 action\u3001mutation \u548c getter \u662f\u6ce8\u518c\u5728\u5168\u5c40\u547d\u540d\u7a7a\u95f4\u7684\u2014\u2014\u8fd9\u6837\u4f7f\u5f97\u591a\u4e2a\u6a21\u5757\u80fd\u591f\u5bf9\u540c\u4e00 mutation \u6216 action \u4f5c\u51fa\u54cd\u5e94</p> <p>\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0 <code>namespaced: true</code> \u7684\u65b9\u5f0f\u4f7f\u5176\u6210\u4e3a\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u3002\u5f53\u6a21\u5757\u88ab\u6ce8\u518c\u540e\uff0c\u5b83\u7684\u6240\u6709 getter\u3001action \u53ca mutation \u90fd\u4f1a\u81ea\u52a8\u6839\u636e\u6a21\u5757\u6ce8\u518c\u7684\u8def\u5f84\u8c03\u6574\u547d\u540d</p> <pre><code>const store = new Vuex.Store({\n  modules: {\n    account: {\n      namespaced: true,\n\n      // \u6a21\u5757\u5185\u5bb9\uff08module assets\uff09\n      state: () =&gt; ({ ... }), // \u6a21\u5757\u5185\u7684\u72b6\u6001\u5df2\u7ecf\u662f\u5d4c\u5957\u7684\u4e86\uff0c\u4f7f\u7528 `namespaced` \u5c5e\u6027\u4e0d\u4f1a\u5bf9\u5176\u4ea7\u751f\u5f71\u54cd\n      getters: {\n        isAdmin () { ... } // -&gt; getters['account/isAdmin']\n      },\n      actions: {\n        login () { ... } // -&gt; dispatch('account/login')\n      },\n      mutations: {\n        login () { ... } // -&gt; commit('account/login')\n      },\n\n      // \u5d4c\u5957\u6a21\u5757\n      modules: {\n        // \u7ee7\u627f\u7236\u6a21\u5757\u7684\u547d\u540d\u7a7a\u95f4\n        myPage: {\n          state: () =&gt; ({ ... }),\n          getters: {\n            profile () { ... } // -&gt; getters['account/profile']\n          }\n        },\n\n        // \u8fdb\u4e00\u6b65\u5d4c\u5957\u547d\u540d\u7a7a\u95f4\n        posts: {\n          namespaced: true,\n\n          state: () =&gt; ({ ... }),\n          getters: {\n            popular () { ... } // -&gt; getters['account/posts/popular']\n          }\n        }\n      }\n    }\n  }\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#global-assets","title":"\u5728\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u5185\u8bbf\u95ee\u5168\u5c40\u5185\u5bb9\uff08Global Assets\uff09","text":"<p>\u5982\u679c\u4f60\u5e0c\u671b\u4f7f\u7528\u5168\u5c40 state \u548c getter\uff0c<code>rootState</code> \u548c <code>rootGetters</code> \u4f1a\u4f5c\u4e3a\u7b2c\u4e09\u548c\u7b2c\u56db\u53c2\u6570\u4f20\u5165 getter\uff0c\u4e5f\u4f1a\u901a\u8fc7 <code>context</code> \u5bf9\u8c61\u7684\u5c5e\u6027\u4f20\u5165 action\u3002</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#action_4","title":"\u5728\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u6ce8\u518c\u5168\u5c40 action","text":"<p>\u82e5\u9700\u8981\u5728\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u6ce8\u518c\u5168\u5c40 action\uff0c\u4f60\u53ef\u6dfb\u52a0 <code>root: true</code>\uff0c\u5e76\u5c06\u8fd9\u4e2a action \u7684\u5b9a\u4e49\u653e\u5728\u51fd\u6570 <code>handler</code> \u4e2d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_5","title":"\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u7ed1\u5b9a\u51fd\u6570","text":"<p>\u5f53\u4f7f\u7528 <code>mapState</code>, <code>mapGetters</code>, <code>mapActions</code> \u548c <code>mapMutations</code> \u8fd9\u4e9b\u51fd\u6570\u6765\u7ed1\u5b9a\u5e26\u547d\u540d\u7a7a\u95f4\u7684\u6a21\u5757\u65f6\uff0c\u5199\u8d77\u6765\u53ef\u80fd\u6bd4\u8f83\u7e41\u7410</p> <p>\u4f60\u53ef\u4ee5\u5c06\u6a21\u5757\u7684\u7a7a\u95f4\u540d\u79f0\u5b57\u7b26\u4e32\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u9012\u7ed9\u4e0a\u8ff0\u51fd\u6570\uff0c\u8fd9\u6837\u6240\u6709\u7ed1\u5b9a\u90fd\u4f1a\u81ea\u52a8\u5c06\u8be5\u6a21\u5757\u4f5c\u4e3a\u4e0a\u4e0b\u6587</p> <p>\u800c\u4e14\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 <code>createNamespacedHelpers</code> \u521b\u5efa\u57fa\u4e8e\u67d0\u4e2a\u547d\u540d\u7a7a\u95f4\u8f85\u52a9\u51fd\u6570\u3002\u5b83\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5bf9\u8c61\u91cc\u6709\u65b0\u7684\u7ed1\u5b9a\u5728\u7ed9\u5b9a\u547d\u540d\u7a7a\u95f4\u503c\u4e0a\u7684\u7ec4\u4ef6\u7ed1\u5b9a\u8f85\u52a9\u51fd\u6570</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_6","title":"\u6a21\u5757\u52a8\u6001\u6ce8\u518c","text":"<p>\u5728 store \u521b\u5efa\u4e4b\u540e\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>store.registerModule</code> \u65b9\u6cd5\u6ce8\u518c\u6a21\u5757</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>store.unregisterModule(moduleName)</code> \u6765\u52a8\u6001\u5378\u8f7d\u6a21\u5757\u3002\u6ce8\u610f\uff0c\u4f60\u4e0d\u80fd\u4f7f\u7528\u6b64\u65b9\u6cd5\u5378\u8f7d\u9759\u6001\u6a21\u5757\uff08\u5373\u521b\u5efa store \u65f6\u58f0\u660e\u7684\u6a21\u5757\uff09</p> <p>\u53ef\u4ee5\u901a\u8fc7 <code>store.hasModule(moduleName)</code> \u65b9\u6cd5\u68c0\u67e5\u8be5\u6a21\u5757\u662f\u5426\u5df2\u7ecf\u88ab\u6ce8\u518c\u5230 store\u3002</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#state_1","title":"\u4fdd\u7559 state","text":"<p>\u5728\u6ce8\u518c\u4e00\u4e2a\u65b0 module \u65f6\uff0c\u4f60\u5f88\u6709\u53ef\u80fd\u60f3\u4fdd\u7559\u8fc7\u53bb\u7684 state\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>preserveState</code> \u9009\u9879\u5c06\u5176\u5f52\u6863\uff1a<code>store.registerModule('a', module, { preserveState: true })</code></p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%206%20%E4%BD%BF%E7%94%A8%20vuex%E5%AE%9E%E7%8E%B0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/#_7","title":"\u6a21\u5757\u91cd\u7528","text":"<p>\u6709\u65f6\u6211\u4eec\u53ef\u80fd\u9700\u8981\u521b\u5efa\u4e00\u4e2a\u6a21\u5757\u7684\u591a\u4e2a\u5b9e\u4f8b</p> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e00\u4e2a\u7eaf\u5bf9\u8c61\u6765\u58f0\u660e\u6a21\u5757\u7684\u72b6\u6001\uff0c\u90a3\u4e48\u8fd9\u4e2a\u72b6\u6001\u5bf9\u8c61\u4f1a\u901a\u8fc7\u5f15\u7528\u88ab\u5171\u4eab\uff0c\u5bfc\u81f4\u72b6\u6001\u5bf9\u8c61\u88ab\u4fee\u6539\u65f6 store \u6216\u6a21\u5757\u95f4\u6570\u636e\u4e92\u76f8\u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u5b9e\u9645\u4e0a\u8fd9\u548c Vue \u7ec4\u4ef6\u5185\u7684 <code>data</code> \u662f\u540c\u6837\u7684\u95ee\u9898\u3002\u56e0\u6b64\u89e3\u51b3\u529e\u6cd5\u4e5f\u662f\u76f8\u540c\u7684\u2014\u2014\u4f7f\u7528\u4e00\u4e2a\u51fd\u6570\u6765\u58f0\u660e\u6a21\u5757\u72b6\u6001\uff08\u4ec5 2.3.0+ \u652f\u6301\uff09\uff1a</p> <pre><code>const MyReusableModule = {\n  state: () =&gt; ({\n    foo: 'bar'\n  }),\n  // mutation, action \u548c getter \u7b49\u7b49...\n}\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/","title":"Chapter 7. Vuex \u8fdb\u9636","text":""},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_1","title":"\u9879\u76ee\u7ed3\u6784","text":"<p>Vuex \u89c4\u5b9a\u4e86\u4e00\u4e9b\u9700\u8981\u9075\u5b88\u7684\u89c4\u5219</p> <ol> <li>\u5e94\u7528\u5c42\u7ea7\u7684\u72b6\u6001\u5e94\u8be5\u96c6\u4e2d\u5230\u4e00\u4e2a store \u5bf9\u8c61\u4e2d</li> <li>\u63d0\u4ea4 mutation \u662f\u66f4\u6539\u72b6\u6001\u7684\u552f\u4e00\u65b9\u6cd5\uff0c\u5e76\u4e14\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u540c\u6b65\u7684</li> <li>\u5f02\u6b65\u903b\u8f91\u90fd\u8981\u653e\u5728 action \u4e2d</li> </ol> <p>\u5982\u679c store \u6587\u4ef6\u592a\u5927\uff0c\u53ef\u4ee5\u5c06 action\uff0cmutation \u548c getter \u5206\u5272\u5230\u5355\u72ec\u6587\u4ef6\u4e2d</p> <p>\u5bf9\u4e8e\u5927\u578b\u5e94\u7528\uff0c Vuex \u76f8\u5173\u4ee3\u7801\u6700\u597d\u5206\u5272\u5230\u6a21\u5757\u4e2d</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_2","title":"\u63d2\u4ef6","text":"<p>Vuex \u7684 store \u63a5\u6536 <code>plugins</code> \uff0cPlugin\u4e2d\u4f1a\u66b4\u9732\u51fa mutation \u7684\u94a9\u5b50\u3002Vuex \u7684\u63d2\u4ef6\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5b83\u63a5\u6536 store \u4f5c\u4e3a\u552f\u4e00\u53c2\u6570</p> <pre><code>const myPlugin = store =&gt; {\n  // \u5f53 store \u521d\u59cb\u5316\u540e\u8c03\u7528\n  store.subscribe((mutation, state) =&gt; {\n    // \u6bcf\u6b21 mutation \u4e4b\u540e\u8c03\u7528\n    // mutation \u7684\u683c\u5f0f\u4e3a { type, payload }\n  })\n}\n\n\nconst store = new Vuex.Store({\n  // ...\n  plugins: [myPlugin]\n})\n</code></pre>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#mutation","title":"\u63d2\u4ef6\u5185\u63d0\u4ea4 Mutation","text":"<p>\u5728\u63d2\u4ef6\u4e2d\u4e0d\u5141\u8bb8\u76f4\u63a5\u4fee\u6539\u72b6\u6001\u2014\u2014\u7c7b\u4f3c\u4e8e\u7ec4\u4ef6\uff0c\u53ea\u80fd\u901a\u8fc7\u63d0\u4ea4 mutation \u6765\u89e6\u53d1\u53d8\u5316</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#state","title":"\u751f\u6210 State \u5feb\u7167","text":"<p>\u6709\u65f6\u5019\u63d2\u4ef6\u9700\u8981\u83b7\u5f97\u72b6\u6001\u7684\u201c\u5feb\u7167\u201d\uff0c\u6bd4\u8f83\u6539\u53d8\u7684\u524d\u540e\u72b6\u6001\u3002\u60f3\u8981\u5b9e\u73b0\u8fd9\u9879\u529f\u80fd\uff0c\u4f60\u9700\u8981\u5bf9\u72b6\u6001\u5bf9\u8c61\u8fdb\u884c\u6df1\u62f7\u8d1d\u3002</p> <p>\u751f\u6210\u72b6\u6001\u5feb\u7167\u7684\u63d2\u4ef6\u5e94\u8be5\u53ea\u5728\u5f00\u53d1\u9636\u6bb5\u4f7f\u7528</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#logger","title":"\u5185\u7f6e Logger \u63d2\u4ef6","text":"<p>Vuex \u81ea\u5e26\u4e00\u4e2a\u65e5\u5fd7\u63d2\u4ef6\u7528\u4e8e\u4e00\u822c\u7684\u8c03\u8bd5</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_3","title":"\u5f00\u542f\u4e25\u683c\u6a21\u5f0f","text":"<p>\u5f00\u542f\u4e25\u683c\u6a21\u5f0f\uff0c\u4ec5\u9700\u5728\u521b\u5efa store \u7684\u65f6\u5019\u4f20\u5165 <code>strict: true</code></p> <p>\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\uff0c\u65e0\u8bba\u4f55\u65f6\u53d1\u751f\u4e86\u72b6\u6001\u53d8\u66f4\u4e14\u4e0d\u662f\u7531 mutation \u51fd\u6570\u5f15\u8d77\u7684\uff0c\u5c06\u4f1a\u629b\u51fa\u9519\u8bef\u3002\u8fd9\u80fd\u4fdd\u8bc1\u6240\u6709\u7684\u72b6\u6001\u53d8\u66f4\u90fd\u80fd\u88ab\u8c03\u8bd5\u5de5\u5177\u8ddf\u8e2a\u5230</p> <p>\u4e0d\u8981\u5728\u53d1\u5e03\u73af\u5883\u4e0b\u542f\u7528\u4e25\u683c\u6a21\u5f0f\uff01\u4e25\u683c\u6a21\u5f0f\u4f1a\u6df1\u5ea6\u76d1\u6d4b\u72b6\u6001\u6811\u6765\u68c0\u6d4b\u4e0d\u5408\u89c4\u7684\u72b6\u6001\u53d8\u66f4\u2014\u2014\u8bf7\u786e\u4fdd\u5728\u53d1\u5e03\u73af\u5883\u4e0b\u5173\u95ed\u4e25\u683c\u6a21\u5f0f\uff0c\u4ee5\u907f\u514d\u6027\u80fd\u635f\u5931</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_4","title":"\u8868\u5355\u5904\u7406","text":"<p>\u5f53\u5728\u4e25\u683c\u6a21\u5f0f\u4e2d\u4f7f\u7528 Vuex \u65f6\uff0c\u5728\u5c5e\u4e8e Vuex \u7684 state \u4e0a\u4f7f\u7528 <code>v-model</code> \u4f1a\u6bd4\u8f83\u68d8\u624b</p> <p>\u5982\u679c\u5728 input \u4e2d\u7ed1\u5b9a\u4e00\u4e2a Vuex store \u7684\u5bf9\u8c61\uff0c\u5f53\u8f93\u5165\u6846\u503c\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u5c31\u4f1a\u5c1d\u8bd5\u53bb\u4fee\u6539\u8fd9\u4e2a\u5bf9\u8c61\uff0c\u8fd9\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u662f\u4e0d\u5141\u8bb8\u7684</p> <p>\u7528\u201cVuex \u7684\u601d\u7ef4\u201d\u53bb\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\u662f\uff1a\u7ed9 <code>&lt;input&gt;</code> \u4e2d\u7ed1\u5b9a value\uff0c\u7136\u540e\u4fa6\u542c <code>input</code> \u6216\u8005 <code>change</code> \u4e8b\u4ef6\uff0c\u5728\u4e8b\u4ef6\u56de\u8c03\u4e2d\u8c03\u7528\u4e00\u4e2a\u65b9\u6cd5\u6765\u89e6\u53d1 mutation \u51fd\u6570</p> <p>\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u7528\u8d77\u6765\u5e76\u4e0d\u662f\u5f88\u7b80\u6d01\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u65b9\u5f0f</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_5","title":"\u53cc\u5411\u7ed1\u5b9a\u7684\u8ba1\u7b97\u5c5e\u6027","text":"<p>\u4f7f\u7528\u5e26\u6709 setter \u7684\u53cc\u5411\u7ed1\u5b9a\u8ba1\u7b97\u5c5e\u6027\uff0c\u6211\u4eec\u7ed9\u8ba1\u7b97\u5c5e\u6027\u8bbe\u7f6e\u597d getter / setter\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5206\u522b\u5904\u7406\u53cc\u5411\u7ed1\u5b9a\u8ba1\u7b97\u5c5e\u6027\u7684\u83b7\u53d6\u53ca\u66f4\u6539\u4e86</p>"},{"location":"Web/Vue/Vue%20Up%20And%20Run/Chapter%207.%20Vuex%20%E8%BF%9B%E9%98%B6/#_6","title":"\u6d4b\u8bd5&amp;\u70ed\u91cd\u8f7d","text":"<p>\u6d4b\u8bd5 | Vuex</p> <p>\u70ed\u91cd\u8f7d | Vuex</p>"},{"location":"daily/2023-11-16/","title":"2023 11 16","text":"<p>\u53c8\u53d1\u73b0\u4e00\u4e2a\u65b0\u73a9\u5177\uff0c\u641e\u4e00\u4e0b</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/","title":"01 OC \u5bf9\u8c61\u7684\u672c\u8d28","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/#oc","title":"OC\u7684\u672c\u8d28","text":"<ul> <li>\u6211\u4eec\u5e73\u65f6\u7f16\u5199\u7684 Objective-C \u7684\u4ee3\u7801\uff0c\u5e95\u5c42\u5b9e\u73b0\u5176\u5b9e\u90fd\u662f C\\C++ \u4ee3\u7801</li> <li>Objective-C \u7684\u9762\u5411\u5bf9\u8c61\u90fd\u662f\u57fa\u4e8e C\\C++ \u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u7684</li> <li>Objective-C \u7684\u5bf9\u8c61\u3001\u7c7b\u90fd\u662f\u57fa\u4e8e C\\C++ \u7684\u7ed3\u6784\u4f53\u5b9e\u73b0\u7684</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/#oc-cc","title":"OC \u8f6c C\\C++","text":"<p>OC \u8f6c\u4e3a C++ \u4ee3\u7801 <code>lang -rewrite-objc main.m -o main.cpp</code></p> <p>OC \u8f6c\u4e3aiPhone arm64 \u67b6\u6784 C++ \u4ee3\u7801 <code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o main.iphone64.cpp</code></p> <p>NSObject in Objective-C</p> <pre><code>// NSObject \u7684\u5b9a\u4e49\n@interface NSObject {\n    Class isa;\n}\n</code></pre> <p>main.cpp</p> <pre><code>// NSObject Implementation in cpp file\nstruct NSObject_IMPL {\n    CLass isa;\n};\n\n// Class \u4e3a\u6307\u5411\u7ed3\u6784\u4f53\u7684\u6307\u9488\ntypedef struct objc_class *Class;\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/#_1","title":"\u7ed3\u6784\u4f53\u5185\u5b58\u5206\u914d\u539f\u5219","text":"<ul> <li>\u6570\u636e\u6210\u5458\u5bf9\u5176\u89c4\u5219\uff1a\u7ed3\u6784\u4f53\u4e2d\u7684\u6570\u636e\u6210\u5458\uff0c\u7b2c\u4e00\u4e2a\u6570\u636e\u6210\u5458\u653e\u5728offset\u4e3a0\u7684\u5730\u65b9\uff0c\u4e4b\u540e\u6bcf\u4e2a\u6570\u636e\u7684\u8d77\u59cb\u4f4d\u7f6e\u90fd\u8981\u4ece\u8be5\u6210\u5458\u5927\u5c0f\u6216\u8005\u5176\u6700\u5927\u5b50\u6210\u5458\u5927\u5c0f\u7684\u6574\u6570\u500d\u5f00\u59cb\u5b58\u50a8</li> <li>\u7ed3\u6784\u4f53\u5927\u5c0f\uff0c\u5fc5\u987b\u4e3a\u5176\u5185\u90e8\u6700\u5927\u6210\u5458\u7684\u6574\u6570\u500d\uff0c\u4e0d\u8db3\u7684\u8981\u8865\u9f50</li> <li>\u521d\u59cb\u5316\u4e4b\u540e\u5b9e\u9645\u5360\u7528\u5185\u5b58\uff0c\u8fd8\u8981\u9075\u5faa\u7cfb\u7edf\u5185\u5b58\u5bf9\u5176\u539f\u5219\uff0c\u73b0\u5728\u4e00\u822c\u4e3a16\u5b57\u8282\u5bf9\u5176</li> </ul> <p>\u5728\u5b9a\u4e49\u7ed3\u6784\u4f53\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e24\u4e2a\u7ed3\u6784\u4f53\u6709\u76f8\u540c\u7c7b\u578b\u7684\u6210\u5458\uff0c\u5e76\u4e14\u6210\u5458\u987a\u5e8f\u4e0d\u540c\uff0c\u90a3\u4e48\u6700\u7ec8\u7ed3\u6784\u4f53\u6240\u5360\u7528\u7684\u5185\u5b58\u662f\u6709\u53ef\u80fd\u4e0d\u540c\u7684</p> <p>\u4ee3\u7801\uff1a</p> <pre><code>struct Struct1 {\n    char a;     //1\u5b57\u8282 -- \u5360\u636e0\u5b57\u8282\n    double b;   //8\u5b57\u8282 -- \u5360\u636e8-15\u5b57\u8282\n    int c;      //4\u5b57\u8282 -- \u5360\u636e16-19\u5b57\u8282\n    short d;    //2\u5b57\u8282 -- \u5360\u636e20-22\u5b57\u8282\n} MyStruct1;    //\u517122\u5b57\u8282\uff0c\u4f4622\u4e0d\u662f8\u7684\u500d\u6570\uff0c\u5219+2\uff0c\u56e0\u4e3a24\u662f8\u7684\u500d\u6570\n\nstruct Struct2 {\n    double b;   //8\u5b57\u8282 -- \u5360\u636e0-7\u5b57\u8282\n    int c;      //4\u5b57\u8282 -- \u5360\u636e8-11\u5b57\u8282\n    char a;     //1\u5b57\u8282 -- \u5360\u636e12\u5b57\u8282\n    short d;    //2\u5b57\u8282 -- \u5360\u636e14-15\u5b57\u8282\n} MyStruct2;    //\u517116\u5b57\u8282\uff0c16\u662f8\u7684\u500d\u6570\u6240\u4ee5\u603b\u5927\u5c0f\u8fd8\u662f16\u5b57\u8282\n\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        NSLog(@\"Struct1 size\uff1a%lu\",sizeof(MyStruct1)); // 24\n        NSLog(@\"Struct2 size\uff1a%lu\",sizeof(MyStruct2)); // 16\n    }\n    return 0;\n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/#oc_1","title":"OC \u4e2d\u7c7b\u7684\u5185\u5b58\u5206\u914d","text":"<p>\u7531\u4e8e OC \u4e2d\u7684\u7c7b\u540c\u6837\u662f\u57fa\u4e8e C\\C++ \u4e2d\u7ed3\u6784\u4f53\u6765\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5 OC \u4e2d\u7c7b\u7684\u5185\u5b58\u5206\u914d\u539f\u5219\u540c\u7ed3\u6784\u4f53\u662f\u4e00\u6837\u7684</p> <p>OC \u4e2d\u7684\u6210\u5458\u53d8\u91cf\u4e0e\u5c5e\u6027\u7684\u533a\u522b</p> <p>OC \u4e2d\u7684\u6210\u5458\u53d8\u91cf\u5728\u751f\u6210\u7ed3\u6784\u4f53\u7684\u65f6\u5019\u987a\u5e8f\u4e0e\u5b9a\u4e49\u7684\u987a\u5e8f\u76f8\u540c\uff0c\u4f46\u662f\u5c5e\u6027\u5728\u7f16\u8bd1\u751f\u6210\u7ed3\u6784\u4f53\u7684\u65f6\u5019\u4f1a\u6709\u4e00\u4e2a\u91cd\u6392\uff0c\u4fdd\u8bc1\u7c7b\u5728\u9075\u5faa\u5185\u5b58\u5206\u914d\u539f\u5219\u540e\u5360\u7528\u5185\u5b58\u6700\u5c0f\uff0c\u6240\u4ee5\u6210\u5458\u53d8\u91cf\u7684\u987a\u5e8f\u6709\u53ef\u80fd\u4f1a\u5f71\u54cd OC \u7c7b\u6700\u7ec8\u5185\u5b58\u5360\u7528\u5927\u5c0f\uff0c\u800c\u5c5e\u6027\u7684\u5b9a\u4e49\u987a\u5e8f\u4e0d\u4f1a\u3002</p> <p>\u4e0a \ud83c\udf30 </p> <pre><code>@interface Cls1 : NSObject\n@property (nonatomic, assign) double _b;\n@property (nonatomic, assign) int _c;\n@property (nonatomic, assign) char _a;\n@property (nonatomic, assign) short _d;\n\n@end\n\n@implementation Cls1\n@end\n\n@interface Cls2 : NSObject\n@property (nonatomic, assign) char _a;\n@property (nonatomic, assign) double _b;\n@property (nonatomic, assign) int _c;\n@property (nonatomic, assign) short _d;\n@end\n\n@implementation Cls2\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        NSLog(@\"Cls1 size\uff1a%lu, allocSize: %lu\", class_getInstanceSize([Cls1 class]), malloc_size((__bridge const void *)([[Cls1 alloc] init])));\n        NSLog(@\"Cls2 size\uff1a%lu, allocSize: %lu\", class_getInstanceSize([Cls2 class]), malloc_size((__bridge const void *)([[Cls2 alloc] init])));\n    }\n    return 0;\n}\n\n// output\n// Cls1 size\uff1a24, allocSize: 32\n// Cls2 size\uff1a24, allocSize: 32\n\n//\u4ece\u4e0a\u9762\u4f8b\u5b50\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u867d\u7136\u4e24\u4e2a\u7c7b\u5b9a\u4e49\u7684\u5c5e\u6027\u987a\u5e8f\u540c\u4e4b\u524d\u7684\u4e24\u4e2a struct \u76f8\u540c\uff0c\u4f46\u662f\u4e24\u4e2a\u7c7b\u6700\u7ec8\u5360\u7528\u7684\u5185\u5b58\u53ca\u7cfb\u7edf\u6700\u7ec8\u5206\u914d\u7684\u5185\u5b58\u662f\u76f8\u540c\u7684\n</code></pre> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u751f\u6210 C++ \u4e4b\u540e\u7684\u4ee3\u7801</p> <pre><code>struct Cls1_IMPL {\n    struct NSObject_IMPL NSObject_IVARS;\n    char __a;\n    short __d;\n    int __c;\n    double __b;\n};\n\nstruct Cls2_IMPL {\n    struct NSObject_IMPL NSObject_IVARS;\n    char __a;\n    short __d;\n    int __c;\n    double __b;\n};\n\n// \u53ef\u4ee5\u770b\u5230\u8f6c\u6210 C++ \u4ee3\u7801\u4e4b\u540e\uff0c\u7ed3\u6784\u7684\u6210\u5458\u987a\u5e8f\u53d8\u6210\u4e86\u4e00\u6837\u7684\uff0c\u8fd9\u5c31\u8bc1\u660e\u4e86 OC \u7c7b\u5728\u8f6c\u4e3a\u7ed3\u6784\u4f53\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u5c5e\u6027\u8fdb\u884c\u91cd\u6392\uff0c\u4fdd\u8bc1\u5728\u6ee1\u8db3\u5185\u5b58\u5206\u914d\u89c4\u5219\u7684\u524d\u63d0\u4e0b\u4fdd\u8bc1\u5185\u5b58\u5360\u7528\u6700\u4f18\n</code></pre> <p>\u4f46\u662f\u5982\u679c\u7ed9\u7c7b\u6dfb\u52a0\u6210\u5458\u53d8\u91cf\u4f1a\u600e\u4e48\u6837\u5462 \u6211\u4eec\u8fd8\u662f\u7528\u4ee3\u7801\u6765\u8bc1\u660e</p> <pre><code>@interface Cls1 : NSObject\n{\n    char c;\n    double d;\n    int a;\n    int b;\n\n}\n@property (nonatomic, assign) double _b;\n@property (nonatomic, assign) int _c;\n@property (nonatomic, assign) char _a;\n@property (nonatomic, assign) short _d;\n@property (nonatomic, assign) int _c1;\n\n@end\n\n@implementation Cls1\n@end\n\n@interface Cls2 : NSObject\n{\n    double d;\n    int a;\n    int b;\n    char c;\n}\n@property (nonatomic, assign) char _a;\n@property (nonatomic, assign) double _b;\n@property (nonatomic, assign) int _c;\n@property (nonatomic, assign) short _d;\n@property (nonatomic, assign) int _c1;\n@end\n\n@implementation Cls2\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {  \n        NSLog(@\"Cls1 size\uff1a%lu, allocSize: %lu\", class_getInstanceSize([Cls1 class]), malloc_size((__bridge const void *)([[Cls1 alloc] init])));\n        NSLog(@\"Cls2 size\uff1a%lu, allocSize: %lu\", class_getInstanceSize([Cls2 class]), malloc_size((__bridge const void *)([[Cls2 alloc] init])));\n    }\n    return 0;\n}\n// output\n// Cls1 size\uff1a56, allocSize: 64\n// Cls2 size\uff1a48, allocSize: 48\n</code></pre> <p>\u6211\u4eec\u7ee7\u7eed\u6765\u770b\u4e00\u4e0b\u751f\u6210\u7684 C++ \u4ee3\u7801</p> <pre><code>struct Cls1_IMPL {\n    struct NSObject_IMPL NSObject_IVARS;  // 0-7\n    char c;                               // 8\n    double d;                             // 16-23\n    int a;                                // 24-27\n    int b;                                // 28-31\n    char __a;                             // 32\n    short __d;                            // 34-35\n    int __c;                              // 36-39\n    int __c1;                             // 40-43\n    double __b;                           // 48-55\n};\n// \u6700\u7ec8\u5360\u7528 56 \u5b57\u8282\uff0c\u5b9e\u9645\u5185\u5b58\u5206\u914d 16\u5bf9\u5176\uff0c\u5206\u914d 64\n\nstruct Cls2_IMPL {\n    struct NSObject_IMPL NSObject_IVARS; // 0-7\n    double d;                            // 8-15\n    int a;                               // 16-19\n    int b;                               // 20-23\n    char c;                              // 24\n    char __a;                            // 25\n    short __d;                           // 26-27\n    int __c;                             // 28-32\n    int __c1;                            // 36-39\n    double __b;                          // 40-47\n};\n// \u6700\u7ec8\u5360\u7528 48 \u5b57\u8282\uff0c\u5b9e\u9645\u5185\u5b58\u5206\u914d 16\u5bf9\u5176\uff0c\u5206\u914d 48\n\n// \u53ef\u4ee5\u770b\u5230\uff0c\u8f6c\u4e3a C++ \u4ee3\u7801\u4e4b\u540e\uff0c\u6210\u5458\u53d8\u91cf\u5e76\u6ca1\u6709\u91cd\u6392\uff0c\u800c\u662f\u4fdd\u6301\u4e86\u5728 OC \u7c7b\u4e2d\u5b9a\u4e49\u7684\u987a\u5e8f\uff0c\u800c\u5c5e\u6027\u4f9d\u7136\u4f1a\u6309\u7167\u5185\u5b58\u5360\u7528\u6700\u4f18\u89e3\u8fdb\u884c\u91cd\u6392\n</code></pre> <p>\u7531\u4e8e OC \u4e2d\u6240\u6709\u7684\u7c7b\u90fd\u662f\u7ee7\u627f\u81ea NSObject\uff0c\u6240\u4ee5\u5728 OC \u7c7b\u8f6c\u4e3a\u7ed3\u6784\u4f53\u4e4b\u540e\uff0c\u7b2c\u4e00\u4e2a\u6210\u5458\u90fd\u4e3a isa \u6307\u9488\uff0c\u5360 8 \u4e2a\u5b57\u8282\uff0c\u63a5\u4e0b\u6765\u662f\u7c7b\u7684\u6210\u5458\u53d8\u91cf\uff08\u6309\u5b9a\u4e49\u987a\u5e8f\u5b58\u50a8\uff09\uff0c\u6700\u540e\u662f\u91cd\u6392\u540e\u7684\u5c5e\u6027\uff1b</p> <p>NSObject \u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u6210\u5458\u53d8\u91cf\u7684\u5927\u5c0f\u4e3a 8, \u5728 NSObject_IMPL \u4e2d\u4e5f\u5c31\u662f isa \u6240\u5360\u7528\u7684\u5b57\u8282\uff0cNSObject\u5728\u5185\u5b58\u4e2d\u5b9e\u9645\u5360\u7528\u7684\u5927\u5c0f\u4e5f\u4e3a8\uff0c\u4f46\u662f\u7531\u4e8e\u7cfb\u7edf\u5206\u914d\u5185\u5b58\u5bf9\u5176\u539f\u5219\uff0c\u5b9e\u9645\u4e3a NSObject \u5b9e\u4f8b\u5bf9\u8c61\u5206\u914d\u7684\u5185\u5b58\u5219\u4e3a 16</p> <p>\u901a\u8fc7 <code>class_getInstanceSize([NSObject class])</code> \u4f20\u5165\u7c7b\u5bf9\u8c61\uff0c\u53ef\u4ee5\u83b7\u53d6\u5230\u7c7b\u5b9e\u9645\u5360\u7528\u7684\u5185\u5b58 \u800c\u901a\u8fc7 <code>malloc_size</code> \u4f20\u5165\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u8fd4\u56de\u7684\u4e3a\u7cfb\u7edf\u4e3a\u8be5\u5b9e\u4f8b\u5bf9\u8c61\u5b9e\u9645\u5206\u914d\u7684\u5185\u5b58</p> <pre><code>#import &lt;Foundation/Foundation.h&gt;\n#import &lt;objc/runtime.h&gt;\n#import &lt;malloc/malloc.h&gt;\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        NSObject *obj = [[NSObject alloc] init];\n        // \u83b7\u53d6 NSObject \u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\u6210\u5458\u53d8\u91cf\u7684\u5927\u5c0f &gt;&gt; 8, \u5728 NSObject_IMPL \u4e2d\u4e5f\u5c31\u662f isa \u6240\u5360\u7528\u7684\u5b57\u8282\n        NSLog(@\"%zd\", class_getInstanceSize([NSObject class]));\n//        class_getInstanceSize \u5b9e\u73b0\n//        size_t class_getInstanceSize(Class cls)\n//        {\n//            if (!cls) return 0;\n//            return cls-&gt;alignedInstanceSize();\n//        }\n//        Class's ivar size rounded up to a pointer-size boundary.\n//        uint32_t alignedInstanceSize() const {\n//            return word_align(unalignedInstanceSize());\n//        }\n\n\n        // \u83b7\u53d6 obj \u6307\u9488\u6307\u5411\u5185\u5b58\u7684\u5927\u5c0f &gt;&gt; 16 \uff088\u4e2a\u5b57\u8282\u5b58isa\u6307\u9488\uff0c\u53e6\u59168\u4e2a\u7a7a\uff09\n        // malloc_size \u83b7\u53d6\u5206\u914d\u5185\u5b58\u7684\u5927\u5c0f\n        NSLog(@\"%zd\", malloc_size((__bridge const void *)(obj)));\n    }\n    return 0;\n}\n\n</code></pre> <p></p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7debug\u6765\u901a\u8fc7\u65ad\u70b9\u6765\u67e5\u770bobj\u7684\u5185\u5b58\u5206\u914d\u4fa7\u9762\u6765\u8bc1\u660eobj\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5</p> <p>Debug-&gt; Debug Workflow -&gt; view memory\uff0c\u901a\u8fc7\u8f93\u5165obj\u7684\u5185\u5b58\u5730\u5740\u6765\u67e5\u770b\u8fde\u7eed16\u4e2a\u5b57\u8282\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5\uff0c\u53ef\u4ee5\u770b\u5230\u524d8\u4f4d\u662f\u6709\u503c\u7684\uff0c\u540e8\u4f4d\u4e3a0</p> <p></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/01-OC%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/#student","title":"Student \u7684\u672c\u8d28","text":"<pre><code>@interface Student : NSObject{\n    @public\n    int _no;\n    int _age;\n}\n@end\n\n@implementation Student\n\n@end\n\n// Student Implementation\nstruct Student_IMPL {\n    struct NSObject_IMPL NSObject_IVARS;\n    int _no;\n    int _age;\n};\n\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/","title":"02 \u7c7b\u5bf9\u8c61","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/#oc","title":"OC \u5bf9\u8c61\u5206\u7c7b","text":"<p>OC \u4e2d\u7684\u5bf9\u8c61\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a3\u4e2d - instance \u5bf9\u8c61 \uff08\u5b9e\u4f8b\u5bf9\u8c61\uff09 - class \u5bf9\u8c61 \uff08\u7c7b\u5bf9\u8c61\uff09 - meta-class \u5bf9\u8c61\uff08\u5143\u7c7b\u5bf9\u8c61\uff09</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/#instance","title":"Instance \u5bf9\u8c61","text":"<p>instance \u5bf9\u8c61\u5c31\u662f alloc \u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u6bcf\u6b21\u8c03\u7528 alloc \u90fd\u4f1a\u4ea7\u751f\u65b0\u7684 instance \u5bf9\u8c61</p> <p>instance \u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u5b58\u50a8\u4e86 isa \u6307\u9488 \u53ca \u5176\u4ed6 \u6210\u5458\u53d8\u91cf isa \u5728\u5185\u5b58\u4e2d\u59cb\u7ec8\u5728\u6700\u524d</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/#_1","title":"\u7c7b\u5bf9\u8c61","text":"<pre><code>NSObject *obj1 = [[NSObject alloc] init];\nNSObject *obj2 = [[NSObject alloc] init];\nNSObject *obj3 = [[NSObject alloc] init];\n// \u83b7\u53d6\u7c7b\u5bf9\u8c61\nClass class1 = [obj1 class];\nClass class1_1 = object_getClass(obj1);\nClass class2 = [obj2 class];\nClass class3 = [obj3 class];\nClass class4 = [NSObject class];\n\n// \u83b7\u53d6\u5143\u7c7b\u5bf9\u8c61\nClass objMetaClass = object_getClass(class1);\n\nNSLog(@\"class: \\n class1: %p, \\n class1_1: %p, \\n class2: %p, \\n class3: %p, \\n class4: %p\", &amp;class1, class1_1, class2, class3, class4);\n\nNSLog(@\"meta_class: %p\", objMetaClass);\n\n// out put \n// class:\n// class1: 0x7ffeefbff3f0, \n// class1_1: 0x7fff80667088, \n// class2: 0x7fff80667088, \n// class3: 0x7fff80667088, \n// class4: 0x7fff80667088\n\n// meta_class: 0x7fff80667060\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\uff0c\u540c\u4e00\u4e2a\u7c7b\u7684\u7c7b\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u53ea\u6709\u4e00\u4efd \u7c7b\u5bf9\u8c61\u4e2d\u5b58\u50a8\u7684\u4fe1\u606f\u4e3b\u8981\u5305\u62ec\uff1a</p> <ul> <li>isa \u6307\u9488</li> <li>superClass \u6307\u9488</li> <li>\u7c7b\u7684\u5c5e\u6027\u4fe1\u606f(@property)\u3001\u7c7b\u7684\u5bf9\u8c61\u65b9\u6cd5\uff08instance method\uff09</li> <li>\u7c7b\u7684\u534f\u8bae\u4fe1\u606f\uff08protocol\uff09\u3001\u7c7b\u7684\u6210\u5458\u53d8\u91cf\u4fe1\u606f\uff08ivar\uff09</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/#meta-class","title":"meta-class \u5bf9\u8c61","text":"<pre><code>// file objc-class.mm\nClass object_getClass(id obj){\n    // \u5982\u679c\u4f20\u5165\u53c2\u6570\u4e3a instance \u5bf9\u8c61\uff0c\u5219\u8fd4\u56de class \u5bf9\u8c61\n    // \u5982\u679c\u4f20\u5165\u53c2\u6570\u4e3a class \u5bf9\u8c61\uff0c\u5219\u8fd4\u56de meta-class \u5bf9\u8c61\n    // \u5982\u679c\u662f meta-class \u5bf9\u8c61\uff0c\u5219\u8fd4\u56de NSObject\uff08\u57fa\u7c7b\uff09\u7684meta-class \u5bf9\u8c61\n    if (obj) return obj-&gt;getIsa();\n    else return Nil;\n}\n</code></pre> <p><code>Class objMetaClass = object_getClass([NSObject class]]);</code></p> <p>objMetaClass \u4e3a\u5143\u7c7b\u5bf9\u8c61\uff0c\u4e0e\u7c7b\u5bf9\u8c61\u5185\u5b58\u7ed3\u6784\u76f8\u540c\uff0c\u4f46\u662f\u7528\u9014\u4e0d\u540c\uff0c\u5143\u7c7b\u4e2d\u5b58\u50a8\u7684\u4fe1\u606f\u5305\u62ec</p> <ul> <li>isa \u6307\u9488</li> <li>superclass \u6307\u9488</li> <li>\u7c7b\u7684\u7c7b\u65b9\u6cd5\u4fe1\u606f\uff08class method\uff09</li> </ul> <p>\u800c\u7c7b\u5bf9\u8c61\u4e2d\u5b58\u50a8\u7684 \u7c7b\u5c5e\u6027\u4fe1\u606f\u3001\u5bf9\u8c61\u65b9\u6cd5\u3001\u534f\u8bae\u4fe1\u606f\u3001\u6210\u5458\u53d8\u91cf\u4fe1\u606f\u90fd\u4e3a <code>null</code></p> <p><code>class_isMetaClass([NSObject calss]);</code> \u53ef\u7528\u6765\u5224\u65ad\u662f\u5426\u4e3a\u5143\u7c7b\u5bf9\u8c61</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/02-%E7%B1%BB%E5%AF%B9%E8%B1%A1/#isa","title":"isa \u6307\u9488","text":"<p><code>instance</code> \u7684 <code>isa</code> \u6307\u5411 <code>class</code></p> <p>\u5f53\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u65f6\uff0c\u901a\u8fc7 <code>instance</code> \u7684 <code>isa</code> \u6307\u9488\u627e\u5230 <code>class</code>, \u6700\u540e\u627e\u5230 \u5bf9\u8c61\u65b9\u6cd5 \u7684\u5b9e\u73b0\u8fdb\u884c\u8c03\u7528</p> <p><code>class</code> \u7684 <code>isa</code> \u6307\u5411 <code>meta-class</code></p> <p>\u5f53\u8c03\u7528\u7c7b\u65b9\u6cd5\u65f6\uff0c\u901a\u8fc7 <code>class</code> \u7684 <code>isa</code> \u627e\u5230 <code>meta-class</code>\uff0c\u6700\u540e\u627e\u5230\u7c7b\u65b9\u6cd5\u8fdb\u884c\u8c03\u7528</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03-isa%E3%80%81class%E3%80%81superClass/","title":"03 isa\u3001class\u3001superClass","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03-isa%E3%80%81class%E3%80%81superClass/#isa","title":"isa \u6307\u9488","text":"<p><code>instance</code> \u7684 <code>isa</code> \u6307\u5411 <code>class</code></p> <p>\u5f53\u8c03\u7528\u5bf9\u8c61\u65b9\u6cd5\u65f6\uff0c\u901a\u8fc7 <code>instance</code> \u7684 <code>isa</code> \u6307\u9488\u627e\u5230 <code>class</code>, \u6700\u540e\u627e\u5230 \u5bf9\u8c61\u65b9\u6cd5 \u7684\u5b9e\u73b0\u8fdb\u884c\u8c03\u7528</p> <p><code>class</code> \u7684 <code>isa</code> \u6307\u5411 <code>meta-class</code></p> <p>\u5f53\u8c03\u7528\u7c7b\u65b9\u6cd5\u65f6\uff0c\u901a\u8fc7 <code>class</code> \u7684 <code>isa</code> \u627e\u5230 <code>meta-class</code>\uff0c\u6700\u540e\u627e\u5230\u7c7b\u65b9\u6cd5\u8fdb\u884c\u8c03\u7528</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03-isa%E3%80%81class%E3%80%81superClass/#class-superclass","title":"class \u5bf9\u8c61\u7684 superclass \u6307\u9488","text":"<p>\u7c7b\u5bf9\u8c61\u7684 superclass \u6307\u9488\u6307\u5411\u7684\u662f\u7236\u7c7b\u7684\u7c7b\u5bf9\u8c61</p> <p><code>Student -&gt; Person -&gt; NSObject</code></p> <p>\u5f53 <code>Student</code> \u7684  <code>instance</code> \u5bf9\u8c61\u8c03\u7528 <code>Person</code> \u7684\u5bf9\u8c61\u65b9\u6cd5\u65f6\uff0c\u4f1a\u5148\u901a\u8fc7 <code>isa</code> \u627e\u5230 <code>Student</code> \u7684 <code>class</code>\uff0c\u7136\u540e\u901a\u8fc7 <code>superclass</code> \u627e\u5230 <code>Person</code> \u7684 <code>class</code>\uff0c\u6700\u540e\u627e\u5230\u5bf9\u8c61\u65b9\u6cd5\u7684\u5b9e\u73b0\u8fdb\u884c\u8c03\u7528 </p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03-isa%E3%80%81class%E3%80%81superClass/#meta-class-superclass","title":"meta-class \u5bf9\u8c61\u7684 superclass \u6307\u9488","text":"<p>\u5143\u7c7b\u7684<code>superclass</code>\u6307\u9488\u6307\u5411\u7684\u662f\u7236\u7c7b\u7684\u5143\u7c7b\u5bf9\u8c61</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/03-isa%E3%80%81class%E3%80%81superClass/#isaclassmeta-class","title":"isa\u3001class\u3001meta-class \u603b\u7ed3","text":"<ul> <li>instance \u7684 isa \u6307\u5411 class</li> <li>class \u7684 isa \u6307\u5411 meta-class</li> <li>meta-class \u7684 isa \u6307\u5411\u57fa\u7c7b(NSObject)\u7684 meta-class</li> <li>class \u7684 superclass \u6307\u5411\u7236\u7c7b\u7684 class</li> <li>\u5982\u679c\u6ca1\u6709\u7236\u7c7b superclass \u4e3a nil</li> <li>meta-class \u7684 superclss \u6307\u5411\u7236\u7c7b\u7684 meta-class</li> <li>\u57fa\u7c7b meta-class \u7684 superclass \u6307\u5411\u57fa\u7c7b\u7684 class</li> </ul> <p>instance \u65b9\u6cd5\u8c03\u7528\u8f68\u8ff9</p> <ul> <li>isa \u627e\u5230 class, \u5982\u679c\u65b9\u6cd5\u4e0d\u5b58\u5728\u5c31\u901a\u8fc7 superclass \u5230\u7236\u7c7b\u4e2d\u67e5\u627e\uff0c\u5982\u679c\u5230\u57fa\u7c7b\u8fd8\u662f\u627e\u4e0d\u5230\u65b9\u6cd5 \u5219\u629b\u51fa\u9519\u8bef</li> </ul> <p>class \u8c03\u7528\u7c7b\u65b9\u6cd5\u7684\u8f68\u8ff9 - isa \u627e\u5230 meta-class\uff0c\u5982\u679c\u65b9\u6cd5\u4e0d\u5b58\u5728\u5219\u901a\u8fc7 superclass \u5230\u7236\u7c7b\u67e5\u627e\uff0c\u5982\u679c\u5230\u57fa\u7c7b\u7684 meta-class\u8fd8\u662f\u627e\u4e0d\u5230\uff0c\u5219\u901a\u8fc7\u57fa\u7c7b\u7684 superclass \u627e\u5230\u57fa\u7c7b\u7684 class \u7c7b\u5bf9\u8c61\uff0c\u82e5\u8fd8\u662f\u6ca1\u6709\u5219\u62a5\u9519</p> <p>\u4ece64bit\u5f00\u59cb\uff0cisa\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u4f4d\u8fd0\u7b97\uff0c\u624d\u80fd\u8ba1\u7b97\u51fa\u771f\u5b9e\u5730\u5740 <code>&amp;ISA_MASK</code></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/04-KVO/","title":"04 KVO","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/04-KVO/#kvo","title":"KVO","text":"<p>KVO \u7684\u5168\u79f0 Key-Value Observing\uff0c\u4fd7\u79f0 \u952e\u503c\u76d1\u542c\uff0c\u7528\u6765\u76d1\u542c\u67d0\u4e2a\u5bf9\u8c61\u5c5e\u6027\u503c\u7684\u6539\u53d8</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/04-KVO/#_1","title":"\u5e95\u5c42\u5b9e\u73b0","text":"<pre><code>@interface Person : NSObject\n@property(nonatomic, assign) int age;\n@end\n\n@implementation Person\n\n@end\n</code></pre> <p>\u62ff <code>Person</code> \u7c7b\u6765\u4e3e\u4f8b\u7684\u8bdd</p> <p><code>Person</code> \u5b9e\u4f8b\u5bf9\u8c61\u5982\u679c\u4f7f\u7528\u4e86 KVO\uff0c\u90a3\u4e48\u8be5\u5b9e\u4f8b\u5bf9\u8c61\u7684 isa \u5219\u4f1a\u6307\u5411\u4e00\u4e2a\u540d\u53eb <code>NSKVONotifying_Person</code> \u7684\u7c7b\u5bf9\u8c61</p> <p><code>NSKVONotifying_Person</code> \u7c7b\u7ee7\u627f\u81ea <code>Person</code>\uff0c\u4e5f\u5c31\u662f <code>NSKVONotifying_Person</code> \u7c7b\u5bf9\u8c61\u7684 <code>superclass</code> \u6307\u9488\u6307\u5411 <code>Person</code> \u7c7b\u5bf9\u8c61</p> <p><code>NSKVONotifying_Person</code> \u7684 setAge \u65b9\u6cd5\u4f1a\u6307\u5411Foundation \u4e2d\u7684 _NSSetIntValueAndNotify \u65b9\u6cd5</p> <p></p> <p></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/04-KVO/#_nssetvalueandnotify","title":"_NSSet*ValueAndNotify \u7684\u5185\u90e8\u5b9e\u73b0","text":"<p><code>NSKVONotifying_Person</code> \u4e2d\u7684\u5b9e\u73b0\u5927\u6982\u5982\u4e0b\uff1a</p> <pre><code>@implementation NSKVONotifying_Person\n\n- (void) setAge: (int) age {\n    _NSSetIntValueAndNotify()\n}\n\nvoid _NSSetIntValueAndNotify() {\n    [self willChangeValueForKey:@\"age\"];\n    [super setAge: age];\n    [self didChangeValueForKey: @\"age\"];\n}\n\n// \u5c4f\u853d\u5185\u90e8\u5b9e\u73b0\uff0c\u9690\u85cf NSKVONotifying_Person \u7684\u5b58\u5728\uff0c\u5982\u679c\u91cd\u5199\u5c31\u4f1a\u8fd4\u56de\u5b9e\u9645\u7684\u7c7b\u5bf9\u8c61 NSKVONotifying_Person\n-(Class)class {\n    retrun [Person class];\n}\n\n-(void)dealloc {\n\n}\n\n-(BOOL)_isKVOA {\n    return YES;\n}\n</code></pre> <p>NSKeyValueObserving</p> <pre><code>@implementation NSObject (NSKeyValueObserverNotification)\n-(void)didChangeValueForKey: (NSString*) key {\n    // \u5f53\u7136\u8fd9\u90e8\u5206\u903b\u8f91\u4e0d\u662f\u5b9e\u73b0\u5728\u8be5\u7c7b\u4e2d\uff0c\u800c\u662f\u5728 Foundation \u7684 NSObject(NSKeyValueObserverNotification) \u7c7b\u6269\u5c55\u4e2d\u5b9e\u73b0\u7684\u8be5\u903b\u8f91\uff0c\u5047\u5982\u81ea\u5df1\u91cd\u5199\u4e86didChangeValueForKey \u65b9\u6cd5\uff0c\u5e76\u4e14\u6ca1\u6709\u8c03\u7528 [super didChangeValueForKey]\uff0c\u4e0d\u80fd\u89e6\u53d1 KVO \u7684\u76d1\u542c\u65b9\u6cd5\n    [observe observeValueForKeyPath:key ofObject:self change: change context: context]\n}\n@end\n</code></pre> <p>NSKVONotifying_Person \u4e2d\u91cd\u5199\u7684\u65b9\u6cd5\u53ef\u4ee5\u901a\u8fc7\u83b7\u53d6\u5176\u4e2d\u65b9\u6cd5\u5217\u8868\u6765\u67e5\u770b</p> <pre><code>#import &lt;objc/runtime.h&gt;\n\n@implementation Utils \n+ (void) printMethodNamesOfClass: (Class) cls {\n    unsigned int count;\n    Method *methodList = class_copyMethodList(cls, &amp;count);\n    NSMutableString *methodNames = [NSMutableString string];\n\n    for (int i = 0; i &lt; count; i++) {\n        Method method = methodList[i];\n        NSString *methodName = NSStringFromSelector(method_getName(method));\n        [methodNames appendFormat:@\"%@ \", methodName];\n    }\n    NSLog(@\"%@\", methodNames);\n}\n@end\n\n[Utils printMethodNamesOfClass: object_getClass(self.person1)];\n</code></pre> <p>\u6dfb\u52a0\u76d1\u542c\u5668\u7684\u5bf9\u8c61\u5728\u4e0d\u6539\u53d8\u76d1\u542c\u5c5e\u6027\u6539\u53d8\u7684\u524d\u63d0\u4e0b\u89e6\u53d1 \u89c2\u5bdf\u8005\u76d1\u542c\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8fd9\u6837\u505a</p> <pre><code>[self.person1 willChangeValueForKey:@\"age\"];\n// didChangeValueForKey \u4e2d\u4f1a\u6709\u5224\u65ad\u662f\u5426\u8c03\u7528\u4e86 willChangeValueForKey\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u89e6\u53d1 KVO \u90a3\u4e48\u9700\u8981\u5c06\u4e24\u4e2a\u65b9\u6cd5\u4e00\u8d77\u8c03\u7528\u624d\u53ef\u4ee5\n[self.person1 didChangeValueForKey:@\"age\"];\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/05-KVC/","title":"05 KVC","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/05-KVC/#kvc","title":"KVC","text":"<p>KVC \u5168\u7a0b Key-Value Coding \u4fd7\u79f0 \u201c\u952e\u503c\u7f16\u7801\u201d \uff0c\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a key \u6765\u8bbf\u95ee\u67d0\u4e2a\u5c5e\u6027</p> <p>\u5e38\u89c1API</p> <pre><code>\n- (void)setValue:(nullable id)value forKeyPath:(NSString *)keyPath;\n- (void)setValue:(nullable id)value forKey:(NSString *)key;\n- (nullable id)valueForKeyPath:(NSString *)keyPath;\n- (nullable id)valueForKey:(NSString *)key;\n\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/05-KVC/#kvc_1","title":"KVC \u8d4b\u503c\u8fc7\u7a0b","text":"<pre><code>/* Given a value and a key that identifies an attribute, set the value of the attribute. Given an object and a key that identifies a to-one relationship, relate the object to the receiver, unrelating the previously related object if there was one. Given a collection object and a key that identifies a to-many relationship, relate the objects contained in the collection to the receiver, unrelating previously related objects if there were any.\n\nThe default implementation of this method does the following:\n    1. Searches the class of the receiver for an accessor method whose name matches the pattern -set&lt;Key&gt;:. If such a method is found the type of its parameter is checked. If the parameter type is not an object pointer type but the value is nil -setNilValueForKey: is invoked. The default implementation of -setNilValueForKey: raises an NSInvalidArgumentException, but you can override it in your application. Otherwise, if the type of the method's parameter is an object pointer type the method is simply invoked with the value as the argument. If the type of the method's parameter is some other type the inverse of the NSNumber/NSValue conversion done by -valueForKey: is performed before the method is invoked.\n    2. Otherwise (no accessor method is found), if the receiver's class' +accessInstanceVariablesDirectly property returns YES, searches the class of the receiver for an instance variable whose name matches the pattern _&lt;key&gt;, _is&lt;Key&gt;, &lt;key&gt;, or is&lt;Key&gt;, in that order. If such an instance variable is found and its type is an object pointer type the value is retained and the result is set in the instance variable, after the instance variable's old value is first released. If the instance variable's type is some other type its value is set after the same sort of conversion from NSNumber or NSValue as in step 1.\n    3. Otherwise (no accessor method or instance variable is found), invokes -setValue:forUndefinedKey:. The default implementation of -setValue:forUndefinedKey: raises an NSUndefinedKeyException, but you can override it in your application.\n\nCompatibility notes:\n    - For backward binary compatibility with -takeValue:forKey:'s behavior, a method whose name matches the pattern -_set&lt;Key&gt;: is also recognized in step 1. KVC accessor methods whose names start with underscores were deprecated as of Mac OS 10.3 though.\n    - For backward binary compatibility, -unableToSetNilForKey: will be invoked instead of -setNilValueForKey: in step 1, if the implementation of -unableToSetNilForKey: in the receiver's class is not NSObject's.\n    - The behavior described in step 2 is different from -takeValue:forKey:'s, in which the instance variable search order is &lt;key&gt;, _&lt;key&gt;.\n    - For backward binary compatibility with -takeValue:forKey:'s behavior, -handleTakeValue:forUnboundKey: will be invoked instead of -setValue:forUndefinedKey: in step 3, if the implementation of -handleTakeValue:forUnboundKey: in the receiver's class is not NSObject's.\n*/\n- (void)setValue:(nullable id)value forKey:(NSString *)key;\n</code></pre> <p>\u5373\u4f7f\u6ca1\u6709\u7c7b\u4e2d\u6ca1\u6709\u5c5e\u6027\uff0c\u6ca1\u6709\u5b9e\u73b0 set \u65b9\u6cd5\uff0c\u53ea\u8981\u80fd\u6b63\u5e38\u8c03\u7528 KVC\uff0c \u90a3\u4e48\u4e5f\u53ef\u4ee5\u89e6\u53d1 KVO\uff0cKVC\u4e2d\u4ece\u73b0\u8c61\u6765\u770b\u7684\u8bdd\u662f\u5b9e\u73b0\u4e86 KVO \u7684\u903b\u8f91</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/05-KVC/#kvc_2","title":"KVC \u53d6\u503c\u8fc7\u7a0b","text":"<pre><code>/* Given a key that identifies an attribute or to-one relationship, return the attribute value or the related object. Given a key that identifies a to-many relationship, return an immutable array or an immutable set that contains all of the related objects.\n\nThe default implementation of this method does the following:\n    1. Searches the class of the receiver for an accessor method whose name matches the pattern -get&lt;Key&gt;, -&lt;key&gt;, or -is&lt;Key&gt;, in that order. If such a method is found it is invoked. If the type of the method's result is an object pointer type the result is simply returned. If the type of the result is one of the scalar types supported by NSNumber conversion is done and an NSNumber is returned. Otherwise, conversion is done and an NSValue is returned (new in Mac OS 10.5: results of arbitrary type are converted to NSValues, not just NSPoint, NRange, NSRect, and NSSize).\n    2. (introduced in Mac OS 10.7). Otherwise (no simple accessor method is found), searches the class of the receiver for methods whose names match the patterns -countOf&lt;Key&gt; and -indexIn&lt;Key&gt;OfObject: and -objectIn&lt;Key&gt;AtIndex: (corresponding to the primitive methods defined by the NSOrderedSet class) and also -&lt;key&gt;AtIndexes: (corresponding to -[NSOrderedSet objectsAtIndexes:]). If a count method and an indexOf method and at least one of the other two possible methods are found, a collection proxy object that responds to all NSOrderedSet methods is returned. Each NSOrderedSet message sent to the collection proxy object will result in some combination of -countOf&lt;Key&gt;, -indexIn&lt;Key&gt;OfObject:, -objectIn&lt;Key&gt;AtIndex:, and -&lt;key&gt;AtIndexes: messages being sent to the original receiver of -valueForKey:. If the class of the receiver also implements an optional method whose name matches the pattern -get&lt;Key&gt;:range: that method will be used when appropriate for best performance.\n    3. Otherwise (no simple accessor method or set of ordered set access methods is found), searches the class of the receiver for methods whose names match the patterns -countOf&lt;Key&gt; and -objectIn&lt;Key&gt;AtIndex: (corresponding to the primitive methods defined by the NSArray class) and (introduced in Mac OS 10.4) also -&lt;key&gt;AtIndexes: (corresponding to -[NSArray objectsAtIndexes:]). If a count method and at least one of the other two possible methods are found, a collection proxy object that responds to all NSArray methods is returned. Each NSArray message sent to the collection proxy object will result in some combination of -countOf&lt;Key&gt;, -objectIn&lt;Key&gt;AtIndex:, and -&lt;key&gt;AtIndexes: messages being sent to the original receiver of -valueForKey:. If the class of the receiver also implements an optional method whose name matches the pattern -get&lt;Key&gt;:range: that method will be used when appropriate for best performance.\n    4. (introduced in Mac OS 10.4). Otherwise (no simple accessor method or set of ordered set or array access methods is found), searches the class of the receiver for a threesome of methods whose names match the patterns -countOf&lt;Key&gt;, -enumeratorOf&lt;Key&gt;, and -memberOf&lt;Key&gt;: (corresponding to the primitive methods defined by the NSSet class). If all three such methods are found a collection proxy object that responds to all NSSet methods is returned. Each NSSet message sent to the collection proxy object will result in some combination of -countOf&lt;Key&gt;, -enumeratorOf&lt;Key&gt;, and -memberOf&lt;Key&gt;: messages being sent to the original receiver of -valueForKey:.\n    5. Otherwise (no simple accessor method or set of collection access methods is found), if the receiver's class' +accessInstanceVariablesDirectly property returns YES, searches the class of the receiver for an instance variable whose name matches the pattern _&lt;key&gt;, _is&lt;Key&gt;, &lt;key&gt;, or is&lt;Key&gt;, in that order. If such an instance variable is found, the value of the instance variable in the receiver is returned, with the same sort of conversion to NSNumber or NSValue as in step 1.\n    6. Otherwise (no simple accessor method, set of collection access methods, or instance variable is found), invokes -valueForUndefinedKey: and returns the result. The default implementation of -valueForUndefinedKey: raises an NSUndefinedKeyException, but you can override it in your application.\n\nCompatibility notes:\n    - For backward binary compatibility, an accessor method whose name matches the pattern -_get&lt;Key&gt;, or -_&lt;key&gt; is searched for between steps 1 and 3. If such a method is found it is invoked, with the same sort of conversion to NSNumber or NSValue as in step 1. KVC accessor methods whose names start with underscores were deprecated as of Mac OS 10.3 though.\n    - The behavior described in step 5 is a change from Mac OS 10.2, in which the instance variable search order was &lt;key&gt;, _&lt;key&gt;.\n    - For backward binary compatibility, -handleQueryWithUnboundKey: will be invoked instead of -valueForUndefinedKey: in step 6, if the implementation of -handleQueryWithUnboundKey: in the receiver's class is not NSObject's.\n*/\n- (nullable id)valueForKey:(NSString *)key;\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/06-Category/","title":"06 Category","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/06-Category/#category","title":"Category","text":"<p>\u901a\u8fc7 runtime \u52a8\u6001\u5c06 Category \u65b9\u6cd5\u5408\u5e76\u5230\u7c7b\u5bf9\u8c61/\u5143\u7c7b\u5bf9\u8c61\u4e2d</p> <p>\u5206\u7c7b\u7684\u5e95\u5c42\u7ed3\u6784</p> <pre><code>struct _category_t {\n    const char *name; // \u7c7b\u540d\n    struct _class_t *cls; // \u7c7b\n    const struct _method_list_t *instance_methods; // \u5b9e\u4f8b\u65b9\u6cd5\n    const struct _method_list_t *class_methods; // \u7c7b\u65b9\u6cd5\n    const struct _protocol_list_t *protocols; // \u534f\u8bae\n    const struct _prop_list_t *properties; // \u5c5e\u6027\n};\n</code></pre> <p>\u7f16\u8bd1\u5b8c\u4e4b\u540e\uff0c\u5206\u7c7b\u7684\u4fe1\u606f\u5168\u90e8\u5b58\u653e\u5728 <code>_category_t</code> \u7ed3\u6784\u4e2d\uff0c\u800c\u4e0d\u662f\u5408\u5e76\u5230\u5bf9\u5e94\u7684\u7c7b\u4e2d</p> <p>\u6bd4\u5982\u4e0b\u9762\u7684\u5206\u7c7b\uff1a</p> <pre><code>#import \"Person.h\"\n\nNS_ASSUME_NONNULL_BEGIN\n@protocol P\n-(void)smile;\n@end\n\n@interface Person (Action) &lt;P&gt;\n@property (nonatomic, assign) int a;\n\n-(void) run;\n@end\n\nNS_ASSUME_NONNULL_END\n\n#import \"Person+Action.h\"\n@implementation Person (Action)\n@dynamic a;\n\n-(void) run {\n    NSLog(@\"running.....\");\n}\n-(void) eat {\n    NSLog(@\"eating.....\");\n}\n+(void)sleep {\n    NSLog(@\"sleepping.....\");\n}\n\n- (void)smile {\n    NSLog(@\"ha\");\n}\n\n@end\n</code></pre> <p>\u7f16\u8bd1\u6210 C++ \u4ee3\u7801\u4e4b\u540e\u4e3a</p> <pre><code>static struct _category_t _OBJC_$_CATEGORY_Person_$_Action __attribute__ ((used, section (\"__DATA,__objc_const\"))) = \n{\n    \"Person\",\n    0, // &amp;OBJC_CLASS_$_Person,\n    (const struct _method_list_t *)&amp;_OBJC_$_CATEGORY_INSTANCE_METHODS_Person_$_Action,\n    (const struct _method_list_t *)&amp;_OBJC_$_CATEGORY_CLASS_METHODS_Person_$_Action,\n    (const struct _protocol_list_t *)&amp;_OBJC_CATEGORY_PROTOCOLS_$_Person_$_Action,\n    (const struct _prop_list_t *)&amp;_OBJC_$_PROP_LIST_Person_$_Action,\n};\n</code></pre> <p>\u5206\u7c7b\u5728 runtime \u4e2d\u7684\u52a0\u8f7d</p> <ul> <li>objc-os.mm</li> </ul> <pre><code>/***********************************************************************\n* _objc_init\n* Bootstrap initialization. Registers our image notifier with dyld.\n* Called by libSystem BEFORE library initialization time\n**********************************************************************/\nvoid _objc_init(void)\n{\n    ...\n    // \u7701\u7565\u5176\u4ed6\u5185\u5bb9\uff0c\u6765\u770b\u6211\u4eec\u9700\u8981\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8c03\u7528\u4e86 dyld \u5e93\u4e2d\u7684\u65b9\u6cd5\u6765\u6ce8\u518c\u56de\u8c03\n    _dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);\n    ...\n}\n</code></pre> <p>dyld \u5e93\u4e2d\u7684\u5b9e\u73b0</p> <pre><code>// dyld/dyld_priv.h\n//\n// Note: only for use by objc runtime\n// Register handlers to be called when objc images are mapped, unmapped, and initialized.\n// Dyld will call back the \"mapped\" function with an array of images that contain an objc-image-info section.\n// Those images that are dylibs will have the ref-counts automatically bumped, so objc will no longer need to\n// call dlopen() on them to keep them from being unloaded.  During the call to _dyld_objc_notify_register(),\n// dyld will call the \"mapped\" function with already loaded objc images.  During any later dlopen() call,\n// dyld will also call the \"mapped\" function.  Dyld will call the \"init\" function when dyld would be called\n// initializers in that image.  This is when objc calls any +load methods in that image.\n//\nvoid _dyld_objc_notify_register(_dyld_objc_notify_mapped    mapped,\n                                _dyld_objc_notify_init      init,\n                                _dyld_objc_notify_unmapped  unmapped);\n\n// dyld/APIs.cpp\nvoid _dyld_objc_notify_register(_dyld_objc_notify_mapped    mapped,\n                                _dyld_objc_notify_init      init,\n                                _dyld_objc_notify_unmapped  unmapped)\n{\n    log_apis(\"_dyld_objc_notify_register(%p, %p, %p)\\n\", mapped, init, unmapped);\n\n    gAllImages.setObjCNotifiers(mapped, init, unmapped);\n}\n</code></pre> <p>During the call to _dyld_objc_notify_register(), dyld will call the \"mapped\" function with already loaded objc images.  During any later dlopen() call, dyld will also call the \"mapped\" function.  Dyld will call the \"init\" function when dyld would be called initializers in that image.  This is when objc calls any +load methods in that image.</p> <p>\u5927\u6982\u610f\u601d\u5c31\u662f\u5f53\u8c03\u7528 _dyld_objc_notify_register() \u65b9\u6cd5\u65f6\uff0c\u4f1a\u8c03\u7528 <code>mapped</code> \u65b9\u6cd5\uff0c\u5e76\u5c06\u5df2\u7ecf\u52a0\u8f7d\u7684 objc \u955c\u50cf\u4f20\u5165\uff0c\u7136\u540e\u4e4b\u540e\u518d\u6b21\u8c03\u7528 dlopen \u65b9\u6cd5\u65f6 dyld \u4f1a\u518d\u6b21\u8c03\u7528 mapped \u65b9\u6cd5\u5e76\u5c06\u65b0\u52a0\u8f7d\u7684\u955c\u50cf\u4f20\u5165</p> <p>\u6211\u4eec\u770b\u4e00\u4e0b  <code>gAllImages.setObjCNotifiers</code> \u7684\u5b9e\u73b0</p> <pre><code>void AllImages::setObjCNotifiers(_dyld_objc_notify_mapped map, _dyld_objc_notify_init init, _dyld_objc_notify_unmapped unmap)\n{\n    // \u5148\u5c06\u4e09\u4e2a\u56de\u8c03\u8d4b\u503c\u7ed9 AllImages \u7684\u6210\u5458\uff0c\u4f9b\u540e\u7eed\u8c03\u7528\n    _objcNotifyMapped   = map;\n    _objcNotifyInit     = init;\n    _objcNotifyUnmapped = unmap;\n\n    ...\n    // \u7701\u7565\u8c03\u4e2d\u95f4\u90e8\u5206\uff0c\u6211\u4eec\u53ea\u770b map \u8c03\u7528\u7684\u90e8\u5206\n    // callback about already loaded images\n    uint32_t maxCount = count();\n    STACK_ALLOC_ARRAY(const mach_header*, mhs,   maxCount);\n    STACK_ALLOC_ARRAY(const char*,        paths, maxCount);\n    // don't need _mutex here because this is called when process is still single threaded\n    // \u904d\u5386\u5df2\u7ecf\u52a0\u8f7d\u7684\u955c\u50cf\uff0c\u5e76\u67e5\u770b\u662f\u5426\u6709 objc \u955c\u50cf\uff0c\u5982\u679c\u6709\uff0c\u5c31\u6dfb\u52a0\u5230\u6570\u7ec4\u4e2d\n    for (const LoadedImage&amp; li : _loadedImages) {\n        if ( li.image()-&gt;hasObjC() ) {\n            paths.push_back(imagePath(li.image()));\n            mhs.push_back(li.loadedAddress());\n        }\n    }\n    // \u5982\u679c\u6709\u52a0\u8f7d\u597d\u7684 objc \u955c\u50cf\uff0c\u90a3\u4e48\u5c31\u8c03\u7528 map\n    if ( !mhs.empty() ) {\n        (*map)((uint32_t)mhs.count(), &amp;paths[0], &amp;mhs[0]);\n        if ( log_notifications(\"dyld: objc-mapped-notifier called with %ld images:\\n\", mhs.count()) ) {\n            for (uintptr_t i=0; i &lt; mhs.count(); ++i) {\n                log_notifications(\"dyld:  objc-mapped: %p %s\\n\",  mhs[i], paths[i]);\n            }\n        }\n    }\n}\n</code></pre> <p>\u7136\u540e\u518d\u770b\u4e0b dlopen()</p> <pre><code>const MachOLoaded* AllImages::dlopen(Diagnostics&amp; diag, const char* path, bool rtldNoLoad, bool rtldLocal,\n                                     bool rtldNoDelete, bool rtldNow, bool fromOFI, const void* callerAddress,\n                                     bool canUsePrebuiltSharedCacheClosure)\n{\n\n    ...\n    // \u524d\u8fb9\u4ee3\u7801\u5ffd\u7565\uff0c\u6211\u4eec\u76f4\u63a5\u770b\u6700\u540e\u8fd4\u56de\u4e86 loadImage\n    return loadImage(diag, path, topImageNum, newClosure, rtldLocal, rtldNoDelete, rtldNow, fromOFI, callerAddress);\n}\n\n// dlopen method\n__attribute__((noinline))\nconst MachOLoaded* AllImages::loadImage(Diagnostics&amp; diag, const char* path,\n                                        closure::ImageNum topImageNum, const closure::DlopenClosure* newClosure,\n                                        bool rtldLocal, bool rtldNoDelete, bool rtldNow, bool fromOFI,\n                                        const void* callerAddress) {\n    ...\n\n    // tell gAllImages about new images\n    addImages(newImages);\n\n    // Run notifiers before applyInterposingToDyldCache() as then we have an\n    // accurate image list before any calls to findImage().\n    // TODO: Can we move this even earlier, eg, after map images but before fixups?\n    runImageNotifiers(newImages);\n\n    // if closure adds images that override dyld cache, patch cache\n    if ( newClosure != nullptr )\n        applyInterposingToDyldCache(newClosure, mach_task_self());\n\n    // \u8be5\u65b9\u6cd5\u4f1a\u8c03\u7528 \u955c\u50cf\u52a0\u8f7d\u7684\u56de\u8c03\uff0c\u6211\u4eec\u7ee7\u7eed\u770b\n    runImageCallbacks(newImages);\n\n    // run initializers\n    runInitialzersBottomUp(topImage);\n\n    return topLoadAddress;\n}\n\nvoid AllImages::runImageCallbacks(const Array&lt;LoadedImage&gt;&amp; newImages)\n{\n    // \u53bb\u6389\u65e0\u7528\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u770b\u5230\u8fd9\u91cc\u7684\u5b9e\u73b0\u540c setObjCNotifiers \u4e2d\u6700\u540e\u5bf9 map \u8c03\u7528\u7684\u8fc7\u7a0b\u57fa\u672c\u76f8\u540c\n    // call objc about images that use objc\n    if ( _objcNotifyMapped != nullptr ) {\n        const char*         pathsBuffer[count];\n        const mach_header*  mhBuffer[count];\n        uint32_t            imagesWithObjC = 0;\n        for (const LoadedImage&amp; li : newImages) {\n            const closure::Image* image = li.image();\n            if ( image-&gt;hasObjC() ) {\n                pathsBuffer[imagesWithObjC] = imagePath(image);\n                mhBuffer[imagesWithObjC]    = li.loadedAddress();\n               ++imagesWithObjC;\n            }\n        }\n        if ( imagesWithObjC != 0 ) {\n            dyld3::ScopedTimer timer(DBG_DYLD_TIMING_OBJC_MAP, 0, 0, 0);\n            (*_objcNotifyMapped)(imagesWithObjC, pathsBuffer, mhBuffer);\n            if ( log_notifications(\"dyld: objc-mapped-notifier called with %d images:\\n\", imagesWithObjC) ) {\n                for (uint32_t i=0; i &lt; imagesWithObjC; ++i) {\n                    log_notifications(\"dyld:  objc-mapped: %p %s\\n\",  mhBuffer[i], pathsBuffer[i]);\n                }\n            }\n        }\n    }\n}\n\n</code></pre> <p>\u597d\u4e86\uff0c\u770b\u5b8c\u4e86 dyld \u4e2d\u7684\u8c03\u7528\u8fc7\u7a0b\uff0c\u6211\u4eec\u7ee7\u7eed\u56de\u5230 objc \u4ee3\u7801\u4e2d\u67e5\u770b mapImages \u7684\u5b9e\u73b0</p> <p>Code in objc</p> <pre><code>// objc-runtime-new.mm\nvoid\nmap_images(unsigned count, const char * const paths[],\n           const struct mach_header * const mhdrs[])\n{\n    mutex_locker_t lock(runtimeLock);\n    return map_images_nolock(count, paths, mhdrs);\n}\n\n// objc-os.mm\nvoid \nmap_images_nolock(unsigned mhCount, const char * const mhPaths[],\n                  const struct mach_header * const mhdrs[])\n{\n    static bool firstTime = YES;\n    header_info *hList[mhCount];\n    uint32_t hCount;\n    size_t selrefCount = 0;\n\n    // \u7565\u8fc7\u524d\u9762\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u76f4\u63a5\u770b \u8fd9\u91cc\u8c03\u7528\u4e86 _read_images\n    if (hCount &gt; 0) {\n        _read_images(hList, hCount, totalClasses, unoptimizedTotalClasses);\n    }\n\n    firstTime = NO;\n\n    // Call image load funcs after everything is set up.\n    for (auto func : loadImageFuncs) {\n        for (uint32_t i = 0; i &lt; mhCount; i++) {\n            func(mhdrs[i]);\n        }\n    }\n}\n\n// objc-runtime-new.mm\n// \u901a\u8fc7\u65b9\u6cd5\u4e2d\u5269\u4e0b\u7684\u6ce8\u91ca\u6211\u4e48\u53ef\u4ee5\u770b\u5230 _read_images \u4e2d\u6240\u4f5c\u7684\u4e8b\u60c5\uff0c\u6211\u4eec\u53ea\u4fdd\u7559 Discover categories \u8fd9\u90e8\u5206\u4ee3\u7801\uff0c\u7136\u540e\u7ee7\u7eed\u5f80\u4e0b\u770b\nvoid _read_images(header_info **hList, uint32_t hCount, int totalClasses, int unoptimizedTotalClasses)\n{\n    header_info *hi;\n    uint32_t hIndex;\n    size_t count;\n    size_t i;\n    Class *resolvedFutureClasses = nil;\n    size_t resolvedFutureClassCount = 0;\n    static bool doneOnce;\n    bool launchTime = NO;\n    TimeLogger ts(PrintImageTimes);\n\n    runtimeLock.assertLocked();\n\n#define EACH_HEADER \\\n    hIndex = 0;         \\\n    hIndex &lt; hCount &amp;&amp; (hi = hList[hIndex]); \\\n    hIndex++\n\n    if (!doneOnce) {\n        doneOnce = YES;\n        launchTime = YES;\n\n        ts.log(\"IMAGE TIMES: first time tasks\");\n    }\n\n    // Fix up @selector references\n\n    ts.log(\"IMAGE TIMES: fix up selector references\");\n\n    // Discover classes. Fix up unresolved future classes. Mark bundle classes.\n    ts.log(\"IMAGE TIMES: discover classes\");\n\n    // Fix up remapped classes\n    // Class list and nonlazy class list remain unremapped.\n    // Class refs and super refs are remapped for message dispatching.\n\n    ts.log(\"IMAGE TIMES: remap classes\");\n\n#if SUPPORT_FIXUP\n    // Fix up old objc_msgSend_fixup call sites\n    ts.log(\"IMAGE TIMES: fix up objc_msgSend_fixup\");\n#endif\n\n\n    // Discover protocols. Fix up protocol refs.\n    ts.log(\"IMAGE TIMES: discover protocols\");\n\n    // Fix up @protocol references\n    // Preoptimized images may have the right \n    // answer already but we don't know for sure.\n    ts.log(\"IMAGE TIMES: fix up @protocol references\");\n\n    // Discover categories. Only do this after the initial category\n    // attachment has been done. For categories present at startup,\n    // discovery is deferred until the first load_images call after\n    // the call to _dyld_objc_notify_register completes. rdar://problem/53119145\n    if (didInitialAttachCategories) {\n        for (EACH_HEADER) {\n            load_categories_nolock(hi);\n        }\n    }\n    ts.log(\"IMAGE TIMES: discover categories\");\n\n    // Category discovery MUST BE Late to avoid potential races\n    // when other threads call the new category code before\n    // this thread finishes its fixups.\n\n    // +load handled by prepare_load_methods()\n\n    // Realize non-lazy classes (for +load methods and static instances)\n\n    ts.log(\"IMAGE TIMES: realize non-lazy classes\");\n\n    // Realize newly-resolved future classes, in case CF manipulates them\n\n    ts.log(\"IMAGE TIMES: realize future classes\");\n\n\n    // Print preoptimization statistics\n#undef EACH_HEADER\n}\n\n// objc-runtime-new.mm\nstatic void load_categories_nolock(header_info *hi) {\n    bool hasClassProperties = hi-&gt;info()-&gt;hasCategoryClassProperties();\n\n    size_t count;\n    // \u5b9a\u4e49\u65b9\u6cd5\uff0c\u63a5\u6536 Category \u5217\u8868\uff0c\u5728 load_categories_nolock \u6700\u540e\u8c03\u7528\u4e86\u8be5\u65b9\u6cd5\u5e76\u4f20\u5165 header_info \u4e2d\u5305\u542b\u7684 Category\n    auto processCatlist = [&amp;](category_t * const *catlist) {\n        for (unsigned i = 0; i &lt; count; i++) {\n            category_t *cat = catlist[i];\n            Class cls = remapClass(cat-&gt;cls);\n            locstamped_category_t lc{cat, hi};\n\n            if (!cls) {\n                // Category's target class is missing (probably weak-linked).\n                // Ignore the category.\n                if (PrintConnecting) {\n                    _objc_inform(\"CLASS: IGNORING category \\?\\?\\?(%s) %p with \"\n                                 \"missing weak-linked target class\",\n                                 cat-&gt;name, cat);\n                }\n                continue;\n            }\n\n            // Process this category.\n            if (cls-&gt;isStubClass()) {\n                // Stub classes are never realized. Stub classes\n                // don't know their metaclass until they're\n                // initialized, so we have to add categories with\n                // class methods or properties to the stub itself.\n                // methodizeClass() will find them and add them to\n                // the metaclass as appropriate.\n                if (cat-&gt;instanceMethods ||\n                    cat-&gt;protocols ||\n                    cat-&gt;instanceProperties ||\n                    cat-&gt;classMethods ||\n                    cat-&gt;protocols ||\n                    (hasClassProperties &amp;&amp; cat-&gt;_classProperties))\n                {\n                    objc::unattachedCategories.addForClass(lc, cls);\n                }\n            } else {\n                // First, register the category with its target class.\n                // Then, rebuild the class's method lists (etc) if\n                // the class is realized.\n                // \u73b0\u5c06 Category \u6ce8\u518c\u5230\u5176\u76ee\u6807\u7c7b\u4e2d\uff0c\u5f53\u7c7b\u5bf9\u8c61\u521d\u59cb\u5316\u540e\uff0c\u5c06\u7c7b\u65b9\u6cd5\u5217\u8868\u91cd\u5efa\n\n                // \u5982\u679c\u662f\u7c7b\u5bf9\u8c61\n                if (cat-&gt;instanceMethods ||  cat-&gt;protocols\n                    ||  cat-&gt;instanceProperties)\n                {\n                    if (cls-&gt;isRealized()) {\n                        // \u6211\u4eec\u7ee7\u7eed\u5f80\u4e0b\u770b attachCategories \u8be5\u65b9\u6cd5\u7684\u5b9e\u73b0\n                        attachCategories(cls, &amp;lc, 1, ATTACH_EXISTING);\n                    } else {\n                        objc::unattachedCategories.addForClass(lc, cls);\n                    }\n                }\n\n                // \u5982\u679c\u4e3a\u5143\u7c7b\u5bf9\u8c61\n                if (cat-&gt;classMethods  ||  cat-&gt;protocols\n                    ||  (hasClassProperties &amp;&amp; cat-&gt;_classProperties))\n                {\n                    if (cls-&gt;ISA()-&gt;isRealized()) {\n                        attachCategories(cls-&gt;ISA(), &amp;lc, 1, ATTACH_EXISTING | ATTACH_METACLASS);\n                    } else {\n                        objc::unattachedCategories.addForClass(lc, cls-&gt;ISA());\n                    }\n                }\n            }\n        }\n    };\n\n    processCatlist(hi-&gt;catlist(&amp;count));\n    processCatlist(hi-&gt;catlist2(&amp;count));\n}\n\n// Attach method lists and properties and protocols from categories to a class.\n// Assumes the categories in cats are all loaded and sorted by load order, \n// oldest categories first.\nstatic void\nattachCategories(Class cls, const locstamped_category_t *cats_list, uint32_t cats_count,\n                 int flags)\n{\n    /*\n     * Only a few classes have more than 64 categories during launch.\n     * This uses a little stack, and avoids malloc.\n     *\n     * Categories must be added in the proper order, which is back\n     * to front. To do that with the chunking, we iterate cats_list\n     * from front to back, build up the local buffers backwards,\n     * and call attachLists on the chunks. attachLists prepends the\n     * lists, so the final result is in the expected order.\n     */\n    constexpr uint32_t ATTACH_BUFSIZ = 64;\n    method_list_t   *mlists[ATTACH_BUFSIZ];\n    property_list_t *proplists[ATTACH_BUFSIZ];\n    protocol_list_t *protolists[ATTACH_BUFSIZ];\n\n    uint32_t mcount = 0;\n    uint32_t propcount = 0;\n    uint32_t protocount = 0;\n    bool fromBundle = NO;\n\n    // \u5148\u68c0\u67e5\u662f\u5426\u4e3a\u5143\u7c7b\n    bool isMeta = (flags &amp; ATTACH_METACLASS);\n    // \u5982\u679c\u6ca1\u6709 class_rw_ext_t \u5b9e\u4f8b\u5219\u521d\u59cb\u5316 class_rw_ext_t\uff0c\u7528\u5230\u624d\u4f1a\u521d\u59cb\u5316\uff0c\u6765\u4f18\u5316\u5185\u5b58\u5360\u7528\n    auto rwe = cls-&gt;data()-&gt;extAllocIfNeeded();\n\n    // \u904d\u5386\u5206\u7c7b\n    for (uint32_t i = 0; i &lt; cats_count; i++) {\n        auto&amp; entry = cats_list[i];\n        // \u83b7\u53d6\u5f53\u524d\u5206\u7c7b\u7684\u65b9\u6cd5\u5217\u8868\n        method_list_t *mlist = entry.cat-&gt;methodsForMeta(isMeta);\n        // \u5982\u679c\u4e0d\u4e3a\u7a7a\uff0c\u90a3\u4e48\u5c31\u5c06\u5206\u7c7b\u65b9\u6cd5\u5217\u8868\u6dfb\u52a0\u5230 class_rw_ext_t \u7684\u65b9\u6cd5\u5217\u8868\u4e2d\n        if (mlist) {\n            // \u53ea\u6709\u5f53 mlists \u653e\u6ee1\u4e4b\u540e\uff0c\u624d\u4f1a\u5411 class_rw_ext_t \u65b9\u6cd5\u5217\u8868\u4e2d\u8ffd\u52a0\n            if (mcount == ATTACH_BUFSIZ) {\n                prepareMethodLists(cls, mlists, mcount, NO, fromBundle, __func__);\n                // \u5411 class_rw_ext_t \u65b9\u6cd5\u5217\u8868\u4e2d\u6dfb\u52a0\u5206\u7c7b\u4e2d\u7684\u65b9\u6cd5\u5217\u8868\n                rwe-&gt;methods.attachLists(mlists, mcount);\n                mcount = 0;\n            }\n            // \u5982\u679c\u672a\u6ee1\uff0c\u90a3\u4e48\u5c31\u5148\u5c06\u65b9\u6cd5\u5217\u8868\u5b58\u5230 mlist \u4e2d\uff0c\u5230\u6700\u540e\u518d\u5224\u65ad mcount \u662f\u5426\u4e3a0\uff0c\u5982\u679c\u4e0d\u4e3a0\uff0c\u5219\u628a\u6700\u540e\u7684 mlists \u6dfb\u52a0\u5230 class_rw_ext_t \u65b9\u6cd5\u5217\u8868\u4e2d\n            // \u53ef\u4ee5\u770b\u5230\u6dfb\u52a0\u7684\u987a\u5e8f\u4e3a\u4ece\u540e\u5411\u524d\u6dfb\u52a0\uff0c\u90a3\u4e48\u6700\u5148\u7f16\u8bd1\u7684\u5206\u7c7b\u4f1a\u653e\u5230\u6570\u7ec4\u6700\u540e\uff0c\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u8d8a\u9760\u540e\u7684\u5206\u7c7b\u4f18\u5148\u7ea7\u8d8a\u9ad8\n            mlists[ATTACH_BUFSIZ - ++mcount] = mlist;\n            fromBundle |= entry.hi-&gt;isBundle();\n        }\n\n        //  \u5bf9\u4e8e\u5206\u7c7b\u4e2d\u7684\u5c5e\u6027\u548c\u534f\u8bae\uff0c\u540c\u65b9\u6cd5\u5217\u8868\u5904\u7406\u65b9\u5f0f\u57fa\u672c\u76f8\u540c\uff0c\n        //\u6700\u540e\u4e5f\u4f1a\u7528 class_rw_ext_t \u5bf9\u5e94\u7684\u6210\u5458\u53d8\u91cf(properties, protocols) \u8c03\u7528 attachLists\n        // \u5c06\u5206\u7c7b\u4e2d\u7684\u5c5e\u6027\u548c\u534f\u8bae\u6dfb\u52a0\u5230\u7c7b\u4e2d\n\n        // \u83b7\u53d6\u5f53\u524d\u5206\u7c7b\u7684\u5c5e\u6027\u5217\u8868\n        property_list_t *proplist =\n            entry.cat-&gt;propertiesForMeta(isMeta, entry.hi);\n        if (proplist) {\n            if (propcount == ATTACH_BUFSIZ) {\n                rwe-&gt;properties.attachLists(proplists, propcount);\n                propcount = 0;\n            }\n            proplists[ATTACH_BUFSIZ - ++propcount] = proplist;\n        }\n\n        // \u83b7\u53d6\u5f53\u524d\u5206\u7c7b\u7684\u534f\u8bae\u5217\u8868\n        protocol_list_t *protolist = entry.cat-&gt;protocolsForMeta(isMeta);\n        if (protolist) {\n            if (protocount == ATTACH_BUFSIZ) {\n                rwe-&gt;protocols.attachLists(protolists, protocount);\n                protocount = 0;\n            }\n            protolists[ATTACH_BUFSIZ - ++protocount] = protolist;\n        }\n    }\n\n    if (mcount &gt; 0) {\n        prepareMethodLists(cls, mlists + ATTACH_BUFSIZ - mcount, mcount,\n                           NO, fromBundle, __func__);\n        rwe-&gt;methods.attachLists(mlists + ATTACH_BUFSIZ - mcount, mcount);\n        if (flags &amp; ATTACH_EXISTING) {\n            flushCaches(cls, __func__, [](Class c){\n                // constant caches have been dealt with in prepareMethodLists\n                // if the class still is constant here, it's fine to keep\n                return !c-&gt;cache.isConstantOptimizedCache();\n            });\n        }\n    }\n\n    rwe-&gt;properties.attachLists(proplists + ATTACH_BUFSIZ - propcount, propcount);\n\n    rwe-&gt;protocols.attachLists(protolists + ATTACH_BUFSIZ - protocount, protocount);\n}\n\nvoid attachLists(List* const * addedLists, uint32_t addedCount) {\n        if (addedCount == 0) return;\n\n        if (hasArray()) {\n            // many lists -&gt; many lists\n            uint32_t oldCount = array()-&gt;count;\n            uint32_t newCount = oldCount + addedCount;\n            // \u521b\u5efa\u65b0\u7684\u5217\u8868\uff0c\u5927\u5c0f\u4e3a\u5f53\u524d\u7c7b\u4e2d\u5217\u8868\u5927\u5c0f + \u5206\u7c7b\u4e2d\u7684\u5217\u8868\u5927\u5c0f\n            array_t *newArray = (array_t *)malloc(array_t::byteSize(newCount));\n            newArray-&gt;count = newCount;\n            array()-&gt;count = newCount;\n            // \u5c06\u7c7b\u4e2d\u539f\u6709\u7684\u5217\u8868\u653e\u5230\u65b0\u5217\u8868\u540e\u9762\n            for (int i = oldCount - 1; i &gt;= 0; i--)\n                newArray-&gt;lists[i + addedCount] = array()-&gt;lists[i];\n            // \u5728\u65b0\u5217\u8868\u6700\u524d\u9762\u6dfb\u52a0\u5206\u7c7b\u4e2d\u7684\u5217\u8868\n            for (unsigned i = 0; i &lt; addedCount; i++)\n                newArray-&gt;lists[i] = addedLists[i];\n            // \u91ca\u653e\u539f\u6765\u5217\u8868\n            free(array());\n            // \u5c06\u65b0\u5217\u8868\u8d4b\u7ed9\u7c7b\u5bf9\u8c61\n            setArray(newArray);\n            validate();\n        }\n        else if (!list  &amp;&amp;  addedCount == 1) {\n            // 0 lists -&gt; 1 list\n            list = addedLists[0];\n            validate();\n        } \n        else {\n            // 1 list -&gt; many lists\n            Ptr&lt;List&gt; oldList = list;\n            uint32_t oldCount = oldList ? 1 : 0;\n            uint32_t newCount = oldCount + addedCount;\n            setArray((array_t *)malloc(array_t::byteSize(newCount)));\n            array()-&gt;count = newCount;\n            if (oldList) array()-&gt;lists[addedCount] = oldList;\n            for (unsigned i = 0; i &lt; addedCount; i++)\n                array()-&gt;lists[i] = addedLists[i];\n            validate();\n        }\n    }\n\n</code></pre> <p>\u81f3\u6b64\uff0c\u5206\u7c7b\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u65b9\u6cd5\uff0c\u5c5e\u6027\uff0c\u534f\u8bae\u5df2\u7ecf\u5168\u90e8\u6dfb\u52a0\u5230\u7c7b\u5bf9\u8c61\u4e2d\u3002 \u4ece <code>attachLists</code> \u65b9\u6cd5\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5206\u7c7b\u65b9\u6cd5\u4f1a\u6dfb\u52a0\u5230\u7c7b\u65b9\u6cd5\u5217\u8868\u6700\u524d\u9762\uff0c\u6240\u4ee5\uff0c\u5f53\u5206\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e0e\u7c7b\u4e2d\u76f8\u540c\u7684\u65b9\u6cd5\u65f6\uff0c\u4f1a\u4f18\u5148\u8c03\u7528\u5206\u7c7b\u4e2d\u7684\u65b9\u6cd5</p> <p>\u7c7b\u6269\u5c55\u5728\u7f16\u8bd1\u7684\u65f6\u5019\u5c31\u5df2\u7ecf\u5408\u5e76\u5230\u7c7b\u4e2d\u4e86</p> <pre><code>@interface Person()\n@property(nonatimic, assign) height;\n@end\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/06-Category/#load","title":"\u7c7b\u548c\u5206\u7c7b\u4e2d\u7684 load \u65b9\u6cd5","text":"<pre><code>_dyld_objc_notify_register(&amp;map_images, load_images, unmap_image);\n\n</code></pre> <p>\u6211\u4eec\u7ee7\u7eed\u6765\u770b <code>_dyld_objc_notify_register</code> \u4f20\u5165\u7684 <code>load_images</code>\uff0c <code>load_images</code> \u6700\u540e\u8c03\u7528\u4e86 <code>call_load_methods</code></p> <pre><code>// objc-runtime-new.mm\nvoid\nload_images(const char *path __unused, const struct mach_header *mh)\n{\n    if (!didInitialAttachCategories &amp;&amp; didCallDyldNotifyRegister) {\n        didInitialAttachCategories = true;\n        loadAllCategories();\n    }\n\n    // Return without taking locks if there are no +load methods here.\n    if (!hasLoadMethods((const headerType *)mh)) return;\n\n    recursive_mutex_locker_t lock(loadMethodLock);\n\n    // Discover load methods\n    {\n        mutex_locker_t lock2(runtimeLock);\n        prepare_load_methods((const headerType *)mh);\n    }\n\n    // Call +load methods (without runtimeLock - re-entrant)\n    call_load_methods();\n} \n\n// objc-loadmethod.mm\nvoid call_load_methods(void)\n{\n    static bool loading = NO;\n    bool more_categories;\n\n    loadMethodLock.assertLocked();\n\n    // Re-entrant calls do nothing; the outermost call will finish the job.\n    if (loading) return;\n    loading = YES;\n\n    void *pool = objc_autoreleasePoolPush();\n\n    do {\n        // 1. Repeatedly call class +loads until there aren't any more\n        // \u5148\u8c03\u7528\u6240\u6709 class \u7684 load \u65b9\u6cd5\n        while (loadable_classes_used &gt; 0) {\n            call_class_loads();\n        }\n\n        // 2. Call category +loads ONCE\n        // \u7136\u540e\u8c03\u7528 Category \u7684 load \u65b9\u6cd5\n        more_categories = call_category_loads();\n\n        // 3. Run more +loads if there are classes OR more untried categories\n    } while (loadable_classes_used &gt; 0  ||  more_categories);\n\n    objc_autoreleasePoolPop(pool);\n\n    loading = NO;\n}\n\nstatic void call_class_loads(void)\n{\n    int i;\n\n    // Detach current loadable list.\n    struct loadable_class *classes = loadable_classes;\n    int used = loadable_classes_used;\n    loadable_classes = nil;\n    loadable_classes_allocated = 0;\n    loadable_classes_used = 0;\n\n    // Call all +loads for the detached list.\n    for (i = 0; i &lt; used; i++) {\n        // \u76f4\u63a5\u62ff\u5230\u7c7b\u5bf9\u8c61\uff0c\u7136\u540e\u76f4\u63a5\u83b7\u53d6\u5230\u7c7b\u5bf9\u8c61\u4e2d\u65b9\u6cd5\u5217\u8868\u7684\u5730\u5740\u8fdb\u884c\u8c03\u7528\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u4fdd\u8bc1\u76f4\u63a5\u8c03\u7528\u5230\u7c7b\u5bf9\u8c61\u4e2d\u7684 +(void)load \u65b9\u6cd5\n        Class cls = classes[i].cls;\n        load_method_t load_method = (load_method_t)classes[i].method;\n        if (!cls) continue; \n\n        if (PrintLoading) {\n            _objc_inform(\"LOAD: +[%s load]\\n\", cls-&gt;nameForLogging());\n        }\n        (*load_method)(cls, @selector(load));\n    }\n\n    // Destroy the detached list.\n    if (classes) free(classes);\n}\n\nstatic bool call_category_loads(void)\n{\n    int i, shift;\n    bool new_categories_added = NO;\n\n    // Detach current loadable list.\n    struct loadable_category *cats = loadable_categories;\n    int used = loadable_categories_used;\n    int allocated = loadable_categories_allocated;\n    loadable_categories = nil;\n    loadable_categories_allocated = 0;\n    loadable_categories_used = 0;\n\n    // Call all +loads for the detached list.\n    for (i = 0; i &lt; used; i++) {\n        // \u76f4\u63a5\u62ff\u5230\u5206\u7c7b\u5bf9\u8c61\uff0c\u7136\u540e\u76f4\u63a5\u83b7\u53d6\u5230\u5206\u7c7b\u5bf9\u8c61\u4e2d\u65b9\u6cd5\u5217\u8868\u7684\u5730\u5740\u8fdb\u884c\u8c03\u7528\uff0c\u8fd9\u6837\u505a\u53ef\u4ee5\u4fdd\u8bc1\u76f4\u63a5\u8c03\u7528\u5230\u5206\u7c7b\u5bf9\u8c61\u4e2d\u7684 +(void)load \u65b9\u6cd5\n        Category cat = cats[i].cat;\n        load_method_t load_method = (load_method_t)cats[i].method;\n        Class cls;\n        if (!cat) continue;\n\n        cls = _category_getClass(cat);\n        if (cls  &amp;&amp;  cls-&gt;isLoadable()) {\n            if (PrintLoading) {\n                _objc_inform(\"LOAD: +[%s(%s) load]\\n\", \n                             cls-&gt;nameForLogging(), \n                             _category_getName(cat));\n            }\n            (*load_method)(cls, @selector(load));\n            cats[i].cat = nil;\n        }\n    }\n    ...\n\n    return new_categories_added;\n}\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0cruntime \u901a\u8fc7 load_images -&gt; call_load_methods \u6765\u8c03\u7528 <code>load</code> \u65b9\u6cd5 \u5176\u8c03\u7528\u987a\u5e8f\u4e3a\uff0c\u901a\u8fc7\u6307\u9488\u5148\u8c03\u7528\u6240\u6709\u7c7b\u7684 load \u65b9\u6cd5\uff0c\u7136\u540e\u518d\u8c03\u7528\u6240\u6709\u5206\u7c7b\u7684 load \u65b9\u6cd5\uff0c\u7c7b\u548c\u5206\u7c7b\u7684load \u65b9\u6cd5\u8c03\u7528\u987a\u5e8f\u4e3a\u7f16\u8bd1\u987a\u5e8f \u56e0\u4e3a\u5728\u52a0\u8f7d\u5b8c\u4e4b\u540e\u5206\u7c7b\u65b9\u6cd5\u5df2\u7ecf\u90fd\u5408\u5e76\u5230\u7c7b\u4e2d\uff0c\u5305\u62ec load \u65b9\u6cd5\uff0c\u6240\u4ee5\u5728\u8c03\u7528\u7684\u65f6\u5019\u9700\u8981\u76f4\u63a5\u62ff\u5230 \u7c7b\u6216\u5206\u7c7b\u5bf9\u8c61\u672c\u8eab\uff0c\u7136\u540e\u76f4\u63a5\u62ff\u5230\u65b9\u6cd5\u5217\u8868\u6307\u9488\uff0c\u7136\u540e\u518d\u8fdb\u884c\u8c03\u7528\uff0c\u8fd9\u6837\u80fd\u4fdd\u8bc1\u6211\u4eec\u770b\u5230\u7684\u8c03\u7528\u987a\u5e8f</p> <p>+load \u65b9\u6cd5\u4f1a\u5728 runtime \u52a0\u8f7d\u7c7b\u3001\u5206\u7c7b\u662f\u8c03\u7528 \u6bcf\u4e2a\u7c7b\u3001\u5206\u7c7b\u7684 +load\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53ea\u8c03\u7528\u4e00\u6b21</p> <ul> <li>\u8c03\u7528\u987a\u5e8f</li> <li> <ul> <li>\u5148\u8c03\u7528\u7c7b\u7684 +load \uff08\u6309\u7167\u7f16\u8bd1\u5148\u540e\u987a\u5e8f\u8c03\u7528\uff0c\u5148\u7f16\u8bd1\u5148\u8c03\u7528\uff0c\u8c03\u7528\u5b50\u7c7b\u7684 load \u4e4b\u524d\u4f1a\u5148\u8c03\u7528\u7236\u7c7b\u7684 load\uff09</li> </ul> </li> <li> <ul> <li>\u5728\u8c03\u7528\u5206\u7c7b\u7684 load\uff08\u540c\u6837\u6309\u7167\u7f16\u8bd1\u5148\u540e\u987a\u5e8f\u8c03\u7528\uff09</li> </ul> </li> </ul> <p>\u4e3a\u4fdd\u8bc1\u7236\u7c7b\u7684 load \u4f18\u5148\u8c03\u7528\uff0c\u901a\u8fc7 prepare_load_methods-&gt;schedule_class_load \u5c06\u7f16\u8bd1\u540e\u7684\u7c7b\u8fdb\u884c\u91cd\u6392\uff0c\u6765\u4fdd\u8bc1\u7236\u7c7b\u5728\u6700\u524d</p> <pre><code>void prepare_load_methods(const headerType *mhdr)\n{\n    size_t count, i;\n\n    runtimeLock.assertLocked();\n\n    classref_t const *classlist = \n        _getObjc2NonlazyClassList(mhdr, &amp;count);\n    for (i = 0; i &lt; count; i++) {\n        schedule_class_load(remapClass(classlist[i]));\n    }\n\n    category_t * const *categorylist = _getObjc2NonlazyCategoryList(mhdr, &amp;count);\n    for (i = 0; i &lt; count; i++) {\n        category_t *cat = categorylist[i];\n        Class cls = remapClass(cat-&gt;cls);\n        if (!cls) continue;  // category for ignored weak-linked class\n        if (cls-&gt;isSwiftStable()) {\n            _objc_fatal(\"Swift class extensions and categories on Swift \"\n                        \"classes are not allowed to have +load methods\");\n        }\n        realizeClassWithoutSwift(cls, nil);\n        ASSERT(cls-&gt;ISA()-&gt;isRealized());\n        add_category_to_loadable_list(cat);\n    }\n}\nstatic void schedule_class_load(Class cls)\n{\n    if (!cls) return;\n    ASSERT(cls-&gt;isRealized());  // _read_images should realize\n\n    if (cls-&gt;data()-&gt;flags &amp; RW_LOADED) return;\n\n    // Ensure superclass-first ordering\n    schedule_class_load(cls-&gt;getSuperclass());\n\n    add_class_to_loadable_list(cls);\n    cls-&gt;setInfo(RW_LOADED); \n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/06-Category/#initialize","title":"\u7c7b\u548c\u5206\u7c7b\u4e2d\u7684 +initialize \u65b9\u6cd5","text":"<p><code>+initialize</code> \u65b9\u6cd5\u662f\u5728\u7c7b\u7b2c\u4e00\u6b21\u63a5\u53d7\u6d88\u606f\u7684\u65f6\u5019\u8c03\u7528\u7684 \u6bcf\u4e2a\u7c7b\u53ea\u8c03\u7528\u4e00\u6b21\uff0c<code>initialize</code> \u662f\u901a\u8fc7\u6d88\u606f\u8f6c\u53d1\uff08objc_msgSend\uff09\u8c03\u7528\u7684\uff0cso \u540c\u4e00\u4e2a\u7c7b\u53ea\u4f1a\u8c03\u7528\u4e00\u6b21\uff0c\u5e76\u4e14\u7c7b\u4e2d\u7684 <code>initialize</code> \u4f1a\u88ab\u5206\u7c7b\u4e2d\u7684 <code>initialize</code> \u8986\u76d6\u6389</p> <p>\u8c03\u7528\u987a\u5e8f \u5148\u8c03\u7528\u7236\u7c7b\u7684 +initialize \u65b9\u6cd5\uff0c\u7136\u540e\u518d\u8c03\u7528\u81ea\u5df1\u7684 +initialize \u65b9\u6cd5</p> <p>Source Code</p> <pre><code>Method class_getClassMethod(Class cls, SEL sel)\n{\n    if (!cls  ||  !sel) return nil;\n\n    return class_getInstanceMethod(cls-&gt;getMeta(), sel);\n}\n\nMethod class_getInstanceMethod(Class cls, SEL sel)\n{\n    if (!cls  ||  !sel) return nil;\n\n    // This deliberately avoids +initialize because it historically did so.\n\n    // This implementation is a bit weird because it's the only place that \n    // wants a Method instead of an IMP.\n\n#warning fixme build and search caches\n\n    // Search method lists, try method resolver, etc.\n    lookUpImpOrForward(nil, sel, cls, LOOKUP_RESOLVER);\n\n#warning fixme build and search caches\n\n    return _class_getMethod(cls, sel);\n}\n\nIMP lookUpImpOrForward(id inst, SEL sel, Class cls, int behavior)\n{\n    const IMP forward_imp = (IMP)_objc_msgForward_impcache;\n    IMP imp = nil;\n    Class curClass;\n\n    ...\n    // \u8fd9\u91cc\u8c03\u7528\u4e86 realizeAndInitializeIfNeeded_locked\uff0c \u6211\u4eec\u7ee7\u7eed\u5f80\u4e0b\u770b\n    cls = realizeAndInitializeIfNeeded_locked(inst, cls, behavior &amp; LOOKUP_INITIALIZE);\n    // runtimeLock may have been dropped but is now locked again\n    runtimeLock.assertLocked();\n    curClass = cls;\n    ...\n    runtimeLock.unlock();\n    if (slowpath((behavior &amp; LOOKUP_NIL) &amp;&amp; imp == forward_imp)) {\n        return nil;\n    }\n    return imp;\n}\n\nstatic Class\nrealizeAndInitializeIfNeeded_locked(id inst, Class cls, bool initialize)\n{\n    if (slowpath(initialize &amp;&amp; !cls-&gt;isInitialized())) {\n        // \u627e\u4e00\u4e0b initializeAndLeaveLocked \u7684\u5b9e\u73b0\n        cls = initializeAndLeaveLocked(cls, inst, runtimeLock);\n        // runtimeLock may have been dropped but is now locked again\n\n        // If sel == initialize, class_initialize will send +initialize and\n        // then the messenger will send +initialize again after this\n        // procedure finishes. Of course, if this is not being called\n        // from the messenger then it won't happen. 2778172\n    }\n    return cls;\n}\n\nstatic Class initializeAndLeaveLocked(Class cls, id obj, mutex_t&amp; lock)\n{\n    return initializeAndMaybeRelock(cls, obj, lock, true);\n}\n\n/***********************************************************************\n* class_initialize.  Send the '+initialize' message on demand to any\n* uninitialized class. Force initialization of superclasses first.\n* inst is an instance of cls, or nil. Non-nil is better for performance.\n* Returns the class pointer. If the class was unrealized then \n* it may be reallocated.\n* Locking: \n*   runtimeLock must be held by the caller\n*   This function may drop the lock.\n*   On exit the lock is re-acquired or dropped as requested by leaveLocked.\n**********************************************************************/\nstatic Class initializeAndMaybeRelock(Class cls, id inst,\n                                      mutex_t&amp; lock, bool leaveLocked)\n{\n    ...\n    initializeNonMetaClass(nonmeta);\n    ...\n}\n\nvoid initializeNonMetaClass(Class cls)\n{\n    ASSERT(!cls-&gt;isMetaClass());\n\n    Class supercls;\n    bool reallyInitialize = NO;\n\n    // Make sure super is done initializing BEFORE beginning to initialize cls.\n    // See note about deadlock above.\n    supercls = cls-&gt;getSuperclass();\n    ...\n    // \u5982\u679c\u6709\u7236\u7c7b\uff0c\u5e76\u4e14\u7236\u7c7b\u6ca1\u6709\u8c03\u7528 Initialize\uff0c\u90a3\u4e48\u5148\u53bb\u901a\u8fc7\u9012\u5f52\u8c03\u7528\u7236\u7c7b\u7684 Initialize\n    if (supercls  &amp;&amp;  !supercls-&gt;isInitialized()) {\n        initializeNonMetaClass(supercls);\n    }\n    ...\n    // \u6700\u540e\u8c03\u7528\u81ea\u5df1\u7684 initialize \u65b9\u6cd5\n            callInitialize(cls);\n    ...\n\n}\n\nvoid callInitialize(Class cls)\n{\n    ((void(*)(Class, SEL))objc_msgSend)(cls, @selector(initialize));\n    asm(\"\");\n}\n</code></pre> <ul> <li><code>+initialize</code> \u548c <code>+load</code> \u6700\u5927\u7684\u533a\u522b\u662f\uff0c+initialize \u662f\u901a\u8fc7 objc_msgSend \u8fdb\u884c\u8c03\u7528\u7684\uff0c\u6240\u4ee5\u4f1a\u6709\u4ee5\u4e0b\u7279\u70b9</li> <li> <ul> <li>\u5982\u679c\u5b50\u7c7b\u6ca1\u6709\u5b9e\u73b0 <code>+initialize</code>\uff0c\u4f1a\u8c03\u7528\u7236\u7c7b\u7684 <code>+initialize</code>\uff0c\uff08\u6240\u4ee5\u7236\u7c7b\u7684 +initialize \u53ef\u80fd\u4f1a\u88ab\u8c03\u7528\u591a\u6b21\uff0c\u4f46\u662f\u7236\u7c7b\u81ea\u5df1\u53ea\u8c03\u7528\u4e00\u6b21\uff09</li> </ul> </li> <li> <ul> <li>\u5982\u679c\u5206\u7c7b\u5b9e\u73b0\u4e86 <code>+initialize</code>\uff0c\u5c31\u4f1a\u8986\u76d6\u7c7b\u672c\u8eab\u7684 <code>+initialize</code> \u8c03\u7528</li> </ul> </li> <li><code>+initialize</code> \u65b9\u6cd5\u662f\u5728\u7c7b\u7b2c\u4e00\u6b21\u63a5\u53d7\u6d88\u606f\u7684\u65f6\u5019\u8c03\u7528\u7684</li> <li><code>+load</code> \u662f\u5728\u7c7b\u548c\u5206\u7c7b\u52a0\u8f7d\u7684\u65f6\u5019\u8c03\u7528\u7684</li> <li>\u5148\u8c03\u7528\u7236\u7c7b\u7684 <code>+initialize</code> \u65b9\u6cd5\uff0c\u7136\u540e\u518d\u8c03\u7528\u81ea\u5df1\u7684 <code>+initialize</code> \u65b9\u6cd5</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/","title":"07 \u5173\u8054\u5bf9\u8c61","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/#_1","title":"\u5173\u8054\u5bf9\u8c61","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/#_2","title":"\u5206\u7c7b\u4e2d\u7684\u5c5e\u6027","text":"<p>\u5c5e\u6027\u5199\u5728\u7c7b\u4e2d\u7684\u8bdd\uff0c\u4f1a\u81ea\u52a8\u751f\u6210 _[\u5c5e\u6027\u540d] \u7684\u6210\u5458\u53d8\u91cf\uff0c\u4ee5\u53ca\u6210\u5458\u53d8\u91cf\u7684 <code>get</code> <code>set</code> \u65b9\u6cd5</p> <pre><code>@interface Person: NSObject{\n    int _age;\n}\n@property(assign, nonatomic) int age;\n\n-(void)setAge:(int)age;\n-(int)age \n\n@end\n\n@implement Person\n-(void)setAge:(int)age {\n    _age = age;\n}\n-(int)age{\n    return _age;\n}\n@end\n</code></pre> <p>\u4f46\u662f\u5982\u679c\u5c5e\u6027\u5199\u5728\u5206\u7c7b\u4e2d\u7684\u8bdd\uff0c\u53ea\u4f1a\u751f\u6210\u5c5e\u6027 <code>get</code> <code>set</code> \u65b9\u6cd5\u7684\u58f0\u660e</p> <pre><code>@interface Person(Test)\n\n@property(assign, nonatomic) int age;\n\n-(void)setAge:(int)age;\n-(int)age \n\n@end\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/#_3","title":"\u5173\u8054\u5bf9\u8c61\u65b9\u5f0f\u7ed9\u5206\u7c7b\u6dfb\u52a0\u5c5e\u6027","text":"<p>\u901a\u8fc7 runtime \u5173\u8054\u5bf9\u8c61\u7684\u65b9\u5f0f\u6dfb\u52a0\u5c5e\u6027</p> <pre><code>// \u8bbe\u7f6e\u5173\u8054\u5bf9\u8c61\nobjc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key,\n                         id _Nullable value, objc_AssociationPolicy policy)\n// \u83b7\u53d6\u5173\u8054\u5bf9\u8c61\nobjc_getAssociatedObject(id _Nonnull object, const void * _Nonnull key)\n\n// \u79fb\u9664\u6240\u6709\u5173\u8054\u5bf9\u8c61\n_object_remove_assocations(id object, bool deallocating)\n</code></pre> objc_AssociationPolicy \u5bf9\u5e94\u4fee\u9970\u7b26 OBJC_ASSOCIATION_ASSIGN assign OBJC_ASSOCIATION_RETAIN_NONATOMIC strong, nonatomic OBJC_ASSOCIATION_COPY_NONATOMIC copy, assign OBJC_ASSOCIATION_RETAIN strong, atomic OBJC_ASSOCIATION_COPY copy, atomic <pre><code>@interface Person (Action)\n@property (nonatomic, assign) int age;\n@end\n\n#import \"Person+Action.h\"\n#import &lt;objc/runtime.h&gt;\n\n@implementation Person (Action)\n// static \u4fdd\u8bc1\u4f5c\u7528\u4e8e\u4e3a\u5f53\u524d\u6587\u4ef6\uff0c\u9632\u6b62\u88ab\u5176\u4ed6\u6587\u4ef6\u8bbf\u95ee\n// \u7531\u4e8e objc_setAssociatedObject\uff0cobjc_getAssociatedObject \u7684key \u53c2\u6570\u9700\u8981\u4e00\u4e2a const void *\n// \u5b9a\u4e49\u4e00\u4e2a char \u7c7b\u578b\u7684\u5e38\u91cf\uff0c\u5e76\u5c06\u5176\u5730\u5740\u4f20\u5165\u53ef\u4ee5\u5360\u7528\u66f4\u5c11\u7684\u5185\u5b58\u7a7a\u95f4\n// \u7531\u4e8e\u76f4\u63a5 @\"String\" \u8fd9\u79cd\u65b9\u5f0f\u5b9a\u4e49\u7684\u5b57\u7b26\u4e32\u90fd\u5b58\u5728\u5e38\u91cf\u533a\uff0c\u6240\u4ee5\uff0c\u65e0\u8bba\u5199\u591a\u5c11\u904d\uff0c\u6307\u5411\u7684\u90fd\u662f\u540c\u4e00\u4e2a\u5730\u5740\uff0c\u6240\u4ee5\u4e5f\u53ef\u4ee5\u7528\u76f4\u63a5 \u4f20 \u5b57\u7b26\u4e32\u5e38\u91cf\u7684\u65b9\u5f0f\u6765\u4f20\u5165 key\n// \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165\u8be5\u5c5e\u6027\u7684 get \u65b9\u6cd5\u6765\u5f53\u505akey \u7684\u503c @selector(key)\nstatic const char valueAge;\n\n- (void)setAge:(int)age {\n    objc_setAssociatedObject(self, &amp;valueAge, @(age), OBJC_ASSOCIATION_ASSIGN);\n    // \u6216\u8005\u76f4\u63a5\u7528\u5b57\u7b26\u4e32\u5e38\u91cf\n    objc_setAssociatedObject(self,@\"age\", @(age), OBJC_ASSOCIATION_ASSIGN);\n    // \u76f4\u63a5\u7528 get \u65b9\u6cd5\u4f5c\u4e3a key\n    objc_setAssociatedObject(self,@selector(age), @(age), OBJC_ASSOCIATION_ASSIGN);\n}\n- (int)age {\n    return [objc_getAssociatedObject(self, &amp;valueAge) intValue];\n    // get \u4e5f\u76f4\u63a5\u7528\u5b57\u7b26\u4e32\u5e38\u91cf\n    return [objc_getAssociatedObject(self, @\"age\") intValue];\n    // \u76f4\u63a5\u7528 get \u65b9\u6cd5\u4f5c\u4e3a key\n    return [objc_getAssociatedObject(self, @selector(age)) intValue];\n}\n@end\n</code></pre> <p>\u901a\u8fc7 <code>objc_setAssociatedObject</code> \u8bbe\u7f6e\u5173\u8054\u5bf9\u8c61\uff0c\u662f\u4e0d\u4f1a\u4fee\u6539\u539f\u6765\u7c7b\u7684\u7ed3\u6784\u7684\uff0c\u800c\u662f\u5c06\u5173\u8054\u7684\u5bf9\u8c61\u5355\u72ec\u5b58\u50a8</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/07-%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1/#_4","title":"\u5173\u8054\u5bf9\u8c61\u7684\u5b9e\u73b0","text":"<p>\u5b9e\u73b0\u5173\u8054\u5bf9\u8c61\u7684\u6838\u5fc3\u5bf9\u8c61\u6709\u5982\u4e0b\u51e0\u4e2a</p> <ul> <li>AssociationsManager</li> <li>AssociationsHashMap</li> <li>ObjectAssociationMap</li> <li>ObjcAssociation</li> </ul> <pre><code>\ntypedef DenseMap&lt;DisguisedPtr&lt;objc_object&gt;, ObjectAssociationMap&gt; AssociationsHashMap;\ntypedef DenseMap&lt;const void *, ObjcAssociation&gt; ObjectAssociationMap;\n\nclass AssociationsManager {\n    using Storage = ExplicitInitDenseMap&lt;DisguisedPtr&lt;objc_object&gt;, ObjectAssociationMap&gt;; // \u5b83\u5176\u5b9e\u5c31\u662f AssociationsHashMap\n    static Storage _mapStorage;\n}\n\nclass ObjcAssociation {\n    uintptr_t _policy;\n    id _value;\n}\n</code></pre> <ul> <li>\u5173\u8054\u5bf9\u8c61\u5e76\u4e0d\u662f\u5b58\u50a8\u5728\u88ab\u5173\u8054\u5bf9\u8c61\u672c\u8eab\u7684\u5185\u5b58</li> <li>\u5173\u8054\u5bf9\u8c61\u5b58\u50a8\u5728\u5168\u5c40\u7edf\u4e00\u7684\u4e00\u4e2a <code>AssociationsManager</code> \u4e2d</li> <li>\u8bbe\u7f6e\u5173\u8054\u5bf9\u8c61\u4e3a <code>nil</code>, \u5219\u89e6\u53d1\u79fb\u9664\u5173\u8054\u5bf9\u8c61</li> <li>\u5bf9\u8c61\u9500\u6bc1\uff0c\u5173\u8054\u5bf9\u8c61\u5c31\u4f1a\u88ab\u81ea\u52a8\u79fb\u9664</li> </ul> <p></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/","title":"08 block","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block","title":"Block","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block_1","title":"Block \u7684\u672c\u8d28","text":"<ul> <li>block \u672c\u8d28\u4e0a\u4e5f\u662f\u4e00\u4e2a OC \u5bf9\u8c61\uff0c\u5b83\u7684\u5185\u90e8\u4e5f\u6709\u4e00\u4e2a isa \u6307\u9488</li> <li>block \u662f\u5c01\u88c5\u4e86\u51fd\u6570\u8c03\u7528\u4ee5\u53ca\u51fd\u6570\u8c03\u7528\u73af\u5883\u7684 OC \u5bf9\u8c61</li> <li>block \u5e95\u5c42\u7ed3\u6784\u5982\u4e0b</li> </ul> <pre><code>int main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        int age = 10;\n        // \u5728\u5b9a\u4e49 block \u7684\u65f6\u5019 age \u7684\u503c\u5c31\u5df2\u7ecf\u6355\u83b7\uff08capture\uff09\u8fdb\u6765\uff0c\n        // \u5728\u8fd9\u4e4b\u540e age \u5982\u4f55\u53d8\uff0cblock \u4e2d\u7684\u7684\u503c\u4e5f\u4e0d\u4f1a\u6539\u53d8\n        void (^block)(int, int) = ^(int a, int b){\n            NSLog(@\"aaa\");\n            NSLog(@\"%d, %d, %d\", age, a, b);\n        };\n\n        block(10, 20); \n    }\n    return 0;\n}\n\n</code></pre> <pre><code>int main(int argc, const char * argv[]) {\n    /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; \n        int age = 10;\n        // \u5b9e\u4f8b\u5316 __main_block_impl_0\uff0c\u4f20\u5165 __block_impl \u5bf9\u8c61, \u65b9\u6cd5\u5bf9\u8c61\uff0cdesc\u6307\u9488\uff0c\u4ee5\u53ca block \u4e2d\u5f15\u7528\u7684\u5c40\u90e8\u53d8\u91cf\n        // __main_block_func_0 \u8d4b\u503c\u7ed9 __block_impl-&gt;FuncPtr,\n        // __main_block_desc_0_DATA \u8d4b\u503c\u7ed9 __main_block_impl_0 -&gt; Desc\n        // age \u8d4b\u503c\u7ed9 __main_block_desc_0 \u6210\u5458\u53d8\u91cf age\n        void (*block)(int, int) = ((void (*)(int, int))&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, age));\n\n        void (*block)(int, int) = &amp;__main_block_impl_0(\n          __main_block_func_0, \n          &amp;__main_block_desc_0_DATA, \n          age\n        )); // \u521d\u59cb\u5316\u4e00\u4e2a\u7ed3\u6784\u4f53\u5e76\u5c06\u7ed3\u6784\u4f53\u7684\u5730\u5740\u8fd4\u56de\u7ed9 block\n\n\n        // (void (*)(__block_impl *, int, int)) \u5f3a\u8f6c \n        // (__block_impl *)block block \u5f3a\u8f6c\u4e3a (__block_impl *)\n        // \u7531\u4e8e __block_impl \u662f __main_block_impl_0 \u7684\u7b2c\u4e00\u4e2a\u6210\u5458\uff0c\n        // \u6240\u4ee5\uff0cblock \u7684\u5730\u5740\u4e5f\u662f __block_impl \u7684\u5730\u5740\n        // \u6240\u4ee5\u5c06 __main_block_impl_0 \u5f3a\u5236\u8f6c\u6362\u4e3a __block_impl \u662f\u6ca1\u6709\u95ee\u9898\u7684\n        ((void (*)(__block_impl *, int, int))((__block_impl *) block) -&gt; FuncPtr )((__block_impl *)block, 10, 20);\n        // \u53bb\u6389\u5f3a\u8f6c\u4e4b\u540e\u7b80\u5316\u4e3a\n        (block-&gt;FuncPtr)(block, 10, 20);\n\n    }\n    return 0;\n}\n\nstruct __block_impl {\n  void *isa;\n  int Flags;\n  int Reserved;\n  void *FuncPtr;\n};\n\nstatic struct __main_block_desc_0 {\n  size_t reserved;\n  size_t Block_size;\n} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};\n\nstruct __main_block_impl_0 {\n  struct __block_impl impl;\n  struct __main_block_desc_0* Desc;\n  int age;\n\n  // \u6784\u9020\u51fd\u6570\uff08\u7c7b\u4f3c\u4e8e OC \u7684 init \u65b9\u6cd5\uff09\uff0c\u8fd4\u56de\u7ed3\u6784\u4f53\u5bf9\u8c61\n  __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _age, int flags=0) : age(_age) {\n    impl.isa = &amp;_NSConcreteStackBlock;\n    impl.Flags = flags;\n    impl.FuncPtr = fp;\n    Desc = desc;\n  }\n};\n\n</code></pre> <p>\u4e3a\u4e86\u4fdd\u8bc1 block \u5185\u90e8\u80fd\u591f\u6b63\u5e38\u8bbf\u95ee\u5916\u90e8\u7684\u53d8\u91cf\uff0c block \u6709\u4e2a\u53d8\u91cf\u6355\u83b7\u673a\u5236</p> \u53d8\u91cf\u7c7b\u578b \u6355\u83b7\u5230 block \u5185\u90e8 \u8bbf\u95ee\u65b9\u5f0f \u5c40\u90e8\u53d8\u91cf auto true \u503c\u4f20\u9012 static true \u6307\u9488\u4f20\u9012 \u5168\u5c40\u53d8\u91cf false \u76f4\u63a5\u8bbf\u95ee <p>\u5c40\u90e8\u53d8\u91cf - auto \u5c40\u90e8\u53d8\u91cf\u4f5c\u7528\u57df\u7ed3\u675f\u65f6\u5c31\u88ab\u9500\u6bc1\u4e86\uff0c\u5f53\u8c03\u7528 block \u7684\u65f6\u5019\u53ef\u80fd auto \u7684\u5c40\u90e8\u53d8\u91cf\u5df2\u7ecf\u88ab\u9500\u6bc1\u4e86\uff0c\u6240\u4ee5\u58f0\u660e block \u65f6\u5c31\u76f4\u63a5\u5c06\u5176\u503c\u6355\u83b7\u8fdb\u6765 - static \u5c40\u90e8\u53d8\u91cf\u521d\u59cb\u5316\u4e4b\u540e\u5c31\u4e00\u76f4\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u62c5\u5fc3\u5176\u88ab\u9500\u6bc1\uff0c\u6240\u4ee5\u9700\u8981\u6355\u83b7\u5176\u6307\u9488\uff0c\u6765\u8bbf\u95ee static \u5c40\u90e8\u53d8\u91cf - \u5982\u679c\u6355\u83b7\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u90a3\u4e48\u76f4\u63a5\u6355\u83b7\u5bf9\u8c61\u672c\u8eab </p> <p>\u5168\u5c40\u53d8\u91cf</p> <ul> <li>\u521d\u59cb\u5316\u4e4b\u540e\u4e00\u76f4\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\uff0c\u4efb\u4f55\u5730\u65b9\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u6355\u83b7\uff0c\u76f4\u63a5\u8bbf\u95ee\u5373\u53ef</li> </ul> <pre><code>const int test = 100;\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        // \u968f\u65f6\u53ef\u80fd\u88ab\u9500\u6bc1\uff0c\u5f53\u8c03\u7528 block \u7684\u65f6\u5019\u53ef\u80fd auto \u7684\u53d8\u91cf\u5df2\u7ecf\u88ab\u9500\u6bc1\u4e86\uff0c\u6240\u4ee5\u58f0\u660e block \u65f6\u5c31\u76f4\u63a5\u5c06\u5176\u503c\u6355\u83b7\u8fdb\u6765\n        int age = 10; \n        // \u800c static \u53d8\u91cf\u521d\u59cb\u5316\u4e4b\u540e\u5c31\u4e00\u76f4\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u62c5\u5fc3\u5176\u88ab\u9500\u6bc1\uff0c\u6240\u4ee5\u53ea\u6355\u83b7\u5176\u6307\u9488\u5c31\u4e0d\u4f1a\u6709\u95ee\u9898\n        static int weight = 30;\n        void (^block)(int, int) = ^(int a, int b){\n            NSLog(@\"aaa\");\n            NSLog(@\"%d, %d, %d, %d, %d, %d\", age, a, b, weight, test);\n        };\n        block(10, 20);\n\n    }\n    return 0;\n}\n</code></pre> <pre><code>struct __main_block_impl_0 {\n  struct __block_impl impl;\n  struct __main_block_desc_0* Desc;\n  // \u53d8\u91cf\u7c7b\u578b\u4e3a auto \u7684\u8bdd\uff0c\u53ea\u6355\u83b7\u503c\n  int age;\n  // \u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c block \u8bbf\u95ee static \u53d8\u91cf\u7684\u8bdd\u5c31\u4f1a\u5c06 static \u53d8\u91cf\u7684\u6307\u9488\u6355\u83b7\u8fdb\u6765\uff0c\n  int *weight; \n  NSString *str;\n  __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int _age, int _height, int *_weight, NSString *_str, int flags=0) : age(_age), weight(_weight), str(_str) {\n    impl.isa = &amp;_NSConcreteStackBlock;\n    impl.Flags = flags;\n    impl.FuncPtr = fp;\n    Desc = desc;\n  }\n};\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block_2","title":"block \u7c7b\u578b","text":"<p>Block \u6709 3 \u4e2d\u7c7b\u578b\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 class \u7684\u65b9\u6cd5\u6216\u8005 isa \u6307\u9488\u67e5\u770b\u5177\u4f53\u7c7b\u578b\uff0c\u6700\u7ec8\u90fd\u7ee7\u627f\u81ea NSBlock \u7c7b\u578b, NSBlock \u53c8\u7ee7\u627f\u81ea NSObject </p> <ul> <li>NSGlobalBlock (_NSConcreteGlobalBlock)</li> <li>NSStackBlock (_NSConcreteStackBlock)</li> <li>NSMallocBlock (_NSConcreteMallocBlock)</li> </ul> <p>\u5e94\u7528\u7a0b\u5e8f\u5185\u5b58\u5206\u914d</p> \u5185\u5b58\u5730\u5740\u7531\u5c0f\u5230\u5927 \u5b58\u653e\u7684block \u7c7b\u578b \u5b9a\u4e49\u65b9\u5f0f \u7a0b\u5e8f\u533a\u57df .text\u533a\uff0c\u5b58\u653e\u7f16\u5199\u7684\u4ee3\u7801 \u6570\u636e\u533a\u57df .data \u533a\uff0c \u5b58\u653e\u5168\u5c40\u53d8\u91cf _NSConcreteGlobalBlock \u6ca1\u6709\u8bbf\u95ee auto \u53d8\u91cf \u5806\uff0c \u5b58\u653e alloc \u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u52a8\u6001\u5206\u914d\u5185\u5b58\uff0c\u9700\u8981\u5f00\u53d1\u8005\u6765\u7533\u8bf7\u5185\u5b58\uff0c\u4e5f\u9700\u8981\u7a0b\u5e8f\u5458\u81ea\u5df1\u7ba1\u7406\u5185\u5b58 _NSConcreteMallocBlock _NSConcreteStackBlock \u8c03\u7528 copy \u6808\uff0c\u5b58\u653e\u5c40\u90e8\u53d8\u91cf\uff0c\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u5185\u5b58\uff0c\u7cfb\u7edf\u4e5f\u4f1a\u81ea\u52a8\u9500\u6bc1\u5185\u5b58\uff0c\u4f8b\u5982 int i = 10 _NSConcreteStackBlock \u8bbf\u95ee\u4e86 auto \u53d8\u91cf \uff08\u4e0d\u4f7f\u7528 ARC\uff09 <p>\u7531\u4e8e _NSConcreteStackBlock \u5b58\u653e\u5728\u6808\uff0c\u6240\u4ee5\u51fa\u4e86\u8be5 block \u58f0\u660e\u7684\u4f5c\u7528\u57df\uff0cblock \u6240\u5360\u7528\u7684\u5185\u5b58\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u5728 MRC \u4e0b\u8c03\u7528 _NSConcreteStackBlock \u53ef\u80fd\u4f1a\u6709\u610f\u60f3\u4e0d\u5230\u7684\u7ed3\u679c\uff0c_NSConcreteStackBlock \u8c03\u7528\u4e86 copy \u4e4b\u540e\u5c31\u4f1a\u5347\u7ea7\u4e3a _NSConcreteMallocBlock\uff0c\u4e5f\u5c31\u5c06\u5176\u5b58\u5230\u4e86\u5806\uff0c\u5176\u5360\u7528\u5185\u5b58\u5c31\u4ea4\u7531\u6211\u4eec\u81ea\u5df1\u6765\u7ef4\u62a4\u4e86\u3002</p> block \u7c7b\u578b \u73af\u5883 \u526f\u672c\u6e90\u7684\u914d\u7f6e\u5b58\u50a8\u57df \u590d\u5236\u6548\u679c NSGlobalBlock \u6ca1\u6709\u8bbf\u95ee auto \u53d8\u91cf \u6808 \u4ece\u6808\u590d\u5236\u5230\u5806 NSStackBlock \u6709\u8bbf\u95ee auto \u53d8\u91cf \u7a0b\u5e8f\u7684\u6570\u636e\u533a\u57df \u4ec0\u4e48\u4e5f\u4e0d\u505a NSMallocBlock NSStackBlock \u8c03\u7528 copy \u5806 \u5f15\u7528\u8ba1\u6570\u589e\u52a0"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block-copy","title":"block \u7684 copy","text":"<p>\u5728 ARC \u73af\u5883\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u6839\u636e\u60c5\u51b5\u81ea\u52a8\u5c06\u6808\u4e2d\u7684 block \u590d\u5236\u5230\u5806\u4e0a - block \u4f5c\u4e3a\u8fd4\u56de\u503c\u65f6 - block \u8d4b\u503c\u7ed9 __strong \u6307\u9488\u65f6 - block \u4f5c\u4e3a Cocoa API \u4e2d\u65b9\u6cd5\u540d\u542b\u6709 usingBlock \u65b9\u6cd5\u53c2\u6570\u65f6</p> <pre><code>typedef void (^MyBlock)(void);\n\nMyBlock myBlock() {\n  int age = 10;\n  return ^{\n    NSLog(@\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %d\", age);\n  }\n}\n\nint main(int argc, const char * argv[]) {\n  @autorelease{\n    int age = 10;\n    MyBlock block2 = ^{\n      NSLog(@\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %d\", age);\n    } \n    // block \u4f5c\u4e3a\u8fd4\u56de\u503c\u65f6\n    [myBlock() class];\n    // block \u8d4b\u503c\u7ed9 __strong \u6307\u9488\u65f6\n    [block2 class];\n  }\n}\n\n</code></pre> <p>\u4f7f\u7528 clang \u8f6c\u6362 OC \u4e3a C++ \u4ee3\u7801\u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u4ee5\u4e0b\u95ee\u9898</p> <p>cannot create __weak reference in file useing manual reference</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u652f\u6301 ACR\u3001\u6307\u5b9a\u8fd0\u884c\u65f6\u7cfb\u7edf\u7248\u672c\uff0c\u6bd4\u5982</p> <p><code>xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc -fobjc-arc -fobjc-runtime=ios-8.0.0 main.m</code></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#auto","title":"\u5bf9\u8c61\u7c7b\u578b\u7684 auto \u53d8\u91cf","text":"<p>\u5f53 block \u5185\u90e8\u8bbf\u95ee\u4e86\u5bf9\u8c61\u7c7b\u578b\u7684 auto  \u53d8\u91cf\u65f6 - \u5982\u679c block \u662f\u5728\u6808\u4e0a\uff0c\u5c06\u4e0d\u4f1a\u5bf9 auto \u53d8\u91cf\u4ea7\u751f\u5f3a\u5f15\u7528\uff1f \uff08\u96be\u9053\u4e0d\u662f\uff1a\u7531\u4e8e block \u5728\u6808\u4e0a\uff0c\u5373\u4f7f\u5bf9 auto \u53d8\u91cf\u4ea7\u751f\u4e86\u5f3a\u5f15\u7528\uff0c\u4f46\u662f\u7531\u4e8e\u5728\u79bb\u5f00\u4f5c\u7528\u57df\u4e4b\u540e block \u81ea\u5df1\u672c\u8eab\u5c31\u5df2\u7ecf\u88ab\u9500\u6bc1\u4e86\uff0cblock \u5bf9\u5bf9\u8c61\u7c7b\u578b\u7684 auto \u53d8\u91cf\u5f15\u7528\u4e5f\u5c31\u6ca1\u6709\u4e86\uff0c\u90a3\u4e48\u4e5f\u5c31\u65e0\u4ece\u8c08\u8d77\u5f3a\u5f31\u5f15\u7528\u4e86\uff0c\u8c08\u6808\u4e2d\u7684\u5f3a\u5f31\u5f15\u7528\u5c31\u6ca1\u6709\u610f\u4e49\uff1f\u672c\u8eab\u5c31\u662f\u7cfb\u7edf\u7ba1\u7406\u7684\uff0c\u51fa\u4e86\u4f5c\u7528\u57df\u5168\u73a9\u5b8c\uff09 - \u5982\u679c block \u88ab\u62f7\u8d1d\u5230\u5806\u4e0a - - \u4f1a\u8c03\u7528 block \u5185\u90e8\u7684 copy \u51fd\u6570 - - copy \u51fd\u6570\u5185\u90e8\u4f1a\u8c03\u7528 _Block_object_assign \u51fd\u6570 - - _Block_object_assign \u51fd\u6570\u4f1a\u6839\u636e auto \u53d8\u91cf\u7684\u4fee\u9970\u7b26 \uff08__strong, __weak, __unsafe_unretained\uff09\u4f5c\u51fa\u54cd\u5e94\u7684\u64cd\u4f5c\uff0c\u7c7b\u4f3c\u4e8e retain \uff08\u5f62\u6210\u5f3a\u5f15\u7528\u3001\u5f31\u5f15\u7528\uff09 - \u5982\u679c block \u4ece\u5806\u4e0a\u79fb\u9664 - - \u4f1a\u8c03\u7528 block \u5185\u90e8\u7684 dispose \u51fd\u6570 - - dispose \u51fd\u6570\u5185\u90e8\u4f1a\u8c03\u7528 _Block_object_dispose \u51fd\u6570 - - _Block_object_dispose \u51fd\u6570\u4f1a\u81ea\u52a8\u91ca\u653e\u5f15\u7528\u7684 auto \u53d8\u91cf\uff0c\u7c7b\u4f3c\u4e8e release</p> \u51fd\u6570 \u8c03\u7528\u65f6\u673a copy \u51fd\u6570 \u6808\u4e0a\u7684 Block \u590d\u5236\u5230\u5806\u65f6 dispose \u51fd\u6570 \u6808\u4e0a\u7684 Block \u88ab\u5e9f\u5f03\u65f6 <p>\u5982\u679c block \u4e2d\u5f15\u7528\u4e86 \u5bf9\u8c61\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u90a3\u4e48 <code>__main_block_desc_0</code> \u4e2d\u5c31\u591a\u51fa\u4e86</p> <p><code>void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*)</code> </p> <p><code>void (*dispose)(struct __main_block_impl_0*)</code> </p> <p>\u7528\u6765\u5bf9 block \u5185\u90e8\u5f15\u7528\u7684\u5bf9\u8c61\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u64cd\u4f5c</p> <pre><code>static struct __main_block_desc_0 {\n  size_t reserved;\n  size_t Block_size;\n  void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*);\n  void (*dispose)(struct __main_block_impl_0*);\n} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block-__block","title":"block \u4fee\u6539\u53d8\u91cf\u7684\u503c (__block)","text":"<p>block \u9ed8\u8ba4\u53ea\u80fd\u4fee\u6539 static \u53d8\u91cf\u6216\u8005\u5168\u5c40\u53d8\u91cf\uff0c\u4f46\u662f\u8fd9\u6837\u505a\u5e76\u4e0d\u597d\uff0cstatic \u4fee\u9970\u7684\u53d8\u91cf\u4e0d\u80fd\u88ab\u9500\u6bc1\uff0c\u4f1a\u4e00\u76f4\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\uff0c\u800c\u4ec5\u4e3a\u4e86\u4f7f\u7528 block  \u4fee\u6539\u53d8\u91cf\u503c\u5c31\u5c06\u53d8\u91cf\u641e\u6210\u5168\u5c40\u7684\u540c\u6837\u662f\u4e0d\u597d\u7684\uff0c\u800c\u5207\u4e5f\u6709 static \u53d8\u91cf\u7684\u95ee\u9898\u4e0d\u4f1a\u88ab\u9500\u6bc1</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#__block","title":"__block \u4fee\u9970\u7b26","text":"<ul> <li>__block \u53ef\u4ee5\u7528\u4e8e\u89e3\u51b3 block \u5185\u90e8\u65e0\u6cd5\u4fee\u6539 auto \u53d8\u91cf\u503c\u7684\u95ee\u9898</li> <li>__block \u4e0d\u80fd\u4fee\u9970\u5168\u5c40\u53d8\u91cf\u3001\u9759\u6001\u53d8\u91cf(static)</li> <li>\u7f16\u8bd1\u5668\u4f1a\u5c06 __block \u5305\u88c5\u6210\u4e00\u4e2a\u5bf9\u8c61</li> </ul> <pre><code>int main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        __block int height = 20;\n        void (^block)(int, int) = ^(int a, int b){\n            NSLog(@\"aaa\");\n            height = 20;\n            NSLog(@\"%d, %d, %d\", age, a, b, height);\n        };\n        block(10, 20);\n        NSLog(@\"%p\", &amp;height); // \u62ff\u5230\u7684\u5730\u5740\u5c31\u662f\u6700\u7ec8\u5305\u88c5\u5b8c\u7ed3\u6784\u4f53\u5185\u90e8 height \u6210\u5458\u7684\u5730\u5740\n    }\n    return 0;\n}\n</code></pre> <pre><code>// height \u6700\u7ec8\u88ab\u5305\u88c5\u6210\u5bf9\u8c61\u7684\u7ed3\u6784\nstruct __Block_byref_height_0 {\n  void *__isa;\n__Block_byref_height_0 *__forwarding;\n int __flags;\n int __size;\n int height;\n};\n\nstruct __main_block_impl_0 {\n  struct __block_impl impl;\n  struct __main_block_desc_0* Desc;\n  __Block_byref_height_0 *height; // by ref\n  __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_height_0 *_height, int flags=0) : height(_height-&gt;__forwarding) {\n    impl.isa = &amp;_NSConcreteStackBlock;\n    impl.Flags = flags;\n    impl.FuncPtr = fp;\n    Desc = desc;\n  }\n};\n\nstatic void __main_block_func_0(struct __main_block_impl_0 *__cself, int a, int b) {\n  __Block_byref_height_0 *height = __cself-&gt;height; // bound by ref\n\n    NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_hz_1frfmmyx7q3_8dv6845_7pgc0000gp_T_main_621f5c_mi_0);\n    // height \u7684\u4fee\u6539\n    (height-&gt;__forwarding-&gt;height) = 20;\n    NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_hz_1frfmmyx7q3_8dv6845_7pgc0000gp_T_main_621f5c_mi_1, a, b, (height-&gt;__forwarding-&gt;height));\n}\n\nint main(int argc, const char * argv[]) {\n    /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; \n        __attribute__((__blocks__(byref))) __Block_byref_height_0 height = {\n          (void*)0, // __Block_byref_height_0 -&gt;__isa\n          (__Block_byref_height_0 *)&amp;height, // __Block_byref_height_0 -&gt; __forwarding \u53ef\u4ee5\u770b\u5230 __forwarding \u7684\u6307\u9488\u6307\u5411\u5b83\u81ea\u5df1\n           0, // __Block_byref_height_0 -&gt; __flags\n          sizeof(__Block_byref_height_0), // __Block_byref_height_0 -&gt; __size\n          20 // __Block_byref_height_0 -&gt; height\n        };\n        void (*block)(int, int) = ((void (*)(int, int))&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_height_0 *)&amp;height, 570425344));\n\n        ((void (*)(__block_impl *, int, int))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block, 10, 20);\n\n        // NSLog(@\"%p\", &amp;height); \u7684\u6700\u7ec8\u5b9e\u73b0\n        NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_hz_1frfmmyx7q3_8dv6845_7pgc0000gp_T_main_990137_mi_2, &amp;(height.__forwarding-&gt;height));\n\n    }\n    return 0;\n}\n</code></pre> <p>\u5982\u679c\u4f7f\u7528 __block \u4fee\u9970\u5bf9\u8c61\u7c7b\u578b\u7684\u53d8\u91cf\u7684\u8bdd\uff0c\u6700\u7ec8\u5305\u88c5\u540e\u7684\u5bf9\u8c61\u5982\u4e0b\uff0c\u591a\u51fa\u4e24\u4e2a\u65b9\u6cd5\u6765\u505a\u5185\u5b58\u7ba1\u7406</p> <pre><code>struct __Block_byref_obj_1 {\n  void *__isa;\n__Block_byref_obj_1 *__forwarding;\n int __flags;\n int __size;\n // \u5bf9\u8c61\u7684\u5185\u5b58\u7ba1\u7406\n void (*__Block_byref_id_object_copy)(void*, void*);\n void (*__Block_byref_id_object_dispose)(void*);\n NSObject *obj;\n};\n</code></pre> <p>\u8bbf\u95ee __block \u4fee\u9970\u7684 auto \u53d8\u91cf\u7684\u8bdd\uff0c\u5176\u5b9e\u6700\u7ec8\u8bbf\u95ee\u5230\u7684\u5c31\u662f\u5305\u88c5\u6210\u7684\u7ed3\u6784\u4f53\u4e2d\u7684\u5bf9\u5e94\u6210\u5458\u5730\u5740\uff0c\u800c\u4e0d\u662f\u7ed3\u6784\u4f53\uff0c\u5bf9\u4e8e\u5916\u90e8\u7684\u8bbf\u95ee\u5df2\u7ecf\u5c4f\u853d\u8c03\u4e86\u5e95\u5c42\u7684\u5b9e\u73b0\uff0c\u5bf9\u4e8e\u4e0a\u5c42\u7f16\u7a0b\u6765\u8bf4\uff0c\u62ff\u5230\u7684\u6700\u7ec8\u8fd8\u662f auto \u53d8\u91cf\u672c\u8eab\uff0c\u53ea\u662f\u5728\u5176\u5e95\u5c42\u5b9e\u73b0\u4e2d\u5c01\u88c5\u4e86\u4e00\u5c42\u7ed3\u6784\u4f53\uff0c\u6765\u4fdd\u8bc1\u5176\u5728\u5806\u5185\u5b58\u4e2d\uff0c\u4e0d\u4f1a\u88ab\u7cfb\u7edf\u91ca\u653e\u6389</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#block_3","title":"block \u5185\u5b58\u7ba1\u7406","text":"<p>block \u5728\u6808\u4e0a\u65f6\uff0c\u4e0d\u4f1a\u5bf9 __block \u4ea7\u751f\u5f3a\u5f15\u7528 (\u5b83\u81ea\u5df1\u90fd\u4fdd\u4e0d\u4f4f\uff0c\u5c31\u65e0\u4ece\u8c08\u5f3a\u5f15\u7528\u4e86)</p> <p>\u5f53 block \u88ab copy \u5230\u5806\u65f6 - \u4f1a\u8c03\u7528 block \u7684 copy \u51fd\u6570 - copy \u51fd\u6570\u5185\u90e8\u4f1a\u8c03\u7528 _Block_object_assign \u51fd\u6570 - _Block_object_assign \u51fd\u6570\u4f1a\u5bf9 __block \u53d8\u91cf\u5f62\u6210\u5f3a\u5f15\u7528 \uff08retain\uff09 \u5f53 block \u4ece\u5806\u4e0a\u79fb\u9664 - - \u4f1a\u8c03\u7528 block \u5185\u90e8\u7684 dispose \u51fd\u6570 - - dispose \u51fd\u6570\u5185\u90e8\u4f1a\u8c03\u7528 _Block_object_dispose \u51fd\u6570 - - _Block_object_dispose \u51fd\u6570\u4f1a\u81ea\u52a8\u91ca\u653e\u5f15\u7528\u7684 __block \u53d8\u91cf\uff0c\u7c7b\u4f3c\u4e8e release</p> <p>### \u5bf9\u8c61\u7c7b\u578b\u7684 auto \u53d8\u91cf\u3001 __block \u53d8\u91cf</p> <p>\u5f53 block \u5728\u6808\u4e0a\u65f6\uff0c\u5bf9\u4ed6\u4eec\u90fd\u4e0d\u4f1a\u4ea7\u751f\u5f3a\u5f15\u7528</p> <p>\u5f53 block \u88ab\u62f7\u8d1d\u5230\u5806\u65f6\uff0c\u90fd\u4f1a\u901a\u8fc7 copy \u51fd\u6570\u6765\u5904\u7406\u5b83\u4eec - __block \u53d8\u91cf - - <code>_Block_object_assign((void*)&amp;dst-&gt;height, (void*)src-&gt;height, 8/*BLOCK_FIELD_IS_BYREF*/);</code> - \u5bf9\u8c61\u7c7b\u578b\u7684 auto \u53d8\u91cf - - <code>_Block_object_assign((void*)&amp;dst-&gt;obj, (void*)src-&gt;obj, 3/*BLOCK_FIELD_IS_OBJECT*/);</code> \u5f53 block \u4ece\u5806\u4e0a\u79fb\u9664\uff0c\u90fd\u4f1a\u901a\u8fc7 dispose \u51fd\u6570\u6765\u91ca\u653e\u5b83\u4eec - __block \u53d8\u91cf - - <code>_Block_object_dispose((void*)src-&gt;height, 8/*BLOCK_FIELD_IS_BYREF*/)</code> - \u5bf9\u8c61\u7c7b\u578b\u7684 auto \u53d8\u91cf - - <code>_Block_object_dispose((void*)src-&gt;obj, 3/*BLOCK_FIELD_IS_OBJECT*/);</code></p> \u5bf9\u8c61 BLOCK_FIELD_IS_OBJECT __block \u53d8\u91cf BLOCK_FIELD_IS_BYREF"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#__block-__forwarding","title":"__block \u7684 __forwarding \u6307\u9488\u6307\u5411\u81ea\u5df1","text":"<p>\u7ecf\u8bd5\u9a8c\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u6808\u4e0a\u7684block \u62f7\u8d1d\u5230\u5806\u4e0a\u65f6\uff0c\u6808\u4e0a\u7684 block \u4e2d\u7684 __forwarding \u6307\u9488\u4f1a\u6307\u5411 \u5806\u4e0a block \u7684 <code>__Block_byref_obj_1</code>\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u5728 copy \u4e4b\u540e\u65e0\u8bba\u662f\u8bbf\u95ee \u6808\u4e0a\u7684 block \u526f\u672c\u8fd8\u662f\u8bbf\u95ee\u5806\u4e0a\u7684block \u526f\u672c\uff0c\u62ff\u5230\u7684 __block \u53d8\u91cf\u90fd\u662f\u540c\u4e00\u4efd</p> <p></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#__block_1","title":"__block \u4fee\u9970\u7684\u5bf9\u8c61\u7c7b\u578b","text":"<p>__block \u4fee\u9970\u7684\u5bf9\u8c61\u7c7b\u578b\u5728 MRC \u4e0b\u5305\u88c5\u540e\u7684\u7c7b\u5bf9\u4e8e\u5bf9\u8c61\u7684\u5f15\u7528\u4e00\u76f4\u662f\u5f31\u7684\uff0c\u4f46\u662f\u76f4\u63a5\u4f7f\u7528\u5bf9\u8c61\u5c31\u4e0d\u4f1a\u6709\u8fd9\u79cd\u95ee\u9898\uff0cblock \u5185\u90e8\u4f1a\u81ea\u52a8\u6309\u5f15\u7528\u5bf9\u8c61\u7684\u7c7b\u578b\u6765\u5904\u7406\u5f3a\u5f31\u5f15\u7528 \u5982\u679c\u662f ARC \u4e0b\u7684\u8bdd\u90a3\u5c31\u6839\u636e __block \u4fee\u9970\u7684\u5bf9\u8c61\u5f3a\u5f31\u6765\u51b3\u5b9a\u6700\u7ec8\u7684\u5f15\u7528\u662f\u5f3a\u8fd8\u662f\u5f31</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#_1","title":"\u5faa\u73af\u5f15\u7528","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#arc","title":"ARC \u73af\u5883\u4e0b","text":"<pre><code>\ntypedef (^TestBlock)();\n\n@interface Person : NSObject\n@property(copy, nonatomic) TestBlock block;\n@property(assign, nonatomic) int age;\n\n-(void) test;\n@end\n\n@implementation Person\n-(void) test {\n  // \u8fd9\u79cd\u5199\u6cd5\uff0c\u5982\u679c\u5916\u90e8\u8c03\u7528\u4e86test\uff0c\u90a3\u4e48\u4e5f\u4f1a\u4ea7\u751f\u5faa\u73af\u5f15\u7528\uff0c\u5bfc\u81f4 person \u65e0\u6cd5\u91ca\u653e\n  // \u6216 __weak typeof(self) weakSelf = self;\n  // \u7136\u540e\u5728 block \u5185\u90e8\u4f7f\u7528 weakSelf\n  self.block = ^{\n    NSLog(@\u201c%d\u201d, self.age);\n    //\u6216\u8005 \n    NSLog(@\u201c%d\u201d, _age);\n  }\n\n\n}\n@end\n\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        Person *p = [[Person alloc] init];\n        p.age = 10;\n        // \u6bd4\u5982\u8fd9\u6837\uff0cp\u7684\u5c5e\u6027 block \u4e2d\u4f7f\u7528\u4e86 p \u7684\u5c5e\u6027\n        // \u90a3\u4e48 block \u4f5c\u4e3a p \u7684\u5c5e\u6027\uff0cblock \u5bf9 p \u6709\u4e00\u4e2a\u5f3a\u5f15\u7528\n        // block \u4e2d\u4f7f\u7528\u4e86 p \u7684\u5c5e\u6027\uff0c\u90a3\u4e48 block \u5bf9\u8c61\u4e2d\u4e5f\u4f1a\u6709\u4e00\u4e2a\u5bf9 p \u7684\u5f3a\u5f15\u7528\n        // \u8fd9\u6837\u5c31\u4ea7\u751f\u4e86\u5faa\u73af\u5f15\u7528\uff0c\u5bfc\u81f4 p \u65e0\u6cd5\u91ca\u653e\n        // \u5047\u5982 \u5b9a\u4e49\u4e00\u4e2a __weak Person *weakP = p \u6216 __weak typeof(p) weakP = p;\n        // \u5728 block \u4e2d\u4f7f\u7528 weakP\uff0c\u8fd9\u6837 block \u5bf9\u4e8e p \u7684\u5f15\u7528\u5c31\u662f\u5f31\u5f15\u7528\uff0c\u5c31\u4e0d\u4f1a\u6709\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\n        p.block = ^{\n            NSLog(@\"%d\", p.age);\n        };\n    }\n    return 0;\n}\n</code></pre> <p>__weak\uff0c\u76f4\u63a5\u7528\u5f31\u6307\u9488\u6307\u5411\u5bf9\u8c61\uff0c\u5982\u679c\u5bf9\u8c61\u91ca\u653e\uff0c\u90a3\u4e48\u6307\u9488\u7f6e\u4f4d nil</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 __unsafe__unretained\uff0c\u4e0d\u4f1a\u4ea7\u751f\u5f3a\u5f15\u7528\uff0c\u4e0d\u5b89\u5168\uff0c\u4f46\u662f\u6307\u9488\u6307\u5411\u7684\u5bf9\u8c61\u9500\u6bc1\u65f6\uff0c\u6307\u9488\u5b58\u7684\u5730\u5740\u4e0d\u53d8\uff0c\u5bf9\u8c61\u91ca\u653e\u4e4b\u540e\u518d\u8bbf\u95ee\u4f1a\u6709\u91ce\u6307\u9488\u7684\u95ee\u9898 \u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528 __block \u5bf9\u8c61\u6765\u89e3\u51b3\uff0c\u4f46\u662f\u5728block \u4e2d\u4f7f\u7528\u5b8c\u4f7f\u7528\u5b8c __block \u5bf9\u8c61\u4e4b\u540e\u8981\u5bf9 __block \u4fee\u9970\u7684\u5bf9\u8c61\u7f6e nil</p> <pre><code>__block Person *p = [[Person alloc] init];\np.age = 10;\np.block = ^{\n  NSLog(@\"%d\", p.age);\n  p = nil;\n}\nperson.block();\n\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/08-block/#mrc","title":"MRC \u73af\u5883\u4e0b","text":"<p>MRC \u4e0d\u652f\u6301 __weak \u53ef\u4ee5\u4f7f\u7528 __unsafe__unretained \u6216\u8005\u4f7f\u7528 __block \u6765\u4fee\u9970\u5bf9\u8c61\uff08MRC __block \u5305\u88c5\u4e4b\u540e\u7684\u5bf9\u8c61\u4e0d\u4f1a\u5bf9\u5bf9\u8c61\u8fdb\u884c retain \u4e5f\u5c31\u4e0d\u4f1a\u4ea7\u751f\u5f3a\u5f15\u7528\uff0c\u6240\u4ee5\u7528 __block \u4e5f\u4e0d\u9700\u8981\u50cf ARC \u4e0b\u3002\u5bf9\u5bf9\u8c61\u503c nil \u5e76\u4e14\u8fd0\u884c block\uff09</p> <pre><code>// MRC\u6362\u5c06\u4e0b\u76f4\u63a5\u8fd9\u4e48\u641e\u5c31\u53ef\u4ee5\n__block Person *p = [[Person alloc] init];\np.age = 10;\np.block = ^{\n  NSLog(@\"%d\", p.age);\n}\nperson.block();\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/","title":"09 runtime","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#runtime","title":"runtime","text":"<p>Objective-C \u662f\u4e00\u95e8\u52a8\u6001\u6027\u6bd4\u8f83\u5f3a\u7684\u8bed\u8a00\uff0c\u8ddf C\uff0cC++ \u6709\u5f88\u5927\u4e0d\u540c</p> <p>\u5e38\u89c4\u8bed\u8a00\u7684\u8fc7\u7a0b \u7f16\u5199\u4ee3\u7801 -&gt; \u7f16\u8bd1\u94fe\u63a5 -&gt; \u8fd0\u884c</p> <p>OC \u5f15\u5165\u4e86 runtime \u673a\u5236\uff0c\u8fd0\u884c\u65f6</p> <p>Objective-C \u7684\u52a8\u6001\u6027\u662f\u7531 Runtime API \u6765\u652f\u6301\u7684</p> <p>Runtime API \u63d0\u4f9b\u7684\u63a5\u53e3\u57fa\u672c\u90fd\u662f C \u8bed\u8a00\u7684\uff0c\u6e90\u7801\u7531 C\\C++\\\u6c47\u7f16\u8bed\u8a00\u7f16\u5199</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#isa","title":"isa \u8be6\u89e3","text":"<ul> <li>\u8981\u5b66\u4e60 Runtime\uff0c\u9996\u5148\u8981\u4e86\u89e3\u5b83\u5e95\u5c42\u7684\u4e00\u4e9b\u5e38\u7528\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982 isa \u6307\u9488</li> <li>\u5728 arm64 \u67b6\u6784\u4e4b\u524d\uff0cisa \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684\u6307\u9488\uff0c\u5b58\u50a8\u8fd9 Class\u3001Meta-Class \u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740</li> <li>\u4ece arm64 \u67b6\u6784\u5f00\u59cb\uff0c\u5bf9 isa \u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u53d8\u6210\u4e86\u4e00\u4e2a\u5171\u7528\u4f53\uff08union\uff09\u7ed3\u6784\uff0c\u8fd8\u4f7f\u7528\u4f4d\u57df\u6765\u5b58\u50a8\u66f4\u591a\u7684\u4fe1\u606f</li> </ul> <p>runtime \u4e2d object \u7684\u7ed3\u6784</p> <pre><code>struct objc_object {\nprivate:\n    isa_t isa;\n}\n\nunion isa_t {\n    isa_t() { }\n    isa_t(uintptr_t value) : bits(value) { }\n    uintptr_t bits;\nprivate:\n    // Accessing the class requires custom ptrauth operations, so\n    // force clients to go through setClass/getClass by making this\n    // private.\n    Class cls;\n\npublic:\n#if defined(ISA_BITFIELD)\n    struct {\n        ISA_BITFIELD;  // defined in isa.h\n    };\n\n    bool isDeallocating() {\n        return extra_rc == 0 &amp;&amp; has_sidetable_rc == 0;\n    }\n    void setDeallocating() {\n        extra_rc = 0;\n        has_sidetable_rc = 0;\n    }\n#endif\n\n    void setClass(Class cls, objc_object *obj);\n    Class getClass(bool authenticated);\n    Class getDecodedClass(bool authenticated);\n};\n\n# if __arm64__\n// ARM64 simulators have a larger address space, so use the ARM64e\n// scheme even when simulators build for ARM64-not-e.\n#   if __has_feature(ptrauth_calls) || TARGET_OS_SIMULATOR\n#     define ISA_MASK        0x007ffffffffffff8ULL\n#     define ISA_MAGIC_MASK  0x0000000000000001ULL\n#     define ISA_MAGIC_VALUE 0x0000000000000001ULL\n#     define ISA_HAS_CXX_DTOR_BIT 0\n#     define ISA_BITFIELD                                                      \\\n        uintptr_t nonpointer        : 1;                                       \\\n        uintptr_t has_assoc         : 1;                                       \\\n        uintptr_t weakly_referenced : 1;                                       \\\n        uintptr_t shiftcls_and_sig  : 52;                                      \\\n        uintptr_t has_sidetable_rc  : 1;                                       \\\n        uintptr_t extra_rc          : 8\n#     define RC_ONE   (1ULL&lt;&lt;56)\n#     define RC_HALF  (1ULL&lt;&lt;7)\n#   else\n#     define ISA_MASK        0x0000000ffffffff8ULL\n#     define ISA_MAGIC_MASK  0x000003f000000001ULL\n#     define ISA_MAGIC_VALUE 0x000001a000000001ULL\n#     define ISA_HAS_CXX_DTOR_BIT 1\n#     define ISA_BITFIELD                                                      \\\n        uintptr_t nonpointer        : 1;                                       \\\n        uintptr_t has_assoc         : 1;                                       \\\n        uintptr_t has_cxx_dtor      : 1;                                       \\\n        uintptr_t shiftcls          : 33; /*MACH_VM_MAX_ADDRESS 0x1000000000*/ \\\n        uintptr_t magic             : 6;                                       \\\n        uintptr_t weakly_referenced : 1;                                       \\\n        uintptr_t unused            : 1;                                       \\\n        uintptr_t has_sidetable_rc  : 1;                                       \\\n        uintptr_t extra_rc          : 19\n#     define RC_ONE   (1ULL&lt;&lt;45)\n#     define RC_HALF  (1ULL&lt;&lt;18)\n#   endif\n\n# elif __x86_64__\n#   define ISA_MASK        0x00007ffffffffff8ULL\n#   define ISA_MAGIC_MASK  0x001f800000000001ULL\n#   define ISA_MAGIC_VALUE 0x001d800000000001ULL\n#   define ISA_HAS_CXX_DTOR_BIT 1\n#   define ISA_BITFIELD                                                        \\\n      uintptr_t nonpointer        : 1;                                         \\\n      uintptr_t has_assoc         : 1;                                         \\\n      uintptr_t has_cxx_dtor      : 1;                                         \\\n      uintptr_t shiftcls          : 44; /*MACH_VM_MAX_ADDRESS 0x7fffffe00000*/ \\\n      uintptr_t magic             : 6;                                         \\\n      uintptr_t weakly_referenced : 1;                                         \\\n      uintptr_t unused            : 1;                                         \\\n      uintptr_t has_sidetable_rc  : 1;                                         \\\n      uintptr_t extra_rc          : 8\n#   define RC_ONE   (1ULL&lt;&lt;56)\n#   define RC_HALF  (1ULL&lt;&lt;7)\n\n# else\n#   error unknown architecture for packed isa\n# endif\n\n// SUPPORT_PACKED_ISA\n#endif\n\n</code></pre> <p>\u4f4d\u8fd0\u7b97 &amp;\u4e0e\uff0c|\u6216\uff0c~\u6309\u4f4d\u53d6\u53cd</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_1","title":"\u4f4d\u57df","text":"<pre><code>@interface Person()\n{\n    // \u4f4d\u57df\uff0c\u53ef\u4ee5\u6807\u660e\u6210\u5458\u53d8\u91cf\u5360\u7528\u4f4d\u6570\uff0c\n    // \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u90a3\u4e48\u6bcf\u4e2a\u6210\u5458\u53d8\u91cf\u5360\u7528\u4e00\u5b57\u8282\uff0c\u4f46\u662fchar \u5b9e\u9645\u4f7f\u7528\u7684\u53ea\u6709\u4e00\u4f4d\uff0c\u4e00\u5b57\u8282 = 8bit\n    // \u4f7f\u7528\u4f4d\u57df\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u6309\u987a\u5e8f\u6392\u5f00\uff0c\u4e0d\u9700\u8981\u6bcf\u4e2achar \u90fd\u5360\u7528\u4e00\u4e2a\u5b57\u8282\uff0c\u53ef\u4ee5\u591a\u4e2a char \u5360\u7528\u540c\u4e00\u5b57\u8282\n    struct {\n        char tall : 1 // \u6700\u53f3\u4e00\u4f4d\n        char rich : 1 // \u5012\u6570\u7b2c\u4e8c\u4f4d\n        char handsome : 1 // \u5012\u6570\u7b2c\u4e09\u4f4d\n    } __tallRichHandsome;\n}\n@end\n\n@implement:Person\n-(void) setTall:(BOOL)tall {\n    __tallRichHandsome.tall = tall;\n}\n\n-(BOOL) getTall {\n    return !!__tallRichHandsome.tall;\n}\n@end\n\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_2","title":"\u5171\u7528\u4f53","text":"<pre><code>#define TallMask (1&lt;&lt;0)\n#define RichMask (1&lt;&lt;1)\n#define HandSomeMask (1&lt;&lt;2)\n\n@interface Person()\n{\n    // \u4f7f\u7528\u5171\u7528\u4f53\u5c31\u53ef\u4ee5\u4f7f\u7528\u4f4d\u8fd0\u7b97\u8bfb\u5199\n    union{\n        // \u8fd9\u4e2a\u662f\u6839\u636e\u5b9e\u9645\u9700\u8981\u7684\u5b57\u8282\u6765\u5b9a\u4e49\u7684\uff0cmask \u4e5f\u9700\u8981\u6839\u636e\u5b9e\u9645\u5360\u7528\u7684\u7a7a\u95f4\u6765\u505a\u76f8\u5e94\u8c03\u6574\n        char bits;\n        // \u53ea\u662f\u589e\u52a0\u53ef\u8bfb\u6027\uff0c\u5728\u7a0b\u5e8f\u4e2d\u53ea\u8bbf\u95ee bits\n        struct {\n            char tall : 1 // \u6700\u53f3\u4e00\u4f4d\n            char rich : 1 // \u5012\u6570\u7b2c\u4e8c\u4f4d\n            char handsome : 1 // \u5012\u6570\u7b2c\u4e09\u4f4d\n        }\n    } __tallRichHandsome;\n}\n@end\n\n@implement:Person\n-(void) setTall:(BOOL)tall {\n    if(tall) {\n        __tallRichHandsome.bits |= TallMask;\n    } else {\n        __tallRichHandsome.bits &amp;= ~TallMask;\n    }\n}\n\n-(BOOL) getTall {\n    return !!(__tallRichHandsome.bits &amp; TallMask);\n}\n@end\n</code></pre> <p>\u901a\u8fc7\u4ee5\u4e0a\u5206\u6790\uff0c\u5728 ARM64 \u673a\u5668\u4e0a\uff0c\u6700\u7ec8\u7684 isa  \u957f\u8fd9\u6837</p> <pre><code>union isa_t {\n    isa_t() { }\n    isa_t(uintptr_t value) : bits(value) { }\n    uintptr_t bits;\nprivate:\n    // Accessing the class requires custom ptrauth operations, so\n    // force clients to go through setClass/getClass by making this\n    // private.\n    Class cls;\n    #   define ISA_MASK        0x00007ffffffffff8ULL\n\n    struct {\n        // 0\u4ee3\u8868\u666e\u901a\u6307\u9488\uff0c\u5b58\u50a8\u7740 Class\u3001Meta-Class \u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\n        // 1 \u4ee3\u8868\u4f18\u5316\u8fc7\uff0c\u4f7f\u7528\u4f4d\u57df\u5b58\u50a8\u66f4\u591a\u4fe1\u606f\n        uintptr_t nonpointer        : 1;                                       \\\n\n        // \u662f\u5426\u8bbe\u7f6e\u8fc7\u5173\u8054\u5bf9\u8c61\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u91ca\u653e\u65f6\u4f1a\u66f4\u5feb\n        uintptr_t has_assoc         : 1;                                       \\\n\n        //\u662f\u5426\u6709 C++ \u7684\u6790\u6784\u51fd\u6570\uff08.cxx_destruct\uff09\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u91ca\u653e\u65f6\u4f1a\u66f4\u5feb\n        uintptr_t has_cxx_dtor      : 1;                                       \\\n\n        // \u5b58\u50a8\u7740 Class, Meta-Class \u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u4fe1\u606f\n        uintptr_t shiftcls          : 33; /*MACH_VM_MAX_ADDRESS 0x1000000000*/ \\\n\n        // \u7528\u4e8e\u5728\u8c03\u8bd5\u65f6\u5206\u8fa8\u5bf9\u8c61\u662f\u5426\u672a\u5b8c\u6210\u521d\u59cb\u5316\n        uintptr_t magic             : 6;                                       \\\n\n        // \u662f\u5426\u6709\u88ab\u5f31\u5f15\u7528\u6307\u5411\u8fc7\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u91ca\u653e\u65f6\u4f1a\u66f4\u5feb\n        uintptr_t weakly_referenced : 1;                                       \\\n\n        // \u539f\u6765\u5b58\u50a8\u7684\u662f deallocating \u73b0\u5728\u76f4\u63a5\u4f7f\u7528 has_sidetable_rc \u548c extra_rc \u6765\u5224\u65ad\n        uintptr_t unused            : 1;                                       \\\n\n        // \u5f15\u7528\u8ba1\u6570\u5668\u662f\u5426\u8fc7\u5927\u65e0\u6cd5\u5b58\u50a8\u5728 isa \u4e2d\n        // \u5982\u679c\u4e3a1\uff0c\u90a3\u4e48\u5f15\u7528\u8ba1\u6570\u4f1a\u5b58\u50a8\u5728\u4e00\u4e2a\u53eb\u505a SideTable \u7684\u7c7b\u7684\u5c5e\u6027\u4e2d\n        uintptr_t has_sidetable_rc  : 1;                                       \\\n\n        // \u91cc\u9762\u5b58\u50a8\u7684\u503c\u662f\u5f15\u7528\u8ba1\u6570\u5668\u51cf1\n        uintptr_t extra_rc          : 19 \n    };\n</code></pre> <p>\u6240\u4ee5\u5728\u53d6 isa \u5730\u5740\u7684\u65f6\u5019\u9700\u8981\u4f7f\u7528 isa_t.bits &amp; ISA_MASK \u7531\u4e8e\u4f4d\u57df\u6700\u540e\u4e09\u4f4d\u88ab\u5176\u4ed6\u5360\u7528\uff0c\u6240\u4ee5\u901a\u8fc7 ISA_MASK \u53d6\u51fa\u7684 Class, Meta-Class \u7684\u5730\u5740\u540e\u4e09\u4f4d\u4e3a0</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_3","title":"\u4f4d\u8fd0\u7b97\u8865\u5145","text":"<p>OC \u4e2d\u8bb8\u591a\u5c5e\u6027\u6216\u8005\u53c2\u6570\u4e5f\u90fd\u662f\u901a\u8fc7\u4f4d\u8fd0\u7b97\u6765\u5b9e\u73b0\u7684 \u6bd4\u5982\u5728\u4f20\u53c2\u6216\u8005\u8bbe\u7f6e\u5c5e\u6027\u7684\u65f6\u5019\u7528 option1 | option2 | option3</p> <pre><code>typedef enum {\n    Option1 = 1, // 0b0001 1&lt;&lt;0\n    Option2 = 2, // 0b0010 1&lt;&lt;1\n    Opiont3 = 4, // 0b0100 1&lt;&lt;2\n    Opiont4 = 8, // 0b1000 1&lt;&lt;3\n} Options;\n\n[self setOptions: Options.Option1 | Options.Option2 | Options.Option3]\n\n-(void)setOptions:(Options)options {\n    if (otions &amp; Option1){\n        NSLog(@\"\u5305\u542b option1 \")\n    } \n    if(otions &amp; Option2) {\n        NSLog(@\"\u5305\u542b option2 \")\n    }\n    ......\n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#class","title":"Class \u7684\u7ed3\u6784","text":"<pre><code>// isa_t \u7ed3\u6784\nunion isa_t {\n    isa_t() { }\n    isa_t(uintptr_t value) : bits(value) { }\n\n    uintptr_t bits;\n\nprivate:\n    // \u901a\u8fc7 setClass/getClass \u8bfb\u5199\u503c\n    Class cls;\n\npublic:\n#if defined(ISA_BITFIELD)\n    struct {\n        ISA_BITFIELD;  // defined in isa.h\n    };\n#endif\n};\n\n// objc_object \u7ed3\u6784\nstruct objc_object {\nprivate:\n    isa_t isa;\n}\n\n// objc_class \u7ed3\u6784\nstruct objc_class : objc_object {\n    Class superclass;\n    cache_t cache;             // formerly cache pointer and vtable\n    class_data_bits_t bits;    \n}\n\n// class_data_bits_t \u7684\u5b9a\u4e49\n// \u91cc\u9762\u901a\u8fc7 bits &amp; FAST_DATA_MASK \u62ff\u5230 class_rw_t \u7684\u5730\u5740\nstruct class_data_bits_t {\n    friend objc_class;\n\n    // Values are the FAST_ flags above.\n    uintptr_t bits;\nprivate:\n    bool getBit(uintptr_t bit) const\n    {\n        return bits &amp; bit;\n    }\n\npublic:\n\n    class_rw_t* data() const {\n        return (class_rw_t *)(bits &amp; FAST_DATA_MASK);\n    }\n\n    const class_ro_t *safe_ro() const {\n        class_rw_t *maybe_rw = data();\n        if (maybe_rw-&gt;flags &amp; RW_REALIZED) {\n            // maybe_rw is rw\n            return maybe_rw-&gt;ro();\n        } else {\n            // maybe_rw is actually ro\n            return (class_ro_t *)maybe_rw;\n        }\n    }\n};\n\n// class_rw_t\n// \u73b0\u5728\u7684class_rw_t \u8ddf\u4e4b\u524d\u7684\u5df2\u7ecf\u6709\u5f88\u5927\u7684\u4e0d\u540c\uff0ciOS14 \u4e4b\u524d\u539f\u6765\u7684 class_rw_t\uff0c\u5b58\u50a8\u4e86\u6240\u6709\u53ef\u4ee5\u4fee\u6539\u7684\u4fe1\u606f\n// iOS14 \u4e4b\u540e\uff0c\u5df2\u7ecf\u4f18\u5316\u4e86\uff0c\u628a\u4e00\u5b9a\u4f1a\u88ab\u4fee\u6539\u7684\u653e\u5230\u4e86 class_rw_t \u5185\n// \u4e0d\u662f\u4e00\u5b9a\u4f1a\u88ab\u4fee\u6539\u7684\u5185\u5bb9 \u62bd\u5230\u4e86 class_rw_ext_t \u53ea\u6709\u7528\u5230\u7684\u65f6\u5019\u624d\u4f1a\u521d\u59cb\u5316\n// \u901a\u8fc7 explicit_atomic&lt;uintptr_t&gt; ro_or_rw_ext; \u52a8\u6001\u7684\u7684\u5b58\u50a8 class_ro_t \u6216\u8005 class_rw_ext_t \u7684\u5730\u5740\n// \u5982\u679c\u6709 class_rw_ext_t\uff0c\u90a3\u4e48\u4f1a\u901a\u8fc7 class_rw_ext_t \u4e2d\u7684 ro \u6765\u6307\u5411 class_ro_t\n// \u5982\u679c\u6ca1\u6709 class_rw_ext_t\uff0cclass_rw_t \u4e2d\u7684 explicit_atomic&lt;uintptr_t&gt; ro_or_rw_ext \u4f1a\u76f4\u63a5\u6307\u5411 class_ro_t\n\nstruct class_rw_t {\n    // Be warned that Symbolication knows the layout of this structure.\n    uint32_t flags;\n    uint16_t witness;\n#if SUPPORT_INDEXED_ISA\n    uint16_t index;\n#endif\n\n    explicit_atomic&lt;uintptr_t&gt; ro_or_rw_ext;\n\n    Class firstSubclass;\n    Class nextSiblingClass;\nprivate:   \n    //  \u5b9e\u73b0\u8054\u5408\u4fdd\u5b58\u4e24\u79cd\u4e0d\u540c\u7684\u53ef\u533a\u5206\u7c7b\u578b\u7684\u6307\u9488,\u5c06\u533a\u5206\u4f4d\u4fdd\u5b58\u5728\u6307\u9488\u7684\u6700\u4f4e\u4f4d\n    // \u6bd4\u5982 \u4e24\u79cd\u7684\u8bdd\u662f PointerUnion \u6700\u540e\u4e00\u4f4d\u6765\u4fdd\u5b58\u7c7b\u578b\uff0c \u56db\u79cd\u7684\u8bdd\u662f PointerUnion4 \u540e\u4e24\u4f4d\u6765\u4fdd\u5b58\u7c7b\u578b\n    using ro_or_rw_ext_t = objc::PointerUnion&lt;const class_ro_t, class_rw_ext_t, PTRAUTH_STR(\"class_ro_t\"), PTRAUTH_STR(\"class_rw_ext_t\")&gt;;\npublic:\n    class_rw_ext_t *extAllocIfNeeded() {\n        auto v = get_ro_or_rwe();\n        if (fastpath(v.is&lt;class_rw_ext_t *&gt;())) {\n            return v.get&lt;class_rw_ext_t *&gt;(&amp;ro_or_rw_ext);\n        } else {\n            return extAlloc(v.get&lt;const class_ro_t *&gt;(&amp;ro_or_rw_ext));\n        }\n    }\n\n    void set_ro_or_rwe(class_rw_ext_t *rwe, const class_ro_t *ro) {\n        // the release barrier is so that the class_rw_ext_t::ro initialization\n        // is visible to lockless readers\n        rwe-&gt;ro = ro;\n        ro_or_rw_ext_t{rwe, &amp;ro_or_rw_ext}.storeAt(ro_or_rw_ext, memory_order_release);\n    }\n}\n\n// class_rw_ext_t \u6309\u9700\u521d\u59cb\u5316\uff0c\u53ea\u6709\u5bf9\u5176\u4e2d\u5305\u542b\u7684\u6210\u5458\u8fdb\u884c\u4fee\u6539\u65f6\u624d\u4f1a\u521d\u59cb\u5316\n// cls-&gt;data()-&gt;extAllocIfNeeded() \u5b9e\u9645\u4e0a\u5c31\u662f\u901a\u8fc7 class_rw_t \u4e2d\u7684\u65b9\u6cd5\u6765\u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5982\u679c\u6709\u5219\u521d\u59cb\u5316\u5b8c\u4e4b\u540e\u8fd4\u56de\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u521d\u59cb\u5316\u5e76\u8fd4\u56de\nstruct class_rw_ext_t {\n    DECLARE_AUTHED_PTR_TEMPLATE(class_ro_t)\n    class_ro_t_authed_ptr&lt;const class_ro_t&gt; ro;\n    method_array_t methods;\n    property_array_t properties;\n    protocol_array_t protocols;\n    char *demangledName;\n    uint32_t version;\n};\n\n// class_rw_ext_t \u7684\u521d\u59cb\u5316\u65b9\u6cd5\n// \u53ef\u4ee5\u770b\u5230 class_rw_ext_t \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u5c06 class_ro_t \u4e2d\u7684\u73b0\u6709\u7684\u503c\u5168\u90e8\u6dfb\u52a0\u5230\u4e86 class_rw_ext_t \u4e2d\n\nclass_rw_ext_t *\nclass_rw_t::extAlloc(const class_ro_t *ro, bool deepCopy)\n{\n    runtimeLock.assertLocked();\n\n    auto rwe = objc::zalloc&lt;class_rw_ext_t&gt;();\n\n    rwe-&gt;version = (ro-&gt;flags &amp; RO_META) ? 7 : 0;\n\n    method_list_t *list = ro-&gt;baseMethods();\n    if (list) {\n        if (deepCopy) list = list-&gt;duplicate();\n        rwe-&gt;methods.attachLists(&amp;list, 1);\n    }\n\n    // See comments in objc_duplicateClass\n    // property lists and protocol lists historically\n    // have not been deep-copied\n    //\n    // This is probably wrong and ought to be fixed some day\n    property_list_t *proplist = ro-&gt;baseProperties;\n    if (proplist) {\n        rwe-&gt;properties.attachLists(&amp;proplist, 1);\n    }\n\n    protocol_list_t *protolist = ro-&gt;baseProtocols;\n    if (protolist) {\n        rwe-&gt;protocols.attachLists(&amp;protolist, 1);\n    }\n    // \u901a\u8fc7 set_ro_or_rwe \u5c06 rwe \u5730\u5740\u8d4b\u503c\u7ed9 ro_or_rw_ext\uff0cclass_rw_ext_t \u7684 ro \u6307\u5411 class_rw_t\n    set_ro_or_rwe(rwe, ro);\n    return rwe;\n}\n\n// class_ro_t \u6253\u6b7b\u90fd\u4e0d\u4f1a\u52a8\u7684\uff0c\u4e0d\u4f1a\u6709\u4efb\u4f55\u53d8\u5316\nstruct class_ro_t {\n    uint32_t flags;\n    uint32_t instanceStart;\n    uint32_t instanceSize;\n#ifdef __LP64__\n    uint32_t reserved;\n#endif\n\n    union {\n        const uint8_t * ivarLayout;\n        Class nonMetaclass;\n    };\n\n    explicit_atomic&lt;const char *&gt; name;\n    // With ptrauth, this is signed if it points to a small list, but\n    // may be unsigned if it points to a big list.\n    void *baseMethodList;\n    protocol_list_t * baseProtocols;\n    const ivar_list_t * ivars;\n\n    const uint8_t * weakIvarLayout;\n    property_list_t *baseProperties;\n}\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u5206\u6790\u53ef\u4ee5\u5f97\u5230</p> <p>objc_object \u901a\u8fc7\u5171\u7528\u4f53\uff0c\u4f4d\u57df\uff0c\u5b58\u50a8\u4e86 isa \u6307\u9488\uff0c\u901a\u8fc7<code>isa_t.bits &amp; ISA_MASK</code> \u5f97\u5230 \u7c7b\u5bf9\u8c61\u5730\u5740\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6 mask \u83b7\u5f97\u7c7b\u5bf9\u8c61\u7684\u5176\u4ed6\u4fe1\u606f</p> <p>objc_class \u7ee7\u627f\u81ea objc_object\uff0c\u5176\u4e2d\u5b58\u50a8\u7740 <code>Class superclass</code>\uff0c<code>cache_t cache</code>\uff0c <code>class_data_bits_t bits</code>\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u4ece objc_object \u7ee7\u627f\u6765\u7684 <code>isa_t isa</code>\uff0c</p> <p>\u5176\u4e2d <code>class_data_bits_t</code> (\u4e5f\u662f\u901a\u8fc7\u4f4d\u57df\u6765\u5b58\u50a8\u4fe1\u606f) \u4e2d\u53ef\u4ee5\u901a\u8fc7 <code>bits &amp; FAST_DATA_MASK</code> \u62ff\u5230 <code>class_rw_t</code> \u7684\u5730\u5740\uff0c\u5f53\u7136\u4ece\u5916\u90e8\u662f\u76f4\u63a5\u901a\u8fc7 <code>class_data_bits_t-&gt;data()</code> \u6765\u76f4\u63a5\u83b7\u53d6\u5230 <code>class_rw_t</code> \u7684\u5730\u5740\uff0c\u5916\u90e8\u5e76\u4e0d\u5173\u5fc3\u4f60\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff0c\u53ea\u8981\u62ff\u5230\u81ea\u5df1\u9700\u8981\u7684\u4fe1\u606f\u5c31OK</p> <p>\u7136\u540e\u5c31\u662f <code>class_rw_t</code>\uff0ciOS14 \u4e4b\u524d\uff0c<code>class_rw_t</code> \u51e0\u4e4e\u5b58\u50a8\u4e86\u6240\u6709\u80fd\u5728\u8fd0\u884c\u65f6\u88ab\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u5c3d\u7ba1\u5927\u90e8\u5206\u7c7b\u5e76\u4e0d\u4f1a\u5bf9\u5176\u4f5c\u51fa\u6539\u53d8\uff0c \u73b0\u5728 <code>class_rw_t</code> \u4ec5\u5b58\u50a8\u4e86\u4e00\u4e9b\u4e00\u5b9a\u4f1a\u6539\u53d8\u7684\u5185\u5bb9\uff0c\u800c\u4e0d\u4e00\u5b9a\u9700\u8981\u4fee\u6539\u7684\u5185\u5bb9\u5219\u653e\u5230\u4e86 <code>class_rw_ext_t</code> \u4e2d\u6309\u9700\u505a\u521d\u59cb\u5316 <code>class_rw_t</code>\u4e2d\u5b58\u50a8\u4e86 <code>uint32_t flags;</code>, <code>uint16_t witness;</code>, <code>uint16_t index;</code>, <code>explicit_atomic&lt;uintptr_t&gt; ro_or_rw_ext;</code>, <code>Class firstSubclass;</code>, <code>Class nextSiblingClass;</code></p> <p><code>explicit_atomic&lt;uintptr_t&gt; ro_or_rw_ext;</code> \u901a\u8fc7 UnionPointer \u6765\u5b9e\u73b0\u5b58\u50a8\u4e24\u79cd\u4e0d\u540c\u7684\u53ef\u533a\u5206\u7c7b\u578b\u7684\u6307\u9488,\u5c06\u533a\u5206\u4f4d\u4fdd\u5b58\u5728\u6307\u9488\u7684\u6700\u4f4e\u4f4d\uff0c\u5b83\u6240\u5b58\u50a8\u7684\u7c7b\u578b\u4e3a \u5982\u679c\u6ca1\u6709 <code>class_rw_ext_t</code> \u5219\u4e3a <code>class_ro_t</code>, \u5426\u5219\u4e3a <code>class_rw_ext_t</code></p> <p>\u540c\u65f6 <code>class_rw_t</code> \u4e5f\u63d0\u4f9b\u4e86\u65b9\u6cd5\u6765\u521d\u59cb\u5316 <code>class_rw_ext_t</code> \u7b49\u7684\u4e00\u4e9b\u65b9\u6cd5</p> <p><code>class_rw_ext_t</code>\u4e2d\u5b58\u50a8\u4e86<code>class_ro_t_authed_ptr&lt;const class_ro_t&gt; ro;</code>, <code>method_array_t methods;</code>, <code>property_array_t properties;</code>, <code>protocol_array_t protocols;</code>, <code>char *demangledName;</code>, <code>uint32_t version;</code> \u8fd9\u4e9b\u4fe1\u606f\u3002</p> <p>\u5982\u679c\u6709 <code>class_rw_ext_t</code>\uff0c\u90a3\u4e48\u5219\u7531\u5176\u4e2d\u7684 <code>ro</code> \u6765\u6307\u5411 <code>class_ro_t</code></p> <p><code>class_rw_ext_t</code> \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u5c06 <code>class_ro_t</code> \u4e2d\u7684\u76f8\u5173\u4fe1\u606f\u5b58\u8fc7\u6765\u4e00\u4efd\uff0c\u5728 <code>imageLoad</code> \u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6709\u5206\u7c7b\u5c31\u76f4\u63a5\u5728 <code>mapImages</code> \u7684\u65f6\u5019\u5c31\u521d\u59cb\u5316\u4e86 <code>class_rw_ext_t</code>\uff0c\u5e76\u5c06\u5206\u7c7b\u4e2d\u7684\u4fe1\u606f\u50a8\u5b58\u8fdb\u6765</p> <p><code>class_ro_t</code> \u4e2d\u5c31\u5b58\u50a8\u4e86 class \u7684\u521d\u59cb\u4fe1\u606f\uff0c\u53ea\u8bfb\uff0c\u76f4\u63a5\u53bb\u4e0a\u9762\u4ee3\u7801\u4e2d\u770b\u5427</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#method","title":"\u65b9\u6cd5 method","text":"<pre><code>typedef id _Nullable (*IMP)(id _Nonnull, SEL _Nonnull, ...); \n\nstruct method_t {\n    SEL name; // \u51fd\u6570\u540d\n    const char *types; // \u7f16\u7801 \uff08\u8fd4\u56de\u503c\u7c7b\u578b\uff0c\u53c2\u6570\u7c7b\u578b\uff09\n    IMP imp; // \u6307\u5411\u51fd\u6570\u7684\u6307\u9488\uff08\u51fd\u6570\u5730\u5740\uff09\n}\n</code></pre> <ul> <li> <p>IMP \u4ee3\u8868\u51fd\u6570\u7684\u5177\u4f53\u5b9e\u73b0</p> </li> <li> <ul> <li><code>typedef id _Nullable (*IMP)(id _Nonnull, SEL _Nonnull, ...);</code></li> </ul> </li> <li> <p>SEL \u4ee3\u8868\u65b9\u6cd5\\\u51fd\u6570\u540d\uff0c\u4e00\u822c\u53eb\u505a\u9009\u62e9\u5668\uff0c\u5e95\u5c42\u7ed3\u6784\u8ddf <code>char *</code> \u7c7b\u4f3c</p> </li> <li> <ul> <li>\u901a\u8fc7 @selector \u6216\u8005 sel_registerName \u83b7\u5f97</li> </ul> </li> <li> <ul> <li>\u53ef\u4ee5\u901a\u8fc7 sel_getName \u548c NSStringFromSelector \u8f6c\u6210\u5b57\u7b26\u4e32</li> </ul> </li> <li> <ul> <li>\u4e0d\u540c\u7c7b\u4e2d\u7684\u76f8\u540c\u540d\u5b57\u7684\u65b9\u6cd5\uff0c\u6240\u5bf9\u5e94\u7684\u65b9\u6cd5\u9009\u62e9\u5668\u662f\u76f8\u540c\u7684</li> </ul> </li> <li> <ul> <li>types \u5305\u542b\u4e86\u8fd4\u51fd\u6570\u8fd4\u56de\u503c\u3001\u53c2\u6570\u7f16\u7801\u7684\u5b57\u7b26\u4e32 </li> </ul> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#type-encoding","title":"Type Encoding","text":"<p>iOS \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53eb\u505a @encode \u7684\u6307\u4ee4\uff0c\u53ef\u4ee5\u5c06\u5177\u4f53\u7c7b\u578b \u8868\u793a\u6210\u5b57\u7b26\u4e32\u7f16\u7801</p> <p>\u5b98\u65b9\u6587\u6863\u5730\u5740</p> <pre><code>// types = i24@0:8i16f20\n// i    \u8fd4\u56de\u503cint\n// 24   \u53c2\u6570\u603b\u5927\u5c0f\n// @0   id\u4ece0\u5f00\u59cb\uff0c\u53608\u5b57\u8282\n// :8   SEL\u4eceid\u7ed3\u5c3e\u5f00\u59cb\uff0c\u53608\u5b57\u8282\n// i16  age \u4ece16\u5f00\u59cb\uff0c\u53604\u5b57\u8282\n// f20  height \u4ece20\u5f00\u59cb\uff0c\u53604\u5b57\u8282\n// \u65b9\u6cd5\u9ed8\u8ba4\u4e24\u4e2a\u53c2\u6570 id cmd\n-(int) test:(int) age height:(float)height;\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_4","title":"\u65b9\u6cd5\u7f13\u5b58","text":"<p>Class \u5185\u90e8\u7ed3\u6784\u4e2d\u6709\u4e2a\u65b9\u6cd5\u7f13\u5b58 \uff08cache_t\uff09\uff0c\u7528\u6563\u5217\u8868\u6765\u7f13\u5b58\u66fe\u7ecf\u8c03\u7528\u8fc7\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u63d0\u9ad8\u65b9\u6cd5\u67e5\u627e\u901f\u5ea6</p> <p></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#msgsend","title":"msgSend","text":"<p>OC \u65b9\u6cd5\u8c03\u7528\u6700\u7ec8\u4f1a\u8f6c\u5316\u4e3a objc_msgSend \u7684\u6d88\u606f\u673a\u5236\uff0c\u7ed9\u65b9\u6cd5\u8c03\u7528\u8005\u53d1\u9001\u6d88\u606f</p> <ul> <li> <p>objc_msgSend \u7684\u6267\u884c\u6d41\u7a0b\u5206\u4e3a\u4e09\u5927\u9636\u6bb5</p> </li> <li> <p>\u6d88\u606f\u53d1\u9001</p> </li> <li>\u52a8\u6001\u65b9\u6cd5\u89e3\u6790</li> <li>\u6d88\u606f\u8f6c\u53d1</li> <li>throw error (unreconized selector send to instance)</li> </ul> <pre><code>ENTRY _objc_msgSend\n    UNWIND _objc_msgSend, NoFrame\n\n    // p0 \u5bc4\u5b58\u5668\uff1areceiver\n    cmp p0, #0          // \u6bd4\u8f83\u6307\u4ee4\uff0c\u6bd4\u8f83 receiver \u5730\u5740\u4e0e #0 \u7684\u5927\u5c0f\n#if SUPPORT_TAGGED_POINTERS\n    b.le    LNilOrTagged        // receiver \u5730\u5740 \u5c0f\u4e8e\u7b49\u4e8e 0\uff0c\u7531\u4e8e taggedPointer \u7684\u6700\u9ad8\u4f4d\u4e3a 1\uff0c\u6240\u4ee5\u7b49\u4e8e 1 \u4e3a taggedPointer\uff0c\u7b49\u4e8e0\u4e3a nil\uff0c\u8c03\u7528 LNilOrTagged\n#else\n    b.eq    LReturnZero         // \u4e0d\u652f\u6301 taggedPointer\uff0c\u90a3\u5c31\u76f4\u63a5\u5224\u7a7a\u5c31\u53ef\u4ee5\u4e86\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u53bb\u4ece taggedPointer \u62ff\u503c\u518d\u5f80\u4e0b\u8d70\u7684\u60c5\u51b5\uff0c\u76f4\u63a5\u8c03\u7528 LReturnZero\n#endif\n    ldr p13, [x0]       // p13 = isa // \u5c06 [x0] \u4e2d\u7684\u4fe1\u606f\u8bfb\u53d6\u5230 p13\n    GetClassFromIsa_p16 p13, 1, x0  // p16 = class\nLGetIsaDone:\n    // calls imp or objc_msgSend_uncached\n    CacheLookup NORMAL, _objc_msgSend, __objc_msgSend_uncached // \u67e5\u627e\u7f13\u5b58\n\n#if SUPPORT_TAGGED_POINTERS\nLNilOrTagged:\n    b.eq    LReturnZero     // nil check\n    GetTaggedClass\n    b   LGetIsaDone\n// SUPPORT_TAGGED_POINTERS\n#endif\n\nLReturnZero:\n    // x0 is already zero\n    mov x1, #0\n    movi    d0, #0\n    movi    d1, #0\n    movi    d2, #0\n    movi    d3, #0\n    ret                 // return\n\n    END_ENTRY _objc_msgSend\n</code></pre> <p>CacheLookup \u4e2d\u5c31\u5b9e\u73b0\u4e86\u4ece\u7f13\u5b58\u4e2d\u67e5\u627e\u5df2\u7ecf\u7f13\u5b58\u65b9\u6cd5\uff0c\u5047\u5982\u627e\u4e0d\u5230\u5c31\u4f1a\u8c03\u7528\u5230 <code>__objc_msgSend_uncached</code> <code>__objc_msgSend_uncached</code> \u53c8\u53bb\u8c03\u7528\u4e86 <code>MethodTableLookup</code> <code>MethodTableLookup</code> \u7ee7\u7eed\u8c03\u7528 <code>_lookUpImpOrForward</code></p> <p>\u7136\u540e\u6211\u4eec\u56de\u5230 C++ \u4e2d\u67e5\u770b <code>lookUpImpOrForward</code> \u65b9\u6cd5</p> <pre><code>IMP lookUpImpOrForward(id inst, SEL sel, Class cls, int behavior)\n{\n    const IMP forward_imp = (IMP)_objc_msgForward_impcache;\n    IMP imp = nil;\n    Class curClass;\n\n    runtimeLock.assertUnlocked();\n\n    if (slowpath(!cls-&gt;isInitialized())) {\n        // The first message sent to a class is often +new or +alloc, or +self\n        // which goes through objc_opt_* or various optimized entry points.\n        //\n        // However, the class isn't realized/initialized yet at this point,\n        // and the optimized entry points fall down through objc_msgSend,\n        // which ends up here.\n        //\n        // We really want to avoid caching these, as it can cause IMP caches\n        // to be made with a single entry forever.\n        //\n        // Note that this check is racy as several threads might try to\n        // message a given class for the first time at the same time,\n        // in which case we might cache anyway.\n        behavior |= LOOKUP_NOCACHE;\n    }\n\n    // runtimeLock is held during isRealized and isInitialized checking\n    // to prevent races against concurrent realization.\n\n    // runtimeLock is held during method search to make\n    // method-lookup + cache-fill atomic with respect to method addition.\n    // Otherwise, a category could be added but ignored indefinitely because\n    // the cache was re-filled with the old value after the cache flush on\n    // behalf of the category.\n\n    runtimeLock.lock();\n\n    // We don't want people to be able to craft a binary blob that looks like\n    // a class but really isn't one and do a CFI attack.\n    //\n    // To make these harder we want to make sure this is a class that was\n    // either built into the binary or legitimately registered through\n    // objc_duplicateClass, objc_initializeClassPair or objc_allocateClassPair.\n    checkIsKnownClass(cls);\n\n    cls = realizeAndInitializeIfNeeded_locked(inst, cls, behavior &amp; LOOKUP_INITIALIZE);\n    // runtimeLock may have been dropped but is now locked again\n    runtimeLock.assertLocked();\n    curClass = cls;\n\n    // The code used to lookup the class's cache again right after\n    // we take the lock but for the vast majority of the cases\n    // evidence shows this is a miss most of the time, hence a time loss.\n    //\n    // The only codepath calling into this without having performed some\n    // kind of cache lookup is class_getInstanceMethod().\n\n    for (unsigned attempts = unreasonableClassCount();;) {\n        if (curClass-&gt;cache.isConstantOptimizedCache(/* strict */true)) {\n#if CONFIG_USE_PREOPT_CACHES\n\n\n            imp = cache_getImp(curClass, sel);\n            if (imp) goto done_unlock;\n\n            curClass = curClass-&gt;cache.preoptFallbackClass();\n#endif\n        } else {\n            // \u67e5\u627e\u4f20\u5165\u5bf9\u8c61\u7684\u7c7b\u5bf9\u8c61\u4e2d\u662f\u5426\u6709\u8be5\u65b9\u6cd5\uff0c\u5982\u679c\u6709\uff0c\u62ff\u5230 imp \u76f4\u63a5\u8df3\u8f6c\u5230 done\n            // curClass method list.\n            Method meth = getMethodNoSuper_nolock(curClass, sel);\n            if (meth) {\n                imp = meth-&gt;imp(false);\n                goto done;\n            }\n\n            // \u5982\u679c\u4ece\u81ea\u5df1\u65b9\u6cd5\u5217\u8868\u4e2d\u627e\u4e0d\u5230\u7684\u8bdd\uff0c\u5c31\u62ff\u5230 superClass\uff0c\n            // \u5982\u679c superClass \u662f\u7a7a\uff0c\u90a3\u4e48\u5c31\u8fd4\u56de forward_imp\n            if (slowpath((curClass = curClass-&gt;getSuperclass()) == nil)) {\n                // No implementation found, and method resolver didn't help.\n                // Use forwarding.\n                imp = forward_imp;\n                break;\n            }\n        }\n\n        // Halt if there is a cycle in the superclass chain.\n        if (slowpath(--attempts == 0)) {\n            _objc_fatal(\"Memory corruption in class list.\");\n        }\n        // \u770b\u4e00\u4e0b superClass \u7684cache \u4e2d\u6709\u6ca1\u6709\u5b9e\u73b0\uff0c\u6709\u5c31\u8df3\u51fa\u5faa\u73af\u7ee7\u7eed\u5f80\u4e0b\u8d70\n        // Superclass cache.\n        imp = cache_getImp(curClass, sel);\n        // \u5047\u5982\u7236\u7c7b\u4e2d\u8fd4\u56de\u7684\u5c31\u662f forward_imp\uff0c\u90a3\u76f4\u63a5\u8df3\u51fa\u5faa\u73af\u7ee7\u7eed\u5f80\u4e0b\u8d70\n        if (slowpath(imp == forward_imp)) {\n            // Found a forward:: entry in a superclass.\n            // Stop searching, but don't cache yet; call method\n            // resolver for this class first.\n            break;\n        }\n        // \u5982\u679c\u627e\u5230\u5b9e\u73b0\u7684\u8bdd\uff0c\u90a3\u5c31\u8df3\u8f6c\u5230 done\n        if (fastpath(imp)) {\n            // Found the method in a superclass. Cache it in this class.\n            goto done;\n        }\n    }\n\n    // No implementation found. Try method resolver once.\n\n    if (slowpath(behavior &amp; LOOKUP_RESOLVER)) {\n        behavior ^= LOOKUP_RESOLVER;\n        return resolveMethod_locked(inst, sel, cls, behavior);\n    }\n\n done:\n    if (fastpath((behavior &amp; LOOKUP_NOCACHE) == 0)) {\n#if CONFIG_USE_PREOPT_CACHES\n        while (cls-&gt;cache.isConstantOptimizedCache(/* strict */true)) {\n            cls = cls-&gt;cache.preoptFallbackClass();\n        }\n#endif\n        // \u5c06\u627e\u5230\u7684 imp \u6dfb\u52a0\u5230\u7f13\u5b58\n        log_and_fill_cache(cls, imp, sel, inst, curClass);\n    }\n done_unlock:\n    runtimeLock.unlock();\n    if (slowpath((behavior &amp; LOOKUP_NIL) &amp;&amp; imp == forward_imp)) {\n        return nil;\n    }\n    // \u8fd4\u56de\n    return imp;\n}\n</code></pre> <ul> <li>\u6d88\u606f\u53d1\u9001 </li> <li> <ol> <li>\u6d88\u606f\u63a5\u53d7\u8005\u4e3a nil\uff0c\u4e5f\u5c31\u662f\u65b9\u6cd5\u8c03\u7528\u8005\uff0c\u662f\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u7ee7\u7eed</li> </ol> </li> <li> <ol> <li>\u67e5\u627e\u662f\u5426\u6709cache, \u6709\uff0c\u76f4\u63a5\u8c03\u7528\u5e76\u8fd4\u56de\uff0c\u6ca1\u6709\u7ee7\u7eed\u5f80\u4e0b\u8d70</li> </ol> </li> <li> <ol> <li>\u67e5\u627e\u7c7b\u6216\u8005\u7236\u7c7b\u662f\u5426\u6709\u5b9e\u73b0\uff0c\u6709\u76f4\u63a5\u8c03\u7528\u5b58\u5165\u7f13\u5b58\uff0c\u5e76\u8fd4\u56de</li> </ol> </li> <li> <ol> <li>\u90fd\u6ca1\u6709\uff0c\u90a3\u5c31\u8fdb\u5165\u52a8\u6001\u65b9\u6cd5\u89e3\u6790 </li> </ol> </li> <li>\u6d88\u606f\u52a8\u6001\u89e3\u6790</li> <li> <ol> <li>\u8c03\u7528 <code>resolveInstanceMethod</code> \u6216\u8005 <code>resolveClassMethod</code>, \u5411receiver \u4e2d\u6dfb\u52a0\u65b9\u6cd5\u5e76\u8fd4\u56de <code>BOOL</code> \u503c\uff08\u8fd4\u56de\u4e0d\u505a\u5176\u4ed6\u7528\u9014\uff0c\u53ea\u7528\u6765\u6253\u5370\uff09</li> </ol> </li> <li> <ol> <li>\u7ee7\u7eed\u4e0a\u9762\u7684\u67e5\u627e\u6b65\u9aa4\uff0c\u627e\u5230\u7b2c\u4e00\u6b65\u4e2d\u52a8\u6001\u6dfb\u52a0\u7684\u5b9e\u73b0\uff0c\u8c03\u7528\uff0c\u7f13\u5b58\uff0c\u5e76\u8fd4\u56de\uff0c\u627e\u4e0d\u5230\u5219\u5230\u6d88\u606f\u8f6c\u53d1\u9636\u6bb5 </li> </ol> </li> <li>\u6d88\u606f\u8f6c\u53d1</li> <li> <ol> <li>\u8c03\u7528 <code>forwardingTargetForSelector</code>\uff0c\u5e76\u8fd4\u56de\u5c06\u6d88\u606f\u8f6c\u53d1\u7ed9\u54ea\u4e2a\u5bf9\u8c61\uff0c\u5982\u679c\u8fd4\u56de\u503c\u4e0d\u4e3a <code>nil</code>\uff0c\u76f4\u63a5\u5c06\u6d88\u606f\u53d1\u9001\u7ed9\u8fd4\u56de\u7684\u5bf9\u8c61\u53bb\u505a\u5904\u7406\uff0c\u5982\u679c\u8fd4\u56de\u4e3a <code>nil</code> \u7ee7\u7eed\u5f80\u4e0b\u8d70</li> </ol> </li> <li> <ol> <li>\u8c03\u7528 <code>methodSignatureForSelector</code>\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u65b9\u6cd5\u7b7e\u540d\uff0c\u4e5f\u5c31\u662f types\uff0c <code>v16@0:8</code>\u8fd9\u4e2a\u73a9\u610f\u513f\uff0c\u5982\u679c\u8fd4\u56de\u4e0d\u4e3a <code>nil</code> \u5219\u8df3\u8f6c\u5230\u7b2c 3 \u6b65\uff0c \u5426\u5219\u8df3\u8f6c\u5230\u7b2c 4 \u6b65</li> </ol> </li> <li> <ol> <li>\u8c03\u7528 <code>forwardInvocation</code>\u65b9\u6cd5\uff0c\u53ea\u8981\u8fdb\u5165\u8be5\u65b9\u6cd5\uff0c\u65e0\u8bba\u505a\u4ec0\u4e48\u4e8b\u60c5\u90fd\u6ca1\u6709\u5173\u7cfb</li> </ol> </li> <li> <ol> <li>\u8c03\u7528 <code>doesNotRecognizeSelector</code>\u65b9\u6cd5\uff0c\u5982\u679c\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u65b9\u6cd5\u90a3\u4e48\u5c31\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5982\u679c\u6ca1\u6709\u5b9e\u73b0\uff0c\u90a3\u4e48\u76f4\u63a5\u8c03\u7528\u9ed8\u8ba4\u7684\u5b9e\u73b0\uff0c\u629b\u51fa unrecognized selector \u7684\u9519\u8bef </li> </ol> </li> </ul> <p>instance method</p> <pre><code>+ (BOOL) resolveInstanceMethod:(SEL)sel\n- (id)forwardingTargetForSelector:(SEL)aSelector // \u8fd4\u56de\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u5f53\u7136\u5982\u679c\u5b9e\u73b0\u4e86\u76f8\u5e94\u7684\u7c7b\u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd4\u56de\u7c7b\u5bf9\u8c61\u4e5f\u662f\u53ef\u4ee5\u7684\n- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector\n- (void)forwardInvocation:(NSInvocation *)anInvocation\n</code></pre> <p>class method</p> <pre><code>+ (BOOL) resolveClassMethod:(SEL)sel\n+ (id)forwardingTargetForSelector:(SEL)aSelector // \u8fd4\u56de\u7c7b\u5bf9\u8c61\uff0c\u5f53\u7136\u5982\u679c\u5b9e\u73b0\u4e86\u76f8\u5e94\u7684\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u90a3\u4e48\u8fd4\u56de\u5b9e\u4f8b\u5bf9\u8c61\u4e5f\u662f\u53ef\u4ee5\u7684\n+ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector\n+ (void)forwardInvocation:(NSInvocation *)anInvocation\n</code></pre> <p>@dynamic \u662f\u544a\u8bc9\u7f16\u8bd1\u5668\u4e0d\u7528\u81ea\u52a8\u751f\u6210 getter \u548c setter \u7684\u5b9e\u73b0\uff0c\u800c\u662f\u5230\u8fd0\u884c\u65f6\u5728\u6dfb\u52a0\u5b9e\u73b0</p> <p>@synthesize age=_age \u544a\u8bc9\u7f16\u8bd1\u5668\u81ea\u52a8\u751f\u6210 \u6210\u5458\u53d8\u91cf\u53ca getter \u548c setter \u7684\u5b9e\u73b0\uff0c\u7f16\u8bd1\u5668\u5df2\u7ecf\u81ea\u52a8\u5904\u7406\uff0c\u4e0d\u9700\u8981\u5199\u51fa\u6765</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#super","title":"super","text":"<p>\u4e00\u4e2a\u95ee\u9898\u5f15\u53d1\u7684\u601d\u8003</p> <pre><code>@interface Person : NSObject\n-(void) run;\n@end\n\n@implementation Person\n-(void) run{\n    NSLog(@\"Person run\");\n}\n@end\n\n@interface Student : Person\n-(void)eat;\n@end\n@implementation Student\n- (instancetype)init{\n    if(self=[super init]){\n        NSLog(@\"[self class] %@\", [self class]); // [self class] Student\n        NSLog(@\"[self superClass] %@\", [self superclass]); // [self superClass] Person\n\n        NSLog(@\"[super class] %@\", [super class]); // [super class] Student\n        NSLog(@\"[super superClass] %@\", [super superclass]); // [super superClass] Person\n    }\n    return self;\n}\n-(void)eat{\n    [super run];\n    NSLog(@\"student eat\");\n}\n@end\n</code></pre> <p>\u6211\u4eec\u770b\u5230\uff0c\u5728 <code>Student</code> \u4e2d\uff0c\u65e0\u8bba\u662f\u4f7f\u7528 [self class]\uff0c\u8fd8\u662f [super class]\uff0c\u7ed3\u679c\u90fd\u662f\u4e00\u6837\u7684</p> <pre><code>struct __rw_objc_super { \n    struct objc_object *object;  // \u6d88\u606f\u63a5\u6536\u8005\n    struct objc_object *superClass;  // \u6d88\u606f\u63a5\u6536\u8005\u7684\u7236\u7c7b\n    __rw_objc_super(struct objc_object *o, struct objc_object *s) : object(o), superClass(s) {} \n};\n\n// Student \u8f6c\u6210 C++ \u7b80\u5316\u540e\u7684\u4ee3\u7801\nobjc_msgSend(self, sel_registerName(\"class\"));\nobjc_msgSend(self, sel_registerName(\"superclass\")));\n\nobjc_msgSendSuper(\n    __rw_objc_super{self, class_getSuperclass(objc_getClass(\"Student\"))},\n    sel_registerName(\"class\")\n);\n\nobjc_msgSendSuper(\n    __rw_objc_super{self, class_getSuperclass(objc_getClass(\"Student\"))},\n     sel_registerName(\"superclass\"))\n);\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728 objc_msgSendSuper \u4e2d\u4f1a\u4f20\u5165\u4e00\u4e2a __rw_objc_super \u7684\u7ed3\u6784\u4f53\uff0c\u5305\u542b\u6d88\u606f\u63a5\u6536\u8005\u4ee5\u53ca\u7236\u7c7b\u5bf9\u8c61\uff0c</p> <p>\u6d88\u606f\u63a5\u6536\u8005\u4ecd\u7136\u662f\u8be5\u5bf9\u8c61\u672c\u8eab\uff0c\u7236\u7c7b\u5bf9\u8c61\u53ea\u662f\u544a\u8bc9 runtime \u4ece\u54ea\u91cc\u5f00\u59cb\u67e5\u627e\u65b9\u6cd5\u7684\u5b9e\u73b0\u800c\u5df2</p> <p>\u800c class \u65b9\u6cd5\u6700\u7ec8\u8c03\u7528\u7684\u90fd\u662f NSObject \u7684 class \u65b9\u6cd5\uff0c\u5176\u5b9e\u73b0\u5927\u6982\u5c31\u662f\uff0c\u6700\u7ec8\u8fd4\u56de\u7684\u8fd8\u662f\u6d88\u606f\u63a5\u6536\u8005\u5230\u5e95\u662f\u4ec0\u4e48\u7c7b\u578b</p> <pre><code>// NSObject \u4e2d class \u53ca superClass \u7684\u5b9e\u73b0\n\n-(Class) class {\n    return object_getClass(self);\n}\n\n-(Class) superclass {\n    return object_getSuperclass(object_getClass(self));\n}\n</code></pre> <p>[super message] \u7684\u5e95\u5c42\u5b9e\u73b0 1. \u6d88\u606f\u63a5\u6536\u8005\u4ecd\u7136\u662f\u5b50\u7c7b\u5bf9\u8c61 2. \u53ea\u662f\u5b9e\u73b0\u8981\u4ece\u7236\u7c7b\u5f00\u59cb\u67e5\u627e</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#ismemberofclass-iskindofclass","title":"isMemberOfClass &amp;&amp;&amp; isKindOfClass","text":"<pre><code>+ (BOOL)isMemberOfClass:(Class)cls {\n    return self-&gt;ISA() == cls;\n}\n\n- (BOOL)isMemberOfClass:(Class)cls {\n    return [self class] == cls;\n}\n\n+ (BOOL)isKindOfClass:(Class)cls {\n    for (Class tcls = self-&gt;ISA(); tcls; tcls = tcls-&gt;getSuperclass()) {\n        if (tcls == cls) return YES;\n    }\n    return NO;\n}\n\n- (BOOL)isKindOfClass:(Class)cls {\n    for (Class tcls = [self class]; tcls; tcls = tcls-&gt;getSuperclass()) {\n        if (tcls == cls) return YES;\n    }\n    return NO;\n}\n</code></pre> <p>isMemberOfClass \u5b9e\u9645\u4e0a\u662f\u6bd4\u8f83\u5bf9\u8c61\u7684 isa \u6307\u9488\u6240\u5411\u7684\u5185\u5bb9\u662f\u5426\u4e3a\u8981\u5224\u65ad\u7684\u7c7b\u578b isKindOfClass \u5b9e\u9645\u4e0a\u662f\u6bd4\u8f83\u5bf9\u8c61\u7684 isa \u6307\u9488\u6240\u5411\u7684\u5185\u5bb9\u6216\u8005\u6240\u6307\u5411\u5185\u5bb9\u7684 superclass \u662f\u5426\u4e3a\u8981\u5224\u65ad\u7684\u7c7b\u578b</p> <p>\u5b9e\u4f8b\u5bf9\u8c61\u4e0e\u7c7b\u5bf9\u8c61\u505a\u5224\u65ad\uff0c\u7c7b\u5bf9\u8c61\u4e0e\u5143\u7c7b\u5bf9\u8c61\u505a\u5224\u65ad</p> <p>\u4f46\u662f\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u9700\u8981\u6ce8\u610f</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_5","title":"\u5751","text":"<p><code>[Person isKindOfClass:[NSObject class]]</code> \u8fd9\u4e2a\u662f\u8fd4\u56de true \u7684\uff0c\u56e0\u4e3a Person \u7684\u5143\u7c7b\u5bf9\u8c61\u5728\u4e00\u5c42\u4e00\u5c42\u5411\u4e0a\u627e superclass \u7684\u65f6\u5019\uff0c\u627e\u5230 NSObject \u7684\u5143\u7c7b\u5bf9\u8c61\uff0cNSObject \u5143\u7c7b\u5bf9\u8c61\u7684 superclass \u662f\u6307\u5411 NSObject \u7684\u7c7b\u5bf9\u8c61\u7684\uff0c\u6240\u4ee5\u6700\u7ec8\u4f1a\u8fd4\u56de true</p> <pre><code>@interface Person : NSObject\n@property(copy, nonatomic) NSString *name;\n@end\n\n@implementation Person\n-(void) test {\n    NSLog(@\"name is %@\", _name);\n}\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        NSString *s = @\"aaa\";\n        // NSObject *obj2 = [[NSObject alloc] init];\n        id cls = [Person class];\n        void *obj = &amp;cls;\n        [(__bridge id)obj test];\n\n    }\n    return 0;\n}\n</code></pre> <p></p> <p>\u5982\u56fe\u6240\u793a\uff0c\u7531\u4e8e\u5728\u65b9\u6cd5\u8c03\u7528\u8fc7\u7a0b\u4e2d\uff0c\u7ed9\u53d8\u91cf\u5206\u914d\u7684\u6808\u7a7a\u95f4\u662f\u8fde\u7eed\u7684\uff0c\u5e76\u4e14\u662f\u7531\u4f4e\u5411\u9ad8\u7684\uff0c\u6240\u4ee5\uff0cmain \u4e2d\u6240\u5206\u914d\u7684\u51e0\u4e2a\u53d8\u91cf\u6392\u5217\u5982\u56fe</p> <p>obj \u5728\u6700\u524d</p> <p>cls \u7b2c\u4e8c</p> <p>s \u7b2c\u4e09</p> <p>\u6bcf\u5757\u5185\u5b58\u4e2d\u6240\u5b58\u50a8\u7684\u5185\u5bb9\u5982\u56fe obj \u6240\u5728\u7684\u5185\u5b58\u4e2d\uff0c\u5b58\u50a8\u7740 cls \u7684\u5730\u5740 cls \u6240\u5728\u5185\u5b58\u4e2d\uff0c\u5b58\u50a8\u7740 Person \u7c7b\u5bf9\u8c61\u7684\u5730\u5740</p> <p>obj cls [Person class] \u4e4b\u95f4\u7684\u5173\u7cfb\u5c31\u50cf\u662f person\u53d8\u91cf person\u5b9e\u4f8b\u5bf9\u8c61 [Person class] \u4e4b\u95f4\u7684\u5173\u7cfb</p> <p>obj \u5c31\u76f8\u5f53\u4e8eperson\u53d8\u91cf\uff0c\u6307\u5411\u5b9e\u4f8b\u5bf9\u8c61\u7684 isa \u6307\u9488\uff08\u5f53\u7136 obj \u6307\u5411\u7684\u662f cls\uff09\uff0c\u4f46\u662f \u5b9e\u4f8b\u5bf9\u8c61\u7684 isa \u6307\u9488\u4e0e cls \u6240\u6307\u5411\u7684\u90fd\u662f Person \u7c7b\u5bf9\u8c61\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c31\u76f4\u63a5\u5c06 cls \u6240\u5728\u5185\u5b58\u5730\u5740\u53ca\u63a5\u4e0b\u6765\u7684\u4e00\u90e8\u5206\u5730\u5740\u76f4\u63a5\u5f53\u505a Person \u5b9e\u4f8b\u5bf9\u8c61\u6765\u770b\u5f85</p> <p>\u5f53\u8c03\u7528 <code>[(__bridge id)obj test];</code> \u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u5c06 obj \u4f5c\u4e3a\u63a5\u6536\u8005\uff0c\u53d1\u9001 test \u6d88\u606f</p> <p>obj \u627e\u5230\u6240\u6307\u5411\u5185\u5b58\u5730\u5740\u62ff\u5230\u6700\u524d\u9762\u7684\u5185\u5bb9\uff0c\u5bf9\u4e8e person\u5b9e\u4f8b\u5bf9\u8c61\u6765\u8bf4\u5c31\u662f isa \uff0c\u5bf9\u4e8e cls \u6765\u8bf4\u5c31\u662f\u5b83\u81ea\u5df1\uff0c\u62ff\u5230\u5176\u4e2d\u7684\u5730\u5740\u5e76\u627e\u5230\u7c7b\u5bf9\u8c61\uff0c\u67e5\u627e\u65b9\u6cd5\u5e76\u8c03\u7528</p> <p>\u7531\u4e8e\u4f20\u9012\u7684 receiver \u5c31\u662f\u4e00\u4e2a\u7cfb\u7edf\u8ba4\u4e3a\u662f person \u5b9e\u4f8b\u5bf9\u8c61\u7684\u4e00\u4e2a\u6307\u9488\uff0c\u5f53 test \u4e2d\u5c1d\u8bd5\u6253\u5370 _name \u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5c1d\u8bd5\u627e\u5230\u8df3\u8fc7 isa \u5730\u5740\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u5bf9\u4e8e\u771f\u6b63\u7684person \u5b9e\u4f8b\u5bf9\u8c61\uff0c\u90a3\u4e48\u5c31\u662f _name \u6210\u5458\u53d8\u91cf\uff0c\u4f46\u662f\u5bf9\u4e8e \u628a cls \u5730\u5740\u5f53\u505a person \u5b9e\u4f8b\u5bf9\u8c61\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u62ff\u5230\u7684\u5c31\u662f\u8df3\u8fc7 cls \u6307\u9488\u63a5\u4e0b\u6765\u7684\u5185\u5bb9\uff0c\u662f\u5565\u5c31\u62ff\u5565\uff0c\u5982\u679c\u80fd\u6b63\u5e38\u89e3\u6790\u5c31\u6253\u5370\uff0c\u4e0d\u80fd\u6b63\u5e38\u89e3\u6790\u5c31\u629b\u51fa\u9519\u8bef </p> <ul> <li>super \u7684\u8c03\u7528\uff0c\u5e95\u5c42\u4f1a\u8f6c\u6362\u4e3a objc_msgSendSuper2 \u51fd\u6570\u7684\u8c03\u7528\uff0c\u63a5\u6536 2 \u4e2a\u53c2\u6570</li> <li>struct objc_super2</li> <li>SEL</li> </ul> <pre><code>struct{\n    id receiver;\n    Class current_class;\n}\n</code></pre> <ul> <li>receiver \u662f\u6d88\u606f\u63a5\u6536\u8005</li> <li>current_class \u662f receiver \u7684 Class \u5bf9\u8c61</li> <li>objc_msgSendSuper2 \u7684\u5b9e\u73b0\u4e2d\u4f1a\u5148\u901a\u8fc7 current_class \u62ff\u5230 superclass\uff0c\u7136\u540e\u518d\u8fdb\u884c\u65b9\u6cd5\u67e5\u627e</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#llvm","title":"LLVM \u4e2d\u95f4\u4ee3\u7801","text":"<p>LLVM \u8bed\u6cd5</p> <p>\u8f6c\u4e3a LLVM \u4e2d\u95f4\u4ee3\u7801 <code>clang -emit-llvm -S main.m</code></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#runtime-api","title":"Runtime API","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/09-runtime/#_6","title":"\u7c7b","text":"<pre><code>void scream(id self, SEL _cmd){\n    NSLog(@\"%@ - %@\", self, NSStringFromClass([self class]));\n}\n\nvoid classRelatedFuncs() {\n    Person *p = [[Person alloc] init];\n    NSLog(@\"%@\", object_getClass(p)); // \u83b7\u53d6\u7c7b\u5bf9\u8c61\n    [p run];\n    // object_setClass \u8bbe\u7f6e\u7c7b\u5bf9\u8c61\uff0c\u5c06\u5f53\u524d\u5b9e\u4f8b\u5bf9\u8c61\u7684\u7c7b\u5bf9\u8c61\u8bbe\u7f6e\u4e3a\u5176\u4ed6\u7c7b\n    object_setClass(p, [Car class]);\n    NSLog(@\"%@\", object_getClass(p));\n    [p run];\n\n    // object_isClass \u662f\u5426\u4e3a\u7c7b\u5bf9\u8c61\n    NSLog(@\"%d %d %d\",\n          object_isClass(p),\n          object_isClass([Person class]),\n          object_isClass(object_getClass([Person class]))); // 0 1 1,\u5143\u7c7b\u5bf9\u8c61\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u7c7b\u5bf9\u8c61\n\n    // \u662f\u5426\u4e3a\u5143\u7c7b\n    class_isMetaClass(object_getClass([Person class]));\n\n    // \u52a8\u6001\u521b\u5efa\u7c7b\n    Class children = objc_allocateClassPair([NSObject class], \"Children\", 0);\n\n    // \u6dfb\u52a0\u6210\u5458\u53d8\u91cf\uff0c\u53ef\u4ee5\u4f7f\u7528 KVC \u6765\u8bbe\u7f6e\u83b7\u53d6\u503c\n    // \u6210\u5458\u53d8\u91cf\u53ea\u53ef\u4ee5\u5728\u7c7b\u6ce8\u518c\u4e4b\u524d\u6dfb\u52a0\uff0c\u56e0\u4e3a ivar list \u662f\u5728 class_ro_t \u4e2d\u5b58\u50a8\uff0c\u5df2\u7ecf\u6ce8\u518c\u5c31\u4e0d\u53ef\u53d8\n    class_addIvar(children, \"_hairColor\", 4, 1, @encode(int));\n    class_addIvar(children, \"_happy\", 4, 1, @encode(int));\n\n    // \u6dfb\u52a0\u65b9\u6cd5\n    // \u65b9\u6cd5\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u6dfb\u52a0\uff0c\u56e0\u4e3a \u65b9\u6cd5\u53d8\u5316\u7684\u8bdd\u4f1a\u52a8\u6001\u521d\u59cb\u5316 class_rw_ext_t \u4e2d\uff0c\u53ef\u53d8\n    class_addMethod(children, @selector(scream), (IMP)scream, \"v16@0:8\");\n\n    // \u6ce8\u518c\u521b\u5efa\u7684\u7c7b\n    objc_registerClassPair(children);\n    id child = [[children alloc] init];\n\n//    [child run];\n//    [child scream];\n    [child performSelector:@selector(scream)];\n    [child setValue:@10 forKey:@\"_happy\"];\n    NSLog(@\"%@ %@\", children, [child valueForKey:@\"_happy\"]);\n\n    // \u5f53\u521b\u5efa\u7684\u7c7b\u4e0d\u9700\u8981\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7\u8be5\u65b9\u6cd5\u91ca\u653e\n//    objc_disposeClassPair(children);\n}\n\nvoid ivars(){\n    // \u83b7\u53d6\u6210\u5458\u53d8\u91cf\u4fe1\u606f\n    Ivar var = class_getInstanceVariable([Person class], \"_name\");\n    Ivar agevar = class_getInstanceVariable([Person class], \"_age\");\n\n    // ivar_getName \u83b7\u53d6 ivar \u540d\u79f0\uff0civar_getTypeEncoding \u83b7\u53d6 types\n    NSLog(@\"%s %s\", ivar_getName(var), ivar_getTypeEncoding(var));\n    Person *p = [[Person alloc] init];\n\n    // \u8bbe\u7f6e\u5bf9\u8c61\u6210\u5458\u53d8\u91cf\u503c\uff0c\u8bbe\u7f6e\u5bf9\u8c61\u7c7b\u578b, \u5982\u679c\u662fint \u4e4b\u7c7b\u7684\u503c\u7c7b\u578b\u7684\u8bdd\u9700\u8981\u5f3a\u8f6c\uff0c\u800c\u4e0d\u53ef\u4ee5\u4f7f\u7528 @10 \u8fd9\u79cd\u65b9\u5f0f\n    object_setIvar(p, var, @\"haha\");\n    object_setIvar(p, agevar, (__bridge id)(void *)10);\n    NSLog(@\"%@ %d\", p.name, p.age);\n\n    unsigned int count;\n    // \u83b7\u53d6\u6210\u5458\u53d8\u91cf\u5217\u8868\n    Ivar *ivars = class_copyIvarList([Person class], &amp;count);\n    // \u904d\u5386\u5e76\u6253\u5370\n    for (int i = 0; i &lt; count; i++) {\n        Ivar ivar = ivars[i];\n        NSLog(@\"%s %s\", ivar_getName(ivar), ivar_getTypeEncoding(ivar));\n    }\n    free(ivars);\n}\n\nvoid methodsRelated(){\n    unsigned int count;\n    Method * methods = class_copyMethodList([Person class], &amp;count);\n    for(int i = 0; i&lt;count; i++) {\n        Method method = methods[i];\n        NSLog(@\"%s\", method_getName(method));\n    }\n\n    // \u66ff\u6362\u65b9\u6cd5\u5b9e\u73b0\n    class_replaceMethod([Person class], @selector(run), (IMP)scream, \"v16@0:8\");\n    Person *p = [[Person alloc] init];\n    [p run];\n\n    // \u4f7f\u7528 block \u66ff\u6362\u65b9\u6cd5\u7684 \u539f\u5b9e\u73b0\n    class_replaceMethod([Person class], @selector(run), imp_implementationWithBlock(^{\n        NSLog(@\"test with block \");\n    }), \"v\");\n    Person *p2 = [[Person alloc] init];\n    [p run];\n\n    // \u4ea4\u6362\u65b9\u6cd5\u5b9e\u73b0\n    // \u8c03\u7528\u4f1a\u6e05\u6389\u7f13\u5b58\uff0cmethod_exchangeImplementations\uff0c\u7136\u540e\u5c06 class_rw_ext_t \u8868\u4e2d\u65b9\u6cd5\u5217\u8868\u4e2d\u5bf9\u5e94\u7684\u65b9\u6cd5\u7684 imp \u6307\u9488\u76f8\u4e92\u4ea4\u6362\n    Method test1 = class_getInstanceMethod([Person class], @selector(test1));\n    Method test2 = class_getInstanceMethod([Person class], @selector(test2));\n    method_exchangeImplementations(test1, test2);\n    Person *p3 = [[Person alloc] init];\n    [p test1];\n    [p test2];\n}\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        classRelatedFuncs();\n    }\n    return 0;\n}\n</code></pre> <p>\u83b7\u53d6\u79c1\u6709\u6210\u5458\u53d8\u91cf \u5b57\u5178\u8f6c\u6a21\u578b</p> <p>\u7c7b\u7c07\uff0cNSString, NSArray, NSDictionary \u770b\u4e0a\u53bb\u662f\u8fd9\u4e2a\uff0c\u5355\u771f\u5b9e\u7c7b\u578b\u662f\u5176\u4ed6\u7c7b\uff0c\u4f7f\u7528 method_exchangeImplementations \u7684\u65f6\u5019\u8981\u6ce8\u610f\u771f\u5b9e\u7684\u7c7b\u5bf9\u8c61\uff0c\u8981\u7528\u5bf9</p> <p>systemFontOfSize hook \u53ef\u4ee5\u7ed9\u8bbe\u7f6e\u7684\u5b57\u4f53\u5927\u5c0f * \u4e00\u4e2a\u7cfb\u6570\u6765\u9002\u914d\u4e0d\u540c\u5c4f\u5e55</p> <p>load \u4e2d\u53bb \u4ea4\u6362\u65b9\u6cd5\u7684\u65f6\u5019\u6700\u597d\u52a0\u4e00\u4e2a dispatch_once\uff0c\u9632\u6b62load \u65b9\u6cd5\u88ab\u624b\u52a8\u8c03\u7528\u4e4b\u540e\u65b9\u6cd5\u5b9e\u73b0\u53c8\u88ab\u6362\u56de\u53bb</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/","title":"10 runloop","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#runloop","title":"Runloop","text":"<p>\u8fd0\u884c\u5faa\u73af\uff0c\u5728\u7a0b\u5e8f\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5faa\u73af\u505a\u4e00\u4e9b\u4e8b\u60c5</p> <p>\u5e94\u7528\u8303\u7574\uff1a \u5b9a\u65f6\u5668\uff08Timer\uff09\uff0cPerformSelector\uff0cGCD Async Main Queue\uff0c\u4e8b\u4ef6\u54cd\u5e94\uff0c\u624b\u52bf\u8bc6\u522b\uff0c\u754c\u9762\u5237\u65b0\uff0c\u7f51\u7edc\u8bf7\u6c42\uff0cAutoreleasePool</p> <p>\u6ca1\u6709 RunLoop \u7a0b\u5e8f\u6267\u884c\u5b8c\u5c31\u4f1a\u9000\u51fa</p> <p>iOS \u4e2d\u6709\u4e24\u5957 API \u6765\u8bbf\u95ee\u548c\u4f7f\u7528 RunLoop</p> <p>Foundation: NSRunloop</p> <p>Core Foundation: CFRunLoopRef</p> <p>\u8fd9\u4e24\u4e2a\u90fd\u4ee3\u8868\u7740RunLoop\u5bf9\u8c61</p> <p>NSRunloop \u662f\u57fa\u4e8e CFRunLoopRef \u7684\u4e00\u5c42 OC \u5305\u88c5</p> <p>CoreFundation \u6e90\u7801\u5730\u5740</p> <p>runloop \u4f2a\u4ee3\u7801</p> <pre><code>int main(int argc, char * argv[]){\n    @autoreleasepool {\n        int retVal = 0\n        do{\n            int message = sleep_and_wait();\n            retVal = process_message(message);\n        } while (0==retVal);\n        return 0;\n    }\n}\n</code></pre> <ul> <li>RunLoop \u7684\u57fa\u672c\u4f5c\u7528</li> <li> <ul> <li>\u4fdd\u6301\u7a0b\u5e8f\u7684\u6301\u7eed\u8fd0\u884c</li> </ul> </li> <li> <ul> <li>\u5904\u7406 APP \u4e2d\u7684\u5404\u79cd\u4e8b\u4ef6\uff0c\u6bd4\u5982\u89e6\u6478\uff0c\u5b9a\u65f6\u5668\u7b49</li> </ul> </li> <li> <ul> <li>\u8282\u7701 CPU \u8d44\u6e90\uff0c\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd\uff1a\u6709\u4e8b\u505a\u4e8b\uff0c\u6ca1\u4e8b\u7761\u89c9</li> </ul> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#runloop_1","title":"RunLoop \u4e0e\u7ebf\u7a0b","text":"<ul> <li>\u6bcf\u6761\u7ebf\u7a0b\u90fd\u6709\u552f\u4e00\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684 RunLoop \u5bf9\u8c61</li> <li>RunLoop \u4fdd\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u7684 Dictionary \u91cc\uff0c\u7ebf\u7a0b\u4f5c\u4e3a Key\uff0cRunLoop \u4f5c\u4e3a Value</li> <li>\u521b\u5efa\u7ebf\u7a0b\u65f6\uff0c\u6ca1\u6709 RunLoop\uff0cRunLoop\u4f1a\u5728\u7b2c\u4e00\u6b21\u83b7\u53d6\u5b83\u65f6\u521b\u5efa</li> <li>RunLoop \u4f1a\u5728\u7ebf\u7a0b\u7ed3\u675f\u65f6\u9500\u6bc1</li> <li>\u4e3b\u7ebf\u7a0b\u7684RunLoop\u5df2\u5c06\u81ea\u52a8\u83b7\u53d6\uff08\u521b\u5efa\uff09\uff0c\u5b50\u7ebf\u7a0b\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f RunLoop</li> </ul> <p>RunLoop \u76f8\u5173\u7684\u7c7b\uff0c Core Foundation \u4e2d\u5173\u4e8e RunLoop \u7684 5 \u4e2a\u7c7b - CFRunLoopRef - CFRunLoopModeRef - CFRunLoopSourceRef - CFRunLoopTimerRef - CFRunLoopObserverRef</p> <pre><code>struct __CFRunLoop {\n    pthread_t _pthread;\n    CFMutableSetRef _commonModes;\n    CFMutableSetRef _commonModeItems;\n    CFRunLoopModeRef _currentMode;\n    CFMutableSetRef _modes;\n};\n\nstruct __CFRunLoopMode {\n    CFStringRef _name;\n    CFMutableSetRef _sources0;\n    CFMutableSetRef _sources1;\n    CFMutableArrayRef _observers;\n    CFMutableArrayRef _timers;\n};\n</code></pre> <ul> <li>CFRunLoopModeRef \u4ee3\u8868 RunLoop \u7684\u8fd0\u884c\u6a21\u5f0f</li> <li>\u4e00\u4e2aRunLoop \u5305\u542b\u82e5\u5e72\u4e2aMode\uff0c\u6bcf\u4e2aMode\u53c8\u5305\u542b\u82e5\u5e72\u4e2a Source0/Sources1/Observer/Timer</li> <li>RunLoop \u542f\u52a8\u65f6\u53ea\u80fd\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a Mode\uff0c\u4f5c\u4e3a CurrentMode</li> <li>\u5982\u679c\u9700\u8981\u5207\u6362 Mode\uff0c\u53ea\u80fd\u9000\u51fa\u5f53\u524d Loop\uff0c\u518d\u91cd\u65b0\u9009\u62e9\u4e00\u4e2a Mode \u8fdb\u5165</li> <li> <ul> <li>\u4e0d\u540c\u7ec4\u7684 Source0/Sources1/Observer/Timer \u80fd\u591f\u5206\u9694\u5f00\u6765\uff0c\u4e92\u4e0d\u5f71\u54cd</li> </ul> </li> <li> <ul> <li>\u5982\u679c mode \u4e2d\u6ca1\u6709\u4efb\u4f55 Source0/Sources1/Observer/Timer\uff0cRunLoop\u4f1a\u7acb\u9a6c\u9000\u51fa</li> </ul> </li> </ul> <p>\u5e38\u89c1\u7684\u4e24\u79cd mode</p> <ul> <li>kCFRunLoopDefaultMode(NSDefaultRunLoopMode)\uff0cApp\u9ed8\u8ba4Mode\uff0c\u901a\u5e38\u4e3b\u7ebf\u7a0b\u662f\u5728\u8fd9\u4e2aMode \u4e0b\u8fd0\u884c</li> <li>UITrackingRunLoopMode\uff1a\u754c\u9762\u8ddf\u8e2a Mode\uff0c\u7528\u4e8e ScrollView \u8ffd\u8e2a\u89e6\u6478\u6ed1\u52a8\uff0c\u4fdd\u8bc1\u754c\u9762\u6ed1\u52a8\u65f6\u4e0d\u53d7\u5176\u4ed6 Mode \u5f71\u54cd</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#_1","title":"\u4e8b\u4ef6\u5904\u7406","text":"<p>llvdb <code>bt</code>\u547d\u4ee4\uff0c\u6253\u5370\u51fd\u6570\u8c03\u7528\u6808</p> <p>Source0\uff08\u5e94\u7528\u5c42\u4e8b\u4ef6\uff09 - \u89e6\u6478\u4e8b\u4ef6\u5904\u7406 - performSelector:onThread:</p> <p>Source1\uff08\u5904\u7406\u7cfb\u7edf\uff0c\u5185\u6838\u4e8b\u4ef6\uff09 - \u57fa\u4e8ePort\u7684\u7ebf\u7a0b\u95f4\u901a\u4fe1 - \u7cfb\u7edf\u4e8b\u4ef6\u6355\u6349</p> <p>Timers - NSTimer - performSelector:withObject:afterDelay:</p> <p>Observers - \u7528\u4e8e\u76d1\u542c RunLoop \u7684\u72b6\u6001 - UI \u5237\u65b0 \uff08BeforeWaiting\uff09 - @autoreleasepool\uff08BeforeWaiting\uff09</p> <pre><code>/* Run Loop Observer Activities */\ntypedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) {\n    kCFRunLoopEntry = (1UL &lt;&lt; 0),           // \u5373\u5c06\u8fdb\u5165 Loop\n    kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1),    // \u5373\u5c06\u5904\u7406 Timer\n    kCFRunLoopBeforeSources = (1UL &lt;&lt; 2),   // \u5373\u5c06\u5904\u7406 Source\n    kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5),   // \u5373\u5c06\u8fdb\u5165\u4f11\u7720\n    kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6),    // \u521a\u4ece\u4f11\u7720\u4e2d\u5524\u9192\n    kCFRunLoopExit = (1UL &lt;&lt; 7),            // \u5373\u5c06\u9000\u51fa Loop\n    kCFRunLoopAllActivities = 0x0FFFFFFFU\n};\n\nstruct __CFRunLoopObserver {\n    CFRuntimeBase _base;\n    pthread_mutex_t _lock;\n    CFRunLoopRef _runLoop;\n    CFIndex _rlCount;\n    CFOptionFlags _activities;      /* immutable */\n    CFIndex _order;         /* immutable */\n    CFRunLoopObserverCallBack _callout; /* immutable */\n    CFRunLoopObserverContext _context;  /* immutable, except invalidation */\n};\n</code></pre> <p>\u6dfb\u52a0 Obverser \u76d1\u542c RunLoop \u7684\u6240\u6709\u72b6\u6001</p> <pre><code>void observerRunLoopAct(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info){\n    switch (activity) {\n        case kCFRunLoopEntry:\n            NSLog(@\"\u8fdb\u5165RunLoop\");\n            NSLog(@\"%@ %lu\", observer, activity);\n            break;\n        case kCFRunLoopBeforeSources:\n            NSLog(@\"\u5373\u5c06\u5904\u7406 Source\");\n            NSLog(@\"%@ %lu\", observer, activity);\n            break;\n        case kCFRunLoopBeforeTimers:\n            NSLog(@\"\u5373\u5c06\u5904\u7406 Timer\");\n            NSLog(@\"%@ %lu\", observer, activity);\n            break;\n        case kCFRunLoopBeforeWaiting:\n            NSLog(@\"\u5373\u5c06\u8fdb\u5165\u4f11\u7720\");\n            NSLog(@\"%@ %lu\", observer, activity);\n            break;\n        case kCFRunLoopAfterWaiting:\n            NSLog(@\"\u5373\u5c06\u5524\u9192\");\n            NSLog(@\"%@ %lu\", observer, activity);\n            break;\n        case kCFRunLoopExit:\n            NSLog(@\"\u5373\u5c06\u9000\u51fa runloop\");\n            NSLog(@\"%@ %lu\", observer, activity);\n        default:\n            break;\n    }\n\n}\n\nCFRunLoopObserverRef ref = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, 0, observerRunLoopAct, NULL);\nCFRunLoopAddObserver(CFRunLoopGetMain(), ref, kCFRunLoopCommonModes);\n    CFRelease(ref);\n\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#runloop_2","title":"RunLoop \u7684\u8fd0\u884c\u903b\u8f91","text":"<pre><code>sInt32 CFRunLoopRunSpecific(CFRunLoopRef rl, CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) {     /* DOES CALLOUT */\n    // \u68c0\u67e5\u5f53\u524dRunLoop mode \u662f\u5426\u4e3a \u8fdb\u5165 RunLoop\uff0c\u5982\u679c\u662f\uff0c\u5c31\u901a\u77e5 observer \u8fdb\u5165 RunLoop \n    if (currentMode-&gt;_observerMask &amp; kCFRunLoopEntry ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopEntry);\n    // \u5f00\u59cb\u6267\u884c RunLoop\n    result = __CFRunLoopRun(rl, currentMode, seconds, returnAfterSourceHandled, previousMode);\n    // \u6267\u884c\u5b8c\u4e4b\u540e\u5224\u65ad\u662f\u5426\u8981\u9000\u51fa RunLoop\uff0c\u5982\u679c\u8981\u9000\u51fa\uff0c\u90a3\u4e48\u901a\u77e5 observer \u8981\u9000\u51fa RunLoop  \n    if (currentMode-&gt;_observerMask &amp; kCFRunLoopExit ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit);\n}\n\n/* rl, rlm are locked on entrance and exit */\nstatic int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode) {\n    do {\n        // \u5224\u65ad\u5e76\u901a\u77e5 observer \u5373\u5c06\u5904\u7406 timers\n        __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeTimers);\n        // \u5224\u65ad\u5e76\u901a\u77e5 observer \u5373\u5c06\u5904\u7406 sources\n        __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeSources);\n        // \u5904\u7406 blocks\n        __CFRunLoopDoBlocks(rl, rlm);\n        // \u5904\u7406 sources0\uff0c\u5e76\u6839\u636e\u7ed3\u679c\u5224\u65ad\u662f\u5426\u8981\u518d\u5904\u7406 blocks\n        if (__CFRunLoopDoSources0(rl, rlm, stopAfterHandle)) {\n            __CFRunLoopDoBlocks(rl, rlm);\n        }\n\n        Boolean poll = sourceHandledThisLoop || (0ULL == timeout_context-&gt;termTSR);\n\n        // \u7b2c\u4e00\u6b21\u4e0d\u4f1a\u6267\u884c\u56e0\u4e3a\u7b2c\u4e00\u6b21 didDispatchPortLastTime \u4e3atrue\uff0cdispatchPort \u5728\u4e3b\u7ebf\u7a0b\u624d\u4f1a\u8d4b\u503c\uff0c\u53ea\u6709\u4e3b\u7ebf\u7a0b\u4e0b\u624d\u4f1a\u8d70\u5230\u91cc\u9762\n        // \u67e5\u5230\u7684livePort \u5728handle_msg \u4e2d\u4f1a\u6839\u636e\u6761\u4ef6\u505a\u5bf9\u5e94\u5904\u7406\n        if (MACH_PORT_NULL != dispatchPort &amp;&amp; !didDispatchPortLastTime) {\n            msg = (mach_msg_header_t *)msg_buffer;\n            if (__CFRunLoopServiceMachPort(dispatchPort, &amp;msg, sizeof(msg_buffer), &amp;livePort, 0, &amp;voucherState, NULL)) {\n                // \u6709\u5c31\u8df3\u8f6c\u5230 handle_msg\n                goto handle_msg;\n            }\n        }\n\n        didDispatchPortLastTime = false;\n        // \u5224\u65ad\u5e76\u901a\u77e5 observer \u5373\u5c06 \u4f11\u7720\n        __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeWaiting);\n        __CFRunLoopSetSleeping(rl);\n        // do not do any user callouts after this point (after notifying of sleeping)\n\n\n        CFAbsoluteTime sleepStart = poll ? 0.0 : CFAbsoluteTimeGetCurrent();\n        do {           \n            // \u7b49\u5f85\u522b\u7684\u6d88\u606f\u6765\u5524\u9192\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e0d\u4f1a\u6267\u884c\u4efb\u4f55\u6307\u4ee4\uff0c\u8c03\u7528\u4e86 mach_msg \u5185\u6838\u6001\u63a7\u5236\u7ebf\u7a0b\u4f11\u7720\uff0c\u4e0d\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u5f53\u5185\u6838\u6536\u5230\u6d88\u606f\u4e4b\u540e\u518d\u6765\u5524\u9192\u7ebf\u7a0b\u7ee7\u7eed\u5904\u7406\n            __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY, &amp;voucherState, &amp;voucherCopy);\n\n        } while (1);\n\n        __CFRunLoopUnsetSleeping(rl);\n        // \u5224\u65ad\u5e76\u901a\u77e5 observer \u7ed3\u675f\u4f11\u7720\n        if (!poll &amp;&amp; (rlm-&gt;_observerMask &amp; kCFRunLoopAfterWaiting)) __CFRunLoopDoObservers(rl, rlm, kCFRunLoopAfterWaiting);\n\nhandle_msg:;\n        if (weak_up_for_timer) {\n            CFRUNLOOP_WAKEUP_FOR_TIMER();\n            // \u5904\u7406timer\n            if (!__CFRunLoopDoTimers(rl, rlm, mach_absolute_time())) {\n                // Re-arm the next timer\n                __CFArmNextTimerInMode(rlm, rl);\n            }\n        } else if (weak_up_for_GCD) {\n            CFRUNLOOP_WAKEUP_FOR_DISPATCH();\n            // \u5904\u7406 GCD\n            __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg);\n        } else { // \u88ab source1 \u5524\u9192\n            CFRUNLOOP_WAKEUP_FOR_SOURCE();\n\n            if (__CFRunLoopModeFindSourceForMachPort(rl, rlm, livePort)) {\n                // \u5904\u7406 source1\n                sourceHandledThisLoop = __CFRunLoopDoSource1(rl, rlm, rls, msg, msg-&gt;msgh_size, &amp;reply) || sourceHandledThisLoop;\n            }\n        } \n        if (msg &amp;&amp; msg != (mach_msg_header_t *)msg_buffer) free(msg);\n\n        // \u5904\u7406 bolcks\n        __CFRunLoopDoBlocks(rl, rlm);\n\n        // \u62ff\u5230 RunLoop \u672c\u8f6e\u6267\u884c\u7ed3\u679c\uff0c\u5982\u679c\u7b49\u4e8e 0\uff0c\u90a3\u4e48\u8fdb\u884c\u4e0b\u4e00\u8f6e\u5faa\u73af\uff0c\u5982\u679c\u4e0d\u7b49\u4e8e 0\uff0c\u8df3\u51fa\u5faa\u73af\uff0c\u8fd4\u56de\n        if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) {\n            retVal = kCFRunLoopRunHandledSource;\n        } else if (timeout_context-&gt;termTSR &lt; mach_absolute_time()) {\n            retVal = kCFRunLoopRunTimedOut;\n        } else if (__CFRunLoopIsStopped(rl)) {\n            __CFRunLoopUnsetStopped(rl);\n            retVal = kCFRunLoopRunStopped;\n        } else if (rlm-&gt;_stopped) {\n            rlm-&gt;_stopped = false;\n            retVal = kCFRunLoopRunStopped;\n        } else if (__CFRunLoopModeIsEmpty(rl, rlm, previousMode)) {\n            retVal = kCFRunLoopRunFinished;\n        }\n    } while (0 == retVal);\n\n    if (timeout_timer) {\n        dispatch_source_cancel(timeout_timer);\n        dispatch_release(timeout_timer);\n    } else {\n        free(timeout_context);\n    }\n\n    return retVal;\n}\n</code></pre> <p>GCD \u4ece\u5b50\u7ebf\u7a0b\u505a\u5b8c\u64cd\u4f5c\u56de\u5230\u4e3b\u7ebf\u7a0b\u4f1a\u4f9d\u8d56 RunLoop\uff0c\u4f46\u662f\u5176\u4ed6\u60c5\u51b5\u4e0d\u4e00\u5b9a\u4f1a\u4f9d\u8d56 RunLoop</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#_2","title":"\u5b9e\u9645\u5e94\u7528","text":"<ul> <li>\u63a7\u5236\u7ebf\u7a0b\u751f\u547d\u5468\u671f\uff08\u7ebf\u7a0b\u4fdd\u6d3b\uff0cAFNetworking\uff09</li> <li>\u89e3\u51b3 NSTimer \u5728\u6ed1\u52a8\u65f6\u505c\u6b62\u5de5\u4f5c\u7684\u95ee\u9898</li> <li>\u76d1\u63a7\u5e94\u7528\u5361\u987f</li> <li>\u6027\u80fd\u4f18\u5316</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#nstimer","title":"NSTimer \u5931\u6548","text":"<pre><code>NSTimer * timer = [NSTimer timerWithTimeInterval:1.0 repeats:YES block:^(NSTimer * _Nonnull timer) {\n    NSLog(@\"\");\n}];\n// NSDefaultRunLoopMode,UITrackingRunLoopMode \u662f\u771f\u5b9e\u5b58\u5728\u7684mode\n// NSRunLoopCommonModes \u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u6a21\u5f0f\uff0c\u53ea\u662f\u4e00\u4e2a\u6807\u8bb0\n// \u6807\u8bb0 timer \u80fd\u5728 _commonModes \u6570\u7ec4\u4e2d\u5b58\u653e\u7684\u6a21\u5f0f\u4e0b\u5de5\u4f5c\n[NSRunLoop.currentRunLoop addTimer:timer forMode:NSRunLoopCommonModes];\n\n// \u8fd9\u79cd\u5199\u6cd5\u53ea\u4f1a\u5c06 timer \u6dfb\u52a0\u5230 NSDefaultRunLoopMode \u4e0b\uff0c\u5982\u679c\u9875\u9762\u6709\u6ed1\u52a8\u7b49\u64cd\u4f5c\uff0c\u5c31\u4f1a\u6682\u505c\n[NSTimer scheduledTimerWithTimeInterval:3 repeats:NO block:^(NSTimer * _Nonnull timer) {\n            NSLog(@\"aaa\");\n        }];\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#_3","title":"\u7ebf\u7a0b\u4fdd\u6d3b","text":"<pre><code>\n#import \"ViewController.h\"\n#import \"TestThread.h\"\n\n@interface ViewController ()\n@property(strong, nonatomic) TestThread * thread;\n@property(assign, nonatomic) BOOL stopped;\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    __weak typeof(self) weakSelf = self;\n    self.thread = [[TestThread alloc] initWithBlock:^{\n        NSLog(@\"%s -----start -----\", __func__);\n        // \u5f80 RunLoop \u91cc\u9762\u6dfb\u52a0Source/Timer/Port\n        [[NSRunLoop currentRunLoop] addPort:[[NSPort alloc] init] forMode:NSDefaultRunLoopMode];\n//        [[NSRunLoop currentRunLoop] run]; // run \u65b9\u6cd5\u662f\u65e0\u6cd5\u505c\u6b62\u7684\uff0c\u5b83\u5185\u90e8\u4f1a\u5faa\u73af\u8c03\u7528[currentRunLoop runMode:beforeDate:]\u4e13\u95e8\u7528\u4e8e\u5f00\u542f\u4e00\u4e2a\u6c38\u4e0d\u9500\u6bc1\u7684\u7ebf\u7a0b\n        while (weakSelf &amp;&amp; !weakSelf.stopped) {\n            [[NSRunLoop currentRunLoop] runMode:NSDefaultRunLoopMode beforeDate:[NSDate distantFuture]];\n        }\n        NSLog(@\"%s -----end -----\", __func__);\n    }];\n//    self.thread = [[TestThread alloc] initWithTarget:self selector:@selector(run) object:nil]; // \u8fd9\u79cd\u65b9\u5f0f\u4f1a\u5bf9 self \u6709\u4e00\u4e2a\u5f3a\u5f15\u7528\uff0c\u4f1a\u5bfc\u81f4\u5faa\u73af\u5f15\u7528\n    [self.thread start];\n\n}\n\n- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event{\n    NSLog(@\"touch\");\n    if(!self.thread) return;\n\n    [self performSelector:@selector(testRunOnThread) onThread:self.thread withObject:nil waitUntilDone:NO];\n}\n\n-(void) testRunOnThread{\n    NSLog(@\"%s %@\", __func__, [NSThread currentThread]);\n}\n\n-(void)stopRunloop {\n    self.stopped = YES;\n    CFRunLoopStop(CFRunLoopGetCurrent());\n    NSLog(@\"%s, %@\", __func__, [NSThread currentThread]);\n    self.thread = nil;\n}\n\n-(void) stop {\n    if(!self.thread) return;\n    // waitUntilDone \u4e00\u5b9a\u8981\u8bbe\u7f6e\u4e3a YES\uff0c\u8981\u7b49\u5230\u5b50\u7ebf\u7a0b\u4ee3\u7801\u6267\u884c\u5b8c\u518d\u8fd4\u56de\u5e76\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\n    // \u5982\u679c\u4e3a NO\uff0c\u90a3\u5728 dealloc \u4e2d\u8c03\u7528\u7684\u65f6\u5019\u5728\u5b9e\u9645\u6267\u884c\u7684\u65f6\u5019 viewController \u5c31\u5df2\u7ecf\u6b7b\u6389\u4e86\uff0c\u540e\u7eed\u8c03\u7528\u4e5f\u5c31\u4f1a\u6709\u95ee\u9898\n    [self performSelector:@selector(stopRunloop) onThread:self.thread withObject:nil waitUntilDone:YES];\n}\n\n- (void)dealloc {\n    [self stop];\n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#_4","title":"\u7ebf\u7a0b\u5c01\u88c5","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/10-runloop/#gcd-runloop","title":"GCD \u4e0e RunLoop","text":"<p>GCD \u53ea\u8d1f\u8d23\u5f00\u542f\u7ebf\u7a0b\uff0c\u4e0d\u8d1f\u8d23\u4fdd\u6d3b\uff0cRunLoop\u7528\u6765\u5bf9\u7ebf\u7a0b\u4fdd\u6d3b</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/","title":"11 \u591a\u7ebf\u7a0b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_1","title":"\u591a\u7ebf\u7a0b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#ios","title":"iOS \u5e38\u89c1\u591a\u7ebf\u7a0b\u65b9\u6848","text":"\u6280\u672f\u65b9\u6848 \u7b80\u4ecb \u8bed\u8a00 \u7ebf\u7a0b\u751f\u547d\u5468\u671f \u4f7f\u7528\u9891\u7387 pthread \u4e00\u5957\u901a\u7528\u591a\u7ebf\u7a0b API\uff0c\u9002\u7528\u4e8eUnix\\Linux\\Windows\u7b49\u7cfb\u7edf\uff0c\u8de8\u5e73\u53f0\\\u53ef\u79fb\u690d\uff0c\u4f7f\u7528\u96be\u5ea6\u5927 C \u7a0b\u5e8f\u5458\u7ba1\u7406 \u51e0\u4e4e\u4e0d\u7528 NSThread \u4f7f\u7528\u66f4\u52a0\u9762\u5411\u5bf9\u8c61\uff0c\u7b80\u5355\u6613\u7528\uff0c\u53ef\u76f4\u63a5\u64cd\u4f5c\u7ebf\u7a0b\u5bf9\u8c61 OC \u7a0b\u5e8f\u5458\u7ba1\u7406 \u5076\u5c14\u4f7f\u7528 GCD \u65e8\u5728\u66ff\u4ee3 NSThread \u7b49\u7ebf\u7a0b\u6280\u672f\uff0c\u5145\u5206\u5229\u7528\u8bbe\u5907\u7684\u591a\u6838 C \u81ea\u52a8\u7ba1\u7406 \u7ecf\u5e38\u4f7f\u7528 NSOperation \u57fa\u4e8e GCD(\u5e95\u5c42\u662f GCD) OC \u81ea\u52a8\u7ba1\u7406 \u7ecf\u5e38\u4f7f\u7528"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#gcd","title":"GCD \u7684\u5e38\u7528\u51fd\u6570","text":"<p>GCD \u4e2d\u6709\u4e24\u4e2a\u7528\u6765\u6267\u884c\u4efb\u52a1\u7684\u51fd\u6570 - \u540c\u6b65\u65b9\u5f0f\u6267\u884c</p> <pre><code>// queue \u961f\u5217\n// block \u4efb\u52a1\ndispatch_sync(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block);\n</code></pre> <ul> <li>\u5f02\u6b65\u65b9\u5f0f\u6267\u884c</li> </ul> <pre><code>dispatch_async(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block);\n\n</code></pre> <p>GCD \u7684\u961f\u5217\u53ef\u4ee5\u5206\u4e3a2\u4e2a\u5927\u7c7b - \u5e76\u53d1\u961f\u5217\uff08Concurrent Dispatch Queue\uff09</p> <p>\u53ef\u4ee5\u8ba9\u591a\u4e2a\u4efb\u52a1\u5e76\u53d1\uff08\u540c\u65f6\uff09\u6267\u884c\uff08\u81ea\u52a8\u5f00\u542f\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u4efb\u52a1\uff09 \u5e76\u53d1\u529f\u80fd\u53ea\u6709\u5728\u5f02\u6b65\uff08dispatch_async\uff09\u51fd\u6570\u4e0b\u624d\u6709\u6548 - \u4e32\u884c\u961f\u5217\uff08Serial Dispatch Queue\uff09  \u4efb\u52a1\u4e00\u4e2a\u63a5\u4e00\u4e2a\u7684\u6267\u884c\uff08\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u518d\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\uff09</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_2","title":"\u672f\u8bed","text":"<p>\u540c\u6b65\u3001\u5f02\u6b65\u3001\u5e76\u53d1\u3001\u4e32\u884c - \u540c\u6b65\u548c\u5f02\u6b65\u4e3b\u8981\u5f71\u54cd\u80fd\u4e0d\u80fd\u5f00\u542f\u65b0\u7684\u7ebf\u7a0b - - \u540c\u6b65\uff1a\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u6267\u884c\u4efb\u52a1\uff0c\u4e0d\u5177\u5907\u5f00\u542f\u65b0\u7ebf\u7a0b\u7684\u80fd\u529b - - \u5f02\u6b65\uff1a\u5728\u65b0\u7684\u7ebf\u7a0b\u4e2d\u6267\u884c\u4efb\u52a1\uff0c\u5177\u5907\u5f00\u542f\u65b0\u7ebf\u7a0b\u7684\u80fd\u529b - \u5e76\u53d1\u548c\u4e32\u884c\u4e3b\u8981\u5f71\u54cd\uff0c\u6267\u884c\u4efb\u52a1\u7684\u65b9\u5f0f - - \u5e76\u53d1\uff1a\u591a\u4e2a\u4efb\u52a1\u5e76\u53d1\uff08\u540c\u65f6\uff09\u6267\u884c - - \u4e32\u884c\uff1a\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u4e4b\u540e\uff0c\u518d\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1</p> \u5e76\u53d1\u961f\u5217 \u4e32\u884c\u961f\u5217 \u4e3b\u961f\u5217 \u540c\u6b65\uff08sync\uff09 \u6ca1\u6709\u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u4e32\u884c\u6267\u884c\u4efb\u52a1 \u6ca1\u6709\u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u4e32\u884c\u6267\u884c\u4efb\u52a1 \u6ca1\u6709\u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u4e32\u884c\u6267\u884c\u4efb\u52a1 \u5f02\u6b65\uff08async\uff09 \u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u5e76\u53d1\u6267\u884c\u4efb\u52a1 \u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u4e32\u884c\u6267\u884c\u4efb\u52a1 \u6ca1\u6709\u5f00\u542f\u65b0\u7ebf\u7a0b\uff0c\u4e32\u884c\u6267\u884c\u4efb\u52a1 <p>\u4f7f\u7528 sync \u51fd\u6570\u5f80\u5f53\u524d\u4e32\u884c\u961f\u5217\u4e2d\u6dfb\u52a0\u4efb\u52a1\uff0c\u4f1a\u5361\u4f4f\u5f53\u524d\u7684\u4e32\u884c\u961f\u5217\uff08\u4ea7\u751f\u6b7b\u9501\uff09</p> <pre><code>// \u6bd4\u5982\u4e0b\u9762\u7684\u5b9e\u73b0\uff0c\u4e32\u884c\u961f\u5217 \u9075\u5faa FIFO\uff08first in first out\uff09\u539f\u5219\uff0c\u5f53\u524d viewDidLoad \u5c31\u5728\u4e3b\u961f\u5217\u4e2d\n// \u90a3\u4e48\u5728 viewDidload \u4e2d\u7ed9\u4e3b\u961f\u5217\u6dfb\u52a0\u540c\u6b65\u4efb\u52a1\uff0c\u7b49\u4e8e\u544a\u8bc9\u4e3b\u7ebf\u7a0b\uff0c\u4f60\u53bb\u4e3b\u961f\u5217\u4e2d\u62ff\u51fa\u67d0\u4e2a\u4efb\u52a1\u7ed9\u6211\u7acb\u9a6c\u6267\u884c\n// \u4f46\u662f\u7531\u4e8e\u73b0\u5728\u4e3b\u961f\u5217\u4e2d\u6709\u6ca1\u6709\u6267\u884c\u5b8c\u7684 viewDidload\uff0c\u90a3\u6b64\u65f6\u4ece\u4e3b\u961f\u5217\u9876\u5c42\u65e0\u6cd5\u62ff\u5230 \u8fd9\u4e2a\u4efb\u52a1\n// \u56e0\u4e3a\u53c8\u8981\u540c\u6b65\u6267\u884c\uff0c\u90a3\u4e48\u6267\u884c\u4e0d\u5230\u8be5\u4efb\u52a1\u5c31\u4f1a\u5361\u5728\u8fd9\u91cc\uff0c\u7b49\u5f85\u6267\u884c\u5b8c\u6210\uff0c\u6b64\u65f6 viewDidload \u4e0d\u53ef\u80fd\u4f1a\u6267\u884c\u5b8c\uff0c\u65b0\u7684\u4efb\u52a1\u4e5f\u4e0d\u53ef\u80fd\u6267\u884c\u5230\uff0c\u5c31\u6b7b\u9501\u4e86\n// \u89e3\u51b3\u65b9\u6cd5\uff0c\u5c06\u6267\u884c\u4efb\u52a1\u65b9\u5f0f\u6539\u4e3a\u5f02\u6b65 async\uff08\u7b49\u5230\u4e0a\u4e00\u4e2a\u4efb\u52a1\u5b8c\u6210\uff0c\u518d\u7ee7\u7eed\u6267\u884c\uff09,\u6216\u8005\u521b\u5efa\u65b0\u7684\u961f\u5217\uff0c\u6216\u8005\u8981\u6267\u884c\u7684\u4efb\u52a1\u90fd\u5728\u5e76\u884c\u961f\u5217\u4e2d\u90a3\u4e5f\u4e0d\u4f1a\u6b7b\u9501\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    NSLog(@\"\u4efb\u52a11\");\n    dispatch_queue_t queue = dispatch_get_main_queue();\n    dispatch_sync(queue, ^{\n        NSLog(@\"\u4efb\u52a12\");\n    });\n    NSLog(@\"\u4efb\u52a13\");\n}\n</code></pre> <pre><code>// \u5e26\u6709\u5ef6\u8fdf\u7684\u65b9\u6cd5\u672c\u8d28\u662f\u5f80 RunLoop \u4e2d\u6dfb\u52a0\u5b9a\u65f6\u5668\uff0c\u5b50\u7ebf\u7a0b\u9ed8\u8ba4\u6ca1\u6709\u542f\u52a8 runloop\ndispatch_queue_t queue = dispatch_get_global_queue(0, 0);\ndispatch_async(queue, ^{\n    NSLog(@\"\u4efb\u52a11\");\n    // \u5411 runloop \u4e2d\u6dfb\u52a0\u5b9a\u65f6\u5668\uff0c\u56e0\u4e3a\u8fd9\u91cc\u5e76\u6ca1\u6709\u83b7\u53d6runloop,\u5b50\u7ebf\u7a0b\u9ed8\u8ba4\u6ca1\u6709runloop\uff0c\u90a3\u8fd9\u4e2a\u4ee3\u7801\u5c31\u4e0d\u7ba1\u7528\u4e86\n    // \u5982\u679c\u5728block\u5bf9\u7ebf\u7a0b\u4fdd\u6d3b\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5728\u6b63\u5e38\u6267\u884c\n    [self performSelector:@selector(test) withObject:nil afterDelay:1];\n    NSLog(@\"\u4efb\u52a13\");\n\n    // \u52a0\u4e0a\u8fd9\u53e5\u5c31\u4f1a\u6b63\u5e38\u6267\u884c delay\u7684\u65b9\u6cd5\n    // [[NSRunLoop currentRunLoop] run];\n});\n</code></pre> <pre><code>// \u6253\u5370 1 \u7136\u540e\u5d29\u6e83\uff0c\u56e0\u4e3a start \u7684\u65f6\u5019\u5c31\u6267\u884c block \u5e76\u9000\u51fa thread\uff0c\u7b49\u4e0b\u9762\u8981performSelector \u7684\u65f6\u5019 thread \u5df2\u7ecf\u9000\u51fa\uff0c\u9664\u975e\u5728 block \u4e2d\u83b7\u53d6\u5e76\u5524\u9192 runloop\nNSThread * thread = [[NSThread alloc] initWithBlock:^{\n    NSLog(@\"1\");\n\n}];\n[thread start];\n[self performSelector:@selector(test) onThread:thread withObject:nil waitUntilDone:YES];\n\n</code></pre> <pre><code>// \u961f\u5217\u7ec4\uff0c\u53ef\u4ee5\u7528\u6765\u7ec4\u5408\u6267\u884c\u67d0\u4e9b\u7279\u5b9a\u7684\u4efb\u52a1\uff0c\u5e76\u4e14\u5728\u7ec4\u5408\u4efb\u52a1\u5b8c\u6210\u4e4b\u540e\u6267\u884c\u5176\u4ed6\u4efb\u52a1\ndispatch_group_t group = dispatch_group_create();\ndispatch_queue_t queue = dispatch_queue_create(\"queue\", DISPATCH_QUEUE_CONCURRENT);\ndispatch_group_async(group, queue, ^{\n    for (int i = 0 ; i&lt;5; i++) {\n        NSLog(@\"task1-%d\", i);\n    }\n});\ndispatch_group_async(group, queue, ^{\n    for (int i = 0 ; i&lt;5; i++) {\n        NSLog(@\"task2-%d\", i);\n    }\n});\n\n// \u7b49\u524d\u9762\u4efb\u52a1\u6267\u884c\u5b8c\u518d\u6267\u884c\u8be5\u4efb\u52a1\uff0c\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2anotify,\u518d\u6b21\u5e76\u53d1\u6267\u884c\u591a\u4e2a\u4efb\u52a1\uff0cqueue \u4e5f\u53ef\u4ee5\u6362\u6210\u4e3b\u7ebf\u7a0b\u961f\u5217\u6765\u56de\u5230\u4e3b\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\ndispatch_group_notify(group, queue, ^{\n    for (int i = 0 ; i&lt;5; i++) {\n        NSLog(@\"task3-%d\", i);\n    }\n});\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_3","title":"\u591a\u7ebf\u7a0b\u5b89\u5168\u9690\u60a3","text":"<ul> <li>\u8d44\u6e90\u5171\u4eab</li> <li> <ol> <li>\u4e00\u5757\u8d44\u6e90\u53ef\u80fd\u88ab\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\uff0c\u4e5f\u5c31\u662f\u591a\u4e2a\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u8bbf\u95ee\u540c\u4e00\u5757\u8d44\u6e90</li> </ol> </li> <li> <ol> <li>\u6bd4\u5982\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u5bf9\u8c61\uff0c\u540c\u4e00\u4e2a\u53d8\u91cf\uff0c\u540c\u4e00\u4e2a\u6587\u4ef6</li> </ol> </li> <li>\u5f53\u591a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u5757\u8d44\u6e90\u65f6\uff0c\u5f88\u5bb9\u6613\u53d1\u751f\u6570\u636e\u9519\u4e71\u548c\u6570\u636e\u5b89\u5168\u95ee\u9898</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_4","title":"\u591a\u7ebf\u7a0b\u5b89\u5168\u9690\u60a3\u7684\u89e3\u51b3\u65b9\u6848","text":"<ul> <li>\u89e3\u51b3\u65b9\u6848\uff1a \u4f7f\u7528\u7ebf\u7a0b\u540c\u6b65\u6280\u672f\uff08\u540c\u6b65\uff0c\u5c31\u662f\u534f\u540c\u6b65\u8c03\uff0c\u6309\u9884\u5b9a\u7684\u5148\u540e\u6b21\u5e8f\u8fdb\u884c\u8fd0\u884c\uff09</li> <li>\u5e38\u7528\u7684\u7ebf\u7a0b\u540c\u6b65\u6280\u672f\uff1a\u52a0\u9501</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#ios_1","title":"iOS \u7ebf\u7a0b\u540c\u6b65\u65b9\u6848","text":"<ul> <li>OSSpinLock(\u81ea\u65cb\u9501)</li> <li>os_unfair_lock</li> <li>pthread_mutex</li> <li>dispatch_semaphore</li> <li>dispatch_queue(DIAPATCH_QUEUE_SERIAL)</li> <li>NSLock</li> <li>NSRecursiveLock</li> <li>NSCondition</li> <li>NSConditionLock</li> <li>@synchronized</li> </ul> <p>\u8981\u4fdd\u8bc1\u540c\u4e00\u8d44\u6e90\u5171\u7528\u4e00\u628a\u9501</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#osspinlock","title":"OSSpinLock \u81ea\u65cb\u9501","text":"<ul> <li>OSSpinLock \u53eb\u505a\u81ea\u65cb\u9501\uff0c\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u4f1a\u5904\u4e8e\u5fd9\u7b49\uff08busy-wait\uff09\u72b6\u6001\uff0c\u4f1a\u4e00\u76f4\u5360\u7528 CPU \u8d44\u6e90</li> <li>\u76ee\u524d\u5df2\u7ecf\u4e0d\u5b89\u5168\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4f18\u5148\u7ea7\u53cd\u8f6c\u95ee\u9898</li> <li>\u5982\u679c\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u4f18\u5148\u7ea7\u8f83\u9ad8\uff0c\u5b83\u4f1a\u4e00\u76f4\u5360\u7528 CPU \u8d44\u6e90\uff0c\u4f18\u5148\u7ea7\u4f4e\u7684\u7ebf\u7a0b\u5c31\u65e0\u6cd5\u91ca\u653e\u9501</li> </ul> <pre><code>#import &lt;libkern/OSAtomic.h&gt;\n\nOSSpinLock _lock= OS_SPINLOCK_INIT;\nOSSpinLockTry(&amp;_lock); // \u5c1d\u8bd5\u52a0\u9501\uff0c\u5982\u679c\u5df2\u7ecf\u9501\u5b9a\u72b6\u6001\u5219\u8fd4\u56de false\nOSSpinLockLock(&amp;_lock);\nOSSpinLockUnlock(&amp;_lock);\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#os_unfair_lock","title":"os_unfair_lock","text":"<p>Low-level Lock\uff0c\u4f4e\u7ea7\u9501\uff0c\u7b49\u4e0d\u5230\u9501\u5c31\u4f11\u7720</p> <ul> <li>os_unfair_lock \u7528\u4e8e\u53d6\u4ee3\u4e0d\u5b89\u5168\u7684 OSSpinLock\uff0c\u4ece iOS 10 \u5f00\u59cb\u652f\u6301</li> <li>\u4ece\u5e95\u5c42\u770b\uff0c\u7b49\u5f85 os_unfair_lock \u9501\u7684\u7ebf\u7a0b\u4f1a\u5904\u4e8e\u4f11\u7720\u72b6\u6001\uff0c\u5e76\u975e\u5fd9\u7b49</li> <li>\u5982\u679c\u5bf9\u8d44\u6e90\u53ea\u52a0\u9501\u4e0d\u89e3\u9501\u90fd\u4f1a\u9020\u6210\u6b7b\u9501</li> </ul> <pre><code>#import &lt;os/lock.h&gt;\n\nos_unfair_lock lock = OS_UNFAIR_LOCK_INIT;\nos_unfair_lock_trylock(&amp;lock); // \u5c1d\u8bd5\u52a0\u9501\uff0c\u5982\u679c\u5df2\u7ecf\u9501\u5b9a\u72b6\u6001\u5219\u8fd4\u56de false\nos_unfair_lock_lock(&amp;lock);\nos_unfair_lock_unlock(&amp;lock);\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#pthread_mutex","title":"pthread_mutex","text":"<ul> <li>mutex \u53eb\u505a\u4e92\u65a5\u9501\uff0c\u7b49\u5f85\u7684\u7ebf\u7a0b\u4f1a\u5904\u4e8e\u4f11\u7720\u72b6\u6001</li> </ul> <pre><code>#define PTHREAD_MUTEX_NORMAL        0\n#define PTHREAD_MUTEX_ERRORCHECK    1\n\n// PTHREAD_MUTEX_RECURSIVE \u9012\u5f52\u9501\uff0c\u540c\u4e00\u7ebf\u7a0b\u5141\u8bb8\u5bf9\u540c\u4e00\u628a\u9501\u91cd\u590d\u52a0\u9501\uff0c\u5982\u679c\u4e0d\u7528\u9012\u5f52\u9501\uff0c\u5bf9\u540c\u4e00\u628a\u9501\u91cd\u590d\u52a0\u9501\u4f1a\u9020\u6210\u6b7b\u9501\n#define PTHREAD_MUTEX_RECURSIVE     2    \n#define PTHREAD_MUTEX_DEFAULT       PTHREAD_MUTEX_NORMAL\n\npthread_mutex_t mutex;\n// \u521d\u59cb\u5316\u5c5e\u6027\npthread_mutexattr_t attr;\npthread_mutexattr_init(&amp;attr);\npthread_mutexattr_settype(&amp;attr, PTHREAD_MUTEX_DEFAULT);\n// \u521d\u59cb\u5316 mutex \u9501\npthread_mutex_init(&amp;mutex, &amp;attr);\n// \u5c5e\u6027\u8bbe\u7f6e\u7ed9 mutex \u4e4b\u540e\u9500\u6bc1\u5c5e\u6027\npthread_mutexattr_destroy(&amp;attr);\n\npthread_mutex_lock(&amp;ticketMutex);\npthread_mutex_unlock(&amp;ticketMutex);\n\n// \u9501\u4f7f\u7528\u5b8c\u4e4b\u540e\u9500\u6bc1\u9501\npthread_mutex_destroy(&amp;mutex);\n\n// \u521d\u59cb\u5316\u6761\u4ef6\uff0c\npthread_cond_t condition;\npthread_cond_init(&amp;condition, NULL);\n\n// \u7b49\u5f85\u6761\u4ef6\uff08\u8fdb\u5165\u4f11\u7720\uff0c\u653e\u5f00 mutex \u9501\uff1b\u88ab\u5524\u9192\u540e\uff0c\u4f1a\u518d\u6b21\u5bf9 mutex \u52a0\u9501\uff09\npthread_cond_wait(&amp;condition, &amp;mutex);\n\n// \u6fc0\u6d3b\u4e00\u4e2a\u7b49\u5f85\u8be5\u6761\u4ef6\u7684\u7ebf\u7a0b\uff0c \u6fc0\u6d3b\u5176\u5b9e\u53ea\u662f\u53d1\u4e00\u4e2a\u4fe1\u53f7\u6fc0\u6d3b\u4f11\u7720\u7684\u7ebf\u7a0b\uff0c\u7136\u540e\u7b49\u9501\u88ab\u91ca\u653e\u4e4b\u540e\uff0c\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u5c31\u4f1a\u62ff\u5230\u9501\uff0c\u52a0\u9501\uff0c\u5e76\u7ee7\u7eed\u6267\u884c\npthread_cond_signal(&amp;condition);\n// \u6fc0\u6d3b\u6240\u6709\u7b49\u5f85\u8be5\u6761\u4ef6\u7684\u7ebf\u7a0b\npthread_cond_brodcast(&amp;condition);\npthread_cond_destory(&amp;condition);\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#nslocknsrecursivelock","title":"NSLock\uff0cNSRecursiveLock","text":"<ul> <li>NSLock \u662f\u5bf9 pthread_mutex \u666e\u901a\u9501\u7684\u5c01\u88c5</li> </ul> <pre><code>-(BOOL)tryLock;\n-(BOOL)lockBeforeDate:(NSData *)limit; // \u5728\u6307\u5b9a\u65f6\u95f4\u4e4b\u5185\u62ff\u5230\u9501\u5c31\u52a0\u9501\u5e76\u8fd4\u56de TRUE\uff0c \u5426\u5219\u8fd4\u56defalse\n-(void)lock;\n-(void)unLock;\n</code></pre> <ul> <li>NSRecursiveLock \u662f\u5bf9 pthread_mutex \u9012\u5f52\u9501\u7684\u5c01\u88c5\uff0cAPI \u540c NSLock \u4e00\u81f4</li> <li>NSCondition \u662f\u5bf9 mutex \u548c cont \u7684\u5c01\u88c5\uff0c\u53ef\u4ee5\u52a0\u9501\u89e3\u9501\u4ee5\u53ca\u8bbe\u7f6e\u7ebf\u7a0b\u4f11\u7720\u53ca\u5524\u9192</li> </ul> <pre><code>- (void)wait;\n- (BOOL)waitUntilDate:(NSDate *)limit;\n- (void)signal;\n- (void)broadcast;\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#nsconditionlock","title":"NSConditionLock","text":"<ul> <li>\u5bf9NSCondition\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u4f9d\u8d56\u5b8c\u6210\u672c\u7ebf\u7a0b\u4efb\u52a1\u4e4b\u540e\u89e3\u9501\u5e76\u8bbe\u7f6e\u6761\u4ef6\u503c\uff0c\u5e76\u89e6\u53d1\u5bf9\u5e94\u6761\u4ef6\u7ebf\u7a0b\u6267\u884c</li> </ul> <pre><code>// \u521d\u59cb\u5316\u7684\u65f6\u5019\u9700\u8981\u4f20\u5165\u6761\u4ef6\u503c\n- (instancetype)initWithCondition:(NSInteger)condition NS_DESIGNATED_INITIALIZER;\n\n@property (readonly) NSInteger condition;\n- (void)lock; // \u4e0d\u7ba1\u6761\u4ef6\uff0c\u80fd\u62ff\u5230\u9501\u76f4\u63a5\u52a0\u9501\n- (void)unlock;\n// \u5f53\u6761\u4ef6\u503c\u6ee1\u8db3\u4f20\u5165\u7684\u6761\u4ef6\u65f6\u624d\u4f1a\u52a0\u9501\u5e76\u5f80\u4e0b\u6267\u884c\uff0c\u5426\u5219\u7b49\u5728\u8fd9\u91cc\n- (void)lockWhenCondition:(NSInteger)condition;\n- (BOOL)tryLock;\n- (BOOL)tryLockWhenCondition:(NSInteger)condition;\n// \u89e3\u9501\uff0c\u5e76\u8bbe\u7f6e\u6761\u4ef6\u503c\uff0c\u7528\u6765\u89e6\u53d1\u5176\u4ed6\u7b49\u5f85\u8be5\u6761\u4ef6\u7684\u7ebf\u7a0b\u52a0\u9501\u5e76\u6267\u884c\n- (void)unlockWithCondition:(NSInteger)condition;\n- (BOOL)lockBeforeDate:(NSDate *)limit;\n- (BOOL)lockWhenCondition:(NSInteger)condition beforeDate:(NSDate *)limit;\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#dispatch_queue","title":"dispatch_queue","text":"<ul> <li>\u76f4\u63a5\u53ea\u7528GCD\u7684\u4e32\u884c\u961f\u5217\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7ebf\u7a0b\u540c\u6b65</li> <li>\u5c06\u8981\u6267\u884c\u7684\u4efb\u52a1\u5168\u90fd\u653e\u5230\u540c\u6b65\u6267\u884c\u7684\u540c\u6b65\u961f\u5217\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u4efb\u52a1\u6309\u987a\u5e8f\u6267\u884c</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#dispatch_semaphore","title":"dispatch_semaphore","text":"<ul> <li>semaphore \u53eb\u505a \u4fe1\u53f7\u91cf</li> <li>\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u503c\uff0c\u53ef\u4ee5\u7528\u6765\u63a7\u5236\u7ebf\u7a0b\u5e76\u53d1\u8bbf\u95ee\u7684\u6700\u5927\u6570\u91cf</li> </ul> <pre><code>dispatch_semaphore_t semaphore = dispatch_semaphore_create(5);\n// \u5982\u679c\u4fe1\u53f7\u91cf\u7684\u503c &gt; 0\uff0c\u90a3\u4e48\u4fe1\u53f7\u91cf\u503c\u51cf1\uff0c\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u4ee3\u7801\n// \u5982\u679c\u4fe1\u53f7\u91cf\u7684\u503c &lt;=0\uff0c\u90a3\u4e48\u4f11\u7720\u7b49\u5f85\uff0c DISPATCH_TIME_FOREVER \u6765\u63a7\u5236\u7b49\u5f85\u65f6\u95f4\uff0c\u4e00\u76f4\u5230\u4fe1\u53f7\u91cf\u7684\u503c\u53d8\u6210 &gt;0\uff0c\u7ee7\u7eed\u6267\u884c\u4e0b\u9762\u4ee3\u7801\ndispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);\n\n// \u4fe1\u53f7\u91cf\u503c +1\ndispatch_semaphore_signal(semaphore);\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#synchronized","title":"@synchronized","text":"<ul> <li>@synchronized \u662f\u5bf9 mutex \u9012\u5f52\u9501\u7684\u5c01\u88c5\uff0c\u652f\u6301\u9012\u5f52\u52a0\u9501</li> </ul> <pre><code>// \u53c2\u6570\u4e3a\u9501\u7684\u6807\u8bc6\uff0c\u8981\u4fdd\u8bc1\u540c\u4e00\u628a\u9501\u7684\u5bf9\u8c61\u4e3a\u540c\u4e00\u4e2a\n @synchronized (@\"money\") {\n    [super __getMoney: money];\n}\n</code></pre> <p>\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003 objc/objc-sync.mm </p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_5","title":"\u7ebf\u7a0b\u540c\u6b65\u65b9\u6848\u6027\u80fd\u5bf9\u6bd4","text":"<ul> <li> <p>\u6027\u80fd\u4ece\u9ad8\u5230\u4f4e</p> </li> <li> <p>os_unfair_lock</p> </li> <li>OSSpinLock</li> <li>dispatch_semaphore</li> <li>pthread_mutex(default)</li> <li>dispatch_queue(DISPATCH_QUEUE_SERIAL)</li> <li>NSLock</li> <li>NSCondition</li> <li>pthread_mutex(recursive)</li> <li>NSRecursiveLock</li> <li>NSConditionLock</li> <li>@synchronized</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#_6","title":"\u81ea\u65cb\u9501\u3001\u4e92\u65a5\u9501\u7684\u6bd4\u8f83","text":"<ul> <li> <p>\u4ec0\u4e48\u60c5\u51b5\u4f7f\u7528\u81ea\u65cb\u9501\u6bd4\u8f83\u5212\u7b97\uff1f</p> <p>\u9884\u8ba1\u7ebf\u7a0b\u7b49\u5f85\u9501\u7684\u4e8b\u4ef6\u5f88\u77ed \u52a0\u9501\u4ee3\u7801\uff08\u4e34\u754c\u533a\uff09\u7ecf\u5e38\u88ab\u8c03\u7528\uff0c\u4f46\u7ade\u4e89\u60c5\u51b5\u5f88\u5c11\u53d1\u751f CPU \u8d44\u6e90\u4e0d\u7d27\u5f20</p> </li> <li> <p>\u4ec0\u4e48\u60c5\u51b5\u4f7f\u7528\u4e92\u65a5\u9501\u6bd4\u8f83\u5212\u7b97\uff1f</p> <p>\u9884\u8ba1\u7ebf\u7a0b\u7b49\u5f85\u9501\u7684\u4e8b\u4ef6\u5f88\u957f \u5355\u6838\u5904\u7406\u5668 \u4e34\u754c\u533a\u6709IO\u64cd\u4f5c \u4e34\u754c\u533a\u4ee3\u7801\u6bd4\u8f83\u590d\u6742\u6216\u8005\u5faa\u73af\u91cf\u5927 \u4e34\u754c\u533a\u7ade\u4e89\u6fc0\u70c8</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#atomic","title":"atomic","text":"<p>atomic \u539f\u5b50\u6027</p> <p>\u7ed9\u5c5e\u6027\u52a0\u4e0a atomic\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5c5e\u6027\u7684 setter \u548c getter \u90fd\u662f\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u4fdd\u8bc1 setter \u548c getter \u5185\u90e8\u662f\u7ebf\u7a0b\u540c\u6b65\u7684</p> <p>\u53ef\u4ee5\u53c2\u8003\u6e90\u7801 objc/objc-accessors.mm</p> <p>\u4ec5\u80fd\u4fdd\u8bc1 setter \u548c getter \u5185\u90e8\u662f\u5b89\u5168\u7684\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u5c5e\u6027\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684</p> <p>\u7531\u4e8e\u6bd4\u8f83\u8017\u6027\u80fd\uff0c\u5e76\u4e14\u7528\u5230\u7684\u573a\u666f\u5e76\u4e0d\u591a\uff0c\u6240\u4ee5\u5728 iOS \u4e2d\u51e0\u4e4e\u4e0d\u7528 atomic</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/11-%E5%A4%9A%E7%BA%BF%E7%A8%8B/#ios_2","title":"iOS \u4e2d\u7684\u8bfb\u5199\u5b89\u5168","text":"<p>IO\u64cd\u4f5c\uff0c\u6587\u4ef6\u64cd\u4f5c</p> <p>\u5199\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u6709\u4e00\u6761\u7ebf\u7a0b\u5199 \u8bfb\uff0c\u5141\u8bb8\u591a\u6761\u7ebf\u7a0b\u540c\u65f6\u8bfb\u53d6 \u540c\u4e00\u65f6\u95f4\uff0c\u4e0d\u80fd\u65e2\u6709\u5199\u53c8\u6709\u8bfb</p> <p>pthread_rwlock: \u8bfb\u5199\u9501 dispatch_barrier_async</p> <pre><code>pthread_rwlock_t lock;\npthread_rwlock_init(&amp;lock, NULL);\npthread_rwlock_rdlock(&amp;lock);\npthread_rwlock_wrlock(&amp;lock);\npthread_rwlock_unlock(&amp;lock);\npthread_rwlock_destroy(&amp;lock);\n</code></pre> <pre><code>// \u5982\u679c\u4f7f\u7528 barrier,\u90a3\u4e48\u5fc5\u987b\u662f\u81ea\u5df1\u521b\u5efa\u7684\u5e76\u53d1\u961f\u5217\uff0c\u5982\u679c\u4e0d\u662f\u81ea\u5df1\u521b\u5efa\u7684\u5e76\u53d1\u961f\u5217\uff0c\u90a3\u4e48 dispatch_barrier_async \u6267\u884c\u4efb\u52a1\u5c31\u540c dispatch_async \u6ca1\u4ec0\u4e48\u533a\u522b\ndispatch_queue_t queue = dispatch_queue_create(\"iw_queue\", DISPATCH_QUEUE_CONCURRENT)\n// \u5199\u4efb\u52a1\ndispatch_async(queue, ^{});\n\n// \u8bfb\u4efb\u52a1\ndispatch_barrier_async(queue, ^{});\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","title":"12 \u5185\u5b58\u7ba1\u7406","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_1","title":"\u5185\u5b58\u7ba1\u7406","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#cadisplaylinknstimer","title":"CADisplayLink\u3002NSTimer \u4f7f\u7528\u6ce8\u610f","text":"<p>CADisplayLink\uff0cNSTimer \u4f1a\u5bf9 target \u4ea7\u751f\u5f3a\u5f15\u7528\uff0c\u5982\u679c target \u53c8\u5bf9\u4ed6\u4eec\u4ea7\u751f\u5f3a\u5f15\u7528\uff0c\u5c31\u4f1a\u5f15\u53d1\u5faa\u73af\u5f15\u7528</p> <ol> <li>NSTimer \u4f7f\u7528 Block</li> <li>\u901a\u8fc7 Proxy \u4ee3\u7406\u7c7b\u6765\u5b9e\u73b0 target\uff0c\u4f7f\u7528timer\u7684\u7c7b\u5bf9timer\u5f3a\u5f15\u7528\uff0ctimer \u5bf9\u4ee3\u7406\u7c7b\u5f3a\u5e94\u7528\uff0c\u4ee3\u7406\u7c7b\u5bf9\u4f7f\u7528 timer \u7684\u7c7b\u5f31\u5f15\u7528\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u6709\u5faa\u73af\u5f15\u7528\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5c06 invalidate \u5199\u5728 dealloc \u4e2d</li> </ol> <p>NSFoundation \u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4ea4\u505a NSProxy \u7684\u57fa\u7c7b\uff0c\u4e13\u95e8\u7528\u6765\u5b9e\u73b0\u4ee3\u7406\u7c7b\uff0c\u7ee7\u627f\u81ea NSProxy \u7684\u4ee3\u7406\u7c7b\uff0c\u5728\u8c03\u7528\u65b9\u6cd5\u7684\u65f6\u5019\u4f1a\u8df3\u8fc7\u6d88\u606f\u89e3\u6790\u9636\u6bb5\uff0c\u76f4\u63a5\u8fdb\u5165\u6d88\u606f\u8f6c\u53d1\uff0c\u800c\u5982\u679c\u901a\u8fc7\u7ee7\u627f NSObject \u5b9e\u73b0\u4ee3\u7406\u7c7b\uff0c\u4f1a\u8d70\u4e00\u904d\u5b8c\u6574\u7684\u6d88\u606f\u53d1\u9001\u8fc7\u7a0b</p> <pre><code>// proxy with object start\n@interface ProxyObj : NSObject\n@property(weak, nonatomic) id target;\n\n+(instancetype)proxyWithObj:(id)obj;\n@end\n\n@implementation ProxyObj\n+(instancetype)proxyWithObj:(id)obj{\n    ProxyObj *proxy = [[ProxyObj alloc] init];\n    proxy.target = obj;\n    return proxy;\n}\n-(id)forwardingTargetForSelector:(SEL)aSelector{\n    return self.target;\n}\n@end\n\n// proxy with object end\n\n// proxy with NSProxy start\n\n@interface ProxyWithNSProxy : NSProxy\n@property(weak, nonatomic) id target;\n\n+(instancetype)proxyWithTarget:(id) target;\n@end\n\n@interface CADisplayLinkDemo()\n@property(strong, nonatomic) CADisplayLink *link;\n@property(strong, nonatomic) NSTimer *timer;\n@end\n\n@implementation ProxyWithNSProxy\n+(instancetype)proxyWithTarget:(id) target{\n    ProxyWithNSProxy *proxy = [ProxyWithNSProxy alloc];\n    proxy.target = target;\n    return proxy;\n}\n// \u56e0\u4e3a NSProxy \u5728\u8fdb\u884c\u65b9\u6cd5\u8c03\u7528\u65f6\u4f1a\u8df3\u8fc7 msgSend \u9636\u6bb5\uff0c\u76f4\u63a5\u8fdb\u5165\u6d88\u606f\u8f6c\u53d1\uff0c\u6240\u4ee5\u76f4\u63a5\u5b9e\u73b0\u4e0b\u9762\u4e24\u4e2a\u65b9\u6cd5\u5373\u53ef\n// \u6548\u7387\u8981\u6bd4 NSObject \u66f4\u9ad8\n- (NSMethodSignature *)methodSignatureForSelector:(SEL)sel {\n    return [self.target methodSignatureForSelector:sel];\n}\n\n-(void)forwardInvocation:(NSInvocation *)invocation {\n    [invocation invokeWithTarget:self.target];\n}\n@end\n// proxy with NSProxy end\n\n@implementation CADisplayLinkDemo\n- (void)viewDidLoad{\n    [super viewDidLoad];\n    self.view.backgroundColor = UIColor.whiteColor;\n    // \u76f4\u63a5\u4f7f\u7528 target \u4f1a\u4ea7\u751f\u5faa\u73af\u5f15\u7528\uff0c\u5982\u679c\u4e0d\u624b\u52a8\u505c\u6389\u90a3\u4e48\u65e0\u6cd5\u8c03\u7528 dealloc\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5728 dealloc \u4e2d\u505c\u6389\uff0c\u5982\u679c\u7528 Proxy \u7c7b\u7684\u8bdd\n    // Proxy \u5bf9\u4e8e self  \u662f\u5f31\u5f15\u7528\uff0c\u8ba1\u65f6\u5668\u5bf9 proxy \u4ea7\u751f\u5f3a\u5f15\u7528\uff0c\u8fd9\u662f\u4e0d\u4f1a\u6709\u5faa\u73af\u5f15\u7528\uff0c\u53ef\u4ee5\u5c06\u505c\u6b62\u8ba1\u65f6\u5668\u7684\u65b9\u6cd5\u5199\u5728 dealloc \u4e2d\n    self.link = [CADisplayLink displayLinkWithTarget:[ProxyObj proxyWithObj:self] selector:@selector(testDisplayLink)];\n    [self.link addToRunLoop:[NSRunLoop currentRunLoop] forMode:NSDefaultRunLoopMode];\n    self.timer = [NSTimer scheduledTimerWithTimeInterval:1 target:[ProxyObj proxyWithObj:self] selector:@selector(testTimer) userInfo:nil repeats:YES];\n}\n\n-(void) testDisplayLink{\n    NSLog(@\"test display link\");\n}\n\n-(void) testTimer{\n    NSLog(@\"test timer\");\n}\n\n- (void)dealloc {\n    [self.link invalidate];\n    [self.timer invalidate];\n    NSLog(@\"viewcontroller delloc\");\n}\n@end\n</code></pre> \u4ee3\u7406\u7ee7\u627f\u81ea \u65b9\u6cd5\u8c03\u7528\u8fc7\u7a0b \u5176\u4ed6 NSObject \u5b8c\u6574\u7684\u65b9\u6cd5\u8c03\u7528\u8fc7\u7a0b \u5bf9\u4e8e\u6b63\u5e38\u7684 NSObject \u4e2d\u5b9e\u73b0\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u4e0d\u9700\u8981\u8f6c\u53d1 NSProxy \u76f4\u63a5\u8fdb\u5165\u65b9\u6cd5\u8f6c\u53d1 \u6240\u6709\u65b9\u6cd5\u90fd\u4f1a\u8f6c\u53d1\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u4f7f\u7528\u88ab\u4ee3\u7406\u7c7b\u81ea\u5df1\u53bb\u8c03\u7528\u65b9\u6cd5"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#gcd","title":"GCD \u5b9a\u65f6\u5668","text":"<p>NSTimer \u4f9d\u8d56\u4e8e RunLoop\uff0c\u5982\u679c RunLoop \u4efb\u52a1\u8fc7\u4e8e\u7e41\u91cd\uff0c\u90a3\u4e48\u4e5f\u53ef\u80fd\u5bfc\u81f4 NSTimer \u4e0d\u51c6\u65f6</p> <p>\u4f7f\u7528 GCD \u7684\u5b9a\u65f6\u5668\u4f1a\u66f4\u52a0\u51c6\u65f6\uff0c\u4e0d\u4f9d\u8d56 RunLoop\uff0c\u4e0d\u4f1a\u53d7 runloop mode \u5207\u6362\u5f71\u54cd</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#ios","title":"iOS \u5185\u5b58\u5e03\u5c40","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#tagged-pointer","title":"Tagged Pointer","text":"<ul> <li>\u4ece 64bit \u5f00\u59cb\uff0ciOS \u5f15\u5165\u4e86 Tagged Pointer \u6280\u672f\uff0c\u7528\u6765\u5b58\u50a8 NSNumber\u3001NSDate\u3001NSString \u7b49\u5c0f\u5bf9\u8c61\u7684\u5b58\u50a8</li> <li>\u5728\u6ca1\u6709\u4f7f\u7528 Tagged Pointer \u4e4b\u524d\uff0cNSNumber \u7b49\u5bf9\u8c61\u9700\u8981\u52a8\u6001\u5206\u914d\u5185\u5b58\u3001\u7ef4\u62a4\u5f15\u7528\u8ba1\u6570\u7b49\uff0cNSNumber \u6307\u9488\u5b58\u50a8\u7684\u662f\u5806\u4e2d NSNumber \u5bf9\u8c61\u7684\u5730\u5740\u503c</li> <li>\u4f7f\u7528 Tagged Pointer \u4e4b\u540e\uff0cNSNumber\u6307\u9488\u5b58\u50a8\u7684\u6570\u636e\u53d8\u4e3a\u4e3a tag+data\uff0c\u4e5f\u5c31\u662f\u5c06\u6570\u636e\u76f4\u63a5\u5b58\u50a8\u5728\u4e86\u6307\u9488\u4e2d</li> <li>\u5f53\u5bf9\u8c61\u6307\u9488\u7684\u6700\u4f4e\u6709\u6548\u4f4d\u662f1(\u5728 ARM\uff0c\u53caiOS 13 \u4e4b\u540e\uff0c\u6700\u9ad8\u4f4d\u662f1)\uff0c\u5219\u8be5\u6307\u9488\u4e3a Tagged Pointer</li> <li>\u5f53\u6307\u9488\u4e0d\u591f\u5b58\u50a8\u6570\u636e\u65f6\uff0c\u624d\u4f1a\u4f7f\u7528\u52a8\u6001\u5206\u914d\u5185\u5b58\u7684\u65b9\u5f0f\u6765\u5b58\u50a8\u6570\u636e</li> <li>objc_msgSend \u80fd\u8bc6\u522b Tagged Pointer\uff0c\u6bd4\u5982 NSNumber \u7684 intValue \u65b9\u6cd5\uff0c\u76f4\u63a5\u4ece\u6307\u9488\u63d0\u53d6\u6570\u636e\uff0c\u8282\u7701\u4e86\u4ee5\u524d\u8c03\u7528\u7684\u5f00\u9500</li> </ul> <pre><code>dispatch_queue_t queue = dispatch_get_global_queue(0,0);\nfor(int i = 0; i &lt; 1000; i++){\n    dispatch_async(queue, ^{\n        //\u5927\u5b57\u7b26\u4e32\uff0c\u4e3a\u5bf9\u8c61\uff0c\u7ed9\u5c5e\u6027\u8d4b\u503c\u65f6\u5e95\u5c42\u9700\u8981 retain release\uff0c\u800c\u591a\u7ebf\u7a0b\u4e0b\uff0c\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u5c5e\u6027\u53bb\u505a\u5bf9\u8c61\u7c7b\u578b\u7684\u5c5e\u6027\u8d4b\u503c\u65f6\uff0c\u53ef\u80fd\u4f1a\u5bf9\u5c5e\u6027\u539f\u6765\u7684\u503c\u591a\u6b21release\uff0c\u5c31\u4f1a\u5d29\u6e83\uff0c\u52a0\u9501\u53ef\u4ee5\u89e3\u51b3\n        self.name = [NSString stringwithFormat:@\"abcdefghijk\"];\n    });\n}\n\nfor(int i = 0; i &lt; 1000; i++){\n    dispatch_async(queue, ^{\n        // \u5c0f\u5b57\u7b26\u4e32\u5bf9\u8c61\uff0c\u6307\u9488\u4e2d\u5b58\u50a8\u7684\u662f Tagged Pointer\uff0c\u5bf9\u8c61\u5c5e\u6027\u8d4b\u503c\u7684\u65f6\u5019\u76f4\u63a5\u5c31\u662f\u6307\u9488\u5b58\u50a8\u7684 Tagged Pointer \u7684\u8d4b\u503c\uff0c\u4e0d\u9700\u8981 retain release \u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5d29\u6e83\n        self.name = [NSString stringwithFormat:@\"abc\"];\n    });\n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#oc","title":"OC \u5bf9\u8c61\u5185\u5b58\u7ba1\u7406","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#mrc","title":"MRC","text":"<p>\u5f15\u7528 retain \u7528\u5b8c release</p> <p>\u65e9\u671f\u9700\u8981\u4f7f\u7528 @synthesize &lt;#property#&gt; \u7684\u65b9\u5f0f\u544a\u8bc9\u7f16\u8bd1\u5668\u751f\u6210 getter/setter</p> <p>\u4e4b\u540e \u5c5e\u6027\u5173\u952e\u5b57 retain, assign, copy\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u751f\u6210\u4e0b\u5212\u7ebf\u5f00\u5934\u7684\u6210\u5458\u53d8\u91cf\uff0cgetter/setter \u7684\u65b9\u6cd5\u58f0\u660e\u53ca\u5b9e\u73b0</p> <p>\u7c7b\u65b9\u6cd5\u521d\u59cb\u5316\uff0c\u5185\u90e8\u57fa\u672c\u90fd\u5df2\u7ecf\u5b9e\u73b0\u4e86 autorelease\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u53bb release \u4e00\u904d</p> <pre><code>// \u4e0b\u9762\u8fd9\u4e09\u79cd\u5199\u6cd5\u5728 MRC \u4e0b\u662f\u76f8\u540c\u7684\u6548\u679c\nNSMutableArray *dic = [[NSMutableArray alloc] init];\n[dic release];\n\nNSMutableArray *dic = [[[NSMutableArray alloc] init] autorelease];\n\nNSMutableArray *dic = [NSMutableArray array];\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#copy","title":"copy","text":"<p>\u4ea7\u751f\u4e00\u4e2a\u526f\u672c\u5bf9\u8c61\uff0c\u4f7f\u5f97\u526f\u672c\u4e0e\u6e90\u5bf9\u8c61\u4e92\u4e0d\u5f71\u54cd</p> <p>iOS \u4e2d\uff08NSString\uff0cNSArray\uff0cNSDictionary\u7b49\uff09 \u63d0\u4f9b\u4e862\u4e2a\u62f7\u8d1d\u65b9\u6cd5 copy \u4e0d\u53ef\u53d8\u62f7\u8d1d\uff0c\u4ea7\u751f\u4e0d\u53ef\u53d8\u526f\u672c \u8fd4\u56de NS mutableCopy \u53ef\u53d8\u62f7\u8d1d\uff0c\u4ea7\u751f\u53ef\u53d8\u526f\u672c \u8fd4\u56de NSMutable</p> <p>\u7531\u4e8e copy \u4ea7\u751f\u4e86\u4e00\u4e2a\u65b0\u7684\u526f\u672c\uff0c\u6240\u4ee5\u5728 MRC \u73af\u5883\u4e0b\u4e5f\u9700\u8981\u5bf9 copy \u51fa\u6765\u7684\u5bf9\u8c61\u8fdb\u884c release \u6216\u8005\u4f7f\u7528 autorelease</p> <p>\u4e0d\u53ef\u53d8\u5bf9\u8c61 copy \u51fa\u6765\u7684\u5bf9\u8c61\u7531\u4e8e\u90fd\u662f\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u65b0\u521b\u5efa\u4e00\u4e2a\u526f\u672c\uff0c\u76f4\u63a5\u8fd4\u56de\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0cmutableCopy \u51fa\u6765\u7684\u4e3a\u53ef\u53d8\u5bf9\u8c61\u5c31\u4f1a\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u526f\u672c</p> <p>\u6df1\u62f7\u8d1d\u548c\u6d45\u62f7\u8d1d 1. \u6df1\u62f7\u8d1d\uff0c\u5185\u5bb9\u62f7\u8d1d\uff0c\u4ea7\u751f\u65b0\u5bf9\u8c61 2. \u6d45\u62f7\u8d1d\uff0c\u6307\u9488\u62f7\u8d1d\uff0c\u4e0d\u4ea7\u751f\u65b0\u5bf9\u8c61\uff0c\u8ba1\u6570\u5668 +1</p> <p>\u4e0d\u53ef\u53d8-&gt;\u4e0d\u53ef\u53d8\uff0c\u6d45\u62f7\u8d1d\uff0c\u5176\u4ed6\u6df1\u62f7\u8d1d</p> <p>\u5c5e\u6027\u7528 copy \u5173\u952e\u5b57\u4fee\u9970\uff0c\u90a3\u4e48\u5728 set \u7684\u65f6\u5019\u4f1a\u6267\u884c copy \u64cd\u4f5c\uff0c\u751f\u6210\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff0c\u6240\u4ee5 copy \u4fee\u9970\u7684\u5c5e\u6027\u4e0d\u53ef\u4ee5\u7528\u53ef\u53d8\u7c7b\u578b</p> <p>\u5b57\u7b26\u4e32\u4e00\u822c\u4f7f\u7528 copy \u4fee\u9970\uff0c\u6570\u7ec4\u6216\u5b57\u5178\u4e4b\u7c7b\u7684\u4e00\u822c\u7528 strong \u4fee\u9970</p> <p>\u9075\u5b88 NSCopying \u534f\u8bae\uff0c\u5e76\u5b9e\u73b0 copyWithZone \u5bf9\u8c61\u5c31\u53ef\u4ee5\u5b9e\u73b0 copy \u4e00\u4e2a\u65b0\u7684\u526f\u672c</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#_2","title":"\u5f15\u7528\u8ba1\u6570\u5b58\u50a8","text":"<p>\u5728 64bit \u4e2d\uff0c\u5f15\u7528\u8ba1\u6570\u53ef\u4ee5\u76f4\u63a5\u5b58\u50a8\u5728\u4f18\u5316\u8fc7\u7684 isa \u6307\u9488\u4e2d\uff0c\u4e5f\u53ef\u80fd\u5b58\u50a8\u5728 SideTable \u4e2d</p> <p>struct SideTable {     spinlock_t slock;     RefcountMap refcnts;     weak_table_t weak_table; }</p> <p>refcnts \u662f\u5b58\u653e\u7740\u5bf9\u8c61\u5f15\u7528\u8ba1\u6570\u7684\u6563\u5217\u8868</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#weak","title":"weak","text":"<p>weak  \u5b58\u5728\u4e86 sidetable \u4e2d\u7684 weak_table_t \u4e2d\uff0c\u88ab\u5f31\u5f15\u7528\u7684\u5bf9\u8c61\u88ab\u9500\u6bc1\u4e4b\u540e\uff0c\u4f1a\u4ece SideTable \u4e2d\u7684 \u5f31\u5f15\u7528\u8868\u4e2d\u627e\u5230\u5f15\u7528\u8be5\u5bf9\u8c61\u7684\u53d8\u91cf\uff0c\u5e76\u5c06\u5176\u7f6e\u7a7a</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#arc","title":"ARC","text":"<p>LLVM \u7f16\u8bd1\u5668\uff08\u81ea\u52a8\u6dfb\u52a0 release \u53ca retain\uff09 + Runtime (\u5f31\u5f15\u7528)</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#autorelease","title":"autorelease \u539f\u7406","text":"<pre><code>\nstruct __AtAutoreleasePool {\n    // \u6784\u9020\u51fd\u6570 \u521b\u5efa\n    __AtAutoreleasePool() {\n      atautoreleasepoolobj = objc_autoreleasePoolPush();\n    }\n    // \u6790\u6784\u51fd\u6570 \u9500\u6bc1\n    ~__AtAutoreleasePool() {\n      objc_autoreleasePoolPop(atautoreleasepoolobj);\n    }\n    void * atautoreleasepoolobj;\n};\n\n{ \n    __AtAutoreleasePool __autoreleasepool; \n    objc_autoreleasePoolPush()\n    Car *car = Car.alloc().init().autorelease();\n    objc_autoreleasePoolPop()\n}\n</code></pre> <ul> <li>\u81ea\u52a8\u91ca\u653e\u6c60\u7684\u4e3b\u8981\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\uff1a__AtAutoreleasePool\u3001AutoreleasePoolPage</li> <li>\u8c03\u7528\u4e86 autorelease \u7684\u5bf9\u8c61\u6700\u7ec8\u90fd\u662f\u901a\u8fc7 AutoreleasePoolPage \u5bf9\u8c61\u6765\u7ba1\u7406\u7684</li> <li>\u6e90\u7801\u5206\u6790</li> </ul> <pre><code>// \u6bcf\u4e2a AutoreleasePoolPage \u5bf9\u8c61\u5360\u7528 4096 \u5b57\u8282\uff0c\u9664\u4e86\u5b58\u653e\u81ea\u5df1\u7684\u6210\u5458\u53d8\u91cf\uff0c\u5269\u4e0b\u7684\u7a7a\u95f4\u7528\u6765\u5b58\u50a8 autorelease \u5bf9\u8c61\u7684\u5730\u5740\n// \u6240\u6709\u7684 AutoreleasePoolPage \u5bf9\u8c61\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u7684\u5f62\u5f0f\u8fde\u63a5\u5728\u4e00\u8d77\nstruct AutoreleasePoolPageData{\n    magic_t const magic;\n    __unsafe_unretained id *next;\n    pthread_t const thread;\n    AutoreleasePoolPage * const parent;\n    AutoreleasePoolPage *child;\n    uint32_t const depth;\n    uint32_t hiwat;\n}\n\nclass AutoreleasePoolPage : private AutoreleasePoolPageData {\n    // \u7528\u6765\u83b7\u53d6 AutoreleasePoolPage \u4e2d\u5b58\u653e\u5bf9\u8c61\u7684\u5f00\u59cb\u4f4d\u7f6e\n    static inline id * begin() \n\n    // \u7528\u6765\u83b7\u53d6 AutoreleasePoolPage \u4e2d\u5b58\u653e\u5bf9\u8c61\u7684\u7ed3\u675f\u4f4d\u7f6e\n    static inline id * end() \n\n    // \u5c06\u5bf9\u8c61\u5730\u5740\u653e\u5165 autoreleasepoolpage,\u5982\u679c\u5f53\u524dpage \u6ee1\u4e86\u7684\u8bdd\u4f1a\u7ee7\u7eed\u521b\u5efa\u65b0\u7684page,\u7136\u540e\u7ee7\u7eed\u5411\u65b0\u7684 page \u4e2d\u6dfb\u52a0\n    static inline void *push() \n\n    // \u627e\u5230 token \u6240\u5728\u7684\u5730\u5740\uff0c\u5e76\u8d4b\u503c\u7ed9stop,\u8c03\u7528 popPage \u7136\u540e\u4ece next\uff08\u4e5f\u5c31\u662f\u5f53\u524d pool \u4e2d\u4e0b\u4e00\u4e2a\u80fd\u5b58\u653e\u5bf9\u8c61\u7684\u5730\u5740\uff09 \u5f00\u59cb\u8c03\u7528 objc_release(obj) \u91ca\u653e\u81ea\u52a8\u91ca\u653e\u6c60\u7684\u5bf9\u8c61\u76f4\u5230 token \u6240\u5728\u7684\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5b58\u50a8 POOL_BOUNDARY \u7684\u4f4d\u7f6e\n}   static inline pop(void *token)\uff0c\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/12-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#runloop-autorelease","title":"runloop \u4e0e autorelease","text":"<p>Apple \u5b98\u65b9\u6587\u6863</p> <p>iOS \u5728\u4e3b\u7ebf\u7a0b runloop \u4e2d\u6ce8\u518c\u4e86\u4e24\u4e2a\u540c autoreleasepool \u76f8\u5173\u7684 observer\u3002</p> <p>\u4e00\u4e2aobserver\u4f1a\u76d1\u542c loopEntry \u4e8b\u4ef6\uff0c\u8c03\u52a8 autoreleasePoolPush</p> <p>\u53e6\u4e00\u4e2a\u76d1\u542c\u4e86 BeforeWaiting \u548c BeforeExit \u4e8b\u4ef6\uff0c\u8c03\u7528 autoreleasePoolPop \u6765\u91ca\u653e\u81ea\u52a8\u91ca\u653e\u6c60\u53d8\u91cf</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/","title":"13 \u4f18\u5316","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#_1","title":"\u4f18\u5316","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#cpu-gpu","title":"CPU \u548c GPU","text":"<ul> <li>\u5728\u5c4f\u5e55\u6210\u50cf\u7684\u8fc7\u7a0b\u4e2d\uff0cCPU\u548cGPU\u8d77\u7740\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528</li> <li> <ol> <li>CPU\uff08Central Processing Unit\uff0c\u4e2d\u592e\u5904\u7406\u5668\uff09: \u5bf9\u8c61\u7684\u521b\u5efa\u548c\u9500\u6bc1\u3001\u5bf9\u8c61\u5c5e\u6027\u7684\u8c03\u6574\u3001\u5e03\u5c40\u8ba1\u7b97\u3001\u6587\u672c\u7684\u8ba1\u7b97\u548c\u6392\u7248\u3001\u56fe\u7247\u7684\u683c\u5f0f\u8f6c\u6362\u548c\u89e3\u7801\u3001\u56fe\u50cf\u7684\u7ed8\u5236\uff08Core Graphics\uff09</li> </ol> </li> <li> <ol> <li>GPU\uff08Graphics Processing Unit\uff0c\u56fe\u5f62\u5904\u7406\u5668\uff09: \u7eb9\u7406\u7684\u6e32\u67d3</li> </ol> </li> </ul> <p>CPU \u8ba1\u7b97\uff0cGPU \u5b8c\u6210\u6e32\u67d3\u540e\u7f13\u5b58\u5230\u5e27\u7f13\u5b58\uff0c\u89c6\u9891\u63a7\u5236\u5668\u4ece\u5e27\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5e76\u663e\u793a\u5230\u5c4f\u5e55</p> <p>\u5728 iOS \u4e2d\u662f\u53cc\u7f13\u51b2\u673a\u5236\uff0c\u6709\u524d\u5e27\u7f13\u5b58\u3001\u540e\u5e27\u7f13\u5b58</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#_2","title":"\u5361\u987f\u89e3\u51b3\u7684\u4e3b\u8981\u601d\u8def","text":"<p>\u5c3d\u53ef\u80fd\u51cf\u5c11CPU\u3001GPU\u8d44\u6e90\u6d88\u8017</p> <p>\u6309\u716760FPS\u7684\u5237\u5e27\u7387\uff0c\u6bcf\u969416ms\u5c31\u4f1a\u6709\u4e00\u6b21VSync\u4fe1\u53f7\uff08\u4e00\u5e27\uff09</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#-cpu","title":"\u5361\u987f\u4f18\u5316 - CPU","text":"<ul> <li> <p>\u5c3d\u91cf\u7528\u8f7b\u91cf\u7ea7\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\u7528\u4e0d\u5230\u4e8b\u4ef6\u5904\u7406\u7684\u5730\u65b9\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528CALayer\u53d6\u4ee3UIView</p> </li> <li> <p>\u4e0d\u8981\u9891\u7e41\u5730\u8c03\u7528UIView\u7684\u76f8\u5173\u5c5e\u6027\uff0c\u6bd4\u5982frame\u3001bounds\u3001transform\u7b49\u5c5e\u6027\uff0c\u5c3d\u91cf\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u4fee\u6539</p> </li> <li> <p>\u5c3d\u91cf\u63d0\u524d\u8ba1\u7b97\u597d\u5e03\u5c40\uff0c\u5728\u6709\u9700\u8981\u65f6\u4e00\u6b21\u6027\u8c03\u6574\u5bf9\u5e94\u7684\u5c5e\u6027\uff0c\u4e0d\u8981\u591a\u6b21\u4fee\u6539\u5c5e\u6027</p> </li> <li> <p>Autolayout\u4f1a\u6bd4\u76f4\u63a5\u8bbe\u7f6eframe\u6d88\u8017\u66f4\u591a\u7684CPU\u8d44\u6e90</p> </li> <li> <p>\u56fe\u7247\u7684size\u6700\u597d\u521a\u597d\u8ddfUIImageView\u7684size\u4fdd\u6301\u4e00\u81f4</p> </li> <li> <p>\u63a7\u5236\u4e00\u4e0b\u7ebf\u7a0b\u7684\u6700\u5927\u5e76\u53d1\u6570\u91cf</p> </li> <li> <p>\u5c3d\u91cf\u628a\u8017\u65f6\u7684\u64cd\u4f5c\u653e\u5230\u5b50\u7ebf\u7a0b\uff0c\u6587\u672c\u5904\u7406\uff08\u5c3a\u5bf8\u8ba1\u7b97\u3001\u7ed8\u5236\uff09\uff0c\u56fe\u7247\u5904\u7406\uff08\u89e3\u7801\u3001\u7ed8\u5236\uff09</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#-gpu","title":"\u5361\u987f\u4f18\u5316 - GPU","text":"<ul> <li> <p>\u5c3d\u91cf\u907f\u514d\u77ed\u65f6\u95f4\u5185\u5927\u91cf\u56fe\u7247\u7684\u663e\u793a\uff0c\u5c3d\u53ef\u80fd\u5c06\u591a\u5f20\u56fe\u7247\u5408\u6210\u4e00\u5f20\u8fdb\u884c\u663e\u793a</p> </li> <li> <p>GPU\u80fd\u5904\u7406\u7684\u6700\u5927\u7eb9\u7406\u5c3a\u5bf8\u662f4096x4096\uff0c\u4e00\u65e6\u8d85\u8fc7\u8fd9\u4e2a\u5c3a\u5bf8\uff0c\u5c31\u4f1a\u5360\u7528CPU\u8d44\u6e90\u8fdb\u884c\u5904\u7406\uff0c\u6240\u4ee5\u7eb9\u7406\u5c3d\u91cf\u4e0d\u8981\u8d85\u8fc7\u8fd9\u4e2a\u5c3a\u5bf8</p> </li> <li> <p>\u5c3d\u91cf\u51cf\u5c11\u89c6\u56fe\u6570\u91cf\u548c\u5c42\u6b21</p> </li> <li> <p>\u51cf\u5c11\u900f\u660e\u7684\u89c6\u56fe\uff08alpha&lt;1\uff09\uff0c\u4e0d\u900f\u660e\u7684\u5c31\u8bbe\u7f6eopaque\u4e3aYES</p> </li> <li> <p>\u5c3d\u91cf\u907f\u514d\u51fa\u73b0\u79bb\u5c4f\u6e32\u67d3</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#_3","title":"\u79bb\u5c4f\u6e32\u67d3","text":"<ul> <li>\u5728OpenGL\u4e2d\uff0cGPU\u67092\u79cd\u6e32\u67d3\u65b9\u5f0f</li> <li>On-Screen Rendering\uff1a\u5f53\u524d\u5c4f\u5e55\u6e32\u67d3\uff0c\u5728\u5f53\u524d\u7528\u4e8e\u663e\u793a\u7684\u5c4f\u5e55\u7f13\u51b2\u533a\u8fdb\u884c\u6e32\u67d3\u64cd\u4f5c</li> <li> <p>Off-Screen Rendering\uff1a\u79bb\u5c4f\u6e32\u67d3\uff0c\u5728\u5f53\u524d\u5c4f\u5e55\u7f13\u51b2\u533a\u4ee5\u5916\u65b0\u5f00\u8f9f\u4e00\u4e2a\u7f13\u51b2\u533a\u8fdb\u884c\u6e32\u67d3\u64cd\u4f5c</p> </li> <li> <p>\u79bb\u5c4f\u6e32\u67d3\u6d88\u8017\u6027\u80fd\u7684\u539f\u56e0</p> </li> <li>\u9700\u8981\u521b\u5efa\u65b0\u7684\u7f13\u51b2\u533a</li> <li> <p>\u79bb\u5c4f\u6e32\u67d3\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u9700\u8981\u591a\u6b21\u5207\u6362\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u5148\u662f\u4ece\u5f53\u524d\u5c4f\u5e55\uff08On-Screen\uff09\u5207\u6362\u5230\u79bb\u5c4f\uff08Off-Screen\uff09\uff1b\u7b49\u5230\u79bb\u5c4f\u6e32\u67d3\u7ed3\u675f\u4ee5\u540e\uff0c\u5c06\u79bb\u5c4f\u7f13\u51b2\u533a\u7684\u6e32\u67d3\u7ed3\u679c\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\uff0c\u53c8\u9700\u8981\u5c06\u4e0a\u4e0b\u6587\u73af\u5883\u4ece\u79bb\u5c4f\u5207\u6362\u5230\u5f53\u524d\u5c4f\u5e55</p> </li> <li> <p>\u54ea\u4e9b\u64cd\u4f5c\u4f1a\u89e6\u53d1\u79bb\u5c4f\u6e32\u67d3\uff1f</p> </li> <li> <p>\u5149\u6805\u5316\uff0c<code>layer.shouldRasterize = YES</code></p> </li> <li> <p>\u906e\u7f69\uff0c<code>layer.mask</code></p> </li> <li> <p>\u5706\u89d2\uff0c\u540c\u65f6\u8bbe\u7f6e<code>layer.masksToBounds = YES</code>\u3001<code>layer.cornerRadius</code> \u5927\u4e8e 0     \u8003\u8651\u901a\u8fc7 CoreGraphics \u7ed8\u5236\u88c1\u526a\u5706\u89d2\uff0c\u6216\u8005\u53eb\u7f8e\u5de5\u63d0\u4f9b\u5706\u89d2\u56fe\u7247</p> </li> <li> <p>\u9634\u5f71\uff0clayer.shadowXXX\uff0c\u4f46\u662f\u5982\u679c\u8bbe\u7f6e\u4e86layer.shadowPath\u5c31\u4e0d\u4f1a\u4ea7\u751f\u79bb\u5c4f\u6e32\u67d3</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#_4","title":"\u5361\u987f\u68c0\u6d4b","text":"<ul> <li> <p>\u5e73\u65f6\u6240\u8bf4\u7684\u201c\u5361\u987f\u201d\u4e3b\u8981\u662f\u56e0\u4e3a\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u4e86\u6bd4\u8f83\u8017\u65f6\u7684\u64cd\u4f5c</p> </li> <li> <p>\u53ef\u4ee5\u6dfb\u52a0Observer\u5230\u4e3b\u7ebf\u7a0bRunLoop\u4e2d\uff0c\u901a\u8fc7\u76d1\u542cRunLoop\u72b6\u6001\u5207\u6362\u7684\u8017\u65f6\uff0c\u4ee5\u8fbe\u5230\u76d1\u63a7\u5361\u987f\u7684\u76ee\u7684</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#_5","title":"\u8017\u7535\u4f18\u5316","text":"<ul> <li> <p>\u5c3d\u53ef\u80fd\u964d\u4f4eCPU\u3001GPU\u529f\u8017</p> </li> <li> <p>\u5c11\u7528\u5b9a\u65f6\u5668</p> </li> <li> <p>\u4f18\u5316I/O\u64cd\u4f5c</p> <p>\u5c3d\u91cf\u4e0d\u8981\u9891\u7e41\u5199\u5165\u5c0f\u6570\u636e\uff0c\u6700\u597d\u6279\u91cf\u4e00\u6b21\u6027\u5199\u5165</p> </li> </ul> <p>\u8bfb\u5199\u5927\u91cf\u91cd\u8981\u6570\u636e\u65f6\uff0c\u8003\u8651\u7528dispatch_io\uff0c\u5176\u63d0\u4f9b\u4e86\u57fa\u4e8eGCD\u7684\u5f02\u6b65\u64cd\u4f5c\u6587\u4ef6I/O\u7684API\u3002\u7528dispatch_io\u7cfb\u7edf\u4f1a\u4f18\u5316\u78c1\u76d8\u8bbf\u95ee\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u7684\uff0c\u5efa\u8bae\u4f7f\u7528\u6570\u636e\u5e93\uff08\u6bd4\u5982SQLite\u3001CoreData\uff09</p> <ul> <li>\u7f51\u7edc\u4f18\u5316</li> <li> <ul> <li>\u51cf\u5c11\u3001\u538b\u7f29\u7f51\u7edc\u6570\u636e</li> </ul> </li> <li> <ul> <li>\u5982\u679c\u591a\u6b21\u8bf7\u6c42\u7684\u7ed3\u679c\u662f\u76f8\u540c\u7684\uff0c\u5c3d\u91cf\u4f7f\u7528\u7f13\u5b58</li> </ul> </li> <li> <ul> <li>\u4f7f\u7528\u65ad\u70b9\u7eed\u4f20\uff0c\u5426\u5219\u7f51\u7edc\u4e0d\u7a33\u5b9a\u65f6\u53ef\u80fd\u591a\u6b21\u4f20\u8f93\u76f8\u540c\u7684\u5185\u5bb9</li> </ul> </li> <li> <ul> <li>\u7f51\u7edc\u4e0d\u53ef\u7528\u65f6\uff0c\u4e0d\u8981\u5c1d\u8bd5\u6267\u884c\u7f51\u7edc\u8bf7\u6c42</li> </ul> </li> <li> <ul> <li>\u8ba9\u7528\u6237\u53ef\u4ee5\u53d6\u6d88\u957f\u65f6\u95f4\u8fd0\u884c\u6216\u8005\u901f\u5ea6\u5f88\u6162\u7684\u7f51\u7edc\u64cd\u4f5c\uff0c\u8bbe\u7f6e\u5408\u9002\u7684\u8d85\u65f6\u65f6\u95f4 \u6279\u91cf\u4f20\u8f93\uff0c\u6bd4\u5982\uff0c\u4e0b\u8f7d\u89c6\u9891\u6d41\u65f6\uff0c\u4e0d\u8981\u4f20\u8f93\u5f88\u5c0f\u7684\u6570\u636e\u5305\uff0c\u76f4\u63a5\u4e0b\u8f7d\u6574\u4e2a\u6587\u4ef6\u6216\u8005\u4e00\u5927\u5757\u4e00\u5927\u5757\u5730\u4e0b\u8f7d\u3002\u5982\u679c\u4e0b\u8f7d\u5e7f\u544a\uff0c\u4e00\u6b21\u6027\u591a\u4e0b\u8f7d\u4e00\u4e9b\uff0c\u7136\u540e\u518d\u6162\u6162\u5c55\u793a\u3002\u5982\u679c\u4e0b\u8f7d\u7535\u5b50\u90ae\u4ef6\uff0c\u4e00\u6b21\u4e0b\u8f7d\u591a\u5c01\uff0c\u4e0d\u8981\u4e00\u5c01\u4e00\u5c01\u5730\u4e0b\u8f7d</li> </ul> </li> <li> <p>\u5b9a\u4f4d\u4f18\u5316</p> </li> <li> <ul> <li>\u5982\u679c\u53ea\u662f\u9700\u8981\u5feb\u901f\u786e\u5b9a\u7528\u6237\u4f4d\u7f6e\uff0c\u6700\u597d\u7528CLLocationManager\u7684requestLocation\u65b9\u6cd5\u3002\u5b9a\u4f4d\u5b8c\u6210\u540e\uff0c\u4f1a\u81ea\u52a8\u8ba9\u5b9a\u4f4d\u786c\u4ef6\u65ad\u7535</li> </ul> </li> <li> <ul> <li>\u5982\u679c\u4e0d\u662f\u5bfc\u822a\u5e94\u7528\uff0c\u5c3d\u91cf\u4e0d\u8981\u5b9e\u65f6\u66f4\u65b0\u4f4d\u7f6e\uff0c\u5b9a\u4f4d\u5b8c\u6bd5\u5c31\u5173\u6389\u5b9a\u4f4d\u670d\u52a1 \u5c3d\u91cf\u964d\u4f4e\u5b9a\u4f4d\u7cbe\u5ea6\uff0c\u6bd4\u5982\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528\u7cbe\u5ea6\u6700\u9ad8\u7684kCLLocationAccuracyBest \u9700\u8981\u540e\u53f0\u5b9a\u4f4d\u65f6\uff0c\u5c3d\u91cf\u8bbe\u7f6epausesLocationUpdatesAutomatically\u4e3aYES\uff0c\u5982\u679c\u7528\u6237\u4e0d\u592a\u53ef\u80fd\u79fb\u52a8\u7684\u65f6\u5019\u7cfb\u7edf\u4f1a\u81ea\u52a8\u6682\u505c\u4f4d\u7f6e\u66f4\u65b0</li> </ul> </li> <li> <ul> <li>\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528startMonitoringSignificantLocationChanges\uff0c\u4f18\u5148\u8003\u8651startMonitoringForRegion:</li> </ul> </li> <li> <p>\u786c\u4ef6\u68c0\u6d4b\u4f18\u5316</p> </li> <li> <ul> <li>\u7528\u6237\u79fb\u52a8\u3001\u6447\u6643\u3001\u503e\u659c\u8bbe\u5907\u65f6\uff0c\u4f1a\u4ea7\u751f\u52a8\u4f5c(motion)\u4e8b\u4ef6\uff0c\u8fd9\u4e9b\u4e8b\u4ef6\u7531\u52a0\u901f\u5ea6\u8ba1\u3001\u9640\u87ba\u4eea\u3001\u78c1\u529b\u8ba1\u7b49\u786c\u4ef6\u68c0\u6d4b\u3002\u5728\u4e0d\u9700\u8981\u68c0\u6d4b\u7684\u573a\u5408\uff0c\u5e94\u8be5\u53ca\u65f6\u5173\u95ed\u8fd9\u4e9b\u786c\u4ef6</li> </ul> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#app","title":"APP \u542f\u52a8","text":"<ul> <li>APP\u7684\u542f\u52a8\u53ef\u4ee5\u5206\u4e3a2\u79cd</li> <li>\u51b7\u542f\u52a8\uff08Cold Launch\uff09\uff1a\u4ece\u96f6\u5f00\u59cb\u542f\u52a8APP</li> <li> <p>\u70ed\u542f\u52a8\uff08Warm Launch\uff09\uff1aAPP\u5df2\u7ecf\u5728\u5185\u5b58\u4e2d\uff0c\u5728\u540e\u53f0\u5b58\u6d3b\u7740\uff0c\u518d\u6b21\u70b9\u51fb\u56fe\u6807\u542f\u52a8APP</p> </li> <li> <p>APP\u542f\u52a8\u65f6\u95f4\u7684\u4f18\u5316\uff0c\u4e3b\u8981\u662f\u9488\u5bf9\u51b7\u542f\u52a8\u8fdb\u884c\u4f18\u5316</p> </li> <li> <p>\u901a\u8fc7\u6dfb\u52a0\u73af\u5883\u53d8\u91cf\u53ef\u4ee5\u6253\u5370\u51faAPP\u7684\u542f\u52a8\u65f6\u95f4\u5206\u6790\uff08Edit scheme -&gt; Run -&gt; Arguments\uff09</p> </li> <li>DYLD_PRINT_STATISTICS\u8bbe\u7f6e\u4e3a1</li> <li>\u5982\u679c\u9700\u8981\u66f4\u8be6\u7ec6\u7684\u4fe1\u606f\uff0c\u90a3\u5c31\u5c06DYLD_PRINT_STATISTICS_DETAILS\u8bbe\u7f6e\u4e3a1</li> </ul> <p>dyld\uff08dynamic link editor\uff09\uff0cApple\u7684\u52a8\u6001\u94fe\u63a5\u5668\uff0c\u53ef\u4ee5\u7528\u6765\u88c5\u8f7dMach-O\u6587\u4ef6\uff08\u53ef\u6267\u884c\u6587\u4ef6\u3001\u52a8\u6001\u5e93\u7b49\uff09</p> <p>\u542f\u52a8APP\u65f6\uff0cdyld\u6240\u505a\u7684\u4e8b\u60c5\u6709 \u88c5\u8f7dAPP\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u540c\u65f6\u4f1a\u9012\u5f52\u52a0\u8f7d\u6240\u6709\u4f9d\u8d56\u7684\u52a8\u6001\u5e93 \u5f53dyld\u628a\u53ef\u6267\u884c\u6587\u4ef6\u3001\u52a8\u6001\u5e93\u90fd\u88c5\u8f7d\u5b8c\u6bd5\u540e\uff0c\u4f1a\u901a\u77e5Runtime\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u5904\u7406</p> <p>\u542f\u52a8APP\u65f6\uff0cruntime\u6240\u505a\u7684\u4e8b\u60c5\u6709 \u8c03\u7528map_images\u8fdb\u884c\u53ef\u6267\u884c\u6587\u4ef6\u5185\u5bb9\u7684\u89e3\u6790\u548c\u5904\u7406 \u5728load_images\u4e2d\u8c03\u7528call_load_methods\uff0c\u8c03\u7528\u6240\u6709Class\u548cCategory\u7684+load\u65b9\u6cd5 \u8fdb\u884c\u5404\u79cdobjc\u7ed3\u6784\u7684\u521d\u59cb\u5316\uff08\u6ce8\u518cObjc\u7c7b\u00a0\u3001\u521d\u59cb\u5316\u7c7b\u5bf9\u8c61\u7b49\u7b49\uff09 \u8c03\u7528C++\u9759\u6001\u521d\u59cb\u5316\u5668\u548c__attribute__((constructor))\u4fee\u9970\u7684\u51fd\u6570</p> <p>\u5230\u6b64\u4e3a\u6b62\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u548c\u52a8\u6001\u5e93\u4e2d\u6240\u6709\u7684\u7b26\u53f7(Class\uff0cProtocol\uff0cSelector\uff0cIMP\uff0c\u2026)\u90fd\u5df2\u7ecf\u6309\u683c\u5f0f\u6210\u529f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u88abruntime \u6240\u7ba1\u7406</p> <p>\u603b\u7ed3\u4e00\u4e0b APP\u7684\u542f\u52a8\u7531dyld\u4e3b\u5bfc\uff0c\u5c06\u53ef\u6267\u884c\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u987a\u4fbf\u52a0\u8f7d\u6240\u6709\u4f9d\u8d56\u7684\u52a8\u6001\u5e93 \u5e76\u7531runtime\u8d1f\u8d23\u52a0\u8f7d\u6210objc\u5b9a\u4e49\u7684\u7ed3\u6784 \u6240\u6709\u521d\u59cb\u5316\u5de5\u4f5c\u7ed3\u675f\u540e\uff0cdyld\u5c31\u4f1a\u8c03\u7528main\u51fd\u6570 \u63a5\u4e0b\u6765\u5c31\u662fUIApplicationMain\u51fd\u6570\uff0cAppDelegate\u7684application:didFinishLaunchingWithOptions:\u65b9\u6cd5</p> <ul> <li>\u6309\u7167\u4e0d\u540c\u7684\u9636\u6bb5</li> <li> <ul> <li>dyld</li> </ul> </li> <li>\u51cf\u5c11\u52a8\u6001\u5e93\u3001\u5408\u5e76\u4e00\u4e9b\u52a8\u6001\u5e93\uff08\u5b9a\u671f\u6e05\u7406\u4e0d\u5fc5\u8981\u7684\u52a8\u6001\u5e93\uff09</li> <li>\u51cf\u5c11Objc\u7c7b\u3001\u5206\u7c7b\u7684\u6570\u91cf\u3001\u51cf\u5c11Selector\u6570\u91cf\uff08\u5b9a\u671f\u6e05\u7406\u4e0d\u5fc5\u8981\u7684\u7c7b\u3001\u5206\u7c7b\uff09</li> <li>\u51cf\u5c11C++\u865a\u51fd\u6570\u6570\u91cf</li> <li> <p>Swift\u5c3d\u91cf\u4f7f\u7528struct</p> </li> <li> <ul> <li>runtime</li> </ul> </li> <li> <p>\u7528+initialize\u65b9\u6cd5\u548cdispatch_once\u53d6\u4ee3\u6240\u6709\u7684__attribute__((constructor))\u3001C++\u9759\u6001\u6784\u9020\u5668\u3001ObjC\u7684+load</p> </li> <li> <ul> <li>main</li> </ul> </li> <li>\u5728\u4e0d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u53ef\u80fd\u5c06\u4e00\u4e9b\u64cd\u4f5c\u5ef6\u8fdf\uff0c\u4e0d\u8981\u5168\u90e8\u90fd\u653e\u5728finishLaunching\u65b9\u6cd5\u4e2d</li> <li>\u6309\u9700\u52a0\u8f7d</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#app_1","title":"APP \u7626\u8eab","text":"<ul> <li>\u8d44\u6e90\uff08\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u7b49\uff09\uff0c\u538b\u7f29\uff0c\u53bb\u9664\u65e0\u7528\u8d44\u6e90</li> <li>\u7f16\u8bd1\u5668\u4f18\u5316\uff08Strip Linked Product\u3001Make Strings Read-Only\u3001Symbols Hidden by Default\u8bbe\u7f6e\u4e3aYES \uff09\uff0c\u53bb\u6389\u5f02\u5e38\u652f\u6301\uff08Enable C++ Exceptions\u3001Enable Objective-C Exceptions\u8bbe\u7f6e\u4e3aNO\uff0c Other C Flags\u6dfb\u52a0-fno-exceptions\uff09</li> <li>\u53bb\u6389\u672a\u4f7f\u7528\u4ee3\u7801\uff0c\u4f18\u5316\u91cd\u590d\u4ee3\u7801\u7b49</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/13-%E4%BC%98%E5%8C%96/#linkmap","title":"LinkMap","text":"<ul> <li>\u751f\u6210LinkMap\u6587\u4ef6\uff0c\u53ef\u4ee5\u67e5\u770b\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5177\u4f53\u7ec4\u6210</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/14-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/","title":"14 \u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7d","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/14-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8A%A0%E8%BD%BD/#_1","title":"\u5e94\u7528\u7a0b\u5e8f\u52a0\u8f7d","text":"<p>load -&gt; C++ -&gt; main()</p> <p>dyld: 1. \u73af\u5883\u53d8\u91cf\u7684\u914d\u7f6e 2. \u5171\u4eab\u7f13\u5b58  3. \u4e3b\u7a0b\u5e8f\u7684\u521d\u59cb\u5316 4. \u63d2\u5165\u52a8\u6001\u5e93 5. link \u4e3b\u7a0b\u5e8f 6. link \u52a8\u6001\u5e93 7. main()</p> <p>read_images</p> <ol> <li>\u6761\u4ef6\u63a7\u5236\u8fdb\u884c\u4e00\u6b21\u7684\u52a0\u8f7d</li> <li>\u4fee\u590d\u9884\u7f16\u8bd1\u9636\u6bb5<code>@selector</code> \u7684\u6df7\u4e71\u95ee\u9898</li> <li>\u4fee\u590d\u6df7\u4e71\u7684\u7c7b\u5904\u7406</li> <li>\u4fee\u590d\u91cd\u6620\u5c04\u4e00\u4e9b\u6ca1\u6709\u88ab\u955c\u50cf\u6587\u4ef6\u52a0\u8f7d\u8fdb\u6765\u7684\u7c7b</li> <li>\u4fee\u590d\u4e00\u4e9b\u6d88\u606f</li> <li>\u5f53\u6211\u4eec\u7c7b\u91cc\u9762\u6709\u534f\u8bae\u7684\u65f6\u5019\uff1areadProtocol</li> <li>\u4fee\u590d\u6ca1\u6709\u88ab\u52a0\u8f7d\u7684\u534f\u8bae</li> <li>\u5206\u7c7b\u5904\u7406</li> <li>\u7c7b\u7684\u52a0\u8f7d\u5904\u7406</li> <li>\u6ca1\u6709\u88ab\u5904\u7406\u7684\u7c7b \u4f18\u5316\u88ab\u4fb5\u72af\u7684\u7c7b</li> </ol> <p>\u7c7b\u52a0\u8f7d \u61d2\u52a0\u8f7d\u7684\u60c5\u51b5 1. lookUpImpOrForword 2. realizeClassMaybeSwiftMaybeRelock 3. relizeClassWithoutSwift 4. methodizeClass</p> <p>\u975e\u61d2\u52a0\u8f7d\u7c7b 1. _getObjc2NonlazeClassList 2. readClass 3. relizeClassWithoutSwift 4. methodizeClass</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/","title":"InterviewQuestions","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#nsobject","title":"\u4e00\u4e2a NSObject \u5bf9\u8c61\u5360\u591a\u5c11\u5185\u5b58","text":"<ul> <li>\u7cfb\u7edf\u5206\u914d\u4e86 16 \u4e2a\u5b57\u8282\u7ed9 NSObject \u5bf9\u8c61\uff08\u901a\u8fc7 <code>malloc_size</code> \u51fd\u6570\u83b7\u5f97\uff09</li> <li>\u4f46\u662f NSObject \u5bf9\u8c61\u5185\u90e8\u53ea\u4f7f\u7528\u4e86 8 \u4e2a\u5b57\u8282\u7684\u7a7a\u95f4\u7528\u6765\u5b58\u50a8 isa \u6307\u9488(64bit \u73af\u5883\u4e0b\uff0c\u901a\u8fc7 <code>class_getInstanceSize</code> \u51fd\u6570\u83b7\u5f97)</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#isa","title":"\u5bf9\u8c61\u7684 isa \u6307\u9488\u6307\u5411\u5728\u54ea\u91cc","text":"<p>\u5b9e\u4f8b \uff08instance\uff09\u3001\u7c7b\uff08class\uff09\u3001\u5143\u7c7b\uff08meta-class\uff09 class\u5bf9\u8c61\u3001meta-class\u5bf9\u8c61 \u5728\u5185\u5b58\u4e2d\u53ea\u6709\u4e00\u4efd</p> <ul> <li>instance \u5bf9\u8c61\u7684 isa \u6307\u9488\u6307\u5411 class \u5bf9\u8c61</li> <li>class \u5bf9\u8c61\u7684 isa \u6307\u9488\u6307\u5411 meta-class \u5bf9\u8c61</li> <li>meta-class \u5bf9\u8c61\u7684 isa \u6307\u9488\u6307\u5411\u57fa\u7c7b\u7684 meta-class \u5bf9\u8c61</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_1","title":"\u7c7b\u4fe1\u606f\u5b58\u653e\u5728\u54ea\u91cc","text":"<ul> <li>\u5c5e\u6027\u503c\u5b58\u653e\u5728 instance \u5bf9\u8c61\u4e2d</li> <li>\u5bf9\u8c61\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u6210\u5458\u53d8\u91cf\u3001\u534f\u8bae \u4fe1\u606f\u5b58\u653e\u5728 class \u5bf9\u8c61\u4e2d</li> <li>\u7c7b\u65b9\u6cd5\u5b58\u653e\u5728 meta-class \u5bf9\u8c61\u4e2d</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#ios-kvokvo","title":"iOS \u7528\u4ec0\u4e48\u65b9\u6cd5\u5b9e\u73b0\u4e00\u4e2a\u5bf9\u8c61\u7684 KVO\uff08KVO \u7684\u672c\u8d28\u662f\u4ec0\u4e48\uff09","text":"<ul> <li>\u5229\u7528 RuntimeAPI \u52a8\u6001\u751f\u6210\u4e00\u4e2a\u5b50\u7c7b\uff0c\u5e76\u4e14\u8ba9 instance \u5bf9\u8c61\u7684 isa \u6307\u5411\u8fd9\u4e2a\u5168\u65b0\u7684\u5b50\u7c7b</li> <li>\u5f53\u4fee\u6539 instance \u5bf9\u8c61\u7684\u5c5e\u6027\u65f6\uff0c\u4f1a\u8c03\u7528 Foundation \u7684 _NSSetXXXValueAndNotify \u51fd\u6570</li> <li> <ul> <li>willChangeValueForKey:</li> </ul> </li> <li> <ul> <li>\u7236\u7c7b\u539f\u6765\u7684 setter</li> </ul> </li> <li> <ul> <li>didChangeValueForKey: (\u8be5\u65b9\u6cd5\u5728<code>NSObject(NSKeyValueObserverNotification)</code>\u4e2d\u5b9e\u73b0\u4e86\u5bf9 \u89c2\u5bdf\u8005 \u76d1\u542c\u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5982\u679c\u5b50\u7c7b\u6709\u91cd\u5199\u8be5\u65b9\u6cd5\u5e76\u4e14\u672a\u8c03\u7528super\uff0c\u90a3\u4e48\u89c2\u5bdf\u8005\u7684\u76d1\u542c\u65b9\u6cd5\u5c31\u65e0\u6cd5\u88ab\u8c03\u7528)</li> </ul> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#kvo","title":"\u5982\u4f55\u624b\u52a8\u89e6\u53d1 KVO","text":"<pre><code>[self.person1 willChangeValueForKey:@\"age\"];\n// didChangeValueForKey \u4e2d\u4f1a\u6709\u5224\u65ad\u662f\u5426\u8c03\u7528\u4e86 willChangeValueForKey\uff0c\u6240\u4ee5\u5982\u679c\u60f3\u89e6\u53d1 KVO \u90a3\u4e48\u9700\u8981\u5c06\u4e24\u4e2a\u65b9\u6cd5\u4e00\u8d77\u8c03\u7528\u624d\u53ef\u4ee5\n[self.person1 didChangeValueForKey:@\"age\"];\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#kvo_1","title":"\u76f4\u63a5\u4fee\u6539\u6210\u5458\u53d8\u91cf\u4f1a\u89e6\u53d1 KVO \u4e48\uff1f","text":"<p>\u80af\u5b9a\u4e0d\u4f1a\uff0c\u76f4\u63a5\u4fee\u6539\u6210\u5458\u53d8\u91cf\u7684\u503c\u5e76\u4e0d\u4f1a\u8c03\u7528 set \u65b9\u6cd5\uff0c\u4e5f\u4e0d\u4f1a\u8d70 KVO \u7684\u6d41\u7a0b\u3002\u3002\u3002 \u5982\u679c\u60f3\u89e6\u53d1\uff0c\u90a3\u4e48\u9700\u8981\u624b\u52a8\u89e6\u53d1</p> <pre><code>[self.person1 willChangeValueForKey:@\"age\"];\nself.person1-&gt;_age\n[self.person1 didChangeValueForKey:@\"age\"];\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#kvc-kvo","title":"\u901a\u8fc7 KVC \u4fee\u6539\u5c5e\u6027\u7684\u65f6\u5019\u4f1a\u4e0d\u4f1a\u89e6\u53d1 KVO","text":"<ul> <li>\u53ef\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u5c5e\u6027\u53ea\u6709\u6210\u5458\u53d8\u91cf\uff0c\u53ea\u8981\u80fd\u4fdd\u8bc1 KVC \u7684\u6b63\u5e38\u8c03\u7528\u5c31\u80fd\u89e6\u53d1 KVO</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#kvc","title":"KVC \u7684\u8d4b\u503c\u548c\u53d6\u503c\u7684\u8fc7\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff0c\u539f\u7406\u662f\u4ec0\u4e48","text":"<p>\u8bf7\u53c2\u89c1</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category","title":"Category","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category_1","title":"Category \u7684\u4f7f\u7528\u573a\u5408\u662f\u4ec0\u4e48","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category_2","title":"Category \u7684\u5b9e\u73b0\u539f\u7406\u662f\u4ec0\u4e48","text":"<ul> <li>\u5e95\u5c42\u7ed3\u6784\u662f struct category_t, \u91cc\u9762\u5b58\u50a8\u7740\u5206\u7c7b\u7684\u5bf9\u8c61\u65b9\u6cd5\u3001\u7c7b\u65b9\u6cd5\u3001\u5c5e\u6027\u3001\u534f\u8bae\u4fe1\u606f</li> <li>\u5728\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0cruntime \u4f1a\u5c06 Category \u7684\u6570\u636e\uff0c\u5408\u5e76\u5230\u7c7b\u4e2d\uff08\u7c7b\u5bf9\u8c61\uff0c\u5143\u7c7b\u5bf9\u8c61\u4e2d\uff09</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category-class-extension","title":"Category \u548c Class Extension \u7684\u533a\u522b\u662f\u4ec0\u4e48","text":"<ul> <li>Class Extension \u5728\u7f16\u8bd1\u65f6\uff0c\u5b83\u7684\u6570\u636e\u5c31\u5df2\u7ecf\u5305\u542b\u5728\u7c7b\u4fe1\u606f\u4e2d</li> <li>\u800c Category \u662f\u5728\u8fd0\u884c\u65f6\uff0c\u624d\u4f1a\u5c06\u6570\u636e\u5408\u5e76\u5230\u7c7b\u4fe1\u606f\u4e2d</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category-load-load-load","title":"Category \u4e2d\u6709 load \u65b9\u6cd5\u4e48\uff1fload \u65b9\u6cd5\u662f\u4ec0\u4e48\u65f6\u5019\u8c03\u7528\u7684\uff0cload \u65b9\u6cd5\u80fd\u7ee7\u627f\u4e48","text":"<ul> <li>\u6709</li> <li>\u5728runtime \u5728\u52a0\u8f7d \u7c7b\u548c\u5206\u7c7b\u7684\u65f6\u5019\u8c03\u7528\u7684</li> <li> <ul> <li>\u5148\u8c03\u7528\u7c7b\u7684 +load \uff08\u6309\u7167\u7f16\u8bd1\u5148\u540e\u987a\u5e8f\u8c03\u7528\uff0c\u5148\u7f16\u8bd1\u5148\u8c03\u7528\uff0c\u8c03\u7528\u5b50\u7c7b\u7684 load \u4e4b\u524d\u4f1a\u5148\u8c03\u7528\u7236\u7c7b\u7684 load\uff09</li> </ul> </li> <li> <ul> <li>\u5728\u8c03\u7528\u5206\u7c7b\u7684 load\uff08\u540c\u6837\u6309\u7167\u7f16\u8bd1\u5148\u540e\u987a\u5e8f\u8c03\u7528\uff09</li> </ul> </li> <li> <p>\u53ef\u4ee5\u7ee7\u627f\uff0c\u4f46\u662f\u4e00\u822c\u4e0d\u4f1a\u4e3b\u52a8\u8c03\u7528 load \u65b9\u6cd5\uff0cload \u662f\u4f9b\u7cfb\u7edf\u6765\u8c03\u7528\u7684</p> </li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#loadinitialize-category","title":"load\u3001initialize \u7684\u65b9\u6cd5\u533a\u522b\u662f\u4ec0\u4e48\uff1f\u5b83\u4eec\u5728 Category \u4e2d\u7684\u8c03\u7528\u987a\u5e8f\uff0c\u4ee5\u53ca\u51fa\u73b0\u7ee7\u627f\u65f6\u4ed6\u4eec\u4e4b\u95f4\u7684\u8c03\u7528\u8fc7\u7a0b","text":"<ol> <li>\u8c03\u7528\u65b9\u5f0f</li> <li> <p><code>+load</code> \u6839\u636e\u51fd\u6570\u5730\u5740\u76f4\u63a5\u8c03\u7528\uff0c <code>+initialize</code> \u901a\u8fc7 <code>objc_msgSend</code> \u8c03\u7528</p> </li> <li> <p>\u8c03\u7528\u65f6\u523b</p> </li> <li>load \u662f runtime \u52a0\u8f7d \u7c7b\u3001\u5206\u7c7b\u7684\u65f6\u5019\u8c03\u7528\uff0c\u53ea\u8c03\u7528\u4e00\u6b21</li> <li> <p>initialize \u662f\u7c7b\u7b2c\u4e00\u6b21\u6536\u5230\u6d88\u606f\u7684\u65f6\u5019\u8c03\u7528\uff0c\u6bcf\u4e2a\u7c7b\u53ea\u4f1a initialize \u4e00\u6b21\uff08\u7236\u7c7b\u7684 initialize \u65b9\u6cd5\u53ef\u80fd\u4f1a\u88ab\u8c03\u7528\u591a\u6b21\uff0c\u4f46\u662f\u8c03\u7528\u8005\u4e3a\u672a\u5b9e\u73b0 initialize \u65b9\u6cd5\u7684\u5b50\u7c7b\uff0c\u5176\u76ee\u7684\u662f initialize \u5b50\u7c7b\uff09</p> </li> <li> <p>\u8c03\u7528\u987a\u5e8f</p> </li> <li>load \u5148\u8c03\u7528\u7c7b\u7684 load\uff0c\u518d\u8c03\u7528\u5206\u7c7b\u7684 load\uff08\u7f16\u8bd1\u987a\u5e8f\uff09\uff0c\u5148\u7f16\u8bd1\u7684\u7c7b\u5148\u8c03\u7528 load\uff0c\u4f46\u662f\u8c03\u7528\u5b50\u7c7b load \u4e4b\u524d\u4f1a\u5148\u8c03\u7528 \u7236\u7c7b\u7684 load\uff08\u5728\u8c03\u7528load\u4e4b\u524d\u4f1a\u5728\u7f16\u8bd1\u987a\u5e8f\u7684\u57fa\u7840\u4e0a\u91cd\u6392\u7c7b\uff0c\u5c06\u7236\u7c7b\u653e\u5728\u524d\u9762\uff09</li> <li>initialize \u5148\u521d\u59cb\u5316\u7236\u7c7b\uff0c\u518d\u521d\u59cb\u5316\u5b50\u7c7b</li> </ol>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#category_3","title":"Category \u80fd\u5426\u6dfb\u52a0\u6210\u5458\u53d8\u91cf\uff1f\u5982\u679c\u53ef\u4ee5\uff0c\u5982\u4f55\u6dfb\u52a0","text":"<ul> <li>Category \u4e0d\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u6210\u5458\u53d8\u91cf\uff0c\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7\u95f4\u63a5\u65b9\u5f0f\u5b9e\u73b0</li> </ul> <pre><code>// \u8bbe\u7f6e\u5173\u8054\u5bf9\u8c61\nobjc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key,\n                         id _Nullable value, objc_AssociationPolicy policy)\n// \u83b7\u53d6\u5173\u8054\u5bf9\u8c61\nobjc_getAssociatedObject(id _Nonnull object, const void * _Nonnull key)\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#block","title":"Block","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#block_1","title":"block \u7684\u539f\u7406\u662f\u600e\u6837\u7684\uff1f\u672c\u8d28\u662f\u4ec0\u4e48","text":"<p>\u5c01\u88c5\u4e86\u51fd\u6570\u8c03\u7528\u53ca\u8c03\u7528\u73af\u5883\u7684OC\u5bf9\u8c61</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_block","title":"_block \u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u4f7f\u7528\u6ce8\u610f\u70b9","text":"<p>\u5c06\u4fee\u9970\u7684 auto \u53d8\u91cf\u5305\u88c5\u6210\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7528\u6765\u4fdd\u8bc1block\u4e2d\u5f15\u7528\u7684\u57fa\u672c\u7c7b\u578b\u53d8\u91cf\u4e0d\u4f1a\u88ab\u7cfb\u7edf\u56de\u6536\uff0c\u4e5f\u53ef\u4ee5\u5728 block \u4e2d\u4fee\u6539 block \u5916\u7684\u53d8\u91cf</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#block-copy-block","title":"block \u7684\u5c5e\u6027\u4fee\u9970\u8bcd\u4e3a\u4ec0\u4e48\u662f copy \uff1f\u4f7f\u7528 block \u6709\u54ea\u4e9b\u9700\u8981\u6ce8\u610f\u7684","text":"<p>\u8c03\u7528 copy \u4e4b\u540e\u5c31\u5c06 block \u590d\u5236\u5230\u5806\u4e0a\u4e86\uff0c\u4fdd\u8bc1\u5176\u4e0d\u4f1a\u88ab\u7cfb\u7edf\u56de\u6536\u6389\uff0c\u6ce8\u610f\u5faa\u73af\u5f15\u7528</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#block-nsmutablearray-_block","title":"block \u5728\u4fee\u6539 NSMutableArray \u65f6\uff0c\u9700\u4e0d\u9700\u8981\u52a0 _block\uff1f","text":"<p>\u4e0d\u9700\u8981\uff0c\u53ea\u6709\u4fee\u6539 NSMutableArray \u6307\u9488\u672c\u8eab\u65f6\u9700\u8981\u52a0 __block\uff0c\u4fee\u6539\u5bf9\u8c61\u4e2d\u7684\u5185\u5bb9\u662f\u4e0d\u9700\u8981\u7684</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runtime","title":"runtime","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#oc","title":"OC \u6d88\u606f\u673a\u5236\uff0c","text":"<p>OC \u4e2d\u7684\u65b9\u6cd5\u8c03\u7528\u6700\u7ec8\u90fd\u662f\u8f6c\u6210 objc_msgSend \u51fd\u6570\u7684\u8c03\u7528\uff0c\u7ed9 receiver(\u65b9\u6cd5\u8c03\u7528\u8005)\u53d1\u9001\u4e86\u4e00\u6761\u6d88\u606f\uff08selector \u65b9\u6cd5\u540d\uff09 \u4e09\u4e2a\u9636\u6bb5 - \u6d88\u606f\u53d1\u9001 - \u52a8\u6001\u65b9\u6cd5\u89e3\u6790 <code>resolveInstanceMethod</code> \u52a8\u6001\u6dfb\u52a0\u5b9e\u73b0 - \u6d88\u606f\u8f6c\u53d1</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_2","title":"\u6d88\u606f\u8f6c\u53d1\u673a\u5236\u6d41\u7a0b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runtime_1","title":"\u4ec0\u4e48\u662f runtime\uff0c\u9879\u76ee\u4e2d\u7684\u4f7f\u7528","text":"<ul> <li> <p>OC \u662f\u4e00\u95e8\u52a8\u6001\u6027\u6bd4\u8f83\u5f3a\u7684\u53d8\u6210\u8bed\u8a00\uff0c\u5141\u8bb8\u5f88\u591a\u64cd\u4f5c\u63a8\u8fdf\u5230\u7a0b\u5e8f\u8fd0\u884c\u65f6\u518d\u8fdb\u884c\uff0cOC \u7684\u52a8\u6001\u6027\u5c31\u662f\u7531 runtime \u6765\u652f\u6491\u548c\u5b9e\u73b0\u7684\uff0cruntime\u662f\u4e00\u5957 C \u8bed\u8a00 API \u5c01\u88c5\u4e86\u5f88\u591a\u52a8\u6001\u6027\u76f8\u5173\u7684\u51fd\u6570\uff0c\u5e73\u65f6\u5199\u7684 OC \u4ee3\u7801\uff0c\u5e95\u5c42\u90fd\u662f\u8f6c\u6362\u6210 runtime API \u8fdb\u884c\u8c03\u7528</p> </li> <li> <p>\u5229\u7528\u5173\u8054\u5bf9\u8c61\uff08associatedObject\uff09\u7ed9\u5206\u7c7b\u6dfb\u52a0\u5c5e\u6027</p> </li> <li>\u904d\u5386\u7c7b\u6240\u6709\u6210\u5458\u53d8\u91cf(\u8bbf\u95ee\u79c1\u6709\u6210\u5458\u53d8\u91cf\uff0c\u81ea\u52a8\u5f52\u6863\u89e3\u6863\uff0c\u5b57\u5178\u8f6c\u6a21\u578b)</li> <li>\u4ea4\u6362\u65b9\u6cd5\u5b9e\u73b0\uff08\u4ea4\u6362\u7cfb\u7edf\u81ea\u5e26\u7684\u65b9\u6cd5\uff0chook \u4e00\u4e9b\u7cfb\u7edf\u52a8\u4f5c\uff0c\u5728\u7279\u5b9a\u52a8\u4f5c\u4e0b\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\uff0c\u6bd4\u5982\u6309\u94ae\u70b9\u51fb\uff0cviewcontroller \u663e\u793a\u4e4b\u7c7b\u7684\uff09</li> <li>\u5229\u7528\u6d88\u606f\u8f6c\u53d1\u89e3\u51b3\u65b9\u6cd5\u627e\u4e0d\u5230\u7684\u95ee\u9898</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop","title":"RunLoop","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop_1","title":"RunLoop  \u5728\u9879\u76ee\u4e2d\u7684\u4f7f\u7528","text":"<ul> <li>\u89e3\u51b3 NSTimer \u5728\u6ed1\u52a8\u65f6\u505c\u6b62\u5de5\u4f5c\u7684\u95ee\u9898</li> <li>\u76d1\u63a7\u5e94\u7528\u5361\u987f</li> <li>\u6027\u80fd\u4f18\u5316</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop_2","title":"RunLoop \u5185\u90e8\u5b9e\u73b0","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop_3","title":"RunLoop \u548c\u7ebf\u7a0b\u7684\u5173\u7cfb","text":"<ul> <li>\u6bcf\u6761\u7ebf\u7a0b\u90fd\u6709\u552f\u4e00\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684 RunLoop \u5bf9\u8c61</li> <li>RunLoop \u4fdd\u5b58\u5728\u4e00\u4e2a\u5168\u5c40\u7684 Dictionary \u91cc\uff0c\u7ebf\u7a0b\u4f5c\u4e3a Key\uff0cRunLoop \u4f5c\u4e3a Value</li> <li>\u521b\u5efa\u7ebf\u7a0b\u65f6\uff0c\u6ca1\u6709 RunLoop\uff0cRunLoop\u4f1a\u5728\u7b2c\u4e00\u6b21\u83b7\u53d6\u5b83\u65f6\u521b\u5efa</li> <li>RunLoop \u4f1a\u5728\u7ebf\u7a0b\u7ed3\u675f\u65f6\u9500\u6bc1</li> <li>\u4e3b\u7ebf\u7a0b\u7684RunLoop\u5df2\u5c06\u81ea\u52a8\u83b7\u53d6\uff08\u521b\u5efa\uff09\uff0c\u5b50\u7ebf\u7a0b\u9ed8\u8ba4\u6ca1\u6709\u5f00\u542f RunLoop</li> </ul>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#timer-runloop","title":"timer \u548c RunLoop \u7684\u5173\u7cfb","text":"<p>\u4e00\u4e2aRunLoop \u5305\u542b\u82e5\u5e72\u4e2aMode\uff0c\u6bcf\u4e2aMode\u53c8\u5305\u542b\u82e5\u5e72\u4e2a Source0/Sources1/Observer/Timer Timer\u53ef\u4ee5\u5524\u9192 RunLoop \u6765\u6267\u884c Timer \u4e2d\u7684\u4efb\u52a1</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#3-nstimer-tableview-timer","title":"\u7a0b\u5e8f\u4e2d\u6dfb\u52a0\u6bcf 3 \u79d2\u54cd\u5e94\u4e00\u6b21\u7684 NSTimer\uff0c\u5f53\u62d6\u52a8 tableView  \u65f6 timer \u53ef\u80fd\u65e0\u6cd5\u54cd\u5e94\u8981\u600e\u4e48\u89e3\u51b3","text":"<p>\u5c06 Timer \u6dfb\u52a0\u5230RunLoop\u7684 commonMode \u4e2d\uff0ccommonMode \u5e76\u4e0d\u662f\u6307\u4e00\u4e2a\u7279\u6b8a\u7684 mode\uff0c\u800c\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6807\u7b7e\uff0c\u7528\u6765\u8868\u793a RunLoopMode \u4e2d\u7684 commonModes \u5217\u8868\u4e2d\u5b58\u50a8\u7684\u6240\u6709 mode\uff0c\u4e5f\u5c31\u8868\u660e\u4e86\u8be5 Timer \u5728 \u5f53\u524d RunLoop \u7684\u4efb\u4f55\u4e00\u4e2a mode \u90fd\u53ef\u4ee5\u6267\u884c</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop_4","title":"RunLoop \u5982\u4f55\u54cd\u5e94\u7528\u6237\u64cd\u4f5c\uff0c\u5177\u4f53\u6d41\u7a0b","text":"<p>\u6bd4\u5982\u70b9\u51fb\u4e8b\u4ef6\uff0c\u7528\u6237\u89e6\u6478\u5c4f\u5e55\uff0c\u5c4f\u5e55\u4e8b\u4ef6\u4f1a\u5305\u88c5\u6210 event\uff0cevent \u7531\u7cfb\u7edf\u901a\u77e5 source1\uff0csource1 \u5524\u9192 RunLoop\uff0c\u7136\u540e\u5c06\u4e8b\u4ef6\u4ea4\u7531 source0 \u6765\u5904\u7406\uff0c\u7136\u540e\u68c0\u67e5\u662f\u5426\u6709\u5176\u4ed6\u8981\u6267\u884c\u7684\u4efb\u52a1\uff0c\u6709\u5219\u6267\u884c\uff0c\u6ca1\u6709\u5c31\u7761\u7720</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#runloop-mode","title":"RunLoop \u7684 mode \u4f5c\u7528","text":"<p>Mode \u7528\u6765\u5bf9\u4efb\u52a1\u8fdb\u884c\u9694\u79bb\uff0c\u4fdd\u8bc1\u6bcf\u4e2amode\u4e0b\u7684\u4efb\u52a1\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u6d41\u7545\u8fd0\u884c\uff0c\u6bd4\u5982\u6ed1\u52a8\u7684\u65f6\u5019\u4f1a\u5207\u6362\u5230 UITrackingMode\uff0c\u6765\u4fdd\u8bc1\u6ed1\u52a8\u7684\u6d41\u7545\uff0c\u6ed1\u52a8\u5b8c\u4e4b\u540e\u53c8\u4f1a\u5207\u6362\u5230 defaultMode\uff0c\u6765\u6b63\u5e38\u6267\u884c\u5176\u4ed6\u4efb\u52a1</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_3","title":"\u591a\u7ebf\u7a0b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_4","title":"\u4f60\u7406\u89e3\u7684\u591a\u7ebf\u7a0b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#ios","title":"iOS \u7684\u591a\u7ebf\u7a0b\u65b9\u6848\u6709\u54ea\u51e0\u79cd\uff1f\u66f4\u503e\u5411\u4e8e\u54ea\u4e00\u79cd","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#gcd","title":"\u9879\u76ee\u4e2d\u662f\u5426\u7528\u5230\u8fc7 GCD","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#gcd_1","title":"GCD \u961f\u5217\u7c7b\u578b","text":"<p>\u540c\u6b65\u961f\u5217\uff0c\u5f02\u6b65\u961f\u5217</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#operationqueue-gcd","title":"\u8bf4\u4e00\u4e0b OperationQueue \u548c GCD \u7684\u533a\u522b\uff0c\u4ee5\u53ca\u5404\u81ea\u7684\u4f18\u52bf","text":"<p>OperationQueue \u662f\u5bf9 GCD \u7684 OC \u5c01\u88c5</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_5","title":"\u7ebf\u7a0b\u5b89\u5168\u7684\u5904\u7406\u624b\u6bb5\u6709\u54ea\u4e9b","text":"<p>\u52a0\u9501</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#oc_1","title":"OC\u7684\u9501\u6709\u54ea\u4e9b\uff0c\u4e8c\u6b21\u63d0\u95ee","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_6","title":"\u81ea\u65cb\u9501\u4e0e\u4e92\u65a5\u9501\u7684\u5bf9\u6bd4","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_7","title":"\u6ce8\u610f\u70b9","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#cocc","title":"C/OC/C++\uff0c\u4efb\u9009\u5176\u4e00\uff0c\u5b9e\u73b0\u81ea\u65cb\u9501\u548c\u4e92\u65a5\u9501\uff0c\u53e3\u8ff0","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_8","title":"\u5185\u5b58\u7ba1\u7406","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#cadisplaylinknstimer","title":"\u4f7f\u7528 CADisplayLink\u3002NSTimer \u6709\u4ec0\u4e48\u6ce8\u610f\u70b9","text":"<p>\u5faa\u73af\u5f15\u7528\uff0c\u4f9d\u8d56 runloop \u4e0d\u51c6</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_9","title":"\u4ecb\u7ecd\u4e00\u4e0b\u5185\u5b58\u7684\u51e0\u5927\u533a\u57df","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#ios_1","title":"\u5bf9 iOS \u5185\u5b58\u7ba1\u7406\u7684\u7406\u89e3","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#autorelease-release","title":"autorelease \u7684\u5bf9\u8c61\u5728\u4ec0\u4e48\u65f6\u673a\u4f1a\u88ab release","text":"<ol> <li>\u5728\u5bf9\u8c61\u6240\u5728\u7684 @autorelease{} \u4f5c\u7528\u57df\u7ed3\u675f\u65f6\u4f1a\u88ab\u91ca\u653e</li> <li>iOS main runloop \u4e2d\u4f1a\u5728runloop \u7761\u7720\u4e4b\u524d\u6216\u8005\u9000\u51fa\u4e4b\u524d\u91ca\u653e</li> </ol>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_10","title":"\u65b9\u6cd5\u91cc\u6709\u5c40\u90e8\u5bf9\u8c61\uff0c\u51fa\u4e86\u65b9\u6cd5\u540e\u4f1a\u7acb\u5373\u91ca\u653e\u4e48","text":"<p>ARC \u662f\uff0c\u5982\u679c\u662f MRC autorelease,\u90a3\u4e48\u5c31\u4e0d\u4e00\u5b9a\u4e86</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#arc","title":"ARC \u90fd\u5e2e\u6211\u4eec\u505a\u4e86\u4ec0\u4e48","text":"<p>LLVM \u7f16\u8bd1\u5668\uff08\u81ea\u52a8\u6dfb\u52a0 release \u53ca retain\uff09 + Runtime (\u5f31\u5f15\u7528)</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#weak","title":"weak \u6307\u9488\u5b9e\u73b0\u539f\u7406","text":"<p>sidetable\u5b58\u50a8\u5f31\u5f15\u7528\u53d8\u91cf\u6307\u9488\uff0c\u5bf9\u8c61\u91ca\u653e\u65f6\u4f1a\u4ecesidetable\u7684\u5f31\u5f15\u7528\u8868\u4e2d\u627e\u5230\u5f31\u5f15\u7528\u8be5\u5bf9\u8c61\u7684\u53d8\u91cf\u5e76\u7f6e\u7a7a</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_11","title":"\u4f18\u5316","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_12","title":"\u9879\u76ee\u4e2d\u7684\u5185\u5b58\u4f18\u5316\u65b9\u5f0f","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_13","title":"\u4ece\u54ea\u51e0\u65b9\u9762\u7740\u624b","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_14","title":"\u5217\u8868\u5361\u987f\u7684\u539f\u56e0\u6709\u54ea\u4e9b\uff0c\u600e\u4e48\u4f18\u5316\u7684","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#tableview","title":"tableView \u5361\u987f\u7684\u539f\u56e0","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#lgteacher-lgperson","title":"LGTeacher \u7ee7\u627f\u81ea LGPerson \u4ee5\u4e0b\u4ee3\u7801\u6253\u5370\u7ed3\u679c","text":"<pre><code>LGTeacher *t = [[LGTeacher alloc] init];\n\n- (instancetype)init{\n    self = [super init];\n    if (self) {\n        NSLog(@\"%@ - %@\",[self class],[super class]);\n    }\n    return self;\n}\n// output \"LGTeacher - LGTeacher\"\n// \u56e0\u4e3a\u65e0\u8bba\u662f self \u8c03\u7528 class\uff0c\u8fd8\u662f super \u8c03\u7528 class\uff0c\u6700\u7ec8\u90fd\u662f\u8d70\u5230 OC \u7684\u6d88\u606f\u53d1\u9001\u673a\u5236\n// objc_msgSend \u4e2d\u4f1a\u4f20\u5165\u6d88\u606f\u63a5\u6536\u8005\uff0c\u4e5f\u5c31\u662f\u5b9e\u4f8b\u672c\u8eab\n// \u5728 objc_msgSendSuper \u4e2d\u4f1a\u4f20\u5165\u4e00\u4e2a __rw_objc_super \u7684\u7ed3\u6784\u4f53\uff0c\u5305\u542b\u6d88\u606f\u63a5\u6536\u8005\u4ee5\u53ca\u7236\u7c7b\u5bf9\u8c61\n// \u63a5\u6536\u8005\u90fd\u662f\u5b9e\u4f8b\u5bf9\u8c61\u672c\u8eab\uff0c\u53ea\u662f\u5728\u65b9\u6cd5\u67e5\u627e\u7684\u65f6\u5019 super \u4f1a\u4ece\u7236\u7c7b\u5f00\u59cb\u5bfb\u627e\u65b9\u6cd5\u5b9e\u73b0\u3002\u7531\u4e8e class \u65b9\u6cd5\u7684\u5b9e\u73b0\u662f\u5728\u57fa\u7c7b NSObject \u4e2d\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u4e0d\u7ba1\u662f\u4ece\u54ea\u91cc\u5f00\u59cb\u67e5\u627e\u8c03\u7528\u7684\uff0c\u6700\u7ec8\u90fd\u4f1a\u8fd4\u56de\u5b9e\u4f8b\u5bf9\u8c61\u7684\u5b9e\u9645\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f LGTeacher\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_15","title":"\u4ee5\u4e0b\u4ee3\u7801\u80fd\u5426\u6b63\u5e38\u8f93\u51fa","text":"<pre><code>@interface LGPerson : NSObject\n  @property (nonatomic, retain) NSString *kc_name;\n  - (void)saySomething;\n  @end\n  @implementation LGPerson\n  - (void)saySomething{\n      NSLog(@\"%s - %@\",__func__,self.kc_name);\n  }\n@end\n\n- (void)viewDidLoad { \n    [super viewDidLoad];\n    Class cls = [LGPerson class];\n    void  *kc = &amp;cls;\n    [(__bridge id)kc saySomething];\n}\n// \u7b54\u6848\u53ef\u4ee5\n// LGPerson *person = [[LGPerson alloc] init];\n// \u6700\u7ec8\u7684\u7ed3\u6784\u4e3a person \u7684 isa \u6307\u9488\u6307\u5411 LGPerson \u7684\u7c7b\u5bf9\u8c61\n// \u53c8\u56e0\u4e3a isa \u6307\u9488\u4e3a person \u5bf9\u8c61\u7684\u7b2c\u4e00\u4e2a\u6210\u5458\uff0c\u6240\u4ee5 isa \u6307\u9488\u5b9e\u9645\u4e0a\u5c31\u7b49\u4e8e person \u6307\u9488\n// person \u5b58\u50a8\u7740 person \u5b9e\u4f8b\u5bf9\u8c61\u7684\u5730\u5740\uff0cperson\u5bf9\u8c61\u4e2d\u7b2c\u4e00\u4e2a\u6210\u5458 isa \u53c8\u6307\u5411 LGPerson \u7684\u7c7b\u5bf9\u8c61\n// person -&gt; isa(person \u5b9e\u4f8b\u5bf9\u8c61) -&gt; [LGPerson class]\n// \u7136\u540e\u770b\u4f8b\u5b50\u4e2d\u7684\u7ed3\u6784\n// kc \u4e2d\u5b58\u50a8\u4e86 cls \u7684\u5730\u5740\uff0ccls \u53c8\u6307\u5411 LGPerson \u7c7b\u5bf9\u8c61\uff0c\u7ed3\u679c\u5982\u4e0b\n// kc -&gt; cls -&gt; [LGPerson class]\n// \u53ef\u4ee5\u770b\u5230\u4f8b\u5b50\u4e2d\u7684\u7ed3\u6784\u540c\u666e\u901a\u5b9e\u4f8b\u53d8\u91cf\u6700\u7ec8\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\n// \u5728\u8c03\u7528 saySomething \u8fdb\u884c\u6d88\u606f\u53d1\u9001\u65f6\uff0c\u5148\u627e\u5230\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u7136\u540e\u901a\u8fc7\u5b9e\u4f8b\u5bf9\u8c61\u7684 isa \u6307\u9488\u62ff\u5230\u7c7b\u5bf9\u8c61\uff0c\u8fdb\u884c\u65b9\u6cd5\u67e5\u627e\uff0c\u627e\u5230\u4e4b\u540e\u8fdb\u884c\u8c03\u7528\u3002\n// \u4f8b\u5b50\u4e2d\u7684 cls \u5b9e\u9645\u5c31\u76f8\u5f53\u4e8e isa \u6307\u9488\uff0c\u53ea\u662f\u5728\u6253\u5370 kc_name \u65f6\uff0c\u5982\u679c\u628a cls \u5f53\u6210\u5b9e\u4f8b\u5bf9\u8c61\u7684\u8bdd\uff0c\u90a3\u4e48\u67e5\u627e kc_name \u5c31\u4f1a\u5728 cls \u6307\u9488\u7684\u57fa\u7840\u4e0a\u5411\u4e0b\u79fb\u52a8 8 \u4f4d\uff0c\u62ff\u5230\u5185\u5bb9\uff0c\u6253\u5370\u3002\n// \u6808\u5206\u914d\u65b9\u5f0f\u4e3a\u4ece\u4f4e\u5230\u9ad8\u8fdb\u884c\u5206\u914d\uff0c\u800c [super viewDidLoad] \u8c03\u7528\u8fc7\u7a0b\u4e2d\u4f1a\u521b\u5efa\u4e00\u4e2a __rw_objc_super \u7684\u7ed3\u6784\u4f53\uff0c\u5e76\u4e14 viewController \u4e3a\u7b2c\u4e00\u6210\u5458\uff0c\u6240\u4ee5\uff0ccls \u5411\u4e0b\u79fb 8 \u4f4d \u627e\u5230\u7684\u5c31\u662f viewController\uff0c\u6253\u5370\u51fa\u6765\u5c31\u662f\u5f53\u524d\u7684 viewcontroller\uff0c\u5047\u5982\u5728 cls \u4e4b\u524d\u5b9a\u4e49\u5176\u4ed6\u5b9e\u4f8b\u53d8\u91cf\u5417\uff0c\u6700\u7ec8\u6253\u5370\u7ed3\u679c\u5c31\u662f\u8ddd\u79bb cls \u6700\u8fd1\u7684\u4e00\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_16","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\u8f93\u51fa\u4ec0\u4e48\u7ed3\u679c","text":"<pre><code>NSObject *objc = [NSObject new];\nNSLog(@\"%ld\",CFGetRetainCount((__bridge CFTypeRef)(objc)));\nvoid(^block1)(void) = ^{\n    NSLog(@\"---%ld\",CFGetRetainCount((__bridge CFTypeRef)(objc)));\n}; \nblock1();\n\nvoid(^__weak block2)(void) = ^{\n    NSLog(@\"---%ld\",CFGetRetainCount((__bridge CFTypeRef)(objc)));\n};\nblock2();\n\nvoid(^block3)(void) = [block2 copy];\nblock3();\n__block NSObject *obj = [NSObject new];\nvoid(^block4)(void) = ^{\n    NSLog(@\"---%ld\",CFGetRetainCount((__bridge CFTypeRef)(obj)));\n};\nblock4();\n\n// \u5728 ARC \u73af\u5883\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u6839\u636e\u60c5\u51b5\u81ea\u52a8\u5c06\u6808\u4e2d\u7684 block \u590d\u5236\u5230\u5806\u4e0a\n// - block \u4f5c\u4e3a\u8fd4\u56de\u503c\u65f6\n// block \u8d4b\u503c\u7ed9 __strong \u6307\u9488\u65f6\n// block \u4f5c\u4e3a Cocoa API \u4e2d\u65b9\u6cd5\u540d\u542b\u6709 usingBlock \u65b9\u6cd5\u53c2\u6570\u65f6\n\n// \u6709\u4e0a\u9762\u7684\u8bf4\u660e\u6211\u4eec\u6765\u5206\u6790\n// block1 \u4f5c\u4e3a\u5f3a\u6307\u9488\u6307\u5411\u4e86 block \u5bf9\u8c61\uff0cblock \u5bf9\u8c61\u5148\u5728\u6808\u4e0a\u521b\u5efa\uff0cblock1 \u6307\u5411\u5b83\u4e4b\u540e\u6709\u590d\u5236\u5230\u4e86\u5806\u4e0a\u4e00\u4efd\uff0c\u6240\u4ee5\u6b64\u5904\u7684\u5f15\u7528\u8ba1\u6570\u4f1a +2\uff0c\u6808\u4e0a\u4e00\u4efd\uff0c\u5806\u4e0a\u4e00\u4efd\uff0c\u53c8\u56e0\u4e3a NSObject \u5b9e\u4f8b\u5316\u7684\u65f6\u5019\u5c31\u6709\u4e00\u4e2a\u5f3a\u5f15\u7528\u4e86\uff0c\u6240\u4ee5 block1 \u4e2d\u6253\u5370\u7684\u4e3a 1+2=3\n// block2 \u4e2d\u4e3a\u5f31\u6307\u9488\uff0c\u4e0d\u4f1a\u5c06 block copy \u5230\u5806\u4e0a\uff0c\u6b64\u5904\u53ea\u4f1a\u4ea7\u751f\u4e00\u4efd block\uff0c\u5bf9 objc \u7684\u5f15\u7528\u8ba1\u6570\u4e5f\u53ea\u4f1a + 1\uff0c\u6b64\u5904\u4e3a4\n// block3 \u5c06 block2 copy \u4e86\u4e00\u4efd\uff0c\u6b64\u65f6\u4f1a\u5c06 block2 \u590d\u5236\u5230\u5806\u4e0a\u4e00\u4efd\uff0c\u5f15\u7528\u8ba1\u6570 + 1\uff0c\u6b64\u5904\u4e3a 5\n// __block \u4fee\u9970\u7684\u53d8\u91cf\u5b9e\u9645\u662f\u5c06\u5176\u5305\u88c5\u6210\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0cblock \u4e2d\u5f15\u7528\u7684\u5b9e\u9645\u4e3a \u5305\u88c5\u4e4b\u540e\u7684\u5bf9\u8c61\uff0c\u800c\u8be5\u5bf9\u8c61\u53ea\u6709\u4e00\u4efd\uff0c\u53ea\u4f1a\u5bf9 obj \u4ea7\u751f\u4e00\u4e2a\u5f3a\u5f15\u7528\uff0c\u7531\u4e8e \u5e95\u5c42\u5c4f\u853d\u4e86\u8fd9\u90e8\u5206\u7684\u5b9e\u73b0\uff0c\u6211\u4eec\u4f7f\u7528\u65f6\u8bbf\u95ee\u5230\u7684\u8fd8\u662f\u539f\u5bf9\u8c61\u672c\u8eab\uff0c\u6240\u4ee5 block \u7684\u5f15\u7528\u589e\u52a0\u5f15\u7528\u8ba1\u6570\uff0c\u4e5f\u53ea\u662f\u5bf9\u5305\u88c5\u540e\u7684\u5bf9\u8c61\u6709\u5f71\u54cd\uff0c\u800c\u5bf9\u539f\u5bf9\u8c61\u6ca1\u6709\u5f71\u54cd\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_17","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\uff0c\u63a7\u5236\u53f0\u8f93\u51fa\u7ed3\u679c\u662f\u4ec0\u4e48","text":"<pre><code>- (void)MTDemo{\n    while (self.num &lt; 5) {\n        dispatch_async(dispatch_get_global_queue(0, 0), ^{\n            self.num++;\n        });\n    }\n    NSLog(@\"KC : %d\",self.num);\n}\n// \u672c\u4f8b\u4e2d\u4ee5 self.num \u4e3a\u9650\u5236\u6761\u4ef6\uff0c\u5e76\u4e14while\u4e2d\u5f02\u6b65\u6267\u884c\u51fd\u6570\uff0c\u6700\u7ec8\u7ed3\u679c\u80af\u5b9a\u4f1a\u5927\u4e8e\u7b49\u4e8e5\n// \u5faa\u73af\u6267\u884c\u6b21\u81f3\u5c11\u4e3a 5\n\n- (void)KSDemo{\n     for (int i= 0; i&lt;10000; i++) {\n        dispatch_async(dispatch_get_global_queue(0, 0), ^{\n            self.num++;\n        });\n    }\n    NSLog(@\"Cooci : %d\",self.num);\n}\n// \u672c\u4f8b\u4e2d\u4ee5 i \u4e3a\u9650\u5236\u6761\u4ef6\uff0cfor \u5faa\u73af\u53ea\u6267\u884c 100000 \u6b21\uff0c\u7531\u4e8e\u5f02\u6b65\u51fd\u6570\uff0c\u6700\u7ec8\u63a5\u8fc7\u4e00\u5b9a\u5c0f\u4e8e10000\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_18","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\uff0c\u63a7\u5236\u53f0\u8f93\u51fa\u7ed3\u679c\u662f\u4ec0\u4e48","text":"<pre><code>- (void)textDemo2{\n    dispatch_queue_t queue = dispatch_queue_create(\"cooci\", DISPATCH_QUEUE_CONCURRENT);\n    NSLog(@\"1\");\n    // \u5f02\u6b65\u4efb\u52a1\uff0c\u5148\u6267\u884c\u5b8c\u5f53\u524d\u4efb\u52a1\u5728\u6267\u884c\u8be5\u4efb\u52a1\n    dispatch_async(queue, ^{\n        NSLog(@\"2\");\n        // \u540c\u6b65\u4efb\u52a1\uff0c\u9700\u8981\u5148\u6267\u884c\u5b8c\u624d\u80fd\u7ee7\u7eed\u5f80\u4e0b\u8d70\n        dispatch_sync(queue, ^{\n            NSLog(@\"3\");\n        });\n        NSLog(@\"4\");\n    });\n    NSLog(@\"5\");\n}\n// 1 5 2 3 4\n// \u4f8b\u5b50\u4e2d\u4f7f\u7528\u7684\u961f\u5217\u4e3a\u5e76\u53d1\u961f\u5217\uff0c\u4efb\u52a1\u8fdb\u51fa\u961f\u5217\u7684\u987a\u5e8f\u4e0d\u662f\u56fa\u5b9a\u7684\uff0c\u6240\u4ee5\uff0c\u53ca\u65f6\u5f02\u6b65\u4efb\u52a1\u4e2d\u5d4c\u5957\u6709\u540c\u6b65\u4efb\u52a1\uff0c\u540c\u6b65\u4efb\u52a1\u4e5f\u80fd\u6b63\u5e38\u62ff\u5230\u5e76\u6267\u884c\n\n- (void)textDemo1{\n    // \u521b\u5efa\u961f\u5217\u4e0d\u4f20\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3a\u540c\u6b65\u961f\u5217\n    dispatch_queue_t queue = dispatch_queue_create(\"cooci\", NULL);\n    // 1\u3002 \u6b63\u5e38\u6253\u5370\n    NSLog(@\"1\");\n    // \u7531\u4e8e\u4e3a\u5f02\u6b65\u4efb\u52a1\uff0c\u6240\u4ee5\u5148\u6267\u884c\u4e0b\u9762\u7684\u4ee3\u7801\n    dispatch_async(queue, ^{\n        // 3\u3001 \u6b63\u5e38\u6253\u5370\uff0c\n        NSLog(@\"2\");\n        // 4. \u6b7b\u9501\uff0c\u7531\u4e8e\u961f\u5217\u4e3a\u540c\u6b65\u961f\u5217\uff0c \u6240\u4ee5\u5728\u5f53\u524d\u4efb\u52a1\u6267\u884c\u4e4b\u524d\u4e0b\u9762\u7684\u540c\u6b65\u4efb\u52a1\u62ff\u4e0d\u5230\uff0c\u65e0\u6cd5\u6267\u884c\n        // \u800c\u4efb\u52a1\u53c8\u662f\u540c\u6b65\u7684\uff0c\u5fc5\u987b\u6267\u884c\u5b8c\u624d\u80fd\u5f80\u4e0b\u8d70\uff0c\u7136\u540e\u5c31\u9020\u6210\u4e86\u6b7b\u9501\n        dispatch_sync(queue, ^{\n            NSLog(@\"3\");\n        });\n        NSLog(@\"4\");\n    });\n    // 2\u3002\u6b63\u5e38\u6253\u5370\n    NSLog(@\"5\");\n}\n// \u6240\u4ee5\uff0c\u6253\u5370 1 5 2 \u7136\u540e\u6b7b\u9501\u5d29\u6e83\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_19","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\uff0c\u63a7\u5236\u53f0\u8f93\u51fa\u7ed3\u679c\u662f\u4ec0\u4e48","text":"<pre><code> @property (nonatomic, strong) NSMutableArray      *mArray;\n- (NSMutableArray *)mArray{\n    if (!_mArray) _mArray = [NSMutableArray arrayWithCapacity:1];\n    return _mArray;\n}\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    // \u521b\u5efa\u6570\u7ec4\u5bf9\u8c61\n    NSMutableArray *arr = [NSMutableArray arrayWithObjects:@\"1\",@\"2\", nil];\n    // \u5c06 arr \u8d4b\u503c\u7ed9\u5f53\u524d\u5b9e\u4f8b\u5bf9\u8c61\n    self.mArray = arr;\n\n    void (^kcBlock)(void) = ^{\n        // block \u5bf9\u8c61\u4e2d\u4f1a\u5bf9 arr \u5f3a\u5f15\u7528\uff0c\u867d\u7136\u540e\u8fb9 arr \u53d8\u91cf\u7f6enil\uff0c\u4f46\u662f block \u4e2d\u5f15\u7528\u7684\u6570\u7ec4\u5bf9\u8c61\u8fd8\u5728\n        [arr addObject:@\"3\"];\n        // block \u5bf9\u8c61\u4e2d\u4f1a\u5bf9 self \u5f3a\u5f15\u7528\n        [self.mArray addObject:@\"a\"];\n        NSLog(@\"KC %@\",arr);\n        NSLog(@\"Cooci: %@\",self.mArray);\n    };\n    // arr = [@\"1\", @\"2\", @\"4\"]\n    [arr addObject:@\"4\"];\n    // // arr = [@\"1\", @\"2\", @\"4\", @\"5\"]\n    [self.mArray addObject:@\"5\"];\n    arr = nil;\n    self.mArray \u7f6e\u7a7a\n    self.mArray = nil;\n    // block \u4e2d\u901a\u8fc7self \u62ff\u5230\u7684mArray \u4e3a\u91cd\u65b0\u521d\u59cb\u5316\u7684 \u6dfb\u52a0\u5b8c\u5143\u7d20\u4e4b\u540e\u53ea\u6709\u4e00\u4e2a\u5728block\u4e2d\u6dfb\u52a0\u7684 @\u201ca\u201d\n    // \u4f46\u662f arr \u7531\u4e8e\u6570\u7ec4\u5b9e\u4f8b\u8fd8\u5728\uff0c\u6240\u4ee5 arr \u4e2d\u7684\u5185\u5bb9\u5b9e\u9645\u4e3a [@\"1\", @\"2\", @\"4\", @\"5\", @\"3\"]\n    kcBlock(); \n}\n// \u6700\u7ec8\u6253\u5370 [@\"1\", @\"2\", @\"4\", @\"5\", @\"3\"] [@\"a\"\u3011\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_20","title":"\u53ef\u53d8\u6570\u7ec4\u662f\u7ebf\u7a0b\u5b89\u5168\u7684 \u274e","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_21","title":"\u4e3b\u961f\u5217\u642d\u914d\u540c\u6b65\u51fd\u6570\u5c31\u4f1a\u4ea7\u751f\u6b7b\u9501 \u274e \uff08\u8981\u770b\u961f\u5217\u662f\u4ec0\u4e48\u961f\u5217\uff09","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_22","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\u4e0d\u4f1a\u62a5\u9519 \u2705","text":"<pre><code>int a = 0;\nvoid(^ __weak weakBlock)(void) = ^{ // \u5f53\u524dblock \u5728\u6808\u4e0a\n    NSLog(@\"-----%d\", a);\n};\nstruct _LGBlock *blc = (__bridge struct _LGBlock *)weakBlock; // blc \u6307\u5411\u6808\u4e0a\u7684 block\n\nid __strong strongBlock = [weakBlock copy]; // \u7531\u4e8e\u6808\u4e0a\u7684block \u8c03\u7528\u4e86copy,\u6240\u4ee5 strongBlock \u5728\u5806\u4e0a\nblc-&gt;invoke = nil; // \u6808\u4e0a\u7684 block \u5b9e\u73b0\u7f6e\u7a7a\nvoid(^strongBlock1)(void) = strongBlock;\nstrongBlock1(); // \u7531\u4e8e\u5806\u4e0a\u7684block\u6ca1\u6709\u4efb\u4f55\u6539\u52a8\uff0c\u6240\u4ee5\u8c03\u7528\u5806\u4e0a\u7684 block \u4e00\u5b9a\u4e0d\u4f1a\u62a5\u9519\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_23","title":"\u4e0b\u9762\u4ee3\u7801\u6267\u884c\u4e0d\u4f1a\u62a5\u9519 \u274e","text":"<pre><code>NSObject *a = [NSObject alloc];\n// block1 \u4e3a\u5f31\u6307\u9488\nvoid(^__weak block1)(void) = nil;\n{\n    // block2 \u4e3a\u5f3a\u6307\u9488\n    void(^block2)(void) = ^{\n        NSLog(@\"---%@\", a);\n    };\n    block1 = block2;\n    NSLog(@\"1 - %@ - %@\",block1,block2);\n}\n// \u51fa\u4e86\u4e0a\u9762\u4f5c\u7528\u57df\u4e4b\u540e\uff0c\u7531\u4e8e block2 \u4e0d\u518d\u6709\u5f3a\u6307\u9488\u5f15\u7528\uff0c\u6240\u4ee5\u5c31\u91ca\u653e\u6389\u4e86\uff0c\u6b64\u65f6\u8c03\u7528 block1 \u4f1a\u62a5\u9519\nblock1();\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/InterviewQuestions/#_24","title":"\u4e0b\u9762\u4ee3\u7801\u6ca1\u95ee\u9898 \u274e","text":"<pre><code>- (void)demo3{\n    dispatch_queue_t concurrentQueue = dispatch_get_global_queue(0, 0);\n    for (int i = 0; i&lt;5000; i++) {\n        dispatch_async(concurrentQueue, ^{\n            NSString *imageName = [NSString stringWithFormat:@\"%d.jpg\", (i % 10)];\n            NSURL *url = [[NSBundle mainBundle] URLForResource:imageName withExtension:nil];\n            NSData *data = [NSData dataWithContentsOfURL:url];\n            UIImage *image = [UIImage imageWithData:data];\n            // \u5982\u679c\u4f7f\u7528 barrier,\u90a3\u4e48\u5fc5\u987b\u662f\u81ea\u5df1\u521b\u5efa\u7684\u5e76\u53d1\u961f\u5217\uff0c\n            // \u5982\u679c\u4e0d\u662f\u81ea\u5df1\u521b\u5efa\u7684\u5e76\u53d1\u961f\u5217\uff0c\u90a3\u4e48 dispatch_barrier_async \u6267\u884c\u4efb\u52a1\u5c31\u540c dispatch_async \u6ca1\u4ec0\u4e48\u533a\u522b\n\n            dispatch_barrier_async(concurrentQueue, ^{\n                [self.mArray addObject:image];\n            });\n        });\n    }\n}\n</code></pre>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/WWDC2020/","title":"WWDC2020","text":""},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/WWDC2020/#wwdc2020-class-data-structures-changes","title":"WWDC2020 Class Data Structures Changes","text":"<p>WWDC2020 \u89c6\u9891 </p> <p>\u78c1\u76d8\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\uff0c\u7c7b\u5927\u6982\u662f\u8fd9\u6837\u7684</p> <p></p> <p>\u9996\u5148\uff0c\u7c7b\u5bf9\u8c61\u672c\u8eab\u5305\u542b\u4e86\u6700\u957f\u88ab\u8bbf\u95ee\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u6307\u5411\u5143\u7c7b\u3001\u7236\u7c7b\u548c\u65b9\u6cd5\u7f13\u5b58\u7684\u6307\u9488. \u540c\u65f6\u8fd8\u5305\u62ec\u4e00\u4e2a\u6307\u5411\u66f4\u591a\u6570\u636e\u7684\u6307\u9488\uff0c\u5b58\u50a8\u989d\u5916\u4fe1\u606f\u7684\u5730\u65b9\u53eb\u505a <code>class_ro_t</code></p> <p></p> <p>ro =&gt; read only \u5176\u4e2d\u5b58\u50a8\u8fd9\u5305\u62ec\u7c7b\u540d\u3001\u65b9\u6cd5\u3001\u534f\u8bae\u3001\u5b9e\u4f8b\u53d8\u91cf\u4fe1\u606f Swift \u548c Objective-C \u7c7b\u5171\u4eab\u8fd9\u4e00\u57fa\u7840\u7ed3\u6784\uff0c\u6240\u4ee5\u6bcf\u4e2a Swift \u7c7b\u4e5f\u90fd\u6709\u8fd9\u4e00\u7ed3\u6784</p> <p>\u5f53\u7c7b\u7b2c\u4e00\u6b21\u4ece\u78c1\u76d8\u52a0\u8f7d\u5e26\u5185\u5b58\u4e2d\u65f6\uff0c\u5f00\u59cb\u4e5f\u662f\u8fd9\u6837\u7684\uff0c\u4f46\u662f\u4e00\u7ecf\u4f7f\u7528\uff0c\u5c31\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u5728\u4e86\u89e3\u8fd9\u4e9b\u53d8\u5316\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e00\u4e0b clean memory \u548c dirty memory \u7684\u533a\u522b</p> <p>clean memory - \u6307\u52a0\u8f7d\u540e\u4e0d\u4f1a\u53d1\u751f\u66f4\u6539\u7684\u5185\u5b58\uff0cclass_ro_t \u5c31\u5c5e\u4e8e clean memory\uff0c\u56e0\u4e3a\u5b83\u662f\u53ea\u8bfb\u7684</p> <p>dirty memory - \u6307\u5728\u8fdb\u7a0b\u8fd0\u884c\u65f6\u4f1a\u53d1\u751f\u66f4\u6539\u7684\u5185\u5b58\u3002\u7c7b\u7ed3\u6784\u4e00\u7ecf\u4f7f\u7528\u5c31\u4f1a\u53d8\u6210 dirty memory\uff0c\u56e0\u4e3a runtime \u4f1a\u5bf9\u5176\u5199\u5165\u65b0\u7684\u6570\u636e\u3002\u4f8b\u5982 \u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\u7f13\u5b58\u5e76\u4ece\u7c7b\u4e2d\u6307\u5411\u5b83</p> <p>dirty memory \u8981\u6bd4 clean memory \u4f7f\u7528\u8d77\u6765\u4ee3\u4ef7\u66f4\u9ad8\u4e00\u4e9b\uff0c\u53ea\u8981\u8fdb\u7a0b\u5728\u8fd0\u884c\uff0cdirty memory \u5c31\u5fc5\u987b\u4e00\u76f4\u5b58\u5728\u3002 \u76f8\u6bd4\u4e4b\u4e0b clean memory \u53ef\u4ee5\u8fdb\u884c\u79fb\u9664\u4ee5\u8282\u7701\u66f4\u591a\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u4e3a\u5982\u679c\u9700\u8981 clean memory \u7cfb\u7edf\u53ef\u4ee5\u518d\u6b21\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d</p> <p>Mac \u4e2d\u4f7f\u7528\u4e86 swap(\u865a\u62df\u5185\u5b58)\uff0c\u53ef\u4ee5\u5c06 dirty memory \u7f13\u5b58\u5230 swap \u6765\u5c06\u79fb\u9664 dirty memory\uff0c\u4f46\u662f\u7531\u4e8e iOS \u5e76\u6ca1\u6709\u4f7f\u7528 swap\uff0c\u6240\u4ee5 dirty memory \u5bf9\u4e8e iOS \u6765\u8bf4\uff0c\u4ee3\u4ef7\u4f1a\u66f4\u5927</p> <p>dirty memory \u662f\u7c7b\u6570\u636e\u88ab\u5206\u6210\u4e24\u90e8\u5206\u7684\u539f\u56e0\uff0c\u53ef\u4ee5\u4fdd\u6301 clean memory \u7684\u6570\u636e\u8d8a\u591a\u8d8a\u597d\uff0c\u901a\u8fc7\u5206\u79bb\u51fa\u90a3\u4e9b\u6c38\u8fdc\u4e0d\u4f1a\u6539\u53d8\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u628a\u5927\u90e8\u5206\u7c7b\u6570\u636e\u5b58\u50a8\u4e3a clean memory</p> <p>\u8fd9\u4e9b\u6570\u636e\u8db3\u591f\u8ba9\u6211\u4eec\u7ee7\u7eed\uff0c\u4f46\u662f\u8fd0\u884c\u65f6\u9700\u8981\u8ffd\u8e2a\u6bcf\u4e2a\u7c7b\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u6240\u4ee5\u5f53\u4e00\u4e2a\u7c7b\u9996\u6b21\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u8fd0\u884c\u65f6\u4f1a\u7ed9\u5b83\u5206\u914d\u989d\u5916\u7684\u5b58\u50a8\u5bb9\u91cf</p> <p></p> <p>\u8fd0\u884c\u65f6\u5206\u914d\u7684\u5b58\u50a8\u5bb9\u91cf\u5c31\u662f <code>class_rw_t</code> \u7528\u4e8e\u8bfb\u53d6/\u5199\u5165\u6570\u636e</p> <p>\u5728\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u4e2d\uff0c\u6211\u4eec\u5b58\u50a8\u4e86\u53ea\u6709\u5728\u8fd0\u884c\u65f6\u53c2\u4f1a\u751f\u6210\u7684\u65b0\u4fe1\u606f</p> <p>\u4f8b\u5982 \u6240\u6709\u7684\u7c7b\u90fd\u4f1a\u8fde\u63a5\u6210\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff0c\u8fd9\u662f\u901a\u8fc7\u4f7f\u7528 First Subclass \u548c Next Sibling Class \u6307\u9488\u5b9e\u73b0\u7684\uff0c\u901a\u8fc7\u8fd9\u4e9b\u53ef\u4ee5\u6765\u904d\u5386\u5f53\u524d\u4f7f\u7528\u7684\u6240\u6709\u7c7b\uff0c\u8fd9\u5bf9\u4e8e\u6e05\u9664\u65b9\u6cd5\u7f13\u5b58\u5f88\u6709\u7528</p> <p>\u4f46\u662f\uff0c\u4e3a\u4ec0\u4e48\u5728 <code>class_rw_t</code> \u4e2d\u4e5f\u4f1a\u6709\u53ea\u8bfb\u6570\u636e \u65b9\u6cd5\u3001\u5c5e\u6027\uff1f\u56e0\u4e3a\u65b9\u6cd5\u548c\u5c5e\u6027\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u88ab\u4fee\u6539\uff0c\u5f53 category \u52a0\u8f7d\u65f6\uff0c\u53ef\u4ee5\u5411\u7c7b\u4e2d\u6dfb\u52a0\u65b0\u7684\u65b9\u6cd5\uff0c\u5f53\u7136\uff0c\u5f00\u53d1\u4eba\u5458\u4e5f\u53ef\u4ee5\u901a\u8fc7 runtime API \u5411\u5176\u4e2d\u6dfb\u52a0\u65b9\u6cd5\u3002\u7531\u4e8e <code>class_ro_t</code> \u662f\u53ea\u8bfb\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ea\u80fd\u653e\u5728 <code>class_rw_t</code> \u4e2d\u6765\u8ffd\u8e2a\u8fd9\u4e9b\u53d8\u52a8\u3002</p> <p>\u4ece\u73b0\u5728\u6765\u770b\u7684\u8bdd\uff0c\u8fd9\u79cd\u64cd\u4f5c\u4f1a\u5360\u7528\u76f8\u5f53\u591a\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u4efb\u4f55\u8bbe\u5907\u4e2d\u90fd\u6709\u8bb8\u591a\u7c7b\u5728\u4f7f\u7528\u3002\u7ecf\u8ba1\u7b97\uff0c\u5728iPhone\u4e2d\uff0c\u5927\u6982\u670930M \u7684 <code>class_rw_t</code> \u6570\u636e</p> <p>\u5982\u4f55\u6765\u7f29\u5c0f\u8fd9\u4e9b\u7ed3\u6784\u5462\uff1f</p> <p>\u7531\u4e8e\u8fd0\u884c\u65f6\u4f1a\u5bf9\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u66f4\u6539\uff0c\u6240\u4ee5\u6211\u4eec\u624d\u9700\u8981\u5c06\u5176\u6dfb\u52a0\u5230 <code>class_rw_t</code> \u7ed3\u6784\u4e2d\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u5927\u7ea6\u53ea\u6709 10% \u7684\u7c7b\u4f1a\u771f\u6b63\u7684\u66f4\u6539\u4ed6\u4eec\u7684\u65b9\u6cd5\uff0c\u800c\u4e14 Demangled Name \u53ea\u6709 Swift \u7c7b\u624d\u4f1a\u4f7f\u7528\uff0c\u5e76\u4e14 Swift \u7c7b\u4e5f\u53ea\u6709\u5728\u8be2\u95ee\u5b83\u4eec\u7684 Objective-C \u540d\u79f0\u65f6\u624d\u662f\u7528\u5230</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u62c6\u6389\u90a3\u4e9b\u5e73\u65f6\u4e0d\u7528\u7684\u90e8\u5206\uff0c\u8be5\u64cd\u4f5c\u5c06 <code>class_rw_t</code> \u7684\u5927\u5c0f\u51cf\u5c11\u4e86\u4e00\u534a</p> <p>\u8fd9\u5c31\u51fa\u73b0\u4e86 <code>class_rw_ext_t</code> \uff0c\u53ea\u6709\u7528\u5230\u65f6\u624d\u4f1a\u521d\u59cb\u5316</p> <p></p> <p>\u5bf9\u4e8e\u90a3\u4e9b\u786e\u5b9e\u9700\u8981\u989d\u5916\u4fe1\u606f\u7684\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u521d\u59cb\u5316\u4e00\u4e2a <code>class_rw_ext_t</code> \u5e76\u5c06\u5176\u653e\u5230\u7c7b\u4e2d\u4ee5\u4f9b\u4f7f\u7528</p> <p>\u5927\u7ea6\u6709 90% \u7684\u7c7b\u4ece\u6765\u4e0d\u7528\u8fd9\u4e9b\u6269\u5c55\u6570\u636e\uff0c\u53ef\u4ee5\u518d\u7cfb\u7edf\u8303\u56f4\u5185\u8282\u7701\u5927\u7ea6 14MB \u7684\u5185\u5b58\uff0c\u8282\u7701\u51fa\u6765\u7684\u8fd9\u4e9b\u5185\u5b58\u53ef\u4ee5\u7528\u5230\u66f4\u9700\u8981\u7684\u5730\u65b9\uff0c\u6bd4\u5982 \u5b58\u50a8 APP \u6570\u636e \u7b49</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 heap \u547d\u4ee4\u6765\u67e5\u770b <code>class_rw_t</code> \u548c <code>class_rw_ext_t</code> \u4e24\u8005\u6570\u91cf\u7684\u5bf9\u6bd4</p> <p></p> <p>\u5bf9\u4e8e\u83b7\u53d6\u7c7b\u4fe1\u606f\u7684\u65b9\u6cd5\u6765\u8bf4\uff0c\u5fc5\u987b\u540c\u65f6\u5904\u7406\u90a3\u4e9b\u6709\u6269\u5c55\u6570\u636e\u548c\u6ca1\u6709\u6269\u5c55\u6570\u636e\u7684\u7c7b\uff0c\u5f53\u7136 runtime \u4f1a\u5e2e\u4f60\u5904\u7406\u8fd9\u4e9b\u4e8b\u60c5\uff0c\u4ece\u5916\u90e8\u770b\uff0c\u4e00\u5207\u90fd\u6ca1\u6709\u6539\u53d8\uff0c\u53ea\u662f\u5185\u5b58\u5360\u7528\u66f4\u5c11\u4e86</p> <p>\u4e4b\u6240\u4ee5\u4f1a\u8fd9\u6837\uff0c\u662f\u56e0\u4e3a\u8bfb\u53d6\u8fd9\u4e9b\u673a\u6784\u7684\u4ee3\u7801\u90fd\u5728\u8fd0\u884c\u65f6\u5185\uff0c\u5e76\u4e14\u4f1a\u540c\u65f6\u8fdb\u884c\u66f4\u65b0</p> <p>\u575a\u6301\u4f7f\u7528 API \u662f\u5f88\u91cd\u8981\u7684\uff0c\u56e0\u4e3a\u4efb\u4f55\u89c6\u56fe\u76f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u7684\u4ee3\u7801\uff0c\u90fd\u4f1a\u968f\u7740\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u53d8\u5316\u800c\u53d8\u5f97\u4e0d\u53ef\u7528</p> <p>\u8fd9\u4e9b\u7ed3\u6784\u7684\u6240\u6709\u4fe1\u606f\u90fd\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9 API \u83b7\u5f97</p> <p><code>class_getName</code> <code>class_getSperclass</code> <code>class_copyMethodList</code></p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/WWDC2020/#wwdc2020-relative-method-list","title":"WWDC2020 Relative Method List","text":"<p>\u6bcf\u4e2a\u7c7b\u90fd\u9644\u5e26\u4e00\u4e2a\u65b9\u6cd5\u5217\u8868\uff0c\u5f53\u4f60\u5728\u7c7b\u4e0a\u7f16\u5199\u65b0\u65b9\u6cd5\u65f6\uff0c\u5b83\u5c31\u4f1a\u88ab\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\uff0c\u8fd0\u884c\u65f6\u4f7f\u7528\u8fd9\u4e9b\u5217\u8868\u6765\u89e3\u6790\u6d88\u606f\u53d1\u9001</p> <p>\u6bcf\u4e2a\u65b9\u6cd5\u90fd\u5305\u542b\u4e09\u4e2a\u4fe1\u606f</p> <ul> <li>SEL \u65b9\u6cd5\u540d\u6216\u8005\u8bf4\u53eb\u9009\u62e9\u5668\uff0c\u9009\u62e9\u5668\u662f\u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u5b83\u4eec\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u5979\u4eec\u53ef\u4ee5\u4f7f\u7528\u6307\u9488\u76f8\u7b49\u6765\u8fdb\u884c\u6bd4\u8f83</li> <li>types \u63a5\u4e0b\u6765\u662f\u65b9\u6cd5\u7684\u7c7b\u578b\u7f16\u7801\uff0c\u7528\u6765\u6807\u8bc6\u53c2\u6570\u548c\u8fd4\u56de\u503c\u7c7b\u578b\u7684\u5b57\u7b26\u4e32\uff0c\u5b83\u4e0d\u662f\u7528\u6765\u53d1\u9001\u6d88\u606f\u7684\uff0c\u4f46\u662f\u5b83\u662f\u8fd0\u884c\u65f6 introspection \u548c\u6d88\u606f forwarding \u6240\u5fc5\u987b\u7684\u4e1c\u897f</li> <li>IMP \u6307\u5411\u65b9\u6cd5\u5b9e\u73b0\u7684\u6307\u9488,\u65b9\u6cd5\u7684\u5b9e\u9645\u4ee3\u7801\uff0c\u5f53\u4f60\u7f16\u5199\u4e00\u4e2a\u65b9\u6cd5\u65f6\uff0c\u5b83\u4f1a\u88ab\u7f16\u8bd1\u6210\u4e00\u4e2a C \u51fd\u6570\uff0c\u5176\u4e2d\u5305\u542b\u4f60\u7684\u5b9e\u73b0\uff0c\u65b9\u6cd5\u5217\u8868\u4e2d\u7684 entry \u4f1a\u6307\u5411\u8be5\u51fd\u6570</li> </ul> <p>\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5177\u4f53\u7684\u65b9\u6cd5 init\uff0c\u5b83\u5305\u542b\u65b9\u6cd5\u540d\u79f0\u3001\u7c7b\u578b\u548c\u5b9e\u73b0\uff0c\u65b9\u6cd5\u5217\u8868\u4e2d\u7684\u6bcf\u4e00\u6761\u6570\u636e\u90fd\u662f\u4e00\u4e2a\u6307\u9488</p> <p>Method Lists</p> <p>init        0x00007fff7dc9bb74          8 @16@0:8     0x00007fff703f8ec7         +8 Impl        0x00007fff703cd5c2         +8                                         24</p> <p>\u572864\u4f4d\u7cfb\u7edf\u4e2d\uff0c\u610f\u5473\u7740\u6bcf\u4e2a\u65b9\u6cd5\u6761\u76ee\u5360\u752824\u4e2a\u5b57\u8282</p> <p>\u5b83\u5c5e\u4e8e clean memory\uff0c\u4f46\u662f clean memory \u5e76\u4e0d\u4ee3\u8868\u4e0d\u5360\u7528\uff0c\u5b83\u8fd8\u662f\u5fc5\u987b\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\uff0c\u5e76\u4e14\u4f7f\u7528\u65f6\u4f1a\u5360\u7528\u5185\u5b58</p> <p></p> <p>\u4e0a\u56fe\u662f\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u7684\u5185\u5b58\u65b9\u6cd5\u89c6\u56fe\uff0c\u5e76\u4e0d\u662f\u6309\u6bd4\u4f8b\u65b9\u6cd5\u7684\uff0c\u8fd9\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u9700\u898164\u4f4d\u6765\u5bfb\u5740</p> <p>\u5728\u8fd9\u4e2a\u5730\u5740\u7a7a\u95f4\u5185\uff0c\u5b83\u5212\u5206\u6210\u4e86\u51e0\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u4e3a \u6808\u3001\u5806\u3001\u53ef\u6267\u884c\u6587\u4ef6\u548c\u5e93\u6216\u8005\u4e8c\u8fdb\u5236\u6587\u4ef6\uff08\u84dd\u8272\u90e8\u5206\u8868\u793a\u7684\uff09\uff0c\u8fd9\u4e9b\u90fd\u52a0\u8f7d\u5230\u4e86\u8fdb\u7a0b\u4e2d</p> <p>\u8ba9\u6211\u4eec\u65b9\u6cd5\u5e76\u67e5\u770b\u5176\u4e2d\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6</p> <p>\u8fd9\u91cc\u6211\u4eec\u663e\u793a\u4e86\u4e09\u4e2a\u65b9\u6cd5\u6761\u76ee\uff0c\u6307\u5411\u4e86\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684\u4f4d\u7f6e</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u5c55\u793a\u4e86\u53e6\u4e00\u4e2a\u4ee3\u4ef7\uff0c\u4e8c\u8fdb\u5236\u6587\u4ef6\u53ef\u4ee5\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u7684\u4efb\u4f55\u5730\u65b9\uff0c\u8fd9\u53d6\u51b3\u4e8e\u52a8\u6001\u94fe\u63a5\u5668\u51b3\u5b9a\u628a\u5b83\u653e\u5728\u54ea\u91cc</p> <p>\u8fd9\u610f\u5473\u7740\uff0c\u94fe\u63a5\u5668\u9700\u8981\u5c06\u6307\u9488\u89e3\u6790\u5230\u6587\u4ef6\u4e2d\uff0c\u5e76\u5728\u52a0\u8f7d\u65f6\u5c06\u5176\u4fee\u6b63\u4e3a\u6307\u5411\u5176\u5728\u5185\u5b58\u4e2d\u7684\u5b9e\u9645\u4f4d\u7f6e\uff0c\u8fd9\u4e5f\u662f\u4f1a\u8017\u8d39\u6027\u80fd\u7684</p> <p>\u73b0\u5728\u8bf7\u6ce8\u610f\uff0c\u4e00\u4e2a\u6765\u81ea\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u7c7b\u65b9\u6cd5\u6761\u76ee\uff0c\u6c38\u8fdc\u6307\u5411\u4e8c\u8fdb\u5236\u6587\u4ef6\u5185\u7684\u65b9\u6cd5\u5b9e\u73b0\uff0c</p> <p>\u6211\u4eec\u4e0d\u53ef\u80fd\u4f7f\u4e00\u4e2a\u65b9\u6cd5\u7684\u5143\u6570\u636e\u5b58\u5728\u4e8e\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\uff0c\u800c\u5b9e\u73b0\u5b83\u7684\u4ee3\u7801\u5728\u53e6\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u65b9\u6cd5\u5217\u8868\u6761\u76ee\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u9700\u8981\u80fd\u591f\u5f15\u7528\u6574\u4e2a 64 \u4f4d\u5730\u5740\u7a7a\u95f4</p> <p>\u4ed6\u4eec\u53ea\u9700\u8981\u80fd\u591f\u5f15\u7528\u81ea\u5df1\u4e8c\u8fdb\u5236\u4e2d\u7684\u51fd\u6570\uff0c\u800c\u4e14\u8fd9\u4e9b\u51fd\u6570\u603b\u662f\u5728\u9644\u8fd1\uff0c\u56e0\u6b64\uff0c\u65e0\u9700\u4f7f\u7528\u7edd\u5bf9\u7684 64 \u4f4d\u5730\u5740\uff0c\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u7684 32 \u4f4d\u7684 relative offset</p> <p>\u8fd9\u4e5f\u662f\u4eca\u5e74\u505a\u7684\u4e00\u4e2a\u66f4\u6539</p> <p></p> <p>\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u597d\u5904</p> <p>\u9996\u5148\uff0c\u504f\u79fb\u91cf\u59cb\u7ec8\u662f\u76f8\u540c\u7684\uff0c\u4e0d\u7ba1\u4e8c\u8fdb\u5236\u88ab\u52a0\u8f7d\u5230\u54ea\u91cc\u7684\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5\u5728\u5b83\u4eec\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u540e\u4e0d\u9700\u8981\u8fdb\u884c\u4fee\u6b63\uff0c\u7531\u4e8e\u4e0d\u9700\u8981\u8fdb\u884c\u4fee\u6b63\uff0c\u6240\u4ee5\u5b83\u4eec\u53ef\u4ee5\u5b58\u50a8\u5728\u771f\u6b63\u7684\u53ea\u8bfb\u5185\u5b58\u4e2d\uff0c\u8fd9\u6837\u4f1a\u66f4\u5b89\u5168</p> <p>\u5f53\u7136 32 \u4e3a\u7684\u504f\u79fb\uff0c\u610f\u5473\u7740\u6211\u4eec\u5df2\u7ecf\u5c06 64 \u4f4d\u5e73\u53f0\u4e0a\u6240\u9700\u7684\u5185\u5b58\u51cf\u5c11\u4e86\u4e00\u534a\uff0c\u5728\u4e00\u53f0\u5178\u578b iPhone \u4e2d\u7684\u7cfb\u7edf\u8303\u56f4\u5185\uff0c\u6211\u4eec\u6d4b\u91cf\u4e86\u7ea6 80MB \u7684\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4eec\u7684\u5c3a\u5bf8\u51cf\u534a\uff0c\u6240\u4ee5\u6211\u4eec\u8282\u7701\u4e86 40MB \u7684\u5185\u5b58\uff0c\u8fd9\u6837 app \u5c31\u6709\u66f4\u591a\u7684\u5185\u5b58\u4ece\u800c\u8ba9\u7528\u6237\u4f53\u9a8c\u66f4\u597d</p> <p>Relative Method Lists</p> <p>init        0x0000f7cc          4 @16@0:8     0x0000de87         +4 Impl        0xfffe2428         +4                                 12</p> <p>\u4f46\u662f swizzling \u5462\uff1f</p> <p>\u4e8c\u8fdb\u5236\u4e2d\u7684\u65b9\u6cd5\u5217\u8868\u73b0\u5728\u4e0d\u80fd\u5f15\u7528\u5b8c\u6574\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u662f\u5982\u679c\u4f60 swizzle \u4e00\u4e2a\u65b9\u6cd5\uff0c\u90a3\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5b9e\u73b0\u53ef\u80fd\u5728\u4efb\u4f55\u5730\u65b9\uff0c\u800c\u4e14\uff0c\u6211\u4eec\u521a\u521a\u8bf4\u8fc7\uff0c\u6211\u4eec\u5e0c\u671b\u4fdd\u6301\u8fd9\u4e9b\u65b9\u6cd5\u5217\u8868\u4e3a\u53ea\u8bfb</p> <p>\u4e3a\u4e86\u5904\u7406\u8be5\u95ee\u9898\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5168\u5c40\u8868\uff0c\u8fd9\u4e2a\u5168\u5c40\u8868\u5c06\u65b9\u6cd5\u6620\u5c04\u5230\u5b83\u4eec\u88ab swizzle \u7684\u5b9e\u73b0\u4e0a\uff0cswizzle \u5e76\u4e0d\u5e38\u89c1\uff0c\u5b9e\u9645\u4e0a\u5927\u591a\u6570\u65b9\u6cd5\u4ece\u672a\u88ab swizzle \u8fc7\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8868\u6700\u7ec8\u4e0d\u4f1a\u53d8\u5f97\u5f88\u5927</p> <p>Even better, the table is compact. Memory is dirtied a page at a time. With the old style of method lists, swizzling a method would dirty the entire page it was on, resulting in many kilobytes of dirty memory for a single swizzle. \u66f4\u597d\u7684\u662f\uff0c\u8fd9\u4e2a\u8868\u4f1a\u5f88\u7d27\u51d1\u3002\u4f7f\u7528\u7684\u65f6\u5019\u4e00\u6b21\u53ea\u4f1a\u6c61\u67d3\u4e00\u4e2amemory page\u3002\u4f7f\u7528\u65e7\u7684\u65b9\u6cd5\u5217\u8868\uff0cswizzle \u4e00\u4e2a\u65b9\u6cd5\u4f1a\u5f04\u810f\u5b83\u6240\u5728\u7684\u6574\u4e2a\u9875\u9762\uff0c\u4e00\u6b21 swizzle \u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u5343\u5b57\u8282\u7684 dirty memory\u3002\u6709\u4e86\u8fd9\u4e2a\u5168\u5c40\u8868\uff0c\u6211\u4eec\u53ea\u9700\u4e3a\u4e00\u4e2a\u989d\u5916\u7684\u8868\u7684\u6761\u76ee\u4ed8\u51fa\u4ee3\u4ef7\uff0c\u5f53\u7136\u4f60\u5e76\u4e0d\u4f1a\u770b\u5230\u8fd9\u4e9b\u53d8\u5316\uff0c\u4e00\u5207\u90fd\u4f1a\u6309\u4ee5\u524d\u4e00\u6837\u5de5\u4f5c</p> <p>\u8fd9\u4e9b\u76f8\u5bf9\u65b9\u6cd5\u5217\u8868\u5728\u65b0\u7684OS \u7248\u672c\u4e0a\u662f\u652f\u6301\u7684 macOS Big Sur, iOS 14, tvOS 14, watchOS 7</p> <p>\u5f53\u4f7f\u7528\u76f8\u5e94\u7684\u6700\u4f4e\u76ee\u6807\u8fdb\u884c\u6784\u5efa\u65f6\uff0c\u5de5\u5177\u4f1a\u81ea\u52a8\u5728\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u751f\u6210 relative method lists</p>"},{"location":"iOS/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/WWDC2020/#tagged-pointer-format-changes","title":"Tagged Pointer Format Changes","text":"<p>arm64 \u4e0a tagged pointer \u683c\u5f0f\u7684\u53d8\u5316</p> <p>\u7531\u4e8e\u5185\u5b58\u5bf9\u9f50\uff0c\u4ee5\u53ca\u5185\u5b58\u5730\u5740\u9650\u5236\uff0c\u5b9e\u9645\u5185\u5b58\u4e2d\u5730\u5740\u7684\u4f4e\u4f4d\u53ca\u9ad8\u4f4d\u901a\u5e38\u662f\u4e0d\u4f1a\u88ab\u7528\u5230\u7684\uff0c\u6240\u4ee5\u603b\u4e3a0\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c06\u90a3\u4e9b\u4e00\u5b9a\u4e3a 0 \u7684\u4f4d\u5c06\u5176\u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u5c31\u53ef\u4ee5\u8ba9\u6211\u4eec\u77e5\u9053\uff0c\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u6b63\u7684\u5bf9\u8c61\u6307\u9488\uff0c\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u7ed9\u5176\u4ed6\u6240\u6709\u4f4d\u8d4b\u4e88\u4e00\u4e9b\u5176\u4ed6\u7684\u610f\u4e49\uff0c\u6211\u4eec\u79f0\u8fd9\u79cd\u6307\u9488\u4e3a tagged pointer</p> <p>\u4f8b\u5982 \u6211\u4eec\u53ef\u4ee5\u5728\u5176\u4ed6\u4f4d\u4e2d\u585e\u5165\u4e00\u4e2a\u6570\u503c</p> <p>\u53ea\u8981\u6211\u4eec\u60f3\u6559 NSNumber \u5982\u4f55\u8bfb\u53d6\u8fd9\u4e9b\u4f4d\uff0c\u5e76\u8ba9\u8fd0\u884c\u65f6\u9002\u5f53\u5730\u5904\u7406 tagged pointer\uff0c\u7cfb\u7edf\u7684\u5176\u4ed6\u90e8\u5206\u5c31\u53ef\u4ee5\u628a\u8fd9\u4e9b\u4e1c\u897f\u5f53\u505a\u5bf9\u8c61\u6307\u9488\u6765\u5904\u7406\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u77e5\u9053\u5176\u4e2d\u7684\u533a\u522b</p> <pre><code>[NSNumber numberWithInt:42]\n\n0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0010 1010 0001 \n</code></pre> <p>\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u6211\u4eec\u4e3a\u6bcf\u4e00\u79cd\u7c7b\u4f3c\u60c5\u51b5\u5206\u914d\u4e00\u4e2a\u5c0f\u6570\u5b57\u5bf9\u8c61\u7684\u4ee3\u4ef7\uff0c\u8fd9\u662f\u4e00\u4e2a\u91cd\u5927\u7684\u6539\u52a8</p> <p>\u987a\u4fbf\u8bf4\u4e00\u4e0b\uff0c\u8fd9\u4e9b\u503c\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u4e0e\u8fdb\u7a0b\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7684\u968f\u673a\u503c\u76f8\u7ed3\u5408\u800c\u88ab\u6df7\u6dc6\u7684\uff0c\u8fd9\u4e00\u63aa\u65bd\u4f7f\u5f97\u5f88\u96be\u4f2a\u9020 tagged pointer </p> <p>\u63a5\u4e0b\u6765\u7684\u8ba8\u8bba\u6211\u4eec\u5c06\u5ffd\u7565\u8fd9\u4e00\u70b9\uff0c\u6bd5\u7adf\u8fd9\u53ea\u662f\u5728\u9876\u5c42\u6240\u505a\u7684\u6df7\u6dc6\uff0c\u8ba9\u4f60\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u770b\u8fd9\u4e9b\u503c\u7684\u65f6\u5019\u5e76\u4e0d\u662f\u5b83\u4eec\u539f\u6709\u7684\u6837\u5b50</p> <p>xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxxx xxx1 \u6700\u4f4e\u4f4d 1\uff0c \u5012\u6570\u7b2c2-\u7b2c4\u4f4d\u4e3a Tag\uff0c \u5176\u4ed6\u4e3a payload</p> <p>\u8fd9\u5c31\u662f Intel \u4e0a tagged pointer \u7684\u5b8c\u6574\u683c\u5f0f</p> <p>\u6700\u4f4e\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u4e2a tagged pointer\uff0c\u5c31\u50cf\u6211\u4eec\u4e4b\u524d\u6240\u8bf4\uff0c\u4e00\u4e2a\u771f\u6b63\u7684\u6307\u9488\uff0c\u8fd9\u4e2a\u4f4d\u5fc5\u987b\u59cb\u7ec8\u4e3a 0\uff0c\u6240\u4ee5\u8fd9\u6837\u53ef\u4ee5\u533a\u5206\u5f00</p> <p>\u63a5\u4e0b\u6765\u4e09\u4f4d\u662f\u6807\u7b7e\u4f4d\uff0c\u7528\u6765\u8868\u793a tagged pointer \u7684\u7c7b\u578b\uff0c\u4f8b\u5982 3 \u8868\u793a\u5b83\u662f\u4e00\u4e2a NSNumber\uff0c 6\u8868\u793a \u5b83\u662f\u4e00\u4e2a NSData</p> <p>\u7531\u4e8e\u6211\u4eec\u6709 3 \u4e2a\u6807\u7b7e\u4f4d\uff0c\u6240\u4ee5\u6709 8 \u4e2d\u53ef\u80fd\u7684\u6807\u7b7e\u7c7b\u578b</p> <p>\u5269\u4e0b\u7684\u4e8b\u6709\u6548\u8d1f\u8f7d\uff0c\u8fd9\u662f\u7279\u5b9a\u7c7b\u578b\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u7684\u6570\u636e\uff0c\u5bf9\u4e8e\u6807\u8bb0\u7684 NSNumber \u8fd9\u662f\u5b9e\u9645\u7684\u6570\u5b57</p> <p>\u73b0\u5728\uff0c\u5bf9\u4e8e\u6807\u7b7e 7 \u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u5904\u7406\uff0c\u5b83\u8868\u793a\u4e00\u4e2a\u6269\u5c55\u6807\u7b7e\uff0c\u6269\u5c55\u6807\u7b7e\u4f7f\u7528\u63a5\u4e0b\u6765\u7684 8 \u4f4d\u6765\u7f16\u7801\u7c7b\u578b\uff0c\u8fd9\u5141\u8bb8\u591a\u51fa 256 \u4e2a\u6807\u7b7e\u7c7b\u578b\uff0c\u4f46\u662f\u4ee3\u4ef7\u662f\u51cf\u5c11\u4e86\u6709\u6548\u8d1f\u8f7d</p> <p>\u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5c06 tagged pointer \u7528\u4e8e\u66f4\u591a\u7684\u7c7b\u578b\uff0c\u53ea\u8981\u4ed6\u4eec\u53ef\u4ee5\u5c06\u5176\u6570\u636e\u88c5\u5165\u66f4\u5c0f\u7684\u7a7a\u95f4\uff0c\u8fd9\u53ef\u4ee5\u7528\u4e8e\u4e00\u4e9b\u4e1c\u897f\uff0c\u4f8b\u5982\u7528\u6237\u754c\u9762\u7684 colors \u6216\u8005 NSIndexSets</p> <p>\u53ea\u6709runtime \u7ef4\u62a4\u8fd9 Apple \u53ef\u4ee5\u4f7f\u7528 tagged pointer\uff0c\u5f53\u7136\u5982\u679c\u4f60\u662f\u4e00\u4e2a Swift \u7a0b\u5e8f\u5458\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5df1\u521b\u5efa tagged pointer \u7c7b\u578b</p> <p>\u5982\u679c\u4f60\u66fe\u7ecf\u4f7f\u7528\u8fc7\u4e00\u4e2a\u5177\u6709\u5173\u8054\u503c\u7684\u679a\u4e3e\uff0c\u8fd9\u5c31\u662f\u4e00\u4e2a\u7c7b\u4f3c\u4e8e tagged pointer \u7684\u7c7b\uff0cSwift \u8fd0\u884c\u65f6\u5c06\u679a\u4e3e\u5224\u522b\u5668\u50a8\u5b58\u5728\u5173\u8054\u503c\u7684\u6709\u6548\u8d1f\u8f7d\u7684\u5907\u7528\u4f4d\u4e2d</p> <p>\u800c\u4e14 Swift \u5bf9\u503c\u7c7b\u578b\u7684\u4f7f\u7528\uff0c\u5b9e\u9645\u4e0a\u4f7f\u5f97 tagged pointer \u53d8\u5f97\u6ca1\u6709\u90a3\u4e48\u91cd\u8981\u4e86\uff0c\u56e0\u4e3a\u503c\u4e0d\u518d\u9700\u8981\u5b8c\u5168\u662f\u6307\u9488\u7684\u5927\u5c0f</p> <p>\u4f8b\u5982 Swift UUID \u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u4e24\u4e2a\u5b57\u5e76\u4fdd\u6301\u5185\u8054\uff0c\u800c\u4e0d\u662f\u5206\u914d\u4e00\u4e2a\u5355\u72ec\u7684\u5bf9\u8c61\uff0c\u56e0\u4e3a\u5b83\u4e0d\u9002\u5408\u5728\u4e00\u4e2a\u6307\u9488\u91cc\u9762\u3002</p> <p>\u8fd9\u5c31\u662f Intel \u7684 tagged pointer</p> <p>\u8ba9\u6211\u4eec\u6765\u770b\u770b ARM \u7684</p> <p>\u5728 ARM \u4e0a\uff0c\u5b9e\u9645\u662f\u53cd\u8fc7\u6765\u7684\uff0c\u6700\u9ad8\u4f4d\u8bbe\u7f6e\u4e3a 1 \u800c\u4e0d\u662f\u6700\u4f4e\u4f4d\uff0c\u7136\u540e\u63a5\u4e0b\u6765\u4e09\u4f4d\u662f\u6807\u7b7e\u53f7\uff0c\u6709\u6548\u8d1f\u8f7d\u4f7f\u7528\u5269\u4f59\u4f4d</p> <p>\u4e3a\u5565\u8981\u5728 ARM \u4e0a\u4f7f\u7528\u9876\u90e8\u4e3a\u6765\u8868\u793a tagged pointer \u5462\uff0c\u5b9e\u9645\u4e0a\u662f\u5bf9 objc_msgSend \u7684\u4e00\u4e2a\u5c0f\u4f18\u5316</p> <p>\u6211\u4eec\u5e0c\u671b msgSend \u4e2d\u6700\u5e38\u89c1\u7684\u8def\u5f84\u53ef\u4ee5\u5c3d\u53ef\u80fd\u7684\u5feb\uff0c\u6700\u5e38\u89c1\u7684\u8def\u5f84\u662f\u4e00\u4e2a\u666e\u901a\u7684\u6307\u9488</p> <p>\u4f46\u662f\u6709\u4e24\u79cd\u4e0d\u5e38\u89c1\u7684\u573a\u666f\uff0ctagged pointer  \u548c nil</p> <p>\u4e8b\u5b9e\u8bc1\u660e\uff0c\u5f53\u6211\u4e48\u4f7f\u7528\u6700\u9ad8\u4f4d\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u6b21\u6bd4\u8f83\u5bf9\u7740\u4e24\u4e2a\u8fdb\u884c\u68c0\u67e5\uff0c\u76f8\u6bd4\u4e8e\u5206\u5f00\u6bd4\u8f83 tagged pointer \u548c nil \u8fd9\u5c31\u4e3a msgSend \u4e2d\u7684\u5e38\u89c1\u60c5\u51b5\u8282\u7701\u4e86\u4e00\u4e2a\u6761\u4ef6\u5206\u652f</p> <p>\u548c Intel \u76f8\u540c\uff0c\u5bf9\u4e8e\u6807\u7b7e 7 \u6211\u4eec\u6709\u4e00\u4e2a\u7279\u6b8a\u60c5\u51b5\uff0c\u63a5\u4e0b\u6765\u7684 8 \u4e3a\u88ab\u7528\u4f5c\u6269\u5c55\u6807\u7b7e\uff0c\u7136\u540e\u5269\u4e0b\u7684\u4f4d\u7528\u4e8e\u6709\u6548\u8d1f\u8f7d</p> <p>iOS 13\u4e4b\u524d\u5982\u524d\u9762\u6240\u8bf4</p> <p>\u4f46\u662f \u4e4b\u540e</p> <p>\u6700\u9ad8\u4f4d\u4e3a\u4ecd\u7136\u8bbe\u7f6e\u4e3a 1 \u6765\u4fdd\u8bc1 msgSend \u7684\u4f18\u5316\uff0c\u7136\u540e \u6700\u4f4e\u4e09\u4f4d\u4e3a\u6807\u7b7e\u4f4d\uff0c\u5982\u679c\u4f7f\u7528\u6269\u5c55\u6807\u7b7e\uff0c\u90a3\u4e48\u5b83\u4f1a\u5360\u636e\u6700\u9ad8\u4f4d\u4e4b\u540e\u7684 8 \u4f4d</p> <p>\u4e3a\u5565\u8981\u8fd9\u6837\u505a\u5462\uff0c</p> <p>\u6211\u4eec\u6765\u770b\u6b63\u5e38\u7684\u6307\u9488</p> <p>\u6211\u4eec\u73b0\u6709\u7684\u5de5\u5177\uff0c\u6bd4\u5982\u52a8\u6001\u94fe\u63a5\uff0c\u4f1a\u5ffd\u7565\u6307\u9488\u524d 8 \u4f4d\uff0c\u8fd9\u662f\u7531\u4e8e\u4e00\u4e2a\u540d\u4e3a Top Byte Ignore \u7684 ARM \u7279\u6027\uff0c\u6211\u4eec\u628a\u6269\u5c55\u6807\u7b7e\u653e\u5728 Top Byte Ignore \u4f4d\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5bf9\u5176\u6307\u9488\uff0c\u5e95\u90e8 3 \u4e2a\u4f4d\u603b\u662f 0\uff0c</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u5728\u6307\u9488\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5c0f\u6570\u5b57 7\uff0c\u5c06\u4f4e\u4f4d\u8bbe\u7f6e\u4e3a 1\uff0c\uff087 \u6807\u8bc6\u8fd9\u662f\u4e00\u4e2a\u6269\u5c55\u6807\u7b7e\uff09\uff0c\u8fd9\u610f\u5473\u7740\u6211\u4eec\u5b9e\u9645\u4e0a\u53ef\u4ee5\u5c06\u4e0a\u9762\u7684\u8fd9\u4e2a\u6307\u9488\uff0c\u653e\u5165\u4e00\u4e2a\u6269\u5c55\u6807\u7b7e\u6307\u9488\u7684\u6709\u6548\u8d1f\u8f7d\u4e2d\uff0c\u8fd9\u4e2a\u7ed3\u679c\u662f \u4e00\u4e2a tagged pointer \u4ee5\u53ca\u5176\u6709\u6548\u8d1f\u8f7d\u4e2d\u5305\u542b\u4e00\u4e2a\u6b63\u5e38\u6307\u9488</p> <p>\u4e3a\u4ec0\u4e48\u5b83\u4f1a\u6709\u7528\u5462\uff0c\u5b83\u5f00\u542f\u4e86 tagged pointer \u7684\u80fd\u529b\uff0c\u5f15\u7528\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u5e38\u91cf\u6570\u636e\u7684\u80fd\u529b\uff0c\u4f8b\u5982\u5b57\u7b26\u4e32\u6216\u5176\u4ed6\u6570\u636e\u7ed3\u6784\uff0c\u5426\u5219\u5b83\u4eec\u5c06\u4e0d\u5f97\u4e0d\u5360\u7528 dirty memory</p>"},{"location":"macOS%20Related/setup_new_device/","title":"Setup new device","text":""},{"location":"macOS%20Related/setup_new_device/#command-line-tools","title":"command line tools","text":"<p>xcode-select --install</p>"},{"location":"macOS%20Related/setup_new_device/#_1","title":"\u663e\u793a\u9690\u85cf\u6587\u4ef6","text":"<pre><code>defaults write com.apple.finder AppleShowAllFiles -bool true\nkillall finder\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#brew","title":"brew \u5305\u7ba1\u7406\u5de5\u5177","text":"<pre><code>sudo /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#zsh","title":"zsh","text":"<pre><code>sudo sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#shell-correct","title":"shell correct","text":"<pre><code>brew install thefuck\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#ruby-version-manager","title":"ruby version manager,","text":"<p>you can install and manage ruby env with this tools macOS build-in ruby may not proide some of the header files,  which will cause some of the gem lib such as: cocapods fastlane fail install</p> <pre><code>brew install rbenv\n</code></pre> <p>add eval \"$(rbenv init -)\" into shell config file like: \".bash_profile\", \".zshrc\" etc.</p> <pre><code>rbenv install 2.7.8\nrbenv global 2.7.8\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#nvm-node-version-manager","title":"nvm node version manager","text":"<pre><code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash\n\nnvm install 12/14/16\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#a-simple-http-server","title":"a simple http-server\uff0c","text":"<p>you can use it to start up a simple http server (transform files in interal network or something else)</p> <pre><code>npm install http-server -g\n</code></pre>"},{"location":"macOS%20Related/setup_new_device/#_2","title":"\u817e\u8baf\u5783\u573e\u6e05\u7406\u5de5\u5177","text":"<p>https://lemon.qq.com</p>"},{"location":"macOS%20Related/setup_new_device/#go2shella-tool-can-add-to-finder-tool-bar","title":"go2shell\uff0ca tool can add to finder tool bar","text":"<p>which can start a new terminal in current directory https://zipzapmac.com/go2shell</p>"},{"location":"macOS%20Related/setup_new_device/#swich-default-shell-such-as-sh-zsh-etc","title":"swich default shell such as: sh, zsh etc.","text":"<p><code>chsh</code></p>"},{"location":"%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/","title":"Ffmpeg\u5220\u9664\u89c6\u9891\u4e2d\u7684\u97f3\u9891\u6d41","text":""},{"location":"%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/#ffmpeg","title":"ffmpeg","text":"<pre><code>ffmpeg -i input.mkv -map 0 -map -0:a:0 -c copy output.mkv\n</code></pre> <p>\u8fd9\u6761\u547d\u4ee4\u4f7f\u7528 ffmpeg \u4ece input.mkv \u6587\u4ef6\u751f\u6210\u4e00\u4e2a\u65b0\u7684 output.mkv \u6587\u4ef6\uff0c\u5e76\u5220\u9664\u4e86\u7b2c\u4e00\u6761\u97f3\u9891\u6d41\uff0c\u4ee5\u4e0b\u662f\u89e3\u6790\uff1a</p> <p><code>-i input.mkv</code> \u6307\u5b9a\u8f93\u5165\u6587\u4ef6 input.mkv\u3002</p> <p><code>-map 0</code> \u6620\u5c04\u8f93\u5165\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u6d41\uff08\u89c6\u9891\u3001\u97f3\u9891\u3001\u5b57\u5e55\u7b49\uff09\u5230\u8f93\u51fa\u3002</p> <p><code>-map -0:a:0</code> \u6392\u9664\u8f93\u5165\u6587\u4ef6\u4e2d\u7684\u7b2c\u4e00\u4e2a\u97f3\u9891\u6d41\uff080:a:0\uff09\uff0c\u5373\u5220\u9664\u7b2c\u4e00\u4e2a\u97f3\u9891\u6d41\u3002 -map \u7684 - \u524d\u7f00\u8868\u793a\u6392\u9664\u3002</p> <p><code>-c copy</code> \u5bf9\u6240\u6709\u6620\u5c04\u5230\u8f93\u51fa\u6587\u4ef6\u7684\u6d41\u4f7f\u7528\u201c\u6d41\u62f7\u8d1d\u201d\u6a21\u5f0f\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u4f1a\u91cd\u65b0\u7f16\u7801\uff0c\u53ea\u590d\u5236\u6d41\u3002\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u5904\u7406\u901f\u5ea6\u5e76\u4fdd\u6301\u8d28\u91cf\u3002</p> <p><code>output.mkv</code> \u6307\u5b9a\u8f93\u51fa\u6587\u4ef6\u540d\u3002</p>"},{"location":"%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/#_1","title":"\u6548\u679c","text":"<p>\u751f\u6210\u7684 output1.mkv \u6587\u4ef6\u5c06\u5305\u542b in2.mkv \u7684\u6240\u6709\u6d41\uff0c\u9664\u7b2c\u4e00\u4e2a\u97f3\u9891\u6d41\u5916\u3002 \u8fd9\u5bf9\u4e8e\u9700\u8981\u8c03\u6574\u6587\u4ef6\u4e2d\u5305\u542b\u7684\u6d41\uff08\u6bd4\u5982\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u97f3\u9891\u8f68\u9053\uff09\u975e\u5e38\u6709\u6548\uff0c\u540c\u65f6\u4e5f\u907f\u514d\u4e86\u91cd\u65b0\u7f16\u7801\u7684\u65f6\u95f4\u548c\u8d28\u91cf\u635f\u5931\u3002</p>"},{"location":"%E6%9D%82/ffmpeg%E5%88%A0%E9%99%A4%E8%A7%86%E9%A2%91%E4%B8%AD%E7%9A%84%E9%9F%B3%E9%A2%91%E6%B5%81/#_2","title":"\u6ce8\u610f","text":"<p>\u5982\u679c\u9700\u8981\u66f4\u6539\u7684\u5185\u5bb9\u591a\uff0c\u8bf7\u786e\u4fdd\u97f3\u9891\u6216\u89c6\u9891\u8f68\u9053\u7684\u7f16\u53f7\u6b63\u786e\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b\uff1a</p> <pre><code>ffmpeg -i input.mkv\n</code></pre> <p>\u8fd9\u4f1a\u5217\u51fa\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u6d41\u4fe1\u606f\uff08\u5305\u62ec\u7f16\u53f7\u548c\u7c7b\u578b\uff09\u3002 </p>"},{"location":"%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/","title":"postgreSQL\u914d\u7f6e\u8fdc\u7a0b\u8bbf\u95ee","text":"<p>mac \u5b89\u88c5\u5b8c postgreSQL \u540e\u4f7f\u7528 ip \u8fde\u63a5\u62a5\u4ee5\u4e0b\u9519\u8bef</p> <pre><code>FATAL: no pg_hba.conf entry for host \"10.96.1.11\", user \"postgres\", database\n\"postgres\", SSL off\n</code></pre>"},{"location":"%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/#ip-postgresql","title":"\u7531\u4e8e\u6ca1\u6709\u6b63\u786e\u914d\u7f6e\u8fdc\u7a0b\u8fde\u63a5\uff0c\u5bfc\u81f4\u65e0\u6cd5\u4f7f\u7528 ip \u8fde\u63a5 postgreSQL","text":"<p>\u9700\u8981\u5728 <code>pg_hba.conf</code> \u6587\u4ef6\u4e2d\u914d\u7f6e\u9700\u8981\u8fdc\u7a0b\u8fde\u63a5\u6570\u636e\u5e93\u7684\u5ba2\u6237\u7aef\u7684\u5730\u5740</p>"},{"location":"%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/#mac","title":"mac \u4e0b\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u6587\u4ef6\u5939\u6743\u9650","text":"<p>\u7531\u4e8e mac \u4e0b\u7535\u8111\u7528\u6237\u65e0\u8bbf\u95ee\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u6587\u4ef6\u5939\u7684\u5168\u9009\uff0c\u6240\u4ee5\u9700\u8981\u5207\u6362\u5230 postgreSQL \u7528\u6237\u8fdb\u5165\u6587\u4ef6\u5939\u5e76\u7f16\u8f91\u6587\u4ef6</p>"},{"location":"%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/#mac_1","title":"mac \u4e0b\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u8def\u5f84","text":"<p><code>/Library/PostgreSQL/16/data</code></p>"},{"location":"%E6%9D%82/postgreSQL%E9%85%8D%E7%BD%AE%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE/#_1","title":"\u4fee\u6539\u914d\u7f6e\u6587\u4ef6","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>sudo -u postgres bash</code> \u547d\u4ee4\u5207\u6362\u5230 postgres\uff08\u6570\u636e\u5e93\u7528\u6237\u540d\uff09 \u7528\u6237\u6765\u6267\u884c\u547d\u4ee4</p> <p>\u5207\u6362\u5230 <code>/Library/PostgreSQL/16/data</code> \u8def\u5f84</p> <p>\u4f7f\u7528 <code>vim pg_hba.conf</code> \u6253\u5f00\u5e76\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u6dfb\u52a0\u5ba2\u6237\u7aef ip </p> <p>\u6700\u540e\u5207\u6362\u5230 <code>/Library/PostgreSQL/16/bin</code> \u76ee\u5f55\uff0c\u6267\u884c <code>./pg_ctl reload -D /Library/PostgreSQL/16/data</code>\uff0c\u518d\u6b21\u5c1d\u8bd5\u8fde\u63a5\u5373\u53ef</p>"},{"location":"%E6%9D%82/shell%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%96%87%E4%BB%B6%E5%B9%B6%E9%87%8D%E5%91%BD%E5%90%8D/","title":"Shell\u904d\u5386\u6587\u4ef6\u5939\u4e2d\u6587\u4ef6\u5e76\u91cd\u547d\u540d","text":""},{"location":"%E6%9D%82/shell%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E6%96%87%E4%BB%B6%E5%B9%B6%E9%87%8D%E5%91%BD%E5%90%8D/#shell","title":"shell \u904d\u5386\u6587\u4ef6\u4ef6\u4e2d\u6587\u4ef6\u5e76\u91cd\u547d\u540d","text":"<pre><code>#!/bin/bash\nsearch_rename(){\n    # \u53c2\u6570\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4\u5982\u679c\u6587\u4ef6\u6216\u6587\u4ef6\u5939\u6709\u7a7a\u683c\u7684\u8bdd\u4f1a\u5c06\u5176\u5206\u5272\u5904\u7406\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u5206\u9694\u7b26\uff0c\u5ffd\u7565\u7a7a\u683c\n    IFS=$'\\t\\n'\n    # \u904d\u5386\n    for file in `ls -a \"$1\"`\n    do\n        # \u62fc\u63a5\u8def\u5f84\uff0c\u7528\u4e8e\u540e\u7eed\u904d\u5386\u6216\u6539\u540d\n        source=\"$1/$file\"\n        # \u5982\u679c\u662f\u6587\u4ef6\u5939\uff0c\u90a3\u4e48\u5219\u9012\u5f52\u8c03\u7528\n        if [ -d $source ]\n        then\n            if [[ $file != '.' &amp;&amp; $file != '..' ]]\n            then\n                read_dir $source\n            fi\n        else # \u5426\u5219\u7684\u8bdd\u5e38\u8bc6\u91cd\u547d\u540d\uff0c\u6b64\u5904\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a\u6761\u4ef6\u6765\u5224\u65ad\u662f\u5426\u8fdb\u884c\u91cd\u547d\u540d\u64cd\u4f5c\n            echo $source\n            # sed \u4f1a\u5c06\u7ba1\u9053\u5148\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u6839\u636e\u540e\u9762\u7684\u8868\u8fbe\u5f0f\u8fdb\u884c\u66ff\u6362\n            # s/&lt;source&gt;/&lt;target&gt;/g \u4e0d\u5199 g \u7684\u8bdd\u4f1a\u66ff\u6362\u7b2c\u4e00\u4e2a\uff0c\u5426\u5219\u5339\u914d\u7684\u5168\u90e8\u66ff\u6362\n            target=`echo $source | sed 's/test/t_/g'`\n            # \u76ee\u6807\u6587\u4ef6\u540d\n            echo \"target: $target\"\n            # \u4f7f\u7528 mv \u91cd\u547d\u540d\n            mv $source \"$target\"\n        fi\n    done\n}\n\n#\u6d4b\u8bd5\u76ee\u5f55 test\n# \u7a0b\u5e8f\u5165\u53e3\nsearch_rename test\n</code></pre>"},{"location":"%E6%9D%82/%E4%BD%BF%E7%94%A8%20rmagick%20%E4%BB%8E%20pdf%20%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/","title":"\u4f7f\u7528 rmagick \u4ece pdf \u5bfc\u51fa\u56fe\u7247\u6a21\u7cca\u7684\u95ee\u9898","text":""},{"location":"%E6%9D%82/%E4%BD%BF%E7%94%A8%20rmagick%20%E4%BB%8E%20pdf%20%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/#rmagick","title":"Rmagick","text":"<p>RMagick\u662fRuby\u8bed\u8a00\u8ddfImageMagick\u56fe\u5f62\u5904\u7406\u7a0b\u5e8f\u4e4b\u95f4\u7684\u63a5\u53e3\uff0cRuby\u7a0b\u5e8f\u53ef\u4ee5\u5229\u7528RMagick\u5bf9\u56fe\u50cf\u8fdb\u884c\u7f29\u7565\u3001\u526a\u88c1\u7b49\u7b49\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002</p>"},{"location":"%E6%9D%82/%E4%BD%BF%E7%94%A8%20rmagick%20%E4%BB%8E%20pdf%20%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/#pdf-image","title":"pdf \u8f6c image \u56fe\u7247\u6a21\u7cca","text":"<p>\u53ef\u4ee5\u901a\u8fc7image \u7684\u4e24\u4e2a\u53c2\u6570\u6765\u8c03\u6574\uff1a</p> <p>density\uff0c\u6bcf\u82f1\u5bf8\u5185\u50cf\u7d20\u70b9\u6570\uff0c\u8d8a\u5927\u56fe\u7247\u8d28\u91cf\u8d8a\u9ad8\uff0c\u9ed8\u8ba4 75 quality\uff0c\u56fe\u7247\u8d28\u91cf\uff0c1-100\uff0c\u8d8a\u5927\u8d28\u91cf\u8d8a\u9ad8</p>"},{"location":"%E6%9D%82/%E4%BD%BF%E7%94%A8%20rmagick%20%E4%BB%8E%20pdf%20%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A8%A1%E7%B3%8A%E7%9A%84%E9%97%AE%E9%A2%98/#code","title":"code","text":"<pre><code># \u5f53\u7136\u8981\u4f7f\u7528 rmagick \u9700\u8981\u5728\u7535\u8111\u5b89\u88c5 imagemagick\nrequire 'rmagick'\ndef 2pdf \n    # \u8bfb\u53d6\u5f53\u524d\u6587\u4ef6\u5939\u4e2d\u7684 pdf \u6587\u4ef6\n    pdfs=Dir.glob(File.join(Dir.pwd(), \"**/*.pdf\"))\n    # \u904d\u5386\n    for pdf in pdfs do\n        current+=1\n        # \u83b7\u53d6\u6587\u4ef6\u540d\u79f0\uff08\u4e0d\u5305\u542b .pdf \u6269\u5c55\u540d\uff09\n        filename = File.basename(pdf, '.pdf')\n        puts \"start to convert #{current}/#{total_count}, name: #{filename}\"\n        # \u8bfb\u53d6 pdf \u6587\u4ef6\u4e2d\u7684 imageList\uff0c\u5e76\u8bbe\u7f6e\u56fe\u50cf\u683c\u5f0f\u8d28\u91cf\u7b49\u53c2\u6570\n        image_list = Magick::ImageList.new(pdf){|op|\n            # \u50cf\u7d20\u5bc6\u5ea6\n            op.density = \"200\"\n            # \u8d28\u91cf\n            op.quality = 50\n            # \u683c\u5f0f\n            op.format = \"jpg\"\n        }\n        # \u5c06\u56fe\u7247\u8f93\u51fa\u5230\u6307\u5b9a\u6587\u4ef6\u5939\n        image_list.each_with_index do |image, index|\n            puts \"current page index #{index+1}...\"\n            image.write(\"#{target_path}/#{filename}_#{index+1}.jpg\")\n        end\n    end\nend\n</code></pre> <p>imageMagic \u5b98\u7f51\uff1a imageMagic</p> <p>rmagick doc\uff1a rmagick</p>"}]}